(()=>{var e=[,(e,t,i)=>{"use strict";i.r(t),i.d(t,{ActivityReceivedEventArgs:()=>n.ActivityReceivedEventArgs,AudioConfig:()=>n.AudioConfig,AudioFormatTag:()=>n.AudioFormatTag,AudioInputStream:()=>n.AudioInputStream,AudioOutputStream:()=>n.AudioOutputStream,AudioStreamFormat:()=>n.AudioStreamFormat,AutoDetectSourceLanguageConfig:()=>n.AutoDetectSourceLanguageConfig,AutoDetectSourceLanguageResult:()=>n.AutoDetectSourceLanguageResult,AvatarConfig:()=>n.AvatarConfig,AvatarEventArgs:()=>n.AvatarEventArgs,AvatarSynthesizer:()=>n.AvatarSynthesizer,AvatarVideoFormat:()=>n.AvatarVideoFormat,AvatarWebRTCConnectionResult:()=>n.AvatarWebRTCConnectionResult,BaseAudioPlayer:()=>n.BaseAudioPlayer,BotFrameworkConfig:()=>n.BotFrameworkConfig,CancellationDetails:()=>n.CancellationDetails,CancellationDetailsBase:()=>n.CancellationDetailsBase,CancellationErrorCode:()=>n.CancellationErrorCode,CancellationReason:()=>n.CancellationReason,Connection:()=>n.Connection,ConnectionEventArgs:()=>n.ConnectionEventArgs,ConnectionMessage:()=>n.ConnectionMessage,ConnectionMessageEventArgs:()=>n.ConnectionMessageEventArgs,Conversation:()=>n.Conversation,ConversationExpirationEventArgs:()=>n.ConversationExpirationEventArgs,ConversationParticipantsChangedEventArgs:()=>n.ConversationParticipantsChangedEventArgs,ConversationTranscriber:()=>n.ConversationTranscriber,ConversationTranscriptionCanceledEventArgs:()=>n.ConversationTranscriptionCanceledEventArgs,ConversationTranscriptionEventArgs:()=>n.ConversationTranscriptionEventArgs,ConversationTranscriptionResult:()=>n.ConversationTranscriptionResult,ConversationTranslationCanceledEventArgs:()=>n.ConversationTranslationCanceledEventArgs,ConversationTranslationEventArgs:()=>n.ConversationTranslationEventArgs,ConversationTranslationResult:()=>n.ConversationTranslationResult,ConversationTranslator:()=>n.ConversationTranslator,Coordinate:()=>n.Coordinate,CustomCommandsConfig:()=>n.CustomCommandsConfig,Diagnostics:()=>n.Diagnostics,DialogServiceConfig:()=>n.DialogServiceConfig,DialogServiceConnector:()=>n.DialogServiceConnector,IntentRecognitionCanceledEventArgs:()=>n.IntentRecognitionCanceledEventArgs,IntentRecognitionEventArgs:()=>n.IntentRecognitionEventArgs,IntentRecognitionResult:()=>n.IntentRecognitionResult,IntentRecognizer:()=>n.IntentRecognizer,KeywordRecognitionModel:()=>n.KeywordRecognitionModel,LanguageIdMode:()=>n.LanguageIdMode,LanguageUnderstandingModel:()=>n.LanguageUnderstandingModel,LogLevel:()=>n.LogLevel,Meeting:()=>n.Meeting,MeetingTranscriber:()=>n.MeetingTranscriber,MeetingTranscriptionCanceledEventArgs:()=>n.MeetingTranscriptionCanceledEventArgs,MeetingTranscriptionEventArgs:()=>n.MeetingTranscriptionEventArgs,NoMatchDetails:()=>n.NoMatchDetails,NoMatchReason:()=>n.NoMatchReason,OutputFormat:()=>n.OutputFormat,Participant:()=>n.Participant,ParticipantChangedReason:()=>n.ParticipantChangedReason,PhraseListGrammar:()=>n.PhraseListGrammar,ProfanityOption:()=>n.ProfanityOption,PronunciationAssessmentConfig:()=>n.PronunciationAssessmentConfig,PronunciationAssessmentGradingSystem:()=>n.PronunciationAssessmentGradingSystem,PronunciationAssessmentGranularity:()=>n.PronunciationAssessmentGranularity,PronunciationAssessmentResult:()=>n.PronunciationAssessmentResult,PropertyCollection:()=>n.PropertyCollection,PropertyId:()=>n.PropertyId,PullAudioInputStream:()=>n.PullAudioInputStream,PullAudioInputStreamCallback:()=>n.PullAudioInputStreamCallback,PullAudioOutputStream:()=>n.PullAudioOutputStream,PushAudioInputStream:()=>n.PushAudioInputStream,PushAudioOutputStream:()=>n.PushAudioOutputStream,PushAudioOutputStreamCallback:()=>n.PushAudioOutputStreamCallback,RecognitionEventArgs:()=>n.RecognitionEventArgs,RecognitionResult:()=>n.RecognitionResult,Recognizer:()=>n.Recognizer,ResultReason:()=>n.ResultReason,ServiceEventArgs:()=>n.ServiceEventArgs,ServicePropertyChannel:()=>n.ServicePropertyChannel,SessionEventArgs:()=>n.SessionEventArgs,SourceLanguageConfig:()=>n.SourceLanguageConfig,SpeakerAudioDestination:()=>n.SpeakerAudioDestination,SpeakerIdentificationModel:()=>n.SpeakerIdentificationModel,SpeakerRecognitionCancellationDetails:()=>n.SpeakerRecognitionCancellationDetails,SpeakerRecognitionResult:()=>n.SpeakerRecognitionResult,SpeakerRecognitionResultType:()=>n.SpeakerRecognitionResultType,SpeakerRecognizer:()=>n.SpeakerRecognizer,SpeakerVerificationModel:()=>n.SpeakerVerificationModel,SpeechConfig:()=>n.SpeechConfig,SpeechConfigImpl:()=>n.SpeechConfigImpl,SpeechRecognitionCanceledEventArgs:()=>n.SpeechRecognitionCanceledEventArgs,SpeechRecognitionEventArgs:()=>n.SpeechRecognitionEventArgs,SpeechRecognitionResult:()=>n.SpeechRecognitionResult,SpeechRecognizer:()=>n.SpeechRecognizer,SpeechSynthesisBookmarkEventArgs:()=>n.SpeechSynthesisBookmarkEventArgs,SpeechSynthesisBoundaryType:()=>n.SpeechSynthesisBoundaryType,SpeechSynthesisEventArgs:()=>n.SpeechSynthesisEventArgs,SpeechSynthesisOutputFormat:()=>n.SpeechSynthesisOutputFormat,SpeechSynthesisResult:()=>n.SpeechSynthesisResult,SpeechSynthesisVisemeEventArgs:()=>n.SpeechSynthesisVisemeEventArgs,SpeechSynthesisWordBoundaryEventArgs:()=>n.SpeechSynthesisWordBoundaryEventArgs,SpeechSynthesizer:()=>n.SpeechSynthesizer,SpeechTranslationConfig:()=>n.SpeechTranslationConfig,SpeechTranslationConfigImpl:()=>n.SpeechTranslationConfigImpl,SynthesisResult:()=>n.SynthesisResult,SynthesisVoicesResult:()=>n.SynthesisVoicesResult,Synthesizer:()=>n.Synthesizer,TranslationRecognitionCanceledEventArgs:()=>n.TranslationRecognitionCanceledEventArgs,TranslationRecognitionEventArgs:()=>n.TranslationRecognitionEventArgs,TranslationRecognitionResult:()=>n.TranslationRecognitionResult,TranslationRecognizer:()=>n.TranslationRecognizer,TranslationSynthesisEventArgs:()=>n.TranslationSynthesisEventArgs,TranslationSynthesisResult:()=>n.TranslationSynthesisResult,Translations:()=>n.Translations,TurnStatusReceivedEventArgs:()=>n.TurnStatusReceivedEventArgs,User:()=>n.User,VoiceInfo:()=>n.VoiceInfo,VoiceProfile:()=>n.VoiceProfile,VoiceProfileCancellationDetails:()=>n.VoiceProfileCancellationDetails,VoiceProfileClient:()=>n.VoiceProfileClient,VoiceProfileEnrollmentCancellationDetails:()=>n.VoiceProfileEnrollmentCancellationDetails,VoiceProfileEnrollmentResult:()=>n.VoiceProfileEnrollmentResult,VoiceProfilePhraseResult:()=>n.VoiceProfilePhraseResult,VoiceProfileResult:()=>n.VoiceProfileResult,VoiceProfileType:()=>n.VoiceProfileType});var r=i(2),n=i(3);new r.AgentConfig},(e,t,i)=>{"use strict";i.r(t),i.d(t,{AgentConfig:()=>r});class r{toJsonString(){return JSON.stringify(this.iPrivConfig)}get(){return this.iPrivConfig}set(e){this.iPrivConfig=e}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ActivityReceivedEventArgs:()=>X.ActivityReceivedEventArgs,AudioConfig:()=>r.AudioConfig,AudioFormatTag:()=>n.AudioFormatTag,AudioInputStream:()=>s.AudioInputStream,AudioOutputStream:()=>o.AudioOutputStream,AudioStreamFormat:()=>n.AudioStreamFormat,AutoDetectSourceLanguageConfig:()=>ue.AutoDetectSourceLanguageConfig,AutoDetectSourceLanguageResult:()=>ve.AutoDetectSourceLanguageResult,AvatarConfig:()=>$e.AvatarConfig,AvatarEventArgs:()=>Qe.AvatarEventArgs,AvatarSynthesizer:()=>Xe.AvatarSynthesizer,AvatarVideoFormat:()=>Ze.AvatarVideoFormat,AvatarWebRTCConnectionResult:()=>Ye.AvatarWebRTCConnectionResult,BaseAudioPlayer:()=>te.BaseAudioPlayer,BotFrameworkConfig:()=>G.BotFrameworkConfig,CancellationDetails:()=>U.CancellationDetails,CancellationDetailsBase:()=>q.CancellationDetailsBase,CancellationErrorCode:()=>W.CancellationErrorCode,CancellationReason:()=>a.CancellationReason,Connection:()=>K.Connection,ConnectionEventArgs:()=>H.ConnectionEventArgs,ConnectionMessage:()=>re.ConnectionMessage,ConnectionMessageEventArgs:()=>ie.ConnectionMessageEventArgs,Conversation:()=>me.Conversation,ConversationExpirationEventArgs:()=>Se.ConversationExpirationEventArgs,ConversationParticipantsChangedEventArgs:()=>fe.ConversationParticipantsChangedEventArgs,ConversationTranscriber:()=>Ie.ConversationTranscriber,ConversationTranscriptionCanceledEventArgs:()=>We.ConversationTranscriptionCanceledEventArgs,ConversationTranscriptionEventArgs:()=>C.ConversationTranscriptionEventArgs,ConversationTranscriptionResult:()=>Te.ConversationTranscriptionResult,ConversationTranslationCanceledEventArgs:()=>Ce.ConversationTranslationCanceledEventArgs,ConversationTranslationEventArgs:()=>ye.ConversationTranslationEventArgs,ConversationTranslationResult:()=>Re.ConversationTranslationResult,ConversationTranslator:()=>Pe.ConversationTranslator,Coordinate:()=>Ze.Coordinate,CustomCommandsConfig:()=>$.CustomCommandsConfig,Diagnostics:()=>et.Diagnostics,DialogServiceConfig:()=>j.DialogServiceConfig,DialogServiceConnector:()=>Q.DialogServiceConnector,IntentRecognitionCanceledEventArgs:()=>_.IntentRecognitionCanceledEventArgs,IntentRecognitionEventArgs:()=>l.IntentRecognitionEventArgs,IntentRecognitionResult:()=>S.IntentRecognitionResult,IntentRecognizer:()=>O.IntentRecognizer,KeywordRecognitionModel:()=>h.KeywordRecognitionModel,LanguageIdMode:()=>Ge.LanguageIdMode,LanguageUnderstandingModel:()=>f.LanguageUnderstandingModel,LogLevel:()=>tt.EventType,Meeting:()=>we.Meeting,MeetingTranscriber:()=>Ae.MeetingTranscriber,MeetingTranscriptionCanceledEventArgs:()=>He.MeetingTranscriptionCanceledEventArgs,MeetingTranscriptionEventArgs:()=>C.MeetingTranscriptionEventArgs,NoMatchDetails:()=>F.NoMatchDetails,NoMatchReason:()=>L.NoMatchReason,OutputFormat:()=>v.OutputFormat,Participant:()=>Ee.Participant,ParticipantChangedReason:()=>De.ParticipantChangedReason,PhraseListGrammar:()=>J.PhraseListGrammar,ProfanityOption:()=>ee.ProfanityOption,PronunciationAssessmentConfig:()=>Je.PronunciationAssessmentConfig,PronunciationAssessmentGradingSystem:()=>Ve.PronunciationAssessmentGradingSystem,PronunciationAssessmentGranularity:()=>Ke.PronunciationAssessmentGranularity,PronunciationAssessmentResult:()=>je.PronunciationAssessmentResult,PropertyCollection:()=>D.PropertyCollection,PropertyId:()=>b.PropertyId,PullAudioInputStream:()=>s.PullAudioInputStream,PullAudioInputStreamCallback:()=>c.PullAudioInputStreamCallback,PullAudioOutputStream:()=>o.PullAudioOutputStream,PushAudioInputStream:()=>s.PushAudioInputStream,PushAudioOutputStream:()=>o.PushAudioOutputStream,PushAudioOutputStreamCallback:()=>p.PushAudioOutputStreamCallback,RecognitionEventArgs:()=>u.RecognitionEventArgs,RecognitionResult:()=>g.RecognitionResult,Recognizer:()=>k.Recognizer,ResultReason:()=>w.ResultReason,ServiceEventArgs:()=>V.ServiceEventArgs,ServicePropertyChannel:()=>Y.ServicePropertyChannel,SessionEventArgs:()=>d.SessionEventArgs,SourceLanguageConfig:()=>le.SourceLanguageConfig,SpeakerAudioDestination:()=>Ue.SpeakerAudioDestination,SpeakerIdentificationModel:()=>he.SpeakerIdentificationModel,SpeakerRecognitionCancellationDetails:()=>ge.SpeakerRecognitionCancellationDetails,SpeakerRecognitionResult:()=>ge.SpeakerRecognitionResult,SpeakerRecognitionResultType:()=>ge.SpeakerRecognitionResultType,SpeakerRecognizer:()=>pe.SpeakerRecognizer,SpeakerVerificationModel:()=>de.SpeakerVerificationModel,SpeechConfig:()=>A.SpeechConfig,SpeechConfigImpl:()=>A.SpeechConfigImpl,SpeechRecognitionCanceledEventArgs:()=>y.SpeechRecognitionCanceledEventArgs,SpeechRecognitionEventArgs:()=>C.SpeechRecognitionEventArgs,SpeechRecognitionResult:()=>m.SpeechRecognitionResult,SpeechRecognizer:()=>M.SpeechRecognizer,SpeechSynthesisBookmarkEventArgs:()=>Le.SpeechSynthesisBookmarkEventArgs,SpeechSynthesisBoundaryType:()=>Be.SpeechSynthesisBoundaryType,SpeechSynthesisEventArgs:()=>ze.SpeechSynthesisEventArgs,SpeechSynthesisOutputFormat:()=>ke.SpeechSynthesisOutputFormat,SpeechSynthesisResult:()=>Ne.SpeechSynthesisResult,SpeechSynthesisVisemeEventArgs:()=>Fe.SpeechSynthesisVisemeEventArgs,SpeechSynthesisWordBoundaryEventArgs:()=>xe.SpeechSynthesisWordBoundaryEventArgs,SpeechSynthesizer:()=>Me.SpeechSynthesizer,SpeechTranslationConfig:()=>E.SpeechTranslationConfig,SpeechTranslationConfigImpl:()=>E.SpeechTranslationConfigImpl,SynthesisResult:()=>Oe.SynthesisResult,SynthesisVoicesResult:()=>_e.SynthesisVoicesResult,Synthesizer:()=>be.Synthesizer,TranslationRecognitionCanceledEventArgs:()=>B.TranslationRecognitionCanceledEventArgs,TranslationRecognitionEventArgs:()=>R.TranslationRecognitionEventArgs,TranslationRecognitionResult:()=>I.TranslationRecognitionResult,TranslationRecognizer:()=>z.TranslationRecognizer,TranslationSynthesisEventArgs:()=>P.TranslationSynthesisEventArgs,TranslationSynthesisResult:()=>T.TranslationSynthesisResult,Translations:()=>x.Translations,TurnStatusReceivedEventArgs:()=>Z.TurnStatusReceivedEventArgs,User:()=>Ee.User,VoiceInfo:()=>qe.VoiceInfo,VoiceProfile:()=>ne.VoiceProfile,VoiceProfileCancellationDetails:()=>oe.VoiceProfileCancellationDetails,VoiceProfileClient:()=>ce.VoiceProfileClient,VoiceProfileEnrollmentCancellationDetails:()=>se.VoiceProfileEnrollmentCancellationDetails,VoiceProfileEnrollmentResult:()=>se.VoiceProfileEnrollmentResult,VoiceProfilePhraseResult:()=>ae.VoiceProfilePhraseResult,VoiceProfileResult:()=>oe.VoiceProfileResult,VoiceProfileType:()=>N.VoiceProfileType});var r=i(4),n=i(27),s=i(30),o=i(33),a=i(40),c=i(29),p=i(39),h=i(41),d=i(42),u=i(43),v=i(44),l=i(45),g=i(46),m=i(47),S=i(48),f=i(49),C=i(50),y=i(51),R=i(53),P=i(54),I=i(55),T=i(56),w=i(57),A=i(58),E=i(190),D=i(60),b=i(59),k=i(143),M=i(191),O=i(192),N=i(186),z=i(193),x=i(114),L=i(194),F=i(195),B=i(113),_=i(125),q=i(182),U=i(196),W=i(91),H=i(158),V=i(161),K=i(147),J=i(197),j=i(130),G=i(198),$=i(199),Q=i(200),X=i(132),Z=i(133),Y=i(202),ee=i(189),te=i(203),ie=i(159),re=i(160),ne=i(204),se=i(185),oe=i(188),ae=i(187),ce=i(205),pe=i(206),he=i(207),de=i(208),ue=i(209),ve=i(211),le=i(212),ge=i(181),me=i(213),Se=i(169),fe=i(214),Ce=i(164),ye=i(216),Re=i(171),Pe=i(218),Ie=i(221),Te=i(118),we=i(222),Ae=i(223),Ee=i(217),De=i(215),be=i(224),ke=i(35),Me=i(225),Oe=i(152),Ne=i(151),ze=i(176),xe=i(155),Le=i(156),Fe=i(157),Be=i(228),_e=i(226),qe=i(227),Ue=i(31),We=i(119),He=i(121),Ve=i(229),Ke=i(230),Je=i(231),je=i(232),Ge=i(210),$e=i(233),Qe=i(174),Xe=i(235),Ze=i(234),Ye=i(236),et=i(237),tt=i(20)},(e,t,i)=>{"use strict";i.r(t),i.d(t,{AudioConfig:()=>v,AudioConfigImpl:()=>l,AudioOutputConfigImpl:()=>g});var r=i(5),n=i(8),s=i(28),o=i(36),a=i(29),c=i(30),p=i(31),h=i(39),d=i(33),u=i(37);class v{static fromDefaultMicrophoneInput(){const e=new r.PcmRecorder(!0);return new l(new n.MicAudioSource(e))}static fromMicrophoneInput(e){const t=new r.PcmRecorder(!0);return new l(new n.MicAudioSource(t,e))}static fromWavFileInput(e,t="unnamedBuffer.wav"){return new l(new s.FileAudioSource(e,t))}static fromStreamInput(e){if(e instanceof a.PullAudioInputStreamCallback)return new l(new c.PullAudioInputStreamImpl(e));if(e instanceof c.AudioInputStream)return new l(e);if("undefined"!=typeof MediaStream&&e instanceof MediaStream){const t=new r.PcmRecorder(!1);return new l(new n.MicAudioSource(t,null,null,e))}throw new Error("Not Supported Type")}static fromDefaultSpeakerOutput(){return new g(new p.SpeakerAudioDestination)}static fromSpeakerOutput(e){if(void 0===e)return v.fromDefaultSpeakerOutput();if(e instanceof p.SpeakerAudioDestination)return new g(e);throw new Error("Not Supported Type")}static fromAudioFileOutput(e){return new g(new u.AudioFileWriter(e))}static fromStreamOutput(e){if(e instanceof h.PushAudioOutputStreamCallback)return new g(new d.PushAudioOutputStreamImpl(e));if(e instanceof d.PushAudioOutputStream)return new g(e);if(e instanceof d.PullAudioOutputStream)return new g(e);throw new Error("Not Supported Type")}}class l extends v{constructor(e){super(),this.privSource=e}get format(){return this.privSource.format}close(e,t){this.privSource.turnOff().then((()=>{e&&e()}),(e=>{t&&t(e)}))}id(){return this.privSource.id()}turnOn(){return this.privSource.turnOn()}attach(e){return this.privSource.attach(e)}detach(e){return this.privSource.detach(e)}turnOff(){return this.privSource.turnOff()}get events(){return this.privSource.events}setProperty(e,t){if(o.Contracts.throwIfNull(t,"value"),void 0===this.privSource.setProperty)throw new Error("This AudioConfig instance does not support setting properties.");this.privSource.setProperty(e,t)}getProperty(e,t){if(void 0!==this.privSource.getProperty)return this.privSource.getProperty(e,t);throw new Error("This AudioConfig instance does not support getting properties.")}get deviceInfo(){return this.privSource.deviceInfo}}class g extends v{constructor(e){super(),this.privDestination=e}set format(e){this.privDestination.format=e}write(e){this.privDestination.write(e)}close(){this.privDestination.close()}id(){return this.privDestination.id()}setProperty(){throw new Error("This AudioConfig instance does not support setting properties.")}getProperty(){throw new Error("This AudioConfig instance does not support getting properties.")}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{PcmRecorder:()=>n});var r=i(6);class n{constructor(e){this.privStopInputOnRelease=e}record(e,t,n){const s=new r.RiffPcmEncoder(e.sampleRate,16e3),o=e.createMediaStreamSource(t),a=()=>{const i=(()=>{let t=0;try{return e.createScriptProcessor(t,1,1)}catch(i){t=2048;let r=e.sampleRate;for(;t<16384&&r>=32e3;)t<<=1,r>>=1;return e.createScriptProcessor(t,1,1)}})();i.onaudioprocess=e=>{const t=e.inputBuffer.getChannelData(0);if(n&&!n.isClosed){const e=s.encode(t);e&&n.writeStreamChunk({buffer:e,isEnd:!1,timeReceived:Date.now()})}},o.connect(i),i.connect(e.destination),this.privMediaResources={scriptProcessorNode:i,source:o,stream:t}},c=e=>{const i=new AudioWorkletNode(e,"speech-processor");i.port.onmessage=e=>{const t=e.data;if(n&&!n.isClosed){const e=s.encode(t);e&&n.writeStreamChunk({buffer:e,isEnd:!1,timeReceived:Date.now()})}},o.connect(i),i.connect(e.destination),this.privMediaResources={scriptProcessorNode:i,source:o,stream:t}},p=!!this.privSpeechProcessorScript&&"ignore"===this.privSpeechProcessorScript.toLowerCase();if(e.audioWorklet&&!p)this.privSpeechProcessorScript=new URL(i(7),i.b).toString(),e.audioWorklet.addModule(this.privSpeechProcessorScript).then((()=>{c(e)})).catch((()=>{const t=new Blob(["class SP extends AudioWorkletProcessor {\n                        constructor(options) {\n                        super(options);\n                        }\n                        process(inputs, outputs) {\n                        const input = inputs[0];\n                        const output = [];\n                        for (let channel = 0; channel < input.length; channel += 1) {\n                            output[channel] = input[channel];\n                        }\n                        this.port.postMessage(output[0]);\n                        return true;\n                        }\n                    }\n                    registerProcessor('speech-processor', SP);"],{type:"application/javascript; charset=utf-8"});this.privSpeechProcessorScript=URL.createObjectURL(t),e.audioWorklet.addModule(this.privSpeechProcessorScript).then((()=>{c(e)})).catch((()=>{a()}))}));else try{a()}catch(e){throw new Error(`Unable to start audio worklet node for PCMRecorder: ${e}`)}}releaseMediaResources(e){this.privMediaResources&&(this.privMediaResources.scriptProcessorNode&&(this.privMediaResources.scriptProcessorNode.disconnect(e.destination),this.privMediaResources.scriptProcessorNode=null),this.privMediaResources.source&&(this.privMediaResources.source.disconnect(),this.privStopInputOnRelease&&this.privMediaResources.stream.getTracks().forEach((e=>e.stop())),this.privMediaResources.source=null))}setWorkletUrl(e){this.privSpeechProcessorScript=e}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{RiffPcmEncoder:()=>r});class r{constructor(e,t){this.privActualSampleRate=e,this.privDesiredSampleRate=t}encode(e){const t=this.downSampleAudioFrame(e,this.privActualSampleRate,this.privDesiredSampleRate);if(!t)return null;const i=2*t.length,r=new ArrayBuffer(i),n=new DataView(r);return this.floatTo16BitPCM(n,0,t),r}setString(e,t,i){for(let r=0;r<i.length;r++)e.setUint8(t+r,i.charCodeAt(r))}floatTo16BitPCM(e,t,i){for(let r=0;r<i.length;r++,t+=2){const n=Math.max(-1,Math.min(1,i[r]));e.setInt16(t,n<0?32768*n:32767*n,!0)}}downSampleAudioFrame(e,t,i){if(!e)return null;if(i===t||i>t)return e;const r=t/i,n=Math.round(e.length/r),s=new Float32Array(n);let o=0,a=0;for(;a<n;){const t=Math.round((a+1)*r);let i=0,n=0;for(;o<t&&o<e.length;)i+=e[o++],n++;s[a++]=i/n}return s}}},(e,t,i)=>{"use strict";e.exports=i.p+"d0c01add081a582b6eb0.js"},(e,t,i)=>{"use strict";i.r(t),i.d(t,{AudioWorkletSourceURLPropertyName:()=>u,MicAudioSource:()=>v});var r=i(21),n=i(9),s=i(16),o=i(18),a=i(19),c=i(22),p=i(26),h=i(27),d=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};const u="MICROPHONE-WorkletSourceUrl";class v{constructor(e,t,i,r){this.privRecorder=e,this.deviceId=t,this.privStreams={},this.privOutputChunkSize=v.AUDIOFORMAT.avgBytesPerSec/10,this.privId=i||(0,n.createNoDashGuid)(),this.privEvents=new s.EventSource,this.privMediaStream=r||null,this.privIsClosing=!1}get format(){return Promise.resolve(v.AUDIOFORMAT)}turnOn(){if(this.privInitializeDeferral)return this.privInitializeDeferral.promise;this.privInitializeDeferral=new o.Deferred;try{this.createAudioContext()}catch(e){if(e instanceof Error){const t=e;this.privInitializeDeferral.reject(t.name+": "+t.message)}else this.privInitializeDeferral.reject(e);return this.privInitializeDeferral.promise}const e=window.navigator;let t=e.getUserMedia||e.webkitGetUserMedia||e.mozGetUserMedia||e.msGetUserMedia;if(e.mediaDevices&&(t=(t,i,r)=>{e.mediaDevices.getUserMedia(t).then(i).catch(r)}),t){const e=()=>{this.onEvent(new a.AudioSourceInitializingEvent(this.privId)),this.privMediaStream&&this.privMediaStream.active?(this.onEvent(new a.AudioSourceReadyEvent(this.privId)),this.privInitializeDeferral.resolve()):t({audio:!this.deviceId||{deviceId:this.deviceId},video:!1},(e=>{this.privMediaStream=e,this.onEvent(new a.AudioSourceReadyEvent(this.privId)),this.privInitializeDeferral.resolve()}),(e=>{const t=`Error occurred during microphone initialization: ${e}`;this.privInitializeDeferral.reject(t),this.onEvent(new a.AudioSourceErrorEvent(this.privId,t))}))};"suspended"===this.privContext.state?this.privContext.resume().then(e).catch((e=>{this.privInitializeDeferral.reject(`Failed to initialize audio context: ${e}`)})):e()}else{const e="Browser does not support getUserMedia.";this.privInitializeDeferral.reject(e),this.onEvent(new a.AudioSourceErrorEvent(e,""))}return this.privInitializeDeferral.promise}id(){return this.privId}attach(e){return this.onEvent(new a.AudioStreamNodeAttachingEvent(this.privId,e)),this.listen(e).then((t=>(this.onEvent(new a.AudioStreamNodeAttachedEvent(this.privId,e)),{detach:()=>d(this,void 0,void 0,(function*(){return t.readEnded(),delete this.privStreams[e],this.onEvent(new a.AudioStreamNodeDetachedEvent(this.privId,e)),this.turnOff()})),id:()=>e,read:()=>t.read()})))}detach(e){e&&this.privStreams[e]&&(this.privStreams[e].close(),delete this.privStreams[e],this.onEvent(new a.AudioStreamNodeDetachedEvent(this.privId,e)))}turnOff(){return d(this,void 0,void 0,(function*(){for(const e in this.privStreams)if(e){const t=this.privStreams[e];t&&t.close()}this.onEvent(new a.AudioSourceOffEvent(this.privId)),this.privInitializeDeferral&&(yield this.privInitializeDeferral,this.privInitializeDeferral=null),yield this.destroyAudioContext()}))}get events(){return this.privEvents}get deviceInfo(){return this.getMicrophoneLabel().then((e=>({bitspersample:v.AUDIOFORMAT.bitsPerSample,channelcount:v.AUDIOFORMAT.channels,connectivity:r.connectivity.Unknown,manufacturer:"Speech SDK",model:e,samplerate:v.AUDIOFORMAT.samplesPerSec,type:r.type.Microphones})))}setProperty(e,t){if(e!==u)throw new Error("Property '"+e+"' is not supported on Microphone.");this.privRecorder.setWorkletUrl(t)}getMicrophoneLabel(){const e="microphone";if(void 0!==this.privMicrophoneLabel)return Promise.resolve(this.privMicrophoneLabel);if(void 0===this.privMediaStream||!this.privMediaStream.active)return Promise.resolve(e);this.privMicrophoneLabel=e;const t=this.privMediaStream.getTracks()[0].getSettings().deviceId;if(void 0===t)return Promise.resolve(this.privMicrophoneLabel);const i=new o.Deferred;return navigator.mediaDevices.enumerateDevices().then((e=>{for(const i of e)if(i.deviceId===t){this.privMicrophoneLabel=i.label;break}i.resolve(this.privMicrophoneLabel)}),(()=>i.resolve(this.privMicrophoneLabel))),i.promise}listen(e){return d(this,void 0,void 0,(function*(){yield this.turnOn();const t=new c.ChunkedArrayBufferStream(this.privOutputChunkSize,e);this.privStreams[e]=t;try{this.privRecorder.record(this.privContext,this.privMediaStream,t)}catch(t){throw this.onEvent(new a.AudioStreamNodeErrorEvent(this.privId,e,t)),t}return t}))}onEvent(e){this.privEvents.onEvent(e),p.Events.instance.onEvent(e)}createAudioContext(){this.privContext||(this.privContext=h.AudioStreamFormatImpl.getAudioContext(v.AUDIOFORMAT.samplesPerSec))}destroyAudioContext(){return d(this,void 0,void 0,(function*(){if(!this.privContext)return;this.privRecorder.releaseMediaResources(this.privContext);let e=!1;"close"in this.privContext&&(e=!0),e?this.privIsClosing||(this.privIsClosing=!0,yield this.privContext.close(),this.privContext=null,this.privIsClosing=!1):null!==this.privContext&&"running"===this.privContext.state&&(yield this.privContext.suspend())}))}}v.AUDIOFORMAT=h.AudioStreamFormat.getDefaultInputFormat()},(e,t,i)=>{"use strict";i.r(t),i.d(t,{createGuid:()=>n,createNoDashGuid:()=>s});var r=i(10);const n=()=>(0,r.default)(),s=()=>n().replace(new RegExp("-","g"),"").toUpperCase()},(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var r=i(11),n=i(12),s=i(13);const o=function(e,t,i){if(r.default.randomUUID&&!t&&!e)return r.default.randomUUID();const o=(e=e||{}).random||(e.rng||n.default)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){i=i||0;for(let e=0;e<16;++e)t[i+e]=o[e];return t}return(0,s.unsafeStringify)(o)}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>r});const r={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)}},(e,t,i)=>{"use strict";let r;i.r(t),i.d(t,{default:()=>s});const n=new Uint8Array(16);function s(){if(!r&&(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!r))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(n)}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o,unsafeStringify:()=>s});var r=i(14);const n=[];for(let e=0;e<256;++e)n.push((e+256).toString(16).slice(1));function s(e,t=0){return(n[e[t+0]]+n[e[t+1]]+n[e[t+2]]+n[e[t+3]]+"-"+n[e[t+4]]+n[e[t+5]]+"-"+n[e[t+6]]+n[e[t+7]]+"-"+n[e[t+8]]+n[e[t+9]]+"-"+n[e[t+10]]+n[e[t+11]]+n[e[t+12]]+n[e[t+13]]+n[e[t+14]]+n[e[t+15]]).toLowerCase()}const o=function(e,t=0){const i=s(e,t);if(!(0,r.default)(i))throw TypeError("Stringified UUID is invalid");return i}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>n});var r=i(15);const n=function(e){return"string"==typeof e&&r.default.test(e)}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>r});const r=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},(e,t,i)=>{"use strict";i.r(t),i.d(t,{EventSource:()=>s});var r=i(17),n=i(9);class s{constructor(e){this.privEventListeners={},this.privIsDisposed=!1,this.privConsoleListener=void 0,this.privMetadata=e}onEvent(e){if(this.isDisposed())throw new r.ObjectDisposedError("EventSource");if(this.metadata)for(const t in this.metadata)t&&e.metadata&&(e.metadata[t]||(e.metadata[t]=this.metadata[t]));for(const t in this.privEventListeners)t&&this.privEventListeners[t]&&this.privEventListeners[t](e)}attach(e){const t=(0,n.createNoDashGuid)();return this.privEventListeners[t]=e,{detach:()=>(delete this.privEventListeners[t],Promise.resolve())}}attachListener(e){return this.attach((t=>e.onEvent(t)))}attachConsoleListener(e){return this.privConsoleListener&&this.privConsoleListener.detach(),this.privConsoleListener=this.attach((t=>e.onEvent(t))),this.privConsoleListener}isDisposed(){return this.privIsDisposed}dispose(){this.privEventListeners=null,this.privIsDisposed=!0}get metadata(){return this.privMetadata}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ArgumentNullError:()=>r,InvalidOperationError:()=>n,ObjectDisposedError:()=>s});class r extends Error{constructor(e){super(e),this.name="ArgumentNull",this.message=e}}class n extends Error{constructor(e){super(e),this.name="InvalidOperation",this.message=e}}class s extends Error{constructor(e,t){super(t),this.name=e+"ObjectDisposed",this.message=t}}},(e,t,i)=>{"use strict";var r;i.r(t),i.d(t,{Deferred:()=>o,PromiseResult:()=>n,PromiseResultEventSource:()=>s,PromiseState:()=>r,Sink:()=>a,marshalPromiseToCallbacks:()=>c}),function(e){e[e.None=0]="None",e[e.Resolved=1]="Resolved",e[e.Rejected=2]="Rejected"}(r||(r={}));class n{constructor(e){this.throwIfError=()=>{if(this.isError)throw this.error},e.on((e=>{this.privIsCompleted||(this.privIsCompleted=!0,this.privIsError=!1,this.privResult=e)}),(e=>{this.privIsCompleted||(this.privIsCompleted=!0,this.privIsError=!0,this.privError=e)}))}get isCompleted(){return this.privIsCompleted}get isError(){return this.privIsError}get error(){return this.privError}get result(){return this.privResult}}class s{constructor(){this.setResult=e=>{this.privOnSetResult(e)},this.setError=e=>{this.privOnSetError(e)},this.on=(e,t)=>{this.privOnSetResult=e,this.privOnSetError=t}}}class o{constructor(){this.resolve=e=>(this.privResolve(e),this),this.reject=e=>(this.privReject(e),this),this.privPromise=new Promise(((e,t)=>{this.privResolve=e,this.privReject=t}))}get promise(){return this.privPromise}}class a{constructor(){this.privState=r.None,this.privPromiseResult=null,this.privPromiseResultEvents=null,this.privSuccessHandlers=[],this.privErrorHandlers=[],this.privPromiseResultEvents=new s,this.privPromiseResult=new n(this.privPromiseResultEvents)}get state(){return this.privState}get result(){return this.privPromiseResult}resolve(e){if(this.privState!==r.None)throw new Error("'Cannot resolve a completed promise'");this.privState=r.Resolved,this.privPromiseResultEvents.setResult(e);for(let t=0;t<this.privSuccessHandlers.length;t++)this.executeSuccessCallback(e,this.privSuccessHandlers[t],this.privErrorHandlers[t]);this.detachHandlers()}reject(e){if(this.privState!==r.None)throw new Error("'Cannot reject a completed promise'");this.privState=r.Rejected,this.privPromiseResultEvents.setError(e);for(const t of this.privErrorHandlers)this.executeErrorCallback(e,t);this.detachHandlers()}on(e,t){null==e&&(e=()=>{}),this.privState===r.None?(this.privSuccessHandlers.push(e),this.privErrorHandlers.push(t)):(this.privState===r.Resolved?this.executeSuccessCallback(this.privPromiseResult.result,e,t):this.privState===r.Rejected&&this.executeErrorCallback(this.privPromiseResult.error,t),this.detachHandlers())}executeSuccessCallback(e,t,i){try{t(e)}catch(e){this.executeErrorCallback(`'Unhandled callback error: ${e}'`,i)}}executeErrorCallback(e,t){if(!t)throw new Error(`'Unhandled error: ${e}'`);try{t(e)}catch(t){throw new Error(`'Unhandled callback error: ${t}. InnerError: ${e}'`)}}detachHandlers(){this.privErrorHandlers=[],this.privSuccessHandlers=[]}}function c(e,t,i){e.then((e=>{try{t&&t(e)}catch(e){if(i)try{if(e instanceof Error){const t=e;i(t.name+": "+t.message)}else i(e)}catch(e){}}}),(e=>{if(i)try{if(e instanceof Error){const t=e;i(t.name+": "+t.message)}else i(e)}catch(e){}}))}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{AudioSourceErrorEvent:()=>c,AudioSourceEvent:()=>n,AudioSourceInitializingEvent:()=>s,AudioSourceOffEvent:()=>a,AudioSourceReadyEvent:()=>o,AudioStreamNodeAttachedEvent:()=>d,AudioStreamNodeAttachingEvent:()=>h,AudioStreamNodeDetachedEvent:()=>u,AudioStreamNodeErrorEvent:()=>v,AudioStreamNodeEvent:()=>p});var r=i(20);class n extends r.PlatformEvent{constructor(e,t,i=r.EventType.Info){super(e,i),this.privAudioSourceId=t}get audioSourceId(){return this.privAudioSourceId}}class s extends n{constructor(e){super("AudioSourceInitializingEvent",e)}}class o extends n{constructor(e){super("AudioSourceReadyEvent",e)}}class a extends n{constructor(e){super("AudioSourceOffEvent",e)}}class c extends n{constructor(e,t){super("AudioSourceErrorEvent",e,r.EventType.Error),this.privError=t}get error(){return this.privError}}class p extends n{constructor(e,t,i){super(e,t),this.privAudioNodeId=i}get audioNodeId(){return this.privAudioNodeId}}class h extends p{constructor(e,t){super("AudioStreamNodeAttachingEvent",e,t)}}class d extends p{constructor(e,t){super("AudioStreamNodeAttachedEvent",e,t)}}class u extends p{constructor(e,t){super("AudioStreamNodeDetachedEvent",e,t)}}class v extends p{constructor(e,t,i){super("AudioStreamNodeErrorEvent",e,t),this.privError=i}get error(){return this.privError}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{EventType:()=>r,PlatformEvent:()=>s});var r,n=i(9);!function(e){e[e.Debug=0]="Debug",e[e.Info=1]="Info",e[e.Warning=2]="Warning",e[e.Error=3]="Error",e[e.None=4]="None"}(r||(r={}));class s{constructor(e,t){this.privName=e,this.privEventId=(0,n.createNoDashGuid)(),this.privEventTime=(new Date).toISOString(),this.privEventType=t,this.privMetadata={}}get name(){return this.privName}get eventId(){return this.privEventId}get eventTime(){return this.privEventTime}get eventType(){return this.privEventType}get metadata(){return this.privMetadata}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{Context:()=>n,Device:()=>a,OS:()=>o,SpeechServiceConfig:()=>r,System:()=>s,connectivity:()=>c,type:()=>p});class r{constructor(e){this.context=e}serialize(){return JSON.stringify(this,((e,t)=>{if(t&&"object"==typeof t&&!Array.isArray(t)){const e={};for(const i in t)Object.hasOwnProperty.call(t,i)&&(e[i&&i.charAt(0).toLowerCase()+i.substring(1)]=t[i]);return e}return t}))}get Context(){return this.context}get Recognition(){return this.recognition}set Recognition(e){this.recognition=e.toLowerCase()}}class n{constructor(e){this.system=new s,this.os=e}}class s{constructor(){this.name="SpeechSDK",this.version="1.33.1",this.build="JavaScript",this.lang="JavaScript"}}class o{constructor(e,t,i){this.platform=e,this.name=t,this.version=i}}class a{constructor(e,t,i){this.manufacturer=e,this.model=t,this.version=i}}var c,p;!function(e){e.Bluetooth="Bluetooth",e.Wired="Wired",e.WiFi="WiFi",e.Cellular="Cellular",e.InBuilt="InBuilt",e.Unknown="Unknown"}(c||(c={})),function(e){e.Phone="Phone",e.Speaker="Speaker",e.Car="Car",e.Headset="Headset",e.Thermostat="Thermostat",e.Microphones="Microphones",e.Deskphone="Deskphone",e.RemoteControl="RemoteControl",e.Unknown="Unknown",e.File="File",e.Stream="Stream"}(p||(p={}))},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ChunkedArrayBufferStream:()=>n});var r=i(23);class n extends r.Stream{constructor(e,t){super(t),this.privTargetChunkSize=e,this.privNextBufferReadyBytes=0}writeStreamChunk(e){if(e.isEnd||0===this.privNextBufferReadyBytes&&e.buffer.byteLength===this.privTargetChunkSize)return void super.writeStreamChunk(e);let t=0;for(;t<e.buffer.byteLength;){void 0===this.privNextBufferToWrite&&(this.privNextBufferToWrite=new ArrayBuffer(this.privTargetChunkSize),this.privNextBufferStartTime=e.timeReceived);const i=Math.min(e.buffer.byteLength-t,this.privTargetChunkSize-this.privNextBufferReadyBytes),r=new Uint8Array(this.privNextBufferToWrite),n=new Uint8Array(e.buffer.slice(t,i+t));r.set(n,this.privNextBufferReadyBytes),this.privNextBufferReadyBytes+=i,t+=i,this.privNextBufferReadyBytes===this.privTargetChunkSize&&(super.writeStreamChunk({buffer:this.privNextBufferToWrite,isEnd:!1,timeReceived:this.privNextBufferStartTime}),this.privNextBufferReadyBytes=0,this.privNextBufferToWrite=void 0)}}close(){0===this.privNextBufferReadyBytes||this.isClosed||super.writeStreamChunk({buffer:this.privNextBufferToWrite.slice(0,this.privNextBufferReadyBytes),isEnd:!1,timeReceived:this.privNextBufferStartTime}),super.close()}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{Stream:()=>a});var r=i(17),n=i(9),s=i(24),o=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class a{constructor(e){this.privIsWriteEnded=!1,this.privIsReadEnded=!1,this.privId=e||(0,n.createNoDashGuid)(),this.privReaderQueue=new s.Queue}get isClosed(){return this.privIsWriteEnded}get isReadEnded(){return this.privIsReadEnded}get id(){return this.privId}close(){this.privIsWriteEnded||(this.writeStreamChunk({buffer:null,isEnd:!0,timeReceived:Date.now()}),this.privIsWriteEnded=!0)}writeStreamChunk(e){if(this.throwIfClosed(),!this.privReaderQueue.isDisposed())try{this.privReaderQueue.enqueue(e)}catch(e){}}read(){if(this.privIsReadEnded)throw new r.InvalidOperationError("Stream read has already finished");return this.privReaderQueue.dequeue().then((e=>o(this,void 0,void 0,(function*(){return(void 0===e||e.isEnd)&&(yield this.privReaderQueue.dispose("End of stream reached")),e}))))}readEnded(){this.privIsReadEnded||(this.privIsReadEnded=!0,this.privReaderQueue=new s.Queue)}throwIfClosed(){if(this.privIsWriteEnded)throw new r.InvalidOperationError("Stream closed")}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{Queue:()=>c});var r,n=i(17),s=i(25),o=i(18),a=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};!function(e){e[e.Dequeue=0]="Dequeue",e[e.Peek=1]="Peek"}(r||(r={}));class c{constructor(e){this.privPromiseStore=new s.List,this.privIsDrainInProgress=!1,this.privIsDisposing=!1,this.privDisposeReason=null,this.privList=e||new s.List,this.privDetachables=[],this.privSubscribers=new s.List,this.privDetachables.push(this.privList.onAdded((()=>this.drain())))}enqueue(e){this.throwIfDispose(),this.enqueueFromPromise(new Promise((t=>t(e))))}enqueueFromPromise(e){this.throwIfDispose(),e.then((e=>{this.privList.add(e)}),(()=>{}))}dequeue(){this.throwIfDispose();const e=new o.Deferred;return this.privSubscribers&&(this.privSubscribers.add({deferral:e,type:r.Dequeue}),this.drain()),e.promise}peek(){this.throwIfDispose();const e=new o.Deferred;return this.privSubscribers&&(this.privSubscribers.add({deferral:e,type:r.Peek}),this.drain()),e.promise}length(){return this.throwIfDispose(),this.privList.length()}isDisposed(){return null==this.privSubscribers}drainAndDispose(e,t){return a(this,void 0,void 0,(function*(){if(!this.isDisposed()&&!this.privIsDisposing){this.privDisposeReason=t,this.privIsDisposing=!0;const i=this.privSubscribers;if(i){for(;i.length()>0;){i.removeFirst().deferral.resolve(void 0)}this.privSubscribers===i&&(this.privSubscribers=i)}for(const e of this.privDetachables)yield e.detach();if(this.privPromiseStore.length()>0&&e){const t=[];return this.privPromiseStore.toArray().forEach((e=>{t.push(e)})),Promise.all(t).finally((()=>{this.privSubscribers=null,this.privList.forEach((t=>{e(t)})),this.privList=null})).then()}this.privSubscribers=null,this.privList=null}}))}dispose(e){return a(this,void 0,void 0,(function*(){yield this.drainAndDispose(null,e)}))}drain(){if(!this.privIsDrainInProgress&&!this.privIsDisposing){this.privIsDrainInProgress=!0;const e=this.privSubscribers,t=this.privList;if(e&&t){for(;t.length()>0&&e.length()>0&&!this.privIsDisposing;){const i=e.removeFirst();if(i.type===r.Peek)i.deferral.resolve(t.first());else{const e=t.removeFirst();i.deferral.resolve(e)}}this.privSubscribers===e&&(this.privSubscribers=e),this.privList===t&&(this.privList=t)}this.privIsDrainInProgress=!1}}throwIfDispose(){if(this.isDisposed()){if(this.privDisposeReason)throw new n.InvalidOperationError(this.privDisposeReason);throw new n.ObjectDisposedError("Queue")}if(this.privIsDisposing)throw new n.InvalidOperationError("Queue disposing")}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{List:()=>n});var r=i(17);class n{constructor(e){if(this.privSubscriptionIdCounter=0,this.privAddSubscriptions={},this.privRemoveSubscriptions={},this.privDisposedSubscriptions={},this.privDisposeReason=null,this.privList=[],e)for(const t of e)this.privList.push(t)}get(e){return this.throwIfDisposed(),this.privList[e]}first(){return this.get(0)}last(){return this.get(this.length()-1)}add(e){this.throwIfDisposed(),this.insertAt(this.privList.length,e)}insertAt(e,t){this.throwIfDisposed(),0===e?this.privList.unshift(t):e===this.privList.length?this.privList.push(t):this.privList.splice(e,0,t),this.triggerSubscriptions(this.privAddSubscriptions)}removeFirst(){return this.throwIfDisposed(),this.removeAt(0)}removeLast(){return this.throwIfDisposed(),this.removeAt(this.length()-1)}removeAt(e){return this.throwIfDisposed(),this.remove(e,1)[0]}remove(e,t){this.throwIfDisposed();const i=this.privList.splice(e,t);return this.triggerSubscriptions(this.privRemoveSubscriptions),i}clear(){this.throwIfDisposed(),this.remove(0,this.length())}length(){return this.throwIfDisposed(),this.privList.length}onAdded(e){this.throwIfDisposed();const t=this.privSubscriptionIdCounter++;return this.privAddSubscriptions[t]=e,{detach:()=>(delete this.privAddSubscriptions[t],Promise.resolve())}}onRemoved(e){this.throwIfDisposed();const t=this.privSubscriptionIdCounter++;return this.privRemoveSubscriptions[t]=e,{detach:()=>(delete this.privRemoveSubscriptions[t],Promise.resolve())}}onDisposed(e){this.throwIfDisposed();const t=this.privSubscriptionIdCounter++;return this.privDisposedSubscriptions[t]=e,{detach:()=>(delete this.privDisposedSubscriptions[t],Promise.resolve())}}join(e){return this.throwIfDisposed(),this.privList.join(e)}toArray(){const e=Array();return this.privList.forEach((t=>{e.push(t)})),e}any(e){return this.throwIfDisposed(),e?this.where(e).length()>0:this.length()>0}all(e){return this.throwIfDisposed(),this.where(e).length()===this.length()}forEach(e){this.throwIfDisposed();for(let t=0;t<this.length();t++)e(this.privList[t],t)}select(e){this.throwIfDisposed();const t=[];for(let i=0;i<this.privList.length;i++)t.push(e(this.privList[i],i));return new n(t)}where(e){this.throwIfDisposed();const t=new n;for(let i=0;i<this.privList.length;i++)e(this.privList[i],i)&&t.add(this.privList[i]);return t}orderBy(e){this.throwIfDisposed();const t=this.toArray().sort(e);return new n(t)}orderByDesc(e){return this.throwIfDisposed(),this.orderBy(((t,i)=>e(i,t)))}clone(){return this.throwIfDisposed(),new n(this.toArray())}concat(e){return this.throwIfDisposed(),new n(this.privList.concat(e.toArray()))}concatArray(e){return this.throwIfDisposed(),new n(this.privList.concat(e))}isDisposed(){return null==this.privList}dispose(e){this.isDisposed()||(this.privDisposeReason=e,this.privList=null,this.privAddSubscriptions=null,this.privRemoveSubscriptions=null,this.triggerSubscriptions(this.privDisposedSubscriptions))}throwIfDisposed(){if(this.isDisposed())throw new r.ObjectDisposedError("List",this.privDisposeReason)}triggerSubscriptions(e){if(e)for(const t in e)t&&e[t]()}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{Events:()=>s});var r=i(17),n=i(16);class s{static setEventSource(e){if(!e)throw new r.ArgumentNullError("eventSource");s.privInstance=e}static get instance(){return s.privInstance}}s.privInstance=new n.EventSource},(e,t,i)=>{"use strict";var r;i.r(t),i.d(t,{AudioFormatTag:()=>r,AudioStreamFormat:()=>n,AudioStreamFormatImpl:()=>s}),function(e){e[e.PCM=1]="PCM",e[e.MuLaw=2]="MuLaw",e[e.Siren=3]="Siren",e[e.MP3=4]="MP3",e[e.SILKSkype=5]="SILKSkype",e[e.OGG_OPUS=6]="OGG_OPUS",e[e.WEBM_OPUS=7]="WEBM_OPUS",e[e.ALaw=8]="ALaw",e[e.FLAC=9]="FLAC",e[e.OPUS=10]="OPUS"}(r||(r={}));class n{static getDefaultInputFormat(){return s.getDefaultInputFormat()}static getWaveFormat(e,t,i,r){return new s(e,t,i,r)}static getWaveFormatPCM(e,t,i){return new s(e,t,i)}}class s extends n{constructor(e=16e3,t=16,i=1,n=r.PCM){super();let s=!0;switch(n){case r.PCM:this.formatTag=1;break;case r.ALaw:this.formatTag=6;break;case r.MuLaw:this.formatTag=7;break;default:s=!1}if(this.bitsPerSample=t,this.samplesPerSec=e,this.channels=i,this.avgBytesPerSec=this.samplesPerSec*this.channels*(this.bitsPerSample/8),this.blockAlign=this.channels*Math.max(this.bitsPerSample,8),s){this.privHeader=new ArrayBuffer(44);const e=new DataView(this.privHeader);this.setString(e,0,"RIFF"),e.setUint32(4,0,!0),this.setString(e,8,"WAVEfmt "),e.setUint32(16,16,!0),e.setUint16(20,this.formatTag,!0),e.setUint16(22,this.channels,!0),e.setUint32(24,this.samplesPerSec,!0),e.setUint32(28,this.avgBytesPerSec,!0),e.setUint16(32,this.channels*(this.bitsPerSample/8),!0),e.setUint16(34,this.bitsPerSample,!0),this.setString(e,36,"data"),e.setUint32(40,0,!0)}}static getDefaultInputFormat(){return new s}static getAudioContext(e){const t=window.AudioContext||window.webkitAudioContext||!1;if(t)return void 0!==e&&navigator.mediaDevices.getSupportedConstraints().sampleRate?new t({sampleRate:e}):new t;throw new Error("Browser does not support Web Audio API (AudioContext is not available).")}close(){}get header(){return this.privHeader}setString(e,t,i){for(let r=0;r<i.length;r++)e.setUint8(t+r,i.charCodeAt(r))}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{FileAudioSource:()=>u});var r=i(21),n=i(9),s=i(16),o=i(19),a=i(18),c=i(22),p=i(26),h=i(27),d=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class u{constructor(e,t,i){this.privStreams={},this.privHeaderEnd=44,this.privId=i||(0,n.createNoDashGuid)(),this.privEvents=new s.EventSource,this.privSource=e,"undefined"!=typeof window&&"undefined"!=typeof Blob&&this.privSource instanceof Blob?this.privFilename=e.name:this.privFilename=t||"unknown.wav",this.privAudioFormatPromise=this.readHeader()}get format(){return this.privAudioFormatPromise}turnOn(){if(this.privFilename.lastIndexOf(".wav")!==this.privFilename.length-4){const e=this.privFilename+" is not supported. Only WAVE files are allowed at the moment.";return this.onEvent(new o.AudioSourceErrorEvent(e,"")),Promise.reject(e)}this.onEvent(new o.AudioSourceInitializingEvent(this.privId)),this.onEvent(new o.AudioSourceReadyEvent(this.privId))}id(){return this.privId}attach(e){return d(this,void 0,void 0,(function*(){this.onEvent(new o.AudioStreamNodeAttachingEvent(this.privId,e));const t=yield this.upload(e);return this.onEvent(new o.AudioStreamNodeAttachedEvent(this.privId,e)),Promise.resolve({detach:()=>d(this,void 0,void 0,(function*(){t.readEnded(),delete this.privStreams[e],this.onEvent(new o.AudioStreamNodeDetachedEvent(this.privId,e)),yield this.turnOff()})),id:()=>e,read:()=>t.read()})}))}detach(e){e&&this.privStreams[e]&&(this.privStreams[e].close(),delete this.privStreams[e],this.onEvent(new o.AudioStreamNodeDetachedEvent(this.privId,e)))}turnOff(){for(const e in this.privStreams)if(e){const t=this.privStreams[e];t&&!t.isClosed&&t.close()}return this.onEvent(new o.AudioSourceOffEvent(this.privId)),Promise.resolve()}get events(){return this.privEvents}get deviceInfo(){return this.privAudioFormatPromise.then((e=>Promise.resolve({bitspersample:e.bitsPerSample,channelcount:e.channels,connectivity:r.connectivity.Unknown,manufacturer:"Speech SDK",model:"File",samplerate:e.samplesPerSec,type:r.type.File})))}readHeader(){const e=this.privSource.slice(0,4296),t=new a.Deferred,i=e=>{const i=new DataView(e),r=e=>String.fromCharCode(i.getUint8(e),i.getUint8(e+1),i.getUint8(e+2),i.getUint8(e+3));if("RIFF"!==r(0))return void t.reject("Invalid WAV header in file, RIFF was not found");if("WAVE"!==r(8)||"fmt "!==r(12))return void t.reject("Invalid WAV header in file, WAVEfmt was not found");const n=i.getInt32(16,!0),s=i.getUint16(22,!0),o=i.getUint32(24,!0),a=i.getUint16(34,!0);let c=36+Math.max(n-16,0);for(;"data"!==r(c);c+=2)if(c>4288)return void t.reject("Invalid WAV header in file, data block was not found");this.privHeaderEnd=c+8,t.resolve(h.AudioStreamFormat.getWaveFormatPCM(o,a,s))};if("undefined"!=typeof window&&"undefined"!=typeof Blob&&e instanceof Blob){const t=new FileReader;t.onload=e=>{const t=e.target.result;i(t)},t.readAsArrayBuffer(e)}else{const t=e;i(t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength))}return t.promise}upload(e){return d(this,void 0,void 0,(function*(){const t=t=>{const i=`Error occurred while processing '${this.privFilename}'. ${t}`;throw this.onEvent(new o.AudioStreamNodeErrorEvent(this.privId,e,i)),new Error(i)};try{yield this.turnOn();const i=yield this.privAudioFormatPromise,r=new c.ChunkedArrayBufferStream(i.avgBytesPerSec/10,e);this.privStreams[e]=r;const n=this.privSource.slice(this.privHeaderEnd),s=e=>{r.isClosed||(r.writeStreamChunk({buffer:e,isEnd:!1,timeReceived:Date.now()}),r.close())};if("undefined"!=typeof window&&"undefined"!=typeof Blob&&n instanceof Blob){const e=new FileReader;e.onerror=e=>t(e.toString()),e.onload=e=>{const t=e.target.result;s(t)},e.readAsArrayBuffer(n)}else{const e=n;s(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength))}return r}catch(e){t(e)}}))}onEvent(e){this.privEvents.onEvent(e),p.Events.instance.onEvent(e)}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{PullAudioInputStreamCallback:()=>r});class r{}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{AudioInputStream:()=>d,PullAudioInputStream:()=>l,PullAudioInputStreamImpl:()=>g,PushAudioInputStream:()=>u,PushAudioInputStreamImpl:()=>v});var r=i(21),n=i(16),s=i(22),o=i(19),a=i(26),c=i(9),p=i(27),h=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class d{constructor(){}static createPushStream(e){return u.create(e)}static createPullStream(e,t){return l.create(e,t)}}class u extends d{static create(e){return new v(e)}}class v extends u{constructor(e){super(),this.privFormat=void 0===e?p.AudioStreamFormatImpl.getDefaultInputFormat():e,this.privEvents=new n.EventSource,this.privId=(0,c.createNoDashGuid)(),this.privStream=new s.ChunkedArrayBufferStream(this.privFormat.avgBytesPerSec/10)}get format(){return Promise.resolve(this.privFormat)}write(e){this.privStream.writeStreamChunk({buffer:e,isEnd:!1,timeReceived:Date.now()})}close(){this.privStream.close()}id(){return this.privId}turnOn(){this.onEvent(new o.AudioSourceInitializingEvent(this.privId)),this.onEvent(new o.AudioSourceReadyEvent(this.privId))}attach(e){return h(this,void 0,void 0,(function*(){this.onEvent(new o.AudioStreamNodeAttachingEvent(this.privId,e)),yield this.turnOn();const t=this.privStream;return this.onEvent(new o.AudioStreamNodeAttachedEvent(this.privId,e)),{detach:()=>h(this,void 0,void 0,(function*(){return this.onEvent(new o.AudioStreamNodeDetachedEvent(this.privId,e)),this.turnOff()})),id:()=>e,read:()=>t.read()}}))}detach(e){this.onEvent(new o.AudioStreamNodeDetachedEvent(this.privId,e))}turnOff(){}get events(){return this.privEvents}get deviceInfo(){return Promise.resolve({bitspersample:this.privFormat.bitsPerSample,channelcount:this.privFormat.channels,connectivity:r.connectivity.Unknown,manufacturer:"Speech SDK",model:"PushStream",samplerate:this.privFormat.samplesPerSec,type:r.type.Stream})}onEvent(e){this.privEvents.onEvent(e),a.Events.instance.onEvent(e)}toBuffer(e){const t=Buffer.alloc(e.byteLength),i=new Uint8Array(e);for(let e=0;e<t.length;++e)t[e]=i[e];return t}}class l extends d{constructor(){super()}static create(e,t){return new g(e,t)}}class g extends l{constructor(e,t){super(),this.privFormat=void 0===t?p.AudioStreamFormat.getDefaultInputFormat():t,this.privEvents=new n.EventSource,this.privId=(0,c.createNoDashGuid)(),this.privCallback=e,this.privIsClosed=!1,this.privBufferSize=this.privFormat.avgBytesPerSec/10}get format(){return Promise.resolve(this.privFormat)}close(){this.privIsClosed=!0,this.privCallback.close()}id(){return this.privId}turnOn(){this.onEvent(new o.AudioSourceInitializingEvent(this.privId)),this.onEvent(new o.AudioSourceReadyEvent(this.privId))}attach(e){return h(this,void 0,void 0,(function*(){return this.onEvent(new o.AudioStreamNodeAttachingEvent(this.privId,e)),yield this.turnOn(),this.onEvent(new o.AudioStreamNodeAttachedEvent(this.privId,e)),{detach:()=>(this.privCallback.close(),this.onEvent(new o.AudioStreamNodeDetachedEvent(this.privId,e)),this.turnOff()),id:()=>e,read:()=>{let e,t=0;for(;t<this.privBufferSize;){const i=new ArrayBuffer(this.privBufferSize-t),r=this.privCallback.read(i);if(void 0===e)e=i;else{new Int8Array(e).set(new Int8Array(i),t)}if(0===r)break;t+=r}return Promise.resolve({buffer:e.slice(0,t),isEnd:this.privIsClosed||0===t,timeReceived:Date.now()})}}}))}detach(e){this.onEvent(new o.AudioStreamNodeDetachedEvent(this.privId,e))}turnOff(){}get events(){return this.privEvents}get deviceInfo(){return Promise.resolve({bitspersample:this.privFormat.bitsPerSample,channelcount:this.privFormat.channels,connectivity:r.connectivity.Unknown,manufacturer:"Speech SDK",model:"PullStream",samplerate:this.privFormat.samplesPerSec,type:r.type.Stream})}onEvent(e){this.privEvents.onEvent(e),a.Events.instance.onEvent(e)}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SpeakerAudioDestination:()=>h});var r=i(9),n=i(26),s=i(32),o=i(33),a=i(27),c=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};const p={[a.AudioFormatTag.PCM]:"audio/wav",[a.AudioFormatTag.MuLaw]:"audio/x-wav",[a.AudioFormatTag.MP3]:"audio/mpeg",[a.AudioFormatTag.OGG_OPUS]:"audio/ogg",[a.AudioFormatTag.WEBM_OPUS]:"audio/webm; codecs=opus",[a.AudioFormatTag.ALaw]:"audio/x-wav",[a.AudioFormatTag.FLAC]:"audio/flac"};class h{constructor(e){this.privPlaybackStarted=!1,this.privAppendingToBuffer=!1,this.privMediaSourceOpened=!1,this.privBytesReceived=0,this.privId=e||(0,r.createNoDashGuid)(),this.privIsPaused=!1,this.privIsClosed=!1}id(){return this.privId}write(e,t,i){void 0!==this.privAudioBuffer?(this.privAudioBuffer.push(e),this.updateSourceBuffer().then((()=>{t&&t()}),(e=>{i&&i(e)}))):void 0!==this.privAudioOutputStream&&(this.privAudioOutputStream.write(e),this.privBytesReceived+=e.byteLength)}close(e,t){if(this.privIsClosed=!0,void 0!==this.privSourceBuffer)this.handleSourceBufferUpdateEnd().then((()=>{e&&e()}),(e=>{t&&t(e)}));else if(void 0!==this.privAudioOutputStream&&"undefined"!=typeof window)if(this.privFormat.formatTag!==a.AudioFormatTag.PCM&&this.privFormat.formatTag!==a.AudioFormatTag.MuLaw&&this.privFormat.formatTag!==a.AudioFormatTag.ALaw||!1!==this.privFormat.hasHeader){let i=new ArrayBuffer(this.privBytesReceived);this.privAudioOutputStream.read(i).then((()=>{i=this.privFormat.addHeader(i);const r=new Blob([i],{type:p[this.privFormat.formatTag]});this.privAudio.src=window.URL.createObjectURL(r),this.notifyPlayback().then((()=>{e&&e()}),(e=>{t&&t(e)}))}),(e=>{t&&t(e)}))}else console.warn("Play back is not supported for raw PCM, mulaw or alaw format without header."),this.onAudioEnd&&this.onAudioEnd(this);else this.onAudioEnd&&this.onAudioEnd(this)}set format(e){if("undefined"!=typeof AudioContext||"undefined"!=typeof window&&void 0!==window.webkitAudioContext){this.privFormat=e;const t=p[this.privFormat.formatTag];void 0===t?console.warn(`Unknown mimeType for format ${a.AudioFormatTag[this.privFormat.formatTag]}; playback is not supported.`):"undefined"!=typeof MediaSource&&MediaSource.isTypeSupported(t)?(this.privAudio=new Audio,this.privAudioBuffer=[],this.privMediaSource=new MediaSource,this.privAudio.src=URL.createObjectURL(this.privMediaSource),this.privAudio.load(),this.privMediaSource.onsourceopen=()=>{this.privMediaSourceOpened=!0,this.privMediaSource.duration=1800,this.privSourceBuffer=this.privMediaSource.addSourceBuffer(t),this.privSourceBuffer.onupdate=()=>{this.updateSourceBuffer().catch((e=>{n.Events.instance.onEvent(new s.BackgroundEvent(e))}))},this.privSourceBuffer.onupdateend=()=>{this.handleSourceBufferUpdateEnd().catch((e=>{n.Events.instance.onEvent(new s.BackgroundEvent(e))}))},this.privSourceBuffer.onupdatestart=()=>{this.privAppendingToBuffer=!1}},this.updateSourceBuffer().catch((e=>{n.Events.instance.onEvent(new s.BackgroundEvent(e))}))):(console.warn(`Format ${a.AudioFormatTag[this.privFormat.formatTag]} could not be played by MSE, streaming playback is not enabled.`),this.privAudioOutputStream=new o.PullAudioOutputStreamImpl,this.privAudioOutputStream.format=this.privFormat,this.privAudio=new Audio)}}get volume(){var e,t;return null!==(t=null===(e=this.privAudio)||void 0===e?void 0:e.volume)&&void 0!==t?t:-1}set volume(e){this.privAudio&&(this.privAudio.volume=e)}mute(){this.privAudio&&(this.privAudio.muted=!0)}unmute(){this.privAudio&&(this.privAudio.muted=!1)}get isClosed(){return this.privIsClosed}get currentTime(){return void 0!==this.privAudio?this.privAudio.currentTime:-1}pause(){this.privIsPaused||void 0===this.privAudio||(this.privAudio.pause(),this.privIsPaused=!0)}resume(e,t){this.privIsPaused&&void 0!==this.privAudio&&(this.privAudio.play().then((()=>{e&&e()}),(e=>{t&&t(e)})),this.privIsPaused=!1)}get internalAudio(){return this.privAudio}updateSourceBuffer(){return c(this,void 0,void 0,(function*(){if(void 0!==this.privAudioBuffer&&this.privAudioBuffer.length>0&&this.sourceBufferAvailable()){this.privAppendingToBuffer=!0;const e=this.privAudioBuffer.shift();try{this.privSourceBuffer.appendBuffer(e)}catch(t){return this.privAudioBuffer.unshift(e),void console.log("buffer filled, pausing addition of binaries until space is made")}yield this.notifyPlayback()}else this.canEndStream()&&(yield this.handleSourceBufferUpdateEnd())}))}handleSourceBufferUpdateEnd(){return c(this,void 0,void 0,(function*(){this.canEndStream()&&this.sourceBufferAvailable()&&(this.privMediaSource.endOfStream(),yield this.notifyPlayback())}))}notifyPlayback(){return c(this,void 0,void 0,(function*(){this.privPlaybackStarted||void 0===this.privAudio||(this.privPlaybackStarted=!0,this.onAudioStart&&this.onAudioStart(this),this.privAudio.onended=()=>{this.onAudioEnd&&this.onAudioEnd(this)},this.privIsPaused||(yield this.privAudio.play()))}))}canEndStream(){return this.isClosed&&void 0!==this.privSourceBuffer&&0===this.privAudioBuffer.length&&this.privMediaSourceOpened&&!this.privAppendingToBuffer&&"open"===this.privMediaSource.readyState}sourceBufferAvailable(){return void 0!==this.privSourceBuffer&&!this.privSourceBuffer.updating}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{BackgroundEvent:()=>n});var r=i(20);class n extends r.PlatformEvent{constructor(e){super("BackgroundEvent",r.EventType.Error),this.privError=e}get error(){return this.privError}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{AudioOutputStream:()=>c,PullAudioOutputStream:()=>p,PullAudioOutputStreamImpl:()=>h,PushAudioOutputStream:()=>d,PushAudioOutputStreamImpl:()=>u});var r=i(9),n=i(23),s=i(36),o=i(34),a=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class c{constructor(){}static createPullStream(){return p.create()}}class p extends c{static create(){return new h}}class h extends p{constructor(){super(),this.privId=(0,r.createNoDashGuid)(),this.privStream=new n.Stream}set format(e){null==e&&(this.privFormat=o.AudioOutputFormatImpl.getDefaultOutputFormat()),this.privFormat=e}get format(){return this.privFormat}get isClosed(){return this.privStream.isClosed}id(){return this.privId}read(e){return a(this,void 0,void 0,(function*(){const t=new Int8Array(e);let i=0;if(void 0!==this.privLastChunkView){if(this.privLastChunkView.length>e.byteLength)return t.set(this.privLastChunkView.slice(0,e.byteLength)),this.privLastChunkView=this.privLastChunkView.slice(e.byteLength),Promise.resolve(e.byteLength);t.set(this.privLastChunkView),i=this.privLastChunkView.length,this.privLastChunkView=void 0}for(;i<e.byteLength&&!this.privStream.isReadEnded;){const r=yield this.privStream.read();if(void 0===r||r.isEnd)this.privStream.readEnded();else{let n;r.buffer.byteLength>e.byteLength-i?(n=r.buffer.slice(0,e.byteLength-i),this.privLastChunkView=new Int8Array(r.buffer.slice(e.byteLength-i))):n=r.buffer,t.set(new Int8Array(n),i),i+=n.byteLength}}return i}))}write(e){s.Contracts.throwIfNullOrUndefined(this.privStream,"must set format before writing"),this.privStream.writeStreamChunk({buffer:e,isEnd:!1,timeReceived:Date.now()})}close(){this.privStream.close()}}class d extends c{constructor(){super()}static create(e){return new u(e)}}class u extends d{constructor(e){super(),this.privId=(0,r.createNoDashGuid)(),this.privCallback=e}set format(e){}write(e){this.privCallback.write&&this.privCallback.write(e)}close(){this.privCallback.close&&this.privCallback.close()}id(){return this.privId}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{AudioOutputFormatImpl:()=>s});var r=i(35),n=i(27);class s extends n.AudioStreamFormatImpl{constructor(e,t,i,r,n,s,o,a,c){super(i,s,t,e),this.formatTag=e,this.avgBytesPerSec=r,this.blockAlign=n,this.priAudioFormatString=o,this.priRequestAudioFormatString=a,this.priHasHeader=c}static fromSpeechSynthesisOutputFormat(e){return void 0===e?s.getDefaultOutputFormat():s.fromSpeechSynthesisOutputFormatString(s.SpeechSynthesisOutputFormatToString[e])}static fromSpeechSynthesisOutputFormatString(e){switch(e){case"raw-8khz-8bit-mono-mulaw":return new s(n.AudioFormatTag.MuLaw,1,8e3,8e3,1,8,e,e,!1);case"riff-16khz-16kbps-mono-siren":return new s(n.AudioFormatTag.Siren,1,16e3,2e3,40,0,e,"audio-16khz-16kbps-mono-siren",!0);case"audio-16khz-16kbps-mono-siren":return new s(n.AudioFormatTag.Siren,1,16e3,2e3,40,0,e,e,!1);case"audio-16khz-32kbitrate-mono-mp3":return new s(n.AudioFormatTag.MP3,1,16e3,4096,2,16,e,e,!1);case"audio-16khz-128kbitrate-mono-mp3":return new s(n.AudioFormatTag.MP3,1,16e3,16384,2,16,e,e,!1);case"audio-16khz-64kbitrate-mono-mp3":return new s(n.AudioFormatTag.MP3,1,16e3,8192,2,16,e,e,!1);case"audio-24khz-48kbitrate-mono-mp3":return new s(n.AudioFormatTag.MP3,1,24e3,6144,2,16,e,e,!1);case"audio-24khz-96kbitrate-mono-mp3":return new s(n.AudioFormatTag.MP3,1,24e3,12288,2,16,e,e,!1);case"audio-24khz-160kbitrate-mono-mp3":return new s(n.AudioFormatTag.MP3,1,24e3,20480,2,16,e,e,!1);case"raw-16khz-16bit-mono-truesilk":return new s(n.AudioFormatTag.SILKSkype,1,16e3,32e3,2,16,e,e,!1);case"riff-8khz-16bit-mono-pcm":return new s(n.AudioFormatTag.PCM,1,8e3,16e3,2,16,e,"raw-8khz-16bit-mono-pcm",!0);case"riff-24khz-16bit-mono-pcm":return new s(n.AudioFormatTag.PCM,1,24e3,48e3,2,16,e,"raw-24khz-16bit-mono-pcm",!0);case"riff-8khz-8bit-mono-mulaw":return new s(n.AudioFormatTag.MuLaw,1,8e3,8e3,1,8,e,"raw-8khz-8bit-mono-mulaw",!0);case"raw-16khz-16bit-mono-pcm":return new s(n.AudioFormatTag.PCM,1,16e3,32e3,2,16,e,"raw-16khz-16bit-mono-pcm",!1);case"raw-24khz-16bit-mono-pcm":return new s(n.AudioFormatTag.PCM,1,24e3,48e3,2,16,e,"raw-24khz-16bit-mono-pcm",!1);case"raw-8khz-16bit-mono-pcm":return new s(n.AudioFormatTag.PCM,1,8e3,16e3,2,16,e,"raw-8khz-16bit-mono-pcm",!1);case"ogg-16khz-16bit-mono-opus":return new s(n.AudioFormatTag.OGG_OPUS,1,16e3,8192,2,16,e,e,!1);case"ogg-24khz-16bit-mono-opus":return new s(n.AudioFormatTag.OGG_OPUS,1,24e3,8192,2,16,e,e,!1);case"raw-48khz-16bit-mono-pcm":return new s(n.AudioFormatTag.PCM,1,48e3,96e3,2,16,e,"raw-48khz-16bit-mono-pcm",!1);case"riff-48khz-16bit-mono-pcm":return new s(n.AudioFormatTag.PCM,1,48e3,96e3,2,16,e,"raw-48khz-16bit-mono-pcm",!0);case"audio-48khz-96kbitrate-mono-mp3":return new s(n.AudioFormatTag.MP3,1,48e3,12288,2,16,e,e,!1);case"audio-48khz-192kbitrate-mono-mp3":return new s(n.AudioFormatTag.MP3,1,48e3,24576,2,16,e,e,!1);case"ogg-48khz-16bit-mono-opus":return new s(n.AudioFormatTag.OGG_OPUS,1,48e3,12e3,2,16,e,e,!1);case"webm-16khz-16bit-mono-opus":return new s(n.AudioFormatTag.WEBM_OPUS,1,16e3,4e3,2,16,e,e,!1);case"webm-24khz-16bit-mono-opus":return new s(n.AudioFormatTag.WEBM_OPUS,1,24e3,6e3,2,16,e,e,!1);case"webm-24khz-16bit-24kbps-mono-opus":return new s(n.AudioFormatTag.WEBM_OPUS,1,24e3,3e3,2,16,e,e,!1);case"audio-16khz-16bit-32kbps-mono-opus":return new s(n.AudioFormatTag.OPUS,1,16e3,4e3,2,16,e,e,!1);case"audio-24khz-16bit-48kbps-mono-opus":return new s(n.AudioFormatTag.OPUS,1,24e3,6e3,2,16,e,e,!1);case"audio-24khz-16bit-24kbps-mono-opus":return new s(n.AudioFormatTag.OPUS,1,24e3,3e3,2,16,e,e,!1);case"audio-24khz-16bit-mono-flac":return new s(n.AudioFormatTag.FLAC,1,24e3,24e3,2,16,e,e,!1);case"audio-48khz-16bit-mono-flac":return new s(n.AudioFormatTag.FLAC,1,48e3,3e4,2,16,e,e,!1);case"raw-24khz-16bit-mono-truesilk":return new s(n.AudioFormatTag.SILKSkype,1,24e3,48e3,2,16,e,e,!1);case"raw-8khz-8bit-mono-alaw":return new s(n.AudioFormatTag.ALaw,1,8e3,8e3,1,8,e,e,!1);case"riff-8khz-8bit-mono-alaw":return new s(n.AudioFormatTag.ALaw,1,8e3,8e3,1,8,e,"raw-8khz-8bit-mono-alaw",!0);case"raw-22050hz-16bit-mono-pcm":return new s(n.AudioFormatTag.PCM,1,22050,44100,2,16,e,e,!1);case"riff-22050hz-16bit-mono-pcm":return new s(n.AudioFormatTag.PCM,1,22050,44100,2,16,e,"raw-22050hz-16bit-mono-pcm",!0);case"raw-44100hz-16bit-mono-pcm":return new s(n.AudioFormatTag.PCM,1,44100,88200,2,16,e,e,!1);case"riff-44100hz-16bit-mono-pcm":return new s(n.AudioFormatTag.PCM,1,44100,88200,2,16,e,"raw-44100hz-16bit-mono-pcm",!0);default:return new s(n.AudioFormatTag.PCM,1,16e3,32e3,2,16,"riff-16khz-16bit-mono-pcm","raw-16khz-16bit-mono-pcm",!0)}}static getDefaultOutputFormat(){return s.fromSpeechSynthesisOutputFormatString("undefined"!=typeof window?"audio-24khz-48kbitrate-mono-mp3":"riff-16khz-16bit-mono-pcm")}get hasHeader(){return this.priHasHeader}get header(){if(this.hasHeader)return this.privHeader}updateHeader(e){if(this.priHasHeader){const t=new DataView(this.privHeader);t.setUint32(4,e+this.privHeader.byteLength-8,!0),t.setUint32(40,e,!0)}}get requestAudioFormatString(){return this.priRequestAudioFormatString}addHeader(e){if(!this.hasHeader)return e;this.updateHeader(e.byteLength);const t=new Uint8Array(e.byteLength+this.header.byteLength);return t.set(new Uint8Array(this.header),0),t.set(new Uint8Array(e),this.header.byteLength),t.buffer}}s.SpeechSynthesisOutputFormatToString={[r.SpeechSynthesisOutputFormat.Raw8Khz8BitMonoMULaw]:"raw-8khz-8bit-mono-mulaw",[r.SpeechSynthesisOutputFormat.Riff16Khz16KbpsMonoSiren]:"riff-16khz-16kbps-mono-siren",[r.SpeechSynthesisOutputFormat.Audio16Khz16KbpsMonoSiren]:"audio-16khz-16kbps-mono-siren",[r.SpeechSynthesisOutputFormat.Audio16Khz32KBitRateMonoMp3]:"audio-16khz-32kbitrate-mono-mp3",[r.SpeechSynthesisOutputFormat.Audio16Khz128KBitRateMonoMp3]:"audio-16khz-128kbitrate-mono-mp3",[r.SpeechSynthesisOutputFormat.Audio16Khz64KBitRateMonoMp3]:"audio-16khz-64kbitrate-mono-mp3",[r.SpeechSynthesisOutputFormat.Audio24Khz48KBitRateMonoMp3]:"audio-24khz-48kbitrate-mono-mp3",[r.SpeechSynthesisOutputFormat.Audio24Khz96KBitRateMonoMp3]:"audio-24khz-96kbitrate-mono-mp3",[r.SpeechSynthesisOutputFormat.Audio24Khz160KBitRateMonoMp3]:"audio-24khz-160kbitrate-mono-mp3",[r.SpeechSynthesisOutputFormat.Raw16Khz16BitMonoTrueSilk]:"raw-16khz-16bit-mono-truesilk",[r.SpeechSynthesisOutputFormat.Riff16Khz16BitMonoPcm]:"riff-16khz-16bit-mono-pcm",[r.SpeechSynthesisOutputFormat.Riff8Khz16BitMonoPcm]:"riff-8khz-16bit-mono-pcm",[r.SpeechSynthesisOutputFormat.Riff24Khz16BitMonoPcm]:"riff-24khz-16bit-mono-pcm",[r.SpeechSynthesisOutputFormat.Riff8Khz8BitMonoMULaw]:"riff-8khz-8bit-mono-mulaw",[r.SpeechSynthesisOutputFormat.Raw16Khz16BitMonoPcm]:"raw-16khz-16bit-mono-pcm",[r.SpeechSynthesisOutputFormat.Raw24Khz16BitMonoPcm]:"raw-24khz-16bit-mono-pcm",[r.SpeechSynthesisOutputFormat.Raw8Khz16BitMonoPcm]:"raw-8khz-16bit-mono-pcm",[r.SpeechSynthesisOutputFormat.Ogg16Khz16BitMonoOpus]:"ogg-16khz-16bit-mono-opus",[r.SpeechSynthesisOutputFormat.Ogg24Khz16BitMonoOpus]:"ogg-24khz-16bit-mono-opus",[r.SpeechSynthesisOutputFormat.Raw48Khz16BitMonoPcm]:"raw-48khz-16bit-mono-pcm",[r.SpeechSynthesisOutputFormat.Riff48Khz16BitMonoPcm]:"riff-48khz-16bit-mono-pcm",[r.SpeechSynthesisOutputFormat.Audio48Khz96KBitRateMonoMp3]:"audio-48khz-96kbitrate-mono-mp3",[r.SpeechSynthesisOutputFormat.Audio48Khz192KBitRateMonoMp3]:"audio-48khz-192kbitrate-mono-mp3",[r.SpeechSynthesisOutputFormat.Ogg48Khz16BitMonoOpus]:"ogg-48khz-16bit-mono-opus",[r.SpeechSynthesisOutputFormat.Webm16Khz16BitMonoOpus]:"webm-16khz-16bit-mono-opus",[r.SpeechSynthesisOutputFormat.Webm24Khz16BitMonoOpus]:"webm-24khz-16bit-mono-opus",[r.SpeechSynthesisOutputFormat.Webm24Khz16Bit24KbpsMonoOpus]:"webm-24khz-16bit-24kbps-mono-opus",[r.SpeechSynthesisOutputFormat.Raw24Khz16BitMonoTrueSilk]:"raw-24khz-16bit-mono-truesilk",[r.SpeechSynthesisOutputFormat.Raw8Khz8BitMonoALaw]:"raw-8khz-8bit-mono-alaw",[r.SpeechSynthesisOutputFormat.Riff8Khz8BitMonoALaw]:"riff-8khz-8bit-mono-alaw",[r.SpeechSynthesisOutputFormat.Audio16Khz16Bit32KbpsMonoOpus]:"audio-16khz-16bit-32kbps-mono-opus",[r.SpeechSynthesisOutputFormat.Audio24Khz16Bit48KbpsMonoOpus]:"audio-24khz-16bit-48kbps-mono-opus",[r.SpeechSynthesisOutputFormat.Audio24Khz16Bit24KbpsMonoOpus]:"audio-24khz-16bit-24kbps-mono-opus",[r.SpeechSynthesisOutputFormat.Raw22050Hz16BitMonoPcm]:"raw-22050hz-16bit-mono-pcm",[r.SpeechSynthesisOutputFormat.Riff22050Hz16BitMonoPcm]:"riff-22050hz-16bit-mono-pcm",[r.SpeechSynthesisOutputFormat.Raw44100Hz16BitMonoPcm]:"raw-44100hz-16bit-mono-pcm",[r.SpeechSynthesisOutputFormat.Riff44100Hz16BitMonoPcm]:"riff-44100hz-16bit-mono-pcm"}},(e,t,i)=>{"use strict";var r;i.r(t),i.d(t,{SpeechSynthesisOutputFormat:()=>r}),function(e){e[e.Raw8Khz8BitMonoMULaw=0]="Raw8Khz8BitMonoMULaw",e[e.Riff16Khz16KbpsMonoSiren=1]="Riff16Khz16KbpsMonoSiren",e[e.Audio16Khz16KbpsMonoSiren=2]="Audio16Khz16KbpsMonoSiren",e[e.Audio16Khz32KBitRateMonoMp3=3]="Audio16Khz32KBitRateMonoMp3",e[e.Audio16Khz128KBitRateMonoMp3=4]="Audio16Khz128KBitRateMonoMp3",e[e.Audio16Khz64KBitRateMonoMp3=5]="Audio16Khz64KBitRateMonoMp3",e[e.Audio24Khz48KBitRateMonoMp3=6]="Audio24Khz48KBitRateMonoMp3",e[e.Audio24Khz96KBitRateMonoMp3=7]="Audio24Khz96KBitRateMonoMp3",e[e.Audio24Khz160KBitRateMonoMp3=8]="Audio24Khz160KBitRateMonoMp3",e[e.Raw16Khz16BitMonoTrueSilk=9]="Raw16Khz16BitMonoTrueSilk",e[e.Riff16Khz16BitMonoPcm=10]="Riff16Khz16BitMonoPcm",e[e.Riff8Khz16BitMonoPcm=11]="Riff8Khz16BitMonoPcm",e[e.Riff24Khz16BitMonoPcm=12]="Riff24Khz16BitMonoPcm",e[e.Riff8Khz8BitMonoMULaw=13]="Riff8Khz8BitMonoMULaw",e[e.Raw16Khz16BitMonoPcm=14]="Raw16Khz16BitMonoPcm",e[e.Raw24Khz16BitMonoPcm=15]="Raw24Khz16BitMonoPcm",e[e.Raw8Khz16BitMonoPcm=16]="Raw8Khz16BitMonoPcm",e[e.Ogg16Khz16BitMonoOpus=17]="Ogg16Khz16BitMonoOpus",e[e.Ogg24Khz16BitMonoOpus=18]="Ogg24Khz16BitMonoOpus",e[e.Raw48Khz16BitMonoPcm=19]="Raw48Khz16BitMonoPcm",e[e.Riff48Khz16BitMonoPcm=20]="Riff48Khz16BitMonoPcm",e[e.Audio48Khz96KBitRateMonoMp3=21]="Audio48Khz96KBitRateMonoMp3",e[e.Audio48Khz192KBitRateMonoMp3=22]="Audio48Khz192KBitRateMonoMp3",e[e.Ogg48Khz16BitMonoOpus=23]="Ogg48Khz16BitMonoOpus",e[e.Webm16Khz16BitMonoOpus=24]="Webm16Khz16BitMonoOpus",e[e.Webm24Khz16BitMonoOpus=25]="Webm24Khz16BitMonoOpus",e[e.Raw24Khz16BitMonoTrueSilk=26]="Raw24Khz16BitMonoTrueSilk",e[e.Raw8Khz8BitMonoALaw=27]="Raw8Khz8BitMonoALaw",e[e.Riff8Khz8BitMonoALaw=28]="Riff8Khz8BitMonoALaw",e[e.Webm24Khz16Bit24KbpsMonoOpus=29]="Webm24Khz16Bit24KbpsMonoOpus",e[e.Audio16Khz16Bit32KbpsMonoOpus=30]="Audio16Khz16Bit32KbpsMonoOpus",e[e.Audio24Khz16Bit48KbpsMonoOpus=31]="Audio24Khz16Bit48KbpsMonoOpus",e[e.Audio24Khz16Bit24KbpsMonoOpus=32]="Audio24Khz16Bit24KbpsMonoOpus",e[e.Raw22050Hz16BitMonoPcm=33]="Raw22050Hz16BitMonoPcm",e[e.Riff22050Hz16BitMonoPcm=34]="Riff22050Hz16BitMonoPcm",e[e.Raw44100Hz16BitMonoPcm=35]="Raw44100Hz16BitMonoPcm",e[e.Riff44100Hz16BitMonoPcm=36]="Riff44100Hz16BitMonoPcm"}(r||(r={}))},(e,t,i)=>{"use strict";i.r(t),i.d(t,{Contracts:()=>r});class r{static throwIfNullOrUndefined(e,t){if(null==e)throw new Error("throwIfNullOrUndefined:"+t)}static throwIfNull(e,t){if(null===e)throw new Error("throwIfNull:"+t)}static throwIfNullOrWhitespace(e,t){if(r.throwIfNullOrUndefined(e,t),(""+e).trim().length<1)throw new Error("throwIfNullOrWhitespace:"+t)}static throwIfNullOrTooLong(e,t,i){if(r.throwIfNullOrUndefined(e,t),(""+e).length>i)throw new Error("throwIfNullOrTooLong:"+t+" (more than "+i.toString()+" characters)")}static throwIfNullOrTooShort(e,t,i){if(r.throwIfNullOrUndefined(e,t),(""+e).length<i)throw new Error("throwIfNullOrTooShort:"+t+" (less than "+i.toString()+" characters)")}static throwIfDisposed(e){if(e)throw new Error("the object is already disposed")}static throwIfArrayEmptyOrWhitespace(e,t){if(r.throwIfNullOrUndefined(e,t),0===e.length)throw new Error("throwIfArrayEmptyOrWhitespace:"+t);for(const i of e)r.throwIfNullOrWhitespace(i,t)}static throwIfFileDoesNotExist(e,t){r.throwIfNullOrWhitespace(e,t)}static throwIfNotUndefined(e,t){if(void 0!==e)throw new Error("throwIfNotUndefined:"+t)}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{AudioFileWriter:()=>s});var r=i(38),n=i(36);class s{constructor(e){n.Contracts.throwIfNullOrUndefined(r.openSync,"\nFile System access not available, please use Push or PullAudioOutputStream"),this.privFd=r.openSync(e,"w")}set format(e){n.Contracts.throwIfNotUndefined(this.privAudioFormat,"format is already set"),this.privAudioFormat=e;let t=0;this.privAudioFormat.hasHeader&&(t=this.privAudioFormat.header.byteLength),void 0!==this.privFd&&(this.privWriteStream=r.createWriteStream("",{fd:this.privFd,start:t,autoClose:!1}))}write(e){n.Contracts.throwIfNullOrUndefined(this.privAudioFormat,"must set format before writing."),void 0!==this.privWriteStream&&this.privWriteStream.write(new Uint8Array(e.slice(0)))}close(){void 0!==this.privFd&&(this.privWriteStream.on("finish",(()=>{this.privAudioFormat.hasHeader&&(this.privAudioFormat.updateHeader(this.privWriteStream.bytesWritten),r.writeSync(this.privFd,new Int8Array(this.privAudioFormat.header),0,this.privAudioFormat.header.byteLength,0)),r.closeSync(this.privFd),this.privFd=void 0})),this.privWriteStream.end())}id(){return this.privId}}},()=>{},(e,t,i)=>{"use strict";i.r(t),i.d(t,{PushAudioOutputStreamCallback:()=>r});class r{}},(e,t,i)=>{"use strict";var r;i.r(t),i.d(t,{CancellationReason:()=>r}),function(e){e[e.Error=0]="Error",e[e.EndOfStream=1]="EndOfStream"}(r||(r={}))},(e,t,i)=>{"use strict";i.r(t),i.d(t,{KeywordRecognitionModel:()=>n});var r=i(36);class n{constructor(){this.privDisposed=!1}static fromFile(e){throw r.Contracts.throwIfFileDoesNotExist(e,"fileName"),new Error("Not yet implemented.")}static fromStream(e){throw r.Contracts.throwIfNull(e,"file"),new Error("Not yet implemented.")}close(){this.privDisposed||(this.privDisposed=!0)}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SessionEventArgs:()=>r});class r{constructor(e){this.privSessionId=e}get sessionId(){return this.privSessionId}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{RecognitionEventArgs:()=>n});var r=i(42);class n extends r.SessionEventArgs{constructor(e,t){super(t),this.privOffset=e}get offset(){return this.privOffset}}},(e,t,i)=>{"use strict";var r;i.r(t),i.d(t,{OutputFormat:()=>r}),function(e){e[e.Simple=0]="Simple",e[e.Detailed=1]="Detailed"}(r||(r={}))},(e,t,i)=>{"use strict";i.r(t),i.d(t,{IntentRecognitionEventArgs:()=>n});var r=i(43);class n extends r.RecognitionEventArgs{constructor(e,t,i){super(t,i),this.privResult=e}get result(){return this.privResult}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{RecognitionResult:()=>r});class r{constructor(e,t,i,r,n,s,o,a,c,p){this.privResultId=e,this.privReason=t,this.privText=i,this.privDuration=r,this.privOffset=n,this.privLanguage=s,this.privLanguageDetectionConfidence=o,this.privErrorDetails=a,this.privJson=c,this.privProperties=p}get resultId(){return this.privResultId}get reason(){return this.privReason}get text(){return this.privText}get duration(){return this.privDuration}get offset(){return this.privOffset}get language(){return this.privLanguage}get languageDetectionConfidence(){return this.privLanguageDetectionConfidence}get errorDetails(){return this.privErrorDetails}get json(){return this.privJson}get properties(){return this.privProperties}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SpeechRecognitionResult:()=>n});var r=i(46);class n extends r.RecognitionResult{constructor(e,t,i,r,n,s,o,a,c,p,h){super(e,t,i,r,n,s,o,c,p,h),this.privSpeakerId=a}get speakerId(){return this.privSpeakerId}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{IntentRecognitionResult:()=>n});var r=i(47);class n extends r.SpeechRecognitionResult{constructor(e,t,i,r,n,s,o,a,c,p,h){super(t,i,r,n,s,o,a,void 0,c,p,h),this.privIntentId=e}get intentId(){return this.privIntentId}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{LanguageUnderstandingModel:()=>n,LanguageUnderstandingModelImpl:()=>s});var r=i(36);class n{constructor(){}static fromEndpoint(e){r.Contracts.throwIfNull(e,"uri"),r.Contracts.throwIfNullOrWhitespace(e.hostname,"uri");const t=new s,i=e.host.indexOf(".");if(-1===i)throw new Error("Could not determine region from endpoint");t.region=e.host.substr(0,i);const n=e.pathname.lastIndexOf("/")+1;if(-1===n)throw new Error("Could not determine appId from endpoint");if(t.appId=e.pathname.substr(n),t.subscriptionKey=e.searchParams.get("subscription-key"),void 0===t.subscriptionKey)throw new Error("Could not determine subscription key from endpoint");return t}static fromAppId(e){r.Contracts.throwIfNullOrWhitespace(e,"appId");const t=new s;return t.appId=e,t}static fromSubscription(e,t,i){r.Contracts.throwIfNullOrWhitespace(e,"subscriptionKey"),r.Contracts.throwIfNullOrWhitespace(t,"appId"),r.Contracts.throwIfNullOrWhitespace(i,"region");const n=new s;return n.appId=t,n.region=i,n.subscriptionKey=e,n}}class s extends n{}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConversationTranscriptionEventArgs:()=>s,MeetingTranscriptionEventArgs:()=>o,SpeechRecognitionEventArgs:()=>n});var r=i(43);class n extends r.RecognitionEventArgs{constructor(e,t,i){super(t,i),this.privResult=e}get result(){return this.privResult}}class s extends r.RecognitionEventArgs{constructor(e,t,i){super(t,i),this.privResult=e}get result(){return this.privResult}}class o extends n{}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SpeechRecognitionCanceledEventArgs:()=>n});var r=i(52);class n extends r.CancellationEventArgsBase{}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{CancellationEventArgsBase:()=>n});var r=i(43);class n extends r.RecognitionEventArgs{constructor(e,t,i,r,n){super(r,n),this.privReason=e,this.privErrorDetails=t,this.privErrorCode=i}get reason(){return this.privReason}get errorCode(){return this.privErrorCode}get errorDetails(){return this.privErrorDetails}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{TranslationRecognitionEventArgs:()=>n});var r=i(43);class n extends r.RecognitionEventArgs{constructor(e,t,i){super(t,i),this.privResult=e}get result(){return this.privResult}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{TranslationSynthesisEventArgs:()=>n});var r=i(42);class n extends r.SessionEventArgs{constructor(e,t){super(t),this.privResult=e}get result(){return this.privResult}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{TranslationRecognitionResult:()=>n});var r=i(47);class n extends r.SpeechRecognitionResult{constructor(e,t,i,r,n,s,o,a,c,p,h){super(t,i,r,n,s,o,a,void 0,c,p,h),this.privTranslations=e}static fromSpeechRecognitionResult(e){return new n(void 0,e.resultId,e.reason,e.text,e.duration,e.offset,e.language,e.languageDetectionConfidence,e.errorDetails,e.json,e.properties)}get translations(){return this.privTranslations}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{TranslationSynthesisResult:()=>r});class r{constructor(e,t){this.privReason=e,this.privAudio=t}get audio(){return this.privAudio}get reason(){return this.privReason}}},(e,t,i)=>{"use strict";var r;i.r(t),i.d(t,{ResultReason:()=>r}),function(e){e[e.NoMatch=0]="NoMatch",e[e.Canceled=1]="Canceled",e[e.RecognizingSpeech=2]="RecognizingSpeech",e[e.RecognizedSpeech=3]="RecognizedSpeech",e[e.RecognizedKeyword=4]="RecognizedKeyword",e[e.RecognizingIntent=5]="RecognizingIntent",e[e.RecognizedIntent=6]="RecognizedIntent",e[e.TranslatingSpeech=7]="TranslatingSpeech",e[e.TranslatedSpeech=8]="TranslatedSpeech",e[e.SynthesizingAudio=9]="SynthesizingAudio",e[e.SynthesizingAudioCompleted=10]="SynthesizingAudioCompleted",e[e.SynthesizingAudioStarted=11]="SynthesizingAudioStarted",e[e.EnrollingVoiceProfile=12]="EnrollingVoiceProfile",e[e.EnrolledVoiceProfile=13]="EnrolledVoiceProfile",e[e.RecognizedSpeakers=14]="RecognizedSpeakers",e[e.RecognizedSpeaker=15]="RecognizedSpeaker",e[e.ResetVoiceProfile=16]="ResetVoiceProfile",e[e.DeletedVoiceProfile=17]="DeletedVoiceProfile",e[e.VoicesListRetrieved=18]="VoicesListRetrieved",e[e.TranslatingParticipantSpeech=19]="TranslatingParticipantSpeech",e[e.TranslatedParticipantSpeech=20]="TranslatedParticipantSpeech",e[e.TranslatedInstantMessage=21]="TranslatedInstantMessage",e[e.TranslatedParticipantInstantMessage=22]="TranslatedParticipantInstantMessage"}(r||(r={}))},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SpeechConfig:()=>h,SpeechConfigImpl:()=>d});var r=i(61),n=i(36),s=i(59),o=i(60),a=i(44),c=i(189),p=i(35);class h{constructor(){}static fromSubscription(e,t){n.Contracts.throwIfNullOrWhitespace(e,"subscriptionKey"),n.Contracts.throwIfNullOrWhitespace(t,"region");const i=new d;return i.setProperty(s.PropertyId.SpeechServiceConnection_Region,t),i.setProperty(s.PropertyId.SpeechServiceConnection_IntentRegion,t),i.setProperty(s.PropertyId.SpeechServiceConnection_Key,e),i}static fromEndpoint(e,t){n.Contracts.throwIfNull(e,"endpoint");const i=new d;return i.setProperty(s.PropertyId.SpeechServiceConnection_Endpoint,e.href),void 0!==t&&i.setProperty(s.PropertyId.SpeechServiceConnection_Key,t),i}static fromHost(e,t){n.Contracts.throwIfNull(e,"hostName");const i=new d;return i.setProperty(s.PropertyId.SpeechServiceConnection_Host,e.protocol+"//"+e.hostname+(""===e.port?"":":"+e.port)),void 0!==t&&i.setProperty(s.PropertyId.SpeechServiceConnection_Key,t),i}static fromAuthorizationToken(e,t){n.Contracts.throwIfNull(e,"authorizationToken"),n.Contracts.throwIfNullOrWhitespace(t,"region");const i=new d;return i.setProperty(s.PropertyId.SpeechServiceConnection_Region,t),i.setProperty(s.PropertyId.SpeechServiceConnection_IntentRegion,t),i.authorizationToken=e,i}close(){}}class d extends h{constructor(){super(),this.privProperties=new o.PropertyCollection,this.speechRecognitionLanguage="en-US",this.outputFormat=a.OutputFormat.Simple}get properties(){return this.privProperties}get endPoint(){return new URL(this.privProperties.getProperty(s.PropertyId.SpeechServiceConnection_Endpoint))}get subscriptionKey(){return this.privProperties.getProperty(s.PropertyId.SpeechServiceConnection_Key)}get region(){return this.privProperties.getProperty(s.PropertyId.SpeechServiceConnection_Region)}get authorizationToken(){return this.privProperties.getProperty(s.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(e){this.privProperties.setProperty(s.PropertyId.SpeechServiceAuthorization_Token,e)}get speechRecognitionLanguage(){return this.privProperties.getProperty(s.PropertyId.SpeechServiceConnection_RecoLanguage)}set speechRecognitionLanguage(e){this.privProperties.setProperty(s.PropertyId.SpeechServiceConnection_RecoLanguage,e)}get autoDetectSourceLanguages(){return this.privProperties.getProperty(s.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages)}set autoDetectSourceLanguages(e){this.privProperties.setProperty(s.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,e)}get outputFormat(){return a.OutputFormat[this.privProperties.getProperty(r.OutputFormatPropertyName,void 0)]}set outputFormat(e){this.privProperties.setProperty(r.OutputFormatPropertyName,a.OutputFormat[e])}get endpointId(){return this.privProperties.getProperty(s.PropertyId.SpeechServiceConnection_EndpointId)}set endpointId(e){this.privProperties.setProperty(s.PropertyId.SpeechServiceConnection_EndpointId,e)}setProperty(e,t){n.Contracts.throwIfNull(t,"value"),this.privProperties.setProperty(e,t)}getProperty(e,t){return this.privProperties.getProperty(e,t)}setProxy(e,t,i,r){this.setProperty(s.PropertyId[s.PropertyId.SpeechServiceConnection_ProxyHostName],e),this.setProperty(s.PropertyId[s.PropertyId.SpeechServiceConnection_ProxyPort],t),this.setProperty(s.PropertyId[s.PropertyId.SpeechServiceConnection_ProxyUserName],i),this.setProperty(s.PropertyId[s.PropertyId.SpeechServiceConnection_ProxyPassword],r)}setServiceProperty(e,t){const i=JSON.parse(this.privProperties.getProperty(r.ServicePropertiesPropertyName,"{}"));i[e]=t,this.privProperties.setProperty(r.ServicePropertiesPropertyName,JSON.stringify(i))}setProfanity(e){this.privProperties.setProperty(s.PropertyId.SpeechServiceResponse_ProfanityOption,c.ProfanityOption[e])}enableAudioLogging(){this.privProperties.setProperty(s.PropertyId.SpeechServiceConnection_EnableAudioLogging,"true")}requestWordLevelTimestamps(){this.privProperties.setProperty(s.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,"true")}enableDictation(){this.privProperties.setProperty(r.ForceDictationPropertyName,"true")}clone(){const e=new d;return e.privProperties=this.privProperties.clone(),e}get speechSynthesisLanguage(){return this.privProperties.getProperty(s.PropertyId.SpeechServiceConnection_SynthLanguage)}set speechSynthesisLanguage(e){this.privProperties.setProperty(s.PropertyId.SpeechServiceConnection_SynthLanguage,e)}get speechSynthesisVoiceName(){return this.privProperties.getProperty(s.PropertyId.SpeechServiceConnection_SynthVoice)}set speechSynthesisVoiceName(e){this.privProperties.setProperty(s.PropertyId.SpeechServiceConnection_SynthVoice,e)}get speechSynthesisOutputFormat(){return p.SpeechSynthesisOutputFormat[this.privProperties.getProperty(s.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0)]}set speechSynthesisOutputFormat(e){this.privProperties.setProperty(s.PropertyId.SpeechServiceConnection_SynthOutputFormat,p.SpeechSynthesisOutputFormat[e])}}},(e,t,i)=>{"use strict";var r;i.r(t),i.d(t,{PropertyId:()=>r}),function(e){e[e.SpeechServiceConnection_Key=0]="SpeechServiceConnection_Key",e[e.SpeechServiceConnection_Endpoint=1]="SpeechServiceConnection_Endpoint",e[e.SpeechServiceConnection_Region=2]="SpeechServiceConnection_Region",e[e.SpeechServiceAuthorization_Token=3]="SpeechServiceAuthorization_Token",e[e.SpeechServiceAuthorization_Type=4]="SpeechServiceAuthorization_Type",e[e.SpeechServiceConnection_EndpointId=5]="SpeechServiceConnection_EndpointId",e[e.SpeechServiceConnection_TranslationToLanguages=6]="SpeechServiceConnection_TranslationToLanguages",e[e.SpeechServiceConnection_TranslationVoice=7]="SpeechServiceConnection_TranslationVoice",e[e.SpeechServiceConnection_TranslationFeatures=8]="SpeechServiceConnection_TranslationFeatures",e[e.SpeechServiceConnection_IntentRegion=9]="SpeechServiceConnection_IntentRegion",e[e.SpeechServiceConnection_ProxyHostName=10]="SpeechServiceConnection_ProxyHostName",e[e.SpeechServiceConnection_ProxyPort=11]="SpeechServiceConnection_ProxyPort",e[e.SpeechServiceConnection_ProxyUserName=12]="SpeechServiceConnection_ProxyUserName",e[e.SpeechServiceConnection_ProxyPassword=13]="SpeechServiceConnection_ProxyPassword",e[e.SpeechServiceConnection_RecoMode=14]="SpeechServiceConnection_RecoMode",e[e.SpeechServiceConnection_RecoLanguage=15]="SpeechServiceConnection_RecoLanguage",e[e.Speech_SessionId=16]="Speech_SessionId",e[e.SpeechServiceConnection_SynthLanguage=17]="SpeechServiceConnection_SynthLanguage",e[e.SpeechServiceConnection_SynthVoice=18]="SpeechServiceConnection_SynthVoice",e[e.SpeechServiceConnection_SynthOutputFormat=19]="SpeechServiceConnection_SynthOutputFormat",e[e.SpeechServiceConnection_AutoDetectSourceLanguages=20]="SpeechServiceConnection_AutoDetectSourceLanguages",e[e.SpeechServiceResponse_RequestDetailedResultTrueFalse=21]="SpeechServiceResponse_RequestDetailedResultTrueFalse",e[e.SpeechServiceResponse_RequestProfanityFilterTrueFalse=22]="SpeechServiceResponse_RequestProfanityFilterTrueFalse",e[e.SpeechServiceResponse_JsonResult=23]="SpeechServiceResponse_JsonResult",e[e.SpeechServiceResponse_JsonErrorDetails=24]="SpeechServiceResponse_JsonErrorDetails",e[e.CancellationDetails_Reason=25]="CancellationDetails_Reason",e[e.CancellationDetails_ReasonText=26]="CancellationDetails_ReasonText",e[e.CancellationDetails_ReasonDetailedText=27]="CancellationDetails_ReasonDetailedText",e[e.LanguageUnderstandingServiceResponse_JsonResult=28]="LanguageUnderstandingServiceResponse_JsonResult",e[e.SpeechServiceConnection_Url=29]="SpeechServiceConnection_Url",e[e.SpeechServiceConnection_InitialSilenceTimeoutMs=30]="SpeechServiceConnection_InitialSilenceTimeoutMs",e[e.SpeechServiceConnection_EndSilenceTimeoutMs=31]="SpeechServiceConnection_EndSilenceTimeoutMs",e[e.Speech_SegmentationSilenceTimeoutMs=32]="Speech_SegmentationSilenceTimeoutMs",e[e.SpeechServiceConnection_EnableAudioLogging=33]="SpeechServiceConnection_EnableAudioLogging",e[e.SpeechServiceConnection_LanguageIdMode=34]="SpeechServiceConnection_LanguageIdMode",e[e.SpeechServiceConnection_RecognitionEndpointVersion=35]="SpeechServiceConnection_RecognitionEndpointVersion",e[e.SpeechServiceConnection_SpeakerIdMode=36]="SpeechServiceConnection_SpeakerIdMode",e[e.SpeechServiceResponse_ProfanityOption=37]="SpeechServiceResponse_ProfanityOption",e[e.SpeechServiceResponse_PostProcessingOption=38]="SpeechServiceResponse_PostProcessingOption",e[e.SpeechServiceResponse_RequestWordLevelTimestamps=39]="SpeechServiceResponse_RequestWordLevelTimestamps",e[e.SpeechServiceResponse_StablePartialResultThreshold=40]="SpeechServiceResponse_StablePartialResultThreshold",e[e.SpeechServiceResponse_OutputFormatOption=41]="SpeechServiceResponse_OutputFormatOption",e[e.SpeechServiceResponse_TranslationRequestStablePartialResult=42]="SpeechServiceResponse_TranslationRequestStablePartialResult",e[e.SpeechServiceResponse_RequestWordBoundary=43]="SpeechServiceResponse_RequestWordBoundary",e[e.SpeechServiceResponse_RequestPunctuationBoundary=44]="SpeechServiceResponse_RequestPunctuationBoundary",e[e.SpeechServiceResponse_RequestSentenceBoundary=45]="SpeechServiceResponse_RequestSentenceBoundary",e[e.Conversation_ApplicationId=46]="Conversation_ApplicationId",e[e.Conversation_DialogType=47]="Conversation_DialogType",e[e.Conversation_Initial_Silence_Timeout=48]="Conversation_Initial_Silence_Timeout",e[e.Conversation_From_Id=49]="Conversation_From_Id",e[e.Conversation_Conversation_Id=50]="Conversation_Conversation_Id",e[e.Conversation_Custom_Voice_Deployment_Ids=51]="Conversation_Custom_Voice_Deployment_Ids",e[e.Conversation_Speech_Activity_Template=52]="Conversation_Speech_Activity_Template",e[e.Conversation_Request_Bot_Status_Messages=53]="Conversation_Request_Bot_Status_Messages",e[e.Conversation_Agent_Connection_Id=54]="Conversation_Agent_Connection_Id",e[e.SpeechServiceConnection_Host=55]="SpeechServiceConnection_Host",e[e.ConversationTranslator_Host=56]="ConversationTranslator_Host",e[e.ConversationTranslator_Name=57]="ConversationTranslator_Name",e[e.ConversationTranslator_CorrelationId=58]="ConversationTranslator_CorrelationId",e[e.ConversationTranslator_Token=59]="ConversationTranslator_Token",e[e.PronunciationAssessment_ReferenceText=60]="PronunciationAssessment_ReferenceText",e[e.PronunciationAssessment_GradingSystem=61]="PronunciationAssessment_GradingSystem",e[e.PronunciationAssessment_Granularity=62]="PronunciationAssessment_Granularity",e[e.PronunciationAssessment_EnableMiscue=63]="PronunciationAssessment_EnableMiscue",e[e.PronunciationAssessment_Json=64]="PronunciationAssessment_Json",e[e.PronunciationAssessment_Params=65]="PronunciationAssessment_Params",e[e.SpeakerRecognition_Api_Version=66]="SpeakerRecognition_Api_Version",e[e.WebWorkerLoadType=67]="WebWorkerLoadType",e[e.TalkingAvatarService_WebRTC_SDP=68]="TalkingAvatarService_WebRTC_SDP"}(r||(r={}))},(e,t,i)=>{"use strict";i.r(t),i.d(t,{PropertyCollection:()=>n});var r=i(59);class n{constructor(){this.privKeys=[],this.privValues=[]}getProperty(e,t){let i;i="string"==typeof e?e:r.PropertyId[e];for(let e=0;e<this.privKeys.length;e++)if(this.privKeys[e]===i)return this.privValues[e];if(void 0!==t)return String(t)}setProperty(e,t){let i;i="string"==typeof e?e:r.PropertyId[e];for(let e=0;e<this.privKeys.length;e++)if(this.privKeys[e]===i)return void(this.privValues[e]=t);this.privKeys.push(i),this.privValues.push(t)}clone(){const e=new n;for(let t=0;t<this.privKeys.length;t++)e.privKeys.push(this.privKeys[t]),e.privValues.push(this.privValues[t]);return e}mergeTo(e){this.privKeys.forEach((t=>{if(void 0===e.getProperty(t,void 0)){const i=this.getProperty(t);e.setProperty(t,i)}}))}get keys(){return this.privKeys}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{AddedLmIntent:()=>O.AddedLmIntent,AgentConfig:()=>_.AgentConfig,AuthInfo:()=>s.AuthInfo,AutoDetectSourceLanguagesOpenRangeOptionName:()=>re,AvatarSynthesisAdapter:()=>V.AvatarSynthesisAdapter,CancellationErrorCodePropertyName:()=>ee,CognitiveSubscriptionKeyAuthentication:()=>r.CognitiveSubscriptionKeyAuthentication,CognitiveTokenAuthentication:()=>n.CognitiveTokenAuthentication,ConnectingToServiceEvent:()=>c.ConnectingToServiceEvent,Context:()=>Z.Context,ConversationConnectionConfig:()=>q.ConversationConnectionConfig,ConversationManager:()=>q.ConversationManager,ConversationReceivedTranslationEventArgs:()=>q.ConversationReceivedTranslationEventArgs,ConversationRecognizerFactory:()=>q.ConversationRecognizerFactory,ConversationServiceRecognizer:()=>h.ConversationServiceRecognizer,ConversationTranscriberConnectionFactory:()=>l.ConversationTranscriberConnectionFactory,ConversationTranscriptionServiceRecognizer:()=>D.ConversationTranscriptionServiceRecognizer,ConversationTranslatorCommandTypes:()=>q.ConversationTranslatorCommandTypes,ConversationTranslatorMessageTypes:()=>q.ConversationTranslatorMessageTypes,DetailedSpeechPhrase:()=>k.DetailedSpeechPhrase,Device:()=>Z.Device,DialogServiceAdapter:()=>B.DialogServiceAdapter,DynamicGrammarBuilder:()=>F.DynamicGrammarBuilder,EnumTranslation:()=>f.EnumTranslation,ForceDictationPropertyName:()=>ie,IntentConnectionFactory:()=>o.IntentConnectionFactory,IntentResponse:()=>z.IntentResponse,IntentServiceRecognizer:()=>N.IntentServiceRecognizer,InternalParticipants:()=>q.InternalParticipants,ListeningStartedEvent:()=>c.ListeningStartedEvent,LockRoomEventArgs:()=>q.LockRoomEventArgs,MetadataType:()=>U.MetadataType,MuteAllEventArgs:()=>q.MuteAllEventArgs,OS:()=>Z.OS,OutputFormatPropertyName:()=>Y,ParticipantAttributeEventArgs:()=>q.ParticipantAttributeEventArgs,ParticipantEventArgs:()=>q.ParticipantEventArgs,ParticipantsListEventArgs:()=>q.ParticipantsListEventArgs,RecognitionCompletionStatus:()=>c.RecognitionCompletionStatus,RecognitionEndedEvent:()=>c.RecognitionEndedEvent,RecognitionMode:()=>d.RecognitionMode,RecognitionStartedEvent:()=>c.RecognitionStartedEvent,RecognitionStatus:()=>C.RecognitionStatus,RecognitionTriggeredEvent:()=>c.RecognitionTriggeredEvent,RecognizerConfig:()=>d.RecognizerConfig,RequestSession:()=>x.RequestSession,ServicePropertiesPropertyName:()=>te,ServiceRecognizerBase:()=>p.ServiceRecognizerBase,SimpleSpeechPhrase:()=>M.SimpleSpeechPhrase,SpeakerRecognitionConfig:()=>$.SpeakerRecognitionConfig,SpeakerRecognitionConnectionFactory:()=>a.SpeakerRecognitionConnectionFactory,SpeakerServiceRecognizer:()=>Q.SpeakerServiceRecognizer,SpeechConnectionFactory:()=>v.SpeechConnectionFactory,SpeechContext:()=>L.SpeechContext,SpeechDetected:()=>T.SpeechDetected,SpeechHypothesis:()=>w.SpeechHypothesis,SpeechKeyword:()=>A.SpeechKeyword,SpeechRecognitionEvent:()=>c.SpeechRecognitionEvent,SpeechResultFormat:()=>d.SpeechResultFormat,SpeechServiceConfig:()=>Z.SpeechServiceConfig,SpeechServiceRecognizer:()=>E.SpeechServiceRecognizer,SpeechSynthesisAdapter:()=>K.SpeechSynthesisAdapter,SpeechSynthesisConnectionFactory:()=>S.SpeechSynthesisConnectionFactory,SynthesisAdapterBase:()=>H.SynthesisAdapterBase,SynthesisAudioMetadata:()=>U.SynthesisAudioMetadata,SynthesisContext:()=>G.SynthesisContext,SynthesisRestAdapter:()=>J.SynthesisRestAdapter,SynthesisServiceType:()=>j.SynthesisServiceType,SynthesisStatus:()=>C.SynthesisStatus,SynthesisTurn:()=>W.SynthesisTurn,SynthesizerConfig:()=>j.SynthesizerConfig,System:()=>Z.System,TranscriberConnectionFactory:()=>g.TranscriberConnectionFactory,TranscriberRecognizer:()=>q.TranscriberRecognizer,TranscriptionServiceRecognizer:()=>b.TranscriptionServiceRecognizer,TranslationConnectionFactory:()=>m.TranslationConnectionFactory,TranslationHypothesis:()=>R.TranslationHypothesis,TranslationPhrase:()=>P.TranslationPhrase,TranslationServiceRecognizer:()=>I.TranslationServiceRecognizer,TranslationSynthesisEnd:()=>y.TranslationSynthesisEnd,VoiceProfileConnectionFactory:()=>a.VoiceProfileConnectionFactory,VoiceServiceRecognizer:()=>X.VoiceServiceRecognizer,WebsocketMessageFormatter:()=>u.WebsocketMessageFormatter,connectivity:()=>Z.connectivity,type:()=>Z.type});var r=i(62),n=i(65),s=i(63),o=i(66),a=i(83),c=i(84),p=i(85),h=i(96),d=i(92),u=i(81),v=i(102),l=i(103),g=i(104),m=i(105),S=i(107),f=i(99),C=i(98),y=i(108),R=i(109),P=i(111),I=i(112),T=i(95),w=i(101),A=i(115),E=i(116),D=i(117),b=i(120),k=i(100),M=i(97),O=i(122),N=i(123),z=i(124),x=i(86),L=i(89),F=i(88),B=i(126),_=i(2),q=i(135),U=i(153),W=i(149),H=i(148),V=i(173),K=i(175),J=i(177),j=i(178),G=i(154),$=i(179),Q=i(180),X=i(183),Z=i(21);const Y="OutputFormat",ee="CancellationErrorCode",te="ServiceProperties",ie="ForceDictation",re="OpenRange"},(e,t,i)=>{"use strict";i.r(t),i.d(t,{CognitiveSubscriptionKeyAuthentication:()=>o});var r=i(17),n=i(64),s=i(63);class o{constructor(e){if(!e)throw new r.ArgumentNullError("subscriptionKey");this.privAuthInfo=new s.AuthInfo(n.HeaderNames.AuthKey,e)}fetch(e){return Promise.resolve(this.privAuthInfo)}fetchOnExpiry(e){return Promise.resolve(this.privAuthInfo)}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{AuthInfo:()=>r});class r{constructor(e,t){this.privHeaderName=e,this.privToken=t}get headerName(){return this.privHeaderName}get token(){return this.privToken}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{HeaderNames:()=>r});class r{}r.AuthKey="Ocp-Apim-Subscription-Key",r.Authorization="Authorization",r.SpIDAuthKey="Apim-Subscription-Id",r.ConnectionId="X-ConnectionId",r.ContentType="Content-Type",r.CustomCommandsAppId="X-CommandsAppId",r.Path="Path",r.RequestId="X-RequestId",r.RequestStreamId="X-StreamId",r.RequestTimestamp="X-Timestamp"},(e,t,i)=>{"use strict";i.r(t),i.d(t,{CognitiveTokenAuthentication:()=>o});var r=i(17),n=i(63),s=i(64);class o{constructor(e,t){if(!e)throw new r.ArgumentNullError("fetchCallback");if(!t)throw new r.ArgumentNullError("fetchOnExpiryCallback");this.privFetchCallback=e,this.privFetchOnExpiryCallback=t}fetch(e){return this.privFetchCallback(e).then((e=>new n.AuthInfo(s.HeaderNames.Authorization,void 0===e?void 0:o.privTokenPrefix+e)))}fetchOnExpiry(e){return this.privFetchOnExpiryCallback(e).then((e=>new n.AuthInfo(s.HeaderNames.Authorization,void 0===e?void 0:o.privTokenPrefix+e)))}}o.privTokenPrefix="Bearer "},(e,t,i)=>{"use strict";i.r(t),i.d(t,{IntentConnectionFactory:()=>p});var r=i(69),n=i(82),s=i(59),o=i(67),a=i(81),c=i(64);class p extends o.ConnectionFactoryBase{create(e,t,i){let p=e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_Endpoint);if(!p){const t=e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_IntentRegion),i=o.ConnectionFactoryBase.getHostSuffix(t);p=e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_Host,"wss://"+t+".sr.speech"+i)+"/speech/recognition/interactive/cognitiveservices/v1"}const h={format:"simple",language:e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_RecoLanguage)};this.setCommonUrlParams(e,h,p);const d={};void 0!==t.token&&""!==t.token&&(d[t.headerName]=t.token),d[c.HeaderNames.ConnectionId]=i,e.parameters.setProperty(s.PropertyId.SpeechServiceConnection_Url,p);const u="true"===e.parameters.getProperty("SPEECH-EnableWebsocketCompression","false");return new r.WebsocketConnection(p,h,d,new a.WebsocketMessageFormatter,n.ProxyInfo.fromRecognizerConfig(e),u,i)}getSpeechRegionFromIntentRegion(e){switch(e){case"West US":case"US West":case"westus":return"uswest";case"West US 2":case"US West 2":case"westus2":return"uswest2";case"South Central US":case"US South Central":case"southcentralus":return"ussouthcentral";case"West Central US":case"US West Central":case"westcentralus":return"uswestcentral";case"East US":case"US East":case"eastus":return"useast";case"East US 2":case"US East 2":case"eastus2":return"useast2";case"West Europe":case"Europe West":case"westeurope":return"europewest";case"North Europe":case"Europe North":case"northeurope":return"europenorth";case"Brazil South":case"South Brazil":case"southbrazil":return"brazilsouth";case"Australia East":case"East Australia":case"eastaustralia":return"australiaeast";case"Southeast Asia":case"Asia Southeast":case"southeastasia":return"asiasoutheast";case"East Asia":case"Asia East":case"eastasia":return"asiaeast";default:return e}}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConnectionFactoryBase:()=>o});var r=i(61),n=i(59),s=i(68);class o{static getHostSuffix(e){if(e){if(e.toLowerCase().startsWith("china"))return".azure.cn";if(e.toLowerCase().startsWith("usgov"))return".azure.us"}return".microsoft.com"}setCommonUrlParams(e,t,i){new Map([[n.PropertyId.Speech_SegmentationSilenceTimeoutMs,s.QueryParameterNames.SegmentationSilenceTimeoutMs],[n.PropertyId.SpeechServiceConnection_EnableAudioLogging,s.QueryParameterNames.EnableAudioLogging],[n.PropertyId.SpeechServiceConnection_EndSilenceTimeoutMs,s.QueryParameterNames.EndSilenceTimeoutMs],[n.PropertyId.SpeechServiceConnection_InitialSilenceTimeoutMs,s.QueryParameterNames.InitialSilenceTimeoutMs],[n.PropertyId.SpeechServiceResponse_PostProcessingOption,s.QueryParameterNames.Postprocessing],[n.PropertyId.SpeechServiceResponse_ProfanityOption,s.QueryParameterNames.Profanity],[n.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,s.QueryParameterNames.EnableWordLevelTimestamps],[n.PropertyId.SpeechServiceResponse_StablePartialResultThreshold,s.QueryParameterNames.StableIntermediateThreshold]]).forEach(((r,n)=>{this.setUrlParameter(n,r,e,t,i)}));const o=JSON.parse(e.parameters.getProperty(r.ServicePropertiesPropertyName,"{}"));Object.keys(o).forEach((e=>{t[e]=o[e]}))}setUrlParameter(e,t,i,r,n){const s=i.parameters.getProperty(e,void 0);!s||n&&-1!==n.search(t)||(r[t]=s.toLocaleLowerCase())}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{QueryParameterNames:()=>r});class r{}r.BotId="botid",r.CustomSpeechDeploymentId="cid",r.CustomVoiceDeploymentId="deploymentId",r.EnableAudioLogging="storeAudio",r.EnableLanguageId="lidEnabled",r.EnableWordLevelTimestamps="wordLevelTimestamps",r.EndSilenceTimeoutMs="endSilenceTimeoutMs",r.SegmentationSilenceTimeoutMs="segmentationSilenceTimeoutMs",r.Format="format",r.InitialSilenceTimeoutMs="initialSilenceTimeoutMs",r.Language="language",r.Profanity="profanity",r.RequestBotStatusMessages="enableBotMessageStatus",r.StableIntermediateThreshold="stableIntermediateThreshold",r.StableTranslation="stableTranslation",r.TestHooks="testhooks",r.Postprocessing="postprocessing",r.CtsMeetingId="meetingId",r.CtsDeviceId="deviceId",r.CtsIsParticipant="isParticipant",r.EnableAvatar="enableTalkingAvatar"},(e,t,i)=>{"use strict";i.r(t),i.d(t,{WebsocketConnection:()=>a});var r=i(17),n=i(9),s=i(70),o=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class a{constructor(e,t,i,o,a,c=!1,p){if(this.privIsDisposed=!1,!e)throw new r.ArgumentNullError("uri");if(!o)throw new r.ArgumentNullError("messageFormatter");this.privMessageFormatter=o;let h="",d=0;if(t)for(const i in t)if(i){h+=0===d&&-1===e.indexOf("?")?"?":"&";h+=encodeURIComponent(i);let r=t[i];r&&(r=encodeURIComponent(r),h+=`=${r}`),d++}if(i)for(const t in i)if(t){h+=0===d&&-1===e.indexOf("?")?"?":"&";h+=`${t}=${encodeURIComponent(i[t])}`,d++}this.privUri=e+h,this.privId=p||(0,n.createNoDashGuid)(),this.privConnectionMessageAdapter=new s.WebsocketMessageAdapter(this.privUri,this.id,this.privMessageFormatter,a,i,c)}dispose(){return o(this,void 0,void 0,(function*(){this.privIsDisposed=!0,this.privConnectionMessageAdapter&&(yield this.privConnectionMessageAdapter.close())}))}isDisposed(){return this.privIsDisposed}get id(){return this.privId}get uri(){return this.privUri}state(){return this.privConnectionMessageAdapter.state}open(){return this.privConnectionMessageAdapter.open()}send(e){return this.privConnectionMessageAdapter.send(e)}read(){return this.privConnectionMessageAdapter.read()}get events(){return this.privConnectionMessageAdapter.events}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{WebsocketMessageAdapter:()=>R});var r=i(71),n=i(72),s=i(73),o=i(74),a=i(75),c=i(64),p=i(17),h=i(16),d=i(76),u=i(18),v=i(24),l=i(26),g=i(32),m=i(77),S=i(78),f=i(79),C=i(80),y=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class R{constructor(e,t,i,r,n,s){if(!e)throw new p.ArgumentNullError("uri");if(!i)throw new p.ArgumentNullError("messageFormatter");this.proxyInfo=r,this.privConnectionEvents=new h.EventSource,this.privConnectionId=t,this.privMessageFormatter=i,this.privConnectionState=d.ConnectionState.None,this.privUri=e,this.privHeaders=n,this.privEnableCompression=s,this.privHeaders[c.HeaderNames.ConnectionId]=this.privConnectionId,this.privLastErrorReceived=""}get state(){return this.privConnectionState}open(){if(this.privConnectionState===d.ConnectionState.Disconnected)return Promise.reject(`Cannot open a connection that is in ${this.privConnectionState} state`);if(this.privConnectionEstablishDeferral)return this.privConnectionEstablishDeferral.promise;this.privConnectionEstablishDeferral=new u.Deferred,this.privCertificateValidatedDeferral=new u.Deferred,this.privConnectionState=d.ConnectionState.Connecting;try{if("undefined"==typeof WebSocket||R.forceNpmWebSocket){const e={headers:this.privHeaders,perMessageDeflate:this.privEnableCompression};this.privCertificateValidatedDeferral.resolve(),e.agent=this.getAgent();let t=new URL(this.privUri).protocol;"wss:"===(null==t?void 0:t.toLocaleLowerCase())?t="https:":"ws:"===(null==t?void 0:t.toLocaleLowerCase())&&(t="http:"),e.agent.protocol=t,this.privWebsocketClient=new a(this.privUri,e)}else this.privCertificateValidatedDeferral.resolve(),this.privWebsocketClient=new WebSocket(this.privUri);this.privWebsocketClient.binaryType="arraybuffer",this.privReceivingMessageQueue=new v.Queue,this.privDisconnectDeferral=new u.Deferred,this.privSendMessageQueue=new v.Queue,this.processSendQueue().catch((e=>{l.Events.instance.onEvent(new g.BackgroundEvent(e))}))}catch(e){return this.privConnectionEstablishDeferral.resolve(new m.ConnectionOpenResponse(500,e)),this.privConnectionEstablishDeferral.promise}return this.onEvent(new S.ConnectionStartEvent(this.privConnectionId,this.privUri)),this.privWebsocketClient.onopen=()=>{this.privCertificateValidatedDeferral.promise.then((()=>{this.privConnectionState=d.ConnectionState.Connected,this.onEvent(new S.ConnectionEstablishedEvent(this.privConnectionId)),this.privConnectionEstablishDeferral.resolve(new m.ConnectionOpenResponse(200,""))}),(e=>{this.privConnectionEstablishDeferral.reject(e)}))},this.privWebsocketClient.onerror=e=>{this.onEvent(new S.ConnectionErrorEvent(this.privConnectionId,e.message,e.type)),this.privLastErrorReceived=e.message},this.privWebsocketClient.onclose=e=>{this.privConnectionState===d.ConnectionState.Connecting?(this.privConnectionState=d.ConnectionState.Disconnected,this.privConnectionEstablishDeferral.resolve(new m.ConnectionOpenResponse(e.code,e.reason+" "+this.privLastErrorReceived))):(this.privConnectionState=d.ConnectionState.Disconnected,this.privWebsocketClient=null,this.onEvent(new S.ConnectionClosedEvent(this.privConnectionId,e.code,e.reason))),this.onClose(e.code,e.reason).catch((e=>{l.Events.instance.onEvent(new g.BackgroundEvent(e))}))},this.privWebsocketClient.onmessage=e=>{const t=(new Date).toISOString();if(this.privConnectionState===d.ConnectionState.Connected){const i=new u.Deferred;if(this.privReceivingMessageQueue.enqueueFromPromise(i.promise),e.data instanceof ArrayBuffer){const r=new f.RawWebsocketMessage(C.MessageType.Binary,e.data);this.privMessageFormatter.toConnectionMessage(r).then((e=>{this.onEvent(new S.ConnectionMessageReceivedEvent(this.privConnectionId,t,e)),i.resolve(e)}),(e=>{i.reject(`Invalid binary message format. Error: ${e}`)}))}else{const r=new f.RawWebsocketMessage(C.MessageType.Text,e.data);this.privMessageFormatter.toConnectionMessage(r).then((e=>{this.onEvent(new S.ConnectionMessageReceivedEvent(this.privConnectionId,t,e)),i.resolve(e)}),(e=>{i.reject(`Invalid text message format. Error: ${e}`)}))}}},this.privConnectionEstablishDeferral.promise}send(e){if(this.privConnectionState!==d.ConnectionState.Connected)return Promise.reject(`Cannot send on connection that is in ${d.ConnectionState[this.privConnectionState]} state`);const t=new u.Deferred,i=new u.Deferred;return this.privSendMessageQueue.enqueueFromPromise(i.promise),this.privMessageFormatter.fromConnectionMessage(e).then((r=>{i.resolve({Message:e,RawWebsocketMessage:r,sendStatusDeferral:t})}),(e=>{i.reject(`Error formatting the message. ${e}`)})),t.promise}read(){return this.privConnectionState!==d.ConnectionState.Connected?Promise.reject(`Cannot read on connection that is in ${this.privConnectionState} state`):this.privReceivingMessageQueue.dequeue()}close(e){return this.privWebsocketClient?(this.privConnectionState!==d.ConnectionState.Disconnected&&this.privWebsocketClient.close(1e3,e||"Normal closure by client"),this.privDisconnectDeferral.promise):Promise.resolve()}get events(){return this.privConnectionEvents}sendRawMessage(e){try{return e?(this.onEvent(new S.ConnectionMessageSentEvent(this.privConnectionId,(new Date).toISOString(),e.Message)),this.isWebsocketOpen?(this.privWebsocketClient.send(e.RawWebsocketMessage.payload),Promise.resolve()):Promise.reject("websocket send error: Websocket not ready "+this.privConnectionId+" "+e.Message.id+" "+(new Error).stack)):Promise.resolve()}catch(e){return Promise.reject(`websocket send error: ${e}`)}}onClose(e,t){return y(this,void 0,void 0,(function*(){const i=`Connection closed. ${e}: ${t}`;this.privConnectionState=d.ConnectionState.Disconnected,this.privDisconnectDeferral.resolve(),yield this.privReceivingMessageQueue.drainAndDispose((()=>{}),i),yield this.privSendMessageQueue.drainAndDispose((e=>{e.sendStatusDeferral.reject(i)}),i)}))}processSendQueue(){return y(this,void 0,void 0,(function*(){for(;;){const e=this.privSendMessageQueue.dequeue(),t=yield e;if(!t)return;try{yield this.sendRawMessage(t),t.sendStatusDeferral.resolve()}catch(e){t.sendStatusDeferral.reject(e)}}}))}onEvent(e){this.privConnectionEvents.onEvent(e),l.Events.instance.onEvent(e)}getAgent(){const e=new s.Agent(this.createConnection);return void 0!==this.proxyInfo&&void 0!==this.proxyInfo.HostName&&this.proxyInfo.Port>0&&(e.proxyInfo=this.proxyInfo),e}static GetProxyAgent(e){const t={host:e.HostName,port:e.Port};e.UserName?t.headers={"Proxy-Authentication":"Basic "+new Buffer(`${e.UserName}:${void 0===e.Password?"":e.Password}`).toString("base64")}:t.headers={},t.headers.requestOCSP="true";return new o(t)}createConnection(e,t){let i;if(t=Object.assign(Object.assign({},t),{requestOCSP:!0,servername:t.host}),this.proxyInfo){const r=R.GetProxyAgent(this.proxyInfo);i=new Promise(((i,n)=>{r.callback(e,t,((e,t)=>{e?n(e):i(t)}))}))}else i=t.secureEndpoint?Promise.resolve(n.connect(t)):Promise.resolve(r.connect(t));return i}get isWebsocketOpen(){return this.privWebsocketClient&&this.privWebsocketClient.readyState===this.privWebsocketClient.OPEN}}R.forceNpmWebSocket=!1},()=>{},()=>{},()=>{},()=>{},()=>{},(e,t,i)=>{"use strict";var r;i.r(t),i.d(t,{ConnectionState:()=>r}),function(e){e[e.None=0]="None",e[e.Connected=1]="Connected",e[e.Connecting=2]="Connecting",e[e.Disconnected=3]="Disconnected"}(r||(r={}))},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConnectionOpenResponse:()=>r});class r{constructor(e,t){this.privStatusCode=e,this.privReason=t}get statusCode(){return this.privStatusCode}get reason(){return this.privReason}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConnectionClosedEvent:()=>c,ConnectionErrorEvent:()=>p,ConnectionEstablishErrorEvent:()=>h,ConnectionEstablishedEvent:()=>a,ConnectionEvent:()=>s,ConnectionMessageReceivedEvent:()=>d,ConnectionMessageSentEvent:()=>u,ConnectionStartEvent:()=>o,ServiceEvent:()=>n});var r=i(20);class n extends r.PlatformEvent{constructor(e,t,i=r.EventType.Info){super(e,i),this.privJsonResult=t}get jsonString(){return this.privJsonResult}}class s extends r.PlatformEvent{constructor(e,t,i=r.EventType.Info){super(e,i),this.privConnectionId=t}get connectionId(){return this.privConnectionId}}class o extends s{constructor(e,t,i){super("ConnectionStartEvent",e),this.privUri=t,this.privHeaders=i}get uri(){return this.privUri}get headers(){return this.privHeaders}}class a extends s{constructor(e){super("ConnectionEstablishedEvent",e)}}class c extends s{constructor(e,t,i){super("ConnectionClosedEvent",e,r.EventType.Debug),this.privReason=i,this.privStatusCode=t}get reason(){return this.privReason}get statusCode(){return this.privStatusCode}}class p extends s{constructor(e,t,i){super("ConnectionErrorEvent",e,r.EventType.Debug),this.privMessage=t,this.privType=i}get message(){return this.privMessage}get type(){return this.privType}}class h extends s{constructor(e,t,i){super("ConnectionEstablishErrorEvent",e,r.EventType.Error),this.privStatusCode=t,this.privReason=i}get reason(){return this.privReason}get statusCode(){return this.privStatusCode}}class d extends s{constructor(e,t,i){super("ConnectionMessageReceivedEvent",e),this.privNetworkReceivedTime=t,this.privMessage=i}get networkReceivedTime(){return this.privNetworkReceivedTime}get message(){return this.privMessage}}class u extends s{constructor(e,t,i){super("ConnectionMessageSentEvent",e),this.privNetworkSentTime=t,this.privMessage=i}get networkSentTime(){return this.privNetworkSentTime}get message(){return this.privMessage}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{RawWebsocketMessage:()=>o});var r=i(80),n=i(17),s=i(9);class o{constructor(e,t,i){if(this.privPayload=null,!t)throw new n.ArgumentNullError("payload");if(e===r.MessageType.Binary&&"ArrayBuffer"!==t.__proto__.constructor.name)throw new n.InvalidOperationError("Payload must be ArrayBuffer");if(e===r.MessageType.Text&&"string"!=typeof t)throw new n.InvalidOperationError("Payload must be a string");this.privMessageType=e,this.privPayload=t,this.privId=i||(0,s.createNoDashGuid)()}get messageType(){return this.privMessageType}get payload(){return this.privPayload}get textContent(){if(this.privMessageType===r.MessageType.Binary)throw new n.InvalidOperationError("Not supported for binary message");return this.privPayload}get binaryContent(){if(this.privMessageType===r.MessageType.Text)throw new n.InvalidOperationError("Not supported for text message");return this.privPayload}get id(){return this.privId}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConnectionMessage:()=>o,MessageType:()=>r});var r,n=i(17),s=i(9);!function(e){e[e.Text=0]="Text",e[e.Binary=1]="Binary"}(r||(r={}));class o{constructor(e,t,i,o){if(this.privBody=null,e===r.Text&&t&&"string"!=typeof t)throw new n.InvalidOperationError("Payload must be a string");if(e===r.Binary&&t&&!(t instanceof ArrayBuffer))throw new n.InvalidOperationError("Payload must be ArrayBuffer");switch(this.privMessageType=e,this.privBody=t,this.privHeaders=i||{},this.privId=o||(0,s.createNoDashGuid)(),this.messageType){case r.Binary:this.privSize=null!==this.binaryBody?this.binaryBody.byteLength:0;break;case r.Text:this.privSize=this.textBody.length}}get messageType(){return this.privMessageType}get headers(){return this.privHeaders}get body(){return this.privBody}get textBody(){if(this.privMessageType===r.Binary)throw new n.InvalidOperationError("Not supported for binary message");return this.privBody}get binaryBody(){if(this.privMessageType===r.Text)throw new n.InvalidOperationError("Not supported for text message");return this.privBody}get id(){return this.privId}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{WebsocketMessageFormatter:()=>o});var r=i(18),n=i(80),s=i(79);class o{toConnectionMessage(e){const t=new r.Deferred;try{if(e.messageType===n.MessageType.Text){const i=e.textContent;let r={},s=null;if(i){const e=i.split("\r\n\r\n");e&&e.length>0&&(r=this.parseHeaders(e[0]),e.length>1&&(s=e[1]))}t.resolve(new n.ConnectionMessage(e.messageType,s,r,e.id))}else if(e.messageType===n.MessageType.Binary){const i=e.binaryContent;let r={},s=null;if(!i||i.byteLength<2)throw new Error("Invalid binary message format. Header length missing.");const o=new DataView(i),a=o.getInt16(0);if(i.byteLength<a+2)throw new Error("Invalid binary message format. Header content missing.");let c="";for(let e=0;e<a;e++)c+=String.fromCharCode(o.getInt8(e+2));r=this.parseHeaders(c),i.byteLength>a+2&&(s=i.slice(2+a)),t.resolve(new n.ConnectionMessage(e.messageType,s,r,e.id))}}catch(e){t.reject(`Error formatting the message. Error: ${e}`)}return t.promise}fromConnectionMessage(e){const t=new r.Deferred;try{if(e.messageType===n.MessageType.Text){const i=`${this.makeHeaders(e)}\r\n${e.textBody?e.textBody:""}`;t.resolve(new s.RawWebsocketMessage(n.MessageType.Text,i,e.id))}else if(e.messageType===n.MessageType.Binary){const i=this.makeHeaders(e),r=e.binaryBody,o=this.stringToArrayBuffer(i),a=new Int8Array(o),c=a.byteLength,p=new Int8Array(2+c+(r?r.byteLength:0));if(p[0]=c>>8&255,p[1]=255&c,p.set(a,2),r){const e=new Int8Array(r);p.set(e,2+c)}const h=p.buffer;t.resolve(new s.RawWebsocketMessage(n.MessageType.Binary,h,e.id))}}catch(e){t.reject(`Error formatting the message. ${e}`)}return t.promise}makeHeaders(e){let t="";if(e.headers)for(const i in e.headers)i&&(t+=`${i}: ${e.headers[i]}\r\n`);return t}parseHeaders(e){const t={};if(e){const i=e.match(/[^\r\n]+/g);if(t)for(const e of i)if(e){const i=e.indexOf(":"),r=i>0?e.substr(0,i).trim().toLowerCase():e,n=i>0&&e.length>i+1?e.substr(i+1).trim():"";t[r]=n}}return t}stringToArrayBuffer(e){const t=new ArrayBuffer(e.length),i=new DataView(t);for(let t=0;t<e.length;t++)i.setUint8(t,e.charCodeAt(t));return t}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ProxyInfo:()=>n});var r=i(59);class n{constructor(e,t,i,r){this.privProxyHostName=e,this.privProxyPort=t,this.privProxyUserName=i,this.privProxyPassword=r}static fromParameters(e){return new n(e.getProperty(r.PropertyId.SpeechServiceConnection_ProxyHostName),parseInt(e.getProperty(r.PropertyId.SpeechServiceConnection_ProxyPort),10),e.getProperty(r.PropertyId.SpeechServiceConnection_ProxyUserName),e.getProperty(r.PropertyId.SpeechServiceConnection_ProxyPassword))}static fromRecognizerConfig(e){return this.fromParameters(e.parameters)}get HostName(){return this.privProxyHostName}get Port(){return this.privProxyPort}get UserName(){return this.privProxyUserName}get Password(){return this.privProxyPassword}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SpeakerRecognitionConnectionFactory:()=>h,VoiceProfileConnectionFactory:()=>d});var r=i(69),n=i(82),s=i(59),o=i(67),a=i(81),c=i(64);class p extends o.ConnectionFactoryBase{create(e,t,i,p){let h=e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_Endpoint);if(!h){const t=e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_Region),r=o.ConnectionFactoryBase.getHostSuffix(t),n=e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_Host,`wss://${t}.spr-frontend.speech${r}`),a=e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_SpeakerIdMode,"TextIndependentIdentification");h=`${n}/speaker/ws/${this.scenarioToPath(a)}/${i}`}const d={format:"simple",language:e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_RecoLanguage)};this.setCommonUrlParams(e,d,h);const u={};void 0!==t.token&&""!==t.token&&(u[t.headerName]=t.token),u[c.HeaderNames.ConnectionId]=p,u[c.HeaderNames.SpIDAuthKey]=e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_Key),e.parameters.setProperty(s.PropertyId.SpeechServiceConnection_Url,h);const v="true"===e.parameters.getProperty("SPEECH-EnableWebsocketCompression","false");return new r.WebsocketConnection(h,d,u,new a.WebsocketMessageFormatter,n.ProxyInfo.fromRecognizerConfig(e),v,p)}scenarioToPath(e){switch(e){case"TextIndependentVerification":case"2":return"verification/text-independent";case"TextDependentVerification":case"1":return"verification/text-dependent";default:return"identification/text-independent"}}}class h extends p{create(e,t,i){return super.create(e,t,"recognition",i)}}class d extends p{create(e,t,i){return super.create(e,t,"profile",i)}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConnectingToServiceEvent:()=>c,ListeningStartedEvent:()=>a,RecognitionCompletionStatus:()=>r,RecognitionEndedEvent:()=>h,RecognitionStartedEvent:()=>p,RecognitionTriggeredEvent:()=>o,SpeechRecognitionEvent:()=>s});var r,n=i(20);class s extends n.PlatformEvent{constructor(e,t,i,r=n.EventType.Info){super(e,r),this.privRequestId=t,this.privSessionId=i}get requestId(){return this.privRequestId}get sessionId(){return this.privSessionId}}class o extends s{constructor(e,t,i,r){super("RecognitionTriggeredEvent",e,t),this.privAudioSourceId=i,this.privAudioNodeId=r}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}}class a extends s{constructor(e,t,i,r){super("ListeningStartedEvent",e,t),this.privAudioSourceId=i,this.privAudioNodeId=r}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}}class c extends s{constructor(e,t,i){super("ConnectingToServiceEvent",e,i),this.privAuthFetchEventid=t}get authFetchEventid(){return this.privAuthFetchEventid}}class p extends s{constructor(e,t,i,r,n){super("RecognitionStartedEvent",e,n),this.privAudioSourceId=t,this.privAudioNodeId=i,this.privAuthFetchEventId=r}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}get authFetchEventId(){return this.privAuthFetchEventId}}!function(e){e[e.Success=0]="Success",e[e.AudioSourceError=1]="AudioSourceError",e[e.AudioSourceTimeout=2]="AudioSourceTimeout",e[e.AuthTokenFetchError=3]="AuthTokenFetchError",e[e.AuthTokenFetchTimeout=4]="AuthTokenFetchTimeout",e[e.UnAuthorized=5]="UnAuthorized",e[e.ConnectTimeout=6]="ConnectTimeout",e[e.ConnectError=7]="ConnectError",e[e.ClientRecognitionActivityTimeout=8]="ClientRecognitionActivityTimeout",e[e.UnknownError=9]="UnknownError"}(r||(r={}));class h extends s{constructor(e,t,i,s,o,a,c,p){super("RecognitionEndedEvent",e,o,c===r.Success?n.EventType.Info:n.EventType.Error),this.privAudioSourceId=t,this.privAudioNodeId=i,this.privAuthFetchEventId=s,this.privStatus=c,this.privError=p,this.privServiceTag=a}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}get authFetchEventId(){return this.privAuthFetchEventId}get serviceTag(){return this.privServiceTag}get status(){return this.privStatus}get error(){return this.privError}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ServiceRecognizerBase:()=>E});var r=i(93),n=i(17),s=i(16),o=i(90),a=i(9),c=i(80),p=i(78),h=i(76),d=i(59),u=i(40),v=i(91),l=i(44),g=i(42),m=i(43),S=i(86),f=i(88),C=i(89),y=i(2),R=i(92),P=i(61),I=i(21),T=i(95),w=i(94),A=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class E{constructor(e,t,i,r,c){if(this.privConnectionConfigurationPromise=void 0,this.privConnectionPromise=void 0,this.privSetTimeout=setTimeout,this.privIsLiveAudio=!1,this.privAverageBytesPerMs=0,this.privEnableSpeakerId=!1,this.recognizeOverride=void 0,this.recognizeSpeaker=void 0,this.disconnectOverride=void 0,this.receiveMessageOverride=void 0,this.sendPrePayloadJSONOverride=void 0,this.postConnectImplOverride=void 0,this.configConnectionOverride=void 0,this.handleSpeechPhraseMessage=void 0,this.handleSpeechHypothesisMessage=void 0,!e)throw new n.ArgumentNullError("authentication");if(!t)throw new n.ArgumentNullError("connectionFactory");if(!i)throw new n.ArgumentNullError("audioSource");if(!r)throw new n.ArgumentNullError("recognizerConfig");this.privEnableSpeakerId=r.isSpeakerDiarizationEnabled,this.privMustReportEndOfStream=!1,this.privAuthentication=e,this.privConnectionFactory=t,this.privAudioSource=i,this.privRecognizerConfig=r,this.privIsDisposed=!1,this.privRecognizer=c,this.privRequestSession=new S.RequestSession(this.privAudioSource.id()),this.privConnectionEvents=new s.EventSource,this.privServiceEvents=new s.EventSource,this.privDynamicGrammar=new f.DynamicGrammarBuilder,this.privSpeechContext=new C.SpeechContext(this.privDynamicGrammar),this.privAgentConfig=new y.AgentConfig;"on"===this.privRecognizerConfig.parameters.getProperty(d.PropertyId.WebWorkerLoadType,"on").toLowerCase()&&"undefined"!=typeof Blob&&"undefined"!=typeof Worker?this.privSetTimeout=o.Timeout.setTimeout:"undefined"!=typeof window&&(this.privSetTimeout=window.setTimeout.bind(window)),this.connectionEvents.attach((e=>{if("ConnectionClosedEvent"===e.name){const t=e;(1003===t.statusCode||1007===t.statusCode||1002===t.statusCode||4e3===t.statusCode||this.privRequestSession.numConnectionAttempts>this.privRecognizerConfig.maxRetryCount)&&this.cancelRecognitionLocal(u.CancellationReason.Error,1007===t.statusCode?v.CancellationErrorCode.BadRequestParameters:v.CancellationErrorCode.ConnectionFailure,`${t.reason} websocket error code: ${t.statusCode}`)}})),this.privEnableSpeakerId&&(this.privDiarizationSessionId=(0,a.createNoDashGuid)()),this.setLanguageIdJson(),this.setOutputDetailLevelJson()}setTranslationJson(){const e=this.privRecognizerConfig.parameters.getProperty(d.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0);if(void 0!==e){const t=e.split(","),i=this.privRecognizerConfig.parameters.getProperty(d.PropertyId.SpeechServiceConnection_TranslationVoice,void 0),r=void 0!==i?"Synthesize":"None";if(this.privSpeechContext.setSection("translation",{onSuccess:{action:r},output:{interimResults:{mode:"Always"}},targetLanguages:t}),void 0!==i){const e={};for(const r of t)e[r]=i;this.privSpeechContext.setSection("synthesis",{defaultVoices:e})}}}setSpeechSegmentationTimeoutJson(){const e=this.privRecognizerConfig.parameters.getProperty(d.PropertyId.Speech_SegmentationSilenceTimeoutMs,void 0);if(void 0!==e){const t=this.recognitionMode===R.RecognitionMode.Conversation?"CONVERSATION":this.recognitionMode===R.RecognitionMode.Dictation?"DICTATION":"INTERACTIVE",i=parseInt(e,10),r=this.privSpeechContext.getSection("phraseDetection");r.mode=t,r[t]={segmentation:{mode:"Custom",segmentationSilenceTimeoutMs:i}},this.privSpeechContext.setSection("phraseDetection",r)}}setLanguageIdJson(){const e=this.privSpeechContext.getSection("phraseDetection");if(void 0!==this.privRecognizerConfig.autoDetectSourceLanguages){const t=this.privRecognizerConfig.autoDetectSourceLanguages.split(",");let i;i="Continuous"===this.privRecognizerConfig.languageIdMode?"DetectContinuous":"DetectAtAudioStart",this.privSpeechContext.setSection("languageId",{Priority:"PrioritizeLatency",languages:t,mode:i,onSuccess:{action:"Recognize"},onUnknown:{action:"None"}}),this.privSpeechContext.setSection("phraseOutput",{interimResults:{resultType:"Auto"},phraseResults:{resultType:"Always"}});const r=this.privRecognizerConfig.sourceLanguageModels;void 0!==r&&(e.customModels=r,e.onInterim={action:"None"},e.onSuccess={action:"None"})}void 0!==this.privRecognizerConfig.parameters.getProperty(d.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0)&&(e.onInterim={action:"Translate"},e.onSuccess={action:"Translate"},this.privSpeechContext.setSection("phraseOutput",{interimResults:{resultType:"None"},phraseResults:{resultType:"None"}})),this.privSpeechContext.setSection("phraseDetection",e)}setOutputDetailLevelJson(){if(this.privEnableSpeakerId){if("true"===this.privRecognizerConfig.parameters.getProperty(d.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,"false").toLowerCase())this.privSpeechContext.setWordLevelTimings();else{this.privRecognizerConfig.parameters.getProperty(P.OutputFormatPropertyName,l.OutputFormat[l.OutputFormat.Simple]).toLowerCase()===l.OutputFormat[l.OutputFormat.Detailed].toLocaleLowerCase()&&this.privSpeechContext.setDetailedOutputFormat()}}}get isSpeakerDiarizationEnabled(){return this.privEnableSpeakerId}get audioSource(){return this.privAudioSource}get speechContext(){return this.privSpeechContext}get dynamicGrammar(){return this.privDynamicGrammar}get agentConfig(){return this.privAgentConfig}set conversationTranslatorToken(e){this.privRecognizerConfig.parameters.setProperty(d.PropertyId.ConversationTranslator_Token,e)}set voiceProfileType(e){this.privRecognizerConfig.parameters.setProperty(d.PropertyId.SpeechServiceConnection_SpeakerIdMode,e)}set authentication(e){this.privAuthentication=e}isDisposed(){return this.privIsDisposed}dispose(e){return A(this,void 0,void 0,(function*(){if(this.privIsDisposed=!0,void 0!==this.privConnectionConfigurationPromise)try{const t=yield this.privConnectionConfigurationPromise;yield t.dispose(e)}catch(e){return}}))}get connectionEvents(){return this.privConnectionEvents}get serviceEvents(){return this.privServiceEvents}get recognitionMode(){return this.privRecognizerConfig.recognitionMode}recognize(e,t,i){return A(this,void 0,void 0,(function*(){if(void 0!==this.recognizeOverride)return void(yield this.recognizeOverride(e,t,i));this.privConnectionConfigurationPromise=void 0,this.privRecognizerConfig.recognitionMode=e,this.setSpeechSegmentationTimeoutJson(),this.setTranslationJson(),this.privSuccessCallback=t,this.privErrorCallback=i,this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privAudioSource.events);const n=this.connectImpl();let s;try{const e=yield this.audioSource.attach(this.privRequestSession.audioNodeId),t=yield this.audioSource.format,i=yield this.audioSource.deviceInfo;this.privIsLiveAudio=i.type&&i.type===I.type.Microphones,s=new r.ReplayableAudioNode(e,t.avgBytesPerSec),yield this.privRequestSession.onAudioSourceAttachCompleted(s,!1),this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:i}}catch(e){throw yield this.privRequestSession.onStopRecognizing(),e}try{yield n}catch(e){return void(yield this.cancelRecognitionLocal(u.CancellationReason.Error,v.CancellationErrorCode.ConnectionFailure,e))}const o=new g.SessionEventArgs(this.privRequestSession.sessionId);this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,o),this.receiveMessage();this.sendAudio(s).catch((e=>A(this,void 0,void 0,(function*(){yield this.cancelRecognitionLocal(u.CancellationReason.Error,v.CancellationErrorCode.RuntimeError,e)}))))}))}stopRecognizing(){return A(this,void 0,void 0,(function*(){if(this.privRequestSession.isRecognizing)try{yield this.audioSource.turnOff(),yield this.sendFinalAudio(),yield this.privRequestSession.onStopRecognizing(),yield this.privRequestSession.turnCompletionPromise}finally{yield this.privRequestSession.dispose()}}))}connect(){return A(this,void 0,void 0,(function*(){return yield this.connectImpl(),Promise.resolve()}))}connectAsync(e,t){this.connectImpl().then((()=>{try{e&&e()}catch(e){t&&t(e)}}),(e=>{try{t&&t(e)}catch(e){}}))}disconnect(){return A(this,void 0,void 0,(function*(){if(yield this.cancelRecognitionLocal(u.CancellationReason.Error,v.CancellationErrorCode.NoError,"Disconnecting"),void 0!==this.disconnectOverride&&(yield this.disconnectOverride()),void 0!==this.privConnectionPromise)try{yield(yield this.privConnectionPromise).dispose()}catch(e){}this.privConnectionPromise=void 0}))}sendMessage(e){}sendNetworkMessage(e,t){return A(this,void 0,void 0,(function*(){const i="string"==typeof t?c.MessageType.Text:c.MessageType.Binary,r="string"==typeof t?"application/json":"";return(yield this.fetchConnection()).send(new w.SpeechConnectionMessage(i,e,this.privRequestSession.requestId,r,t))}))}set activityTemplate(e){this.privActivityTemplate=e}get activityTemplate(){return this.privActivityTemplate}sendTelemetryData(){return A(this,void 0,void 0,(function*(){const e=this.privRequestSession.getTelemetry();if(!0!==E.telemetryDataEnabled||this.privIsDisposed||null===e)return;if(E.telemetryData)try{E.telemetryData(e)}catch(e){}const t=yield this.fetchConnection();yield t.send(new w.SpeechConnectionMessage(c.MessageType.Text,"telemetry",this.privRequestSession.requestId,"application/json",e))}))}cancelRecognitionLocal(e,t,i){return A(this,void 0,void 0,(function*(){this.privRequestSession.isRecognizing&&(yield this.privRequestSession.onStopRecognizing(),this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,e,t,i))}))}receiveMessage(){return A(this,void 0,void 0,(function*(){try{if(this.privIsDisposed)return;let e=yield this.fetchConnection();const t=yield e.read();if(void 0!==this.receiveMessageOverride)return this.receiveMessageOverride();if(!t)return this.receiveMessage();this.privServiceHasSentMessage=!0;const i=w.SpeechConnectionMessage.fromConnectionMessage(t);if(i.requestId.toLowerCase()===this.privRequestSession.requestId.toLowerCase())switch(i.path.toLowerCase()){case"turn.start":this.privMustReportEndOfStream=!0,this.privRequestSession.onServiceTurnStartResponse();break;case"speech.startdetected":const t=T.SpeechDetected.fromJSON(i.textBody),r=new m.RecognitionEventArgs(t.Offset,this.privRequestSession.sessionId);this.privRecognizer.speechStartDetected&&this.privRecognizer.speechStartDetected(this.privRecognizer,r);break;case"speech.enddetected":let n;n=i.textBody.length>0?i.textBody:"{ Offset: 0 }";const s=T.SpeechDetected.fromJSON(n),o=new m.RecognitionEventArgs(s.Offset+this.privRequestSession.currentTurnAudioOffset,this.privRequestSession.sessionId);this.privRecognizer.speechEndDetected&&this.privRecognizer.speechEndDetected(this.privRecognizer,o);break;case"turn.end":yield this.sendTelemetryData(),this.privRequestSession.isSpeechEnded&&this.privMustReportEndOfStream&&(this.privMustReportEndOfStream=!1,yield this.cancelRecognitionLocal(u.CancellationReason.EndOfStream,v.CancellationErrorCode.NoError,void 0));const a=new g.SessionEventArgs(this.privRequestSession.sessionId);if(yield this.privRequestSession.onServiceTurnEndResponse(this.privRecognizerConfig.isContinuousRecognition),!this.privRecognizerConfig.isContinuousRecognition||this.privRequestSession.isSpeechEnded||!this.privRequestSession.isRecognizing)return void(this.privRecognizer.sessionStopped&&this.privRecognizer.sessionStopped(this.privRecognizer,a));e=yield this.fetchConnection(),yield this.sendPrePayloadJSON(e);break;default:(yield this.processTypeSpecificMessages(i))||this.privServiceEvents&&this.serviceEvents.onEvent(new p.ServiceEvent(i.path.toLowerCase(),i.textBody))}return this.receiveMessage()}catch(e){return null}}))}updateSpeakerDiarizationAudioOffset(){const e=this.privRequestSession.recognitionBytesSent/this.privAverageBytesPerMs;this.privSpeechContext.setSpeakerDiarizationAudioOffsetMs(e)}sendSpeechContext(e,t){this.privEnableSpeakerId&&this.updateSpeakerDiarizationAudioOffset();const i=this.speechContext.toJSON();if(t&&this.privRequestSession.onSpeechContext(),i)return e.send(new w.SpeechConnectionMessage(c.MessageType.Text,"speech.context",this.privRequestSession.requestId,"application/json",i))}noOp(){}sendPrePayloadJSON(e,t=!0){return A(this,void 0,void 0,(function*(){if(void 0!==this.sendPrePayloadJSONOverride)return this.sendPrePayloadJSONOverride(e);yield this.sendSpeechContext(e,t),yield this.sendWaveHeader(e)}))}sendWaveHeader(e){return A(this,void 0,void 0,(function*(){const t=yield this.audioSource.format;return e.send(new w.SpeechConnectionMessage(c.MessageType.Binary,"audio",this.privRequestSession.requestId,"audio/x-wav",t.header))}))}connectImpl(){return void 0!==this.privConnectionPromise?this.privConnectionPromise.then((e=>e.state()===h.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionPromise=void 0,this.privServiceHasSentMessage=!1,this.connectImpl()):this.privConnectionPromise),(()=>(this.privConnectionId=null,this.privConnectionPromise=void 0,this.privServiceHasSentMessage=!1,this.connectImpl()))):(this.privConnectionPromise=this.retryableConnect(),this.privConnectionPromise.catch((()=>{})),void 0!==this.postConnectImplOverride?this.postConnectImplOverride(this.privConnectionPromise):this.privConnectionPromise)}sendSpeechServiceConfig(e,t,i){if(t.onSpeechContext(),!0!==E.telemetryDataEnabled){const e={context:{system:JSON.parse(i).context.system}};i=JSON.stringify(e)}if("true"===this.privRecognizerConfig.parameters.getProperty("f0f5debc-f8c9-4892-ac4b-90a7ab359fd2","false").toLowerCase()){const e=JSON.parse(i);e.context.DisableReferenceChannel="True",e.context.MicSpec="1_0_0",i=JSON.stringify(e)}if(i)return e.send(new w.SpeechConnectionMessage(c.MessageType.Text,"speech.config",t.requestId,"application/json",i))}fetchConnection(){return A(this,void 0,void 0,(function*(){return void 0!==this.privConnectionConfigurationPromise?this.privConnectionConfigurationPromise.then((e=>e.state()===h.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.privServiceHasSentMessage=!1,this.fetchConnection()):this.privConnectionConfigurationPromise),(()=>(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.privServiceHasSentMessage=!1,this.fetchConnection()))):(this.privConnectionConfigurationPromise=this.configureConnection(),yield this.privConnectionConfigurationPromise)}))}sendAudio(e){return A(this,void 0,void 0,(function*(){const t=yield this.audioSource.format;this.privAverageBytesPerMs=t.avgBytesPerSec/1e3;let i=Date.now();const r=this.privRecognizerConfig.parameters.getProperty("SPEECH-TransmitLengthBeforThrottleMs","5000"),n=t.avgBytesPerSec/1e3*parseInt(r,10),s=this.privRequestSession.recogNumber,o=()=>A(this,void 0,void 0,(function*(){if(!this.privIsDisposed&&!this.privRequestSession.isSpeechEnded&&this.privRequestSession.isRecognizing&&this.privRequestSession.recogNumber===s){const r=yield this.fetchConnection(),a=yield e.read();if(this.privRequestSession.isSpeechEnded)return;let p,h;if(!a||a.isEnd?(p=null,h=0):(p=a.buffer,this.privRequestSession.onAudioSent(p.byteLength),h=n>=this.privRequestSession.bytesSent?0:Math.max(0,i-Date.now())),0!==h&&(yield this.delay(h)),null!==p&&(i=Date.now()+1e3*p.byteLength/(2*t.avgBytesPerSec)),!this.privIsDisposed&&!this.privRequestSession.isSpeechEnded&&this.privRequestSession.isRecognizing&&this.privRequestSession.recogNumber===s){if(r.send(new w.SpeechConnectionMessage(c.MessageType.Binary,"audio",this.privRequestSession.requestId,null,p)).catch((()=>{this.privRequestSession.onServiceTurnEndResponse(this.privRecognizerConfig.isContinuousRecognition).catch((()=>{}))})),!(null==a?void 0:a.isEnd))return o();this.privIsLiveAudio||this.privRequestSession.onSpeechEnded()}}}));return o()}))}retryableConnect(){return A(this,void 0,void 0,(function*(){let e=!1;this.privAuthFetchEventId=(0,a.createNoDashGuid)();const t=this.privRequestSession.sessionId;this.privConnectionId=void 0!==t?t:(0,a.createNoDashGuid)(),this.privRequestSession.onPreConnectionStart(this.privAuthFetchEventId,this.privConnectionId);let i=0,r="";for(;this.privRequestSession.numConnectionAttempts<=this.privRecognizerConfig.maxRetryCount;){const t=e?this.privAuthentication.fetchOnExpiry(this.privAuthFetchEventId):this.privAuthentication.fetch(this.privAuthFetchEventId),n=yield t;yield this.privRequestSession.onAuthCompleted(!1);const s=this.privConnectionFactory.create(this.privRecognizerConfig,n,this.privConnectionId);this.privRequestSession.listenForServiceTelemetry(s.events),s.events.attach((e=>{this.connectionEvents.onEvent(e)}));const o=yield s.open();if(200===o.statusCode)return yield this.privRequestSession.onConnectionEstablishCompleted(o.statusCode),Promise.resolve(s);1006===o.statusCode&&(e=!0),i=o.statusCode,r=o.reason,this.privRequestSession.onRetryConnection()}return yield this.privRequestSession.onConnectionEstablishCompleted(i,r),Promise.reject(`Unable to contact server. StatusCode: ${i}, ${this.privRecognizerConfig.parameters.getProperty(d.PropertyId.SpeechServiceConnection_Endpoint)} Reason: ${r}`)}))}delay(e){return new Promise((t=>this.privSetTimeout(t,e)))}writeBufferToConsole(e){let t="Buffer Size: ";if(null===e)t+="null";else{const i=new Uint8Array(e);t+=`${e.byteLength}\r\n`;for(let r=0;r<e.byteLength;r++)t+=i[r].toString(16).padStart(2,"0")+" ",(r+1)%16==0&&(console.info(t),t="")}console.info(t)}sendFinalAudio(){return A(this,void 0,void 0,(function*(){const e=yield this.fetchConnection();yield e.send(new w.SpeechConnectionMessage(c.MessageType.Binary,"audio",this.privRequestSession.requestId,null,null))}))}configureConnection(){return A(this,void 0,void 0,(function*(){const e=yield this.connectImpl();return void 0!==this.configConnectionOverride?this.configConnectionOverride(e):(yield this.sendSpeechServiceConfig(e,this.privRequestSession,this.privRecognizerConfig.SpeechServiceConfig.serialize()),yield this.sendPrePayloadJSON(e,!1),e)}))}}E.telemetryDataEnabled=!0},(e,t,i)=>{"use strict";i.r(t),i.d(t,{RequestSession:()=>p});var r=i(9),n=i(18),s=i(26),o=i(84),a=i(87),c=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class p{constructor(e){this.privIsDisposed=!1,this.privDetachables=new Array,this.privIsAudioNodeDetached=!1,this.privIsRecognizing=!1,this.privIsSpeechEnded=!1,this.privTurnStartAudioOffset=0,this.privLastRecoOffset=0,this.privHypothesisReceived=!1,this.privBytesSent=0,this.privRecognitionBytesSent=0,this.privRecogNumber=0,this.privInTurn=!1,this.privConnectionAttempts=0,this.privAudioSourceId=e,this.privRequestId=(0,r.createNoDashGuid)(),this.privAudioNodeId=(0,r.createNoDashGuid)(),this.privTurnDeferral=new n.Deferred,this.privTurnDeferral.resolve()}get sessionId(){return this.privSessionId}get requestId(){return this.privRequestId}get audioNodeId(){return this.privAudioNodeId}get turnCompletionPromise(){return this.privTurnDeferral.promise}get isSpeechEnded(){return this.privIsSpeechEnded}get isRecognizing(){return this.privIsRecognizing}get currentTurnAudioOffset(){return this.privTurnStartAudioOffset}get recogNumber(){return this.privRecogNumber}get numConnectionAttempts(){return this.privConnectionAttempts}get bytesSent(){return this.privBytesSent}get recognitionBytesSent(){return this.privRecognitionBytesSent}listenForServiceTelemetry(e){this.privServiceTelemetryListener&&this.privDetachables.push(e.attachListener(this.privServiceTelemetryListener))}startNewRecognition(){this.privRecognitionBytesSent=0,this.privIsSpeechEnded=!1,this.privIsRecognizing=!0,this.privTurnStartAudioOffset=0,this.privLastRecoOffset=0,this.privRecogNumber++,this.privServiceTelemetryListener=new a.ServiceTelemetryListener(this.privRequestId,this.privAudioSourceId,this.privAudioNodeId),this.onEvent(new o.RecognitionTriggeredEvent(this.requestId,this.privSessionId,this.privAudioSourceId,this.privAudioNodeId))}onAudioSourceAttachCompleted(e,t){return c(this,void 0,void 0,(function*(){this.privAudioNode=e,this.privIsAudioNodeDetached=!1,t?yield this.onComplete():this.onEvent(new o.ListeningStartedEvent(this.privRequestId,this.privSessionId,this.privAudioSourceId,this.privAudioNodeId))}))}onPreConnectionStart(e,t){this.privAuthFetchEventId=e,this.privSessionId=t,this.onEvent(new o.ConnectingToServiceEvent(this.privRequestId,this.privAuthFetchEventId,this.privSessionId))}onAuthCompleted(e){return c(this,void 0,void 0,(function*(){e&&(yield this.onComplete())}))}onConnectionEstablishCompleted(e,t){return c(this,void 0,void 0,(function*(){if(200===e)return this.onEvent(new o.RecognitionStartedEvent(this.requestId,this.privAudioSourceId,this.privAudioNodeId,this.privAuthFetchEventId,this.privSessionId)),this.privAudioNode&&this.privAudioNode.replay(),this.privTurnStartAudioOffset=this.privLastRecoOffset,void(this.privBytesSent=0);403===e&&(yield this.onComplete())}))}onServiceTurnEndResponse(e){return c(this,void 0,void 0,(function*(){this.privTurnDeferral.resolve(),!e||this.isSpeechEnded?(yield this.onComplete(),this.privInTurn=!1):(this.privTurnStartAudioOffset=this.privLastRecoOffset,this.privAudioNode.replay())}))}onSpeechContext(){this.privRequestId=(0,r.createNoDashGuid)()}onServiceTurnStartResponse(){this.privTurnDeferral&&this.privInTurn&&(this.privTurnDeferral.reject("Another turn started before current completed."),this.privTurnDeferral.promise.then().catch((()=>{}))),this.privInTurn=!0,this.privTurnDeferral=new n.Deferred}onHypothesis(e){this.privHypothesisReceived||(this.privHypothesisReceived=!0,this.privServiceTelemetryListener.hypothesisReceived(this.privAudioNode.findTimeAtOffset(e)))}onPhraseRecognized(e){this.privServiceTelemetryListener.phraseReceived(this.privAudioNode.findTimeAtOffset(e)),this.onServiceRecognized(e)}onServiceRecognized(e){this.privLastRecoOffset=e,this.privHypothesisReceived=!1,this.privAudioNode.shrinkBuffers(e),this.privConnectionAttempts=0}onAudioSent(e){this.privBytesSent+=e,this.privRecognitionBytesSent+=e}onRetryConnection(){this.privConnectionAttempts++}dispose(){return c(this,void 0,void 0,(function*(){if(!this.privIsDisposed){this.privIsDisposed=!0;for(const e of this.privDetachables)yield e.detach();this.privServiceTelemetryListener&&this.privServiceTelemetryListener.dispose(),this.privIsRecognizing=!1}}))}getTelemetry(){return this.privServiceTelemetryListener.hasTelemetry?this.privServiceTelemetryListener.getTelemetry():null}onStopRecognizing(){return c(this,void 0,void 0,(function*(){yield this.onComplete()}))}onSpeechEnded(){this.privIsSpeechEnded=!0}onEvent(e){this.privServiceTelemetryListener&&this.privServiceTelemetryListener.onEvent(e),s.Events.instance.onEvent(e)}onComplete(){return c(this,void 0,void 0,(function*(){this.privIsRecognizing&&(this.privIsRecognizing=!1,yield this.detachAudioNode())}))}detachAudioNode(){return c(this,void 0,void 0,(function*(){this.privIsAudioNodeDetached||(this.privIsAudioNodeDetached=!0,this.privAudioNode&&(yield this.privAudioNode.detach()))}))}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ServiceTelemetryListener:()=>o});var r=i(19),n=i(78),s=i(84);class o{constructor(e,t,i){this.privIsDisposed=!1,this.privListeningTriggerMetric=null,this.privMicMetric=null,this.privConnectionEstablishMetric=null,this.privRequestId=e,this.privAudioSourceId=t,this.privAudioNodeId=i,this.privReceivedMessages={},this.privPhraseLatencies=[],this.privHypothesisLatencies=[]}phraseReceived(e){e>0&&this.privPhraseLatencies.push(Date.now()-e)}hypothesisReceived(e){e>0&&this.privHypothesisLatencies.push(Date.now()-e)}onEvent(e){if(!this.privIsDisposed&&(e instanceof s.RecognitionTriggeredEvent&&e.requestId===this.privRequestId&&(this.privListeningTriggerMetric={End:e.eventTime,Name:"ListeningTrigger",Start:e.eventTime}),e instanceof r.AudioStreamNodeAttachingEvent&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicStartTime=e.eventTime),e instanceof r.AudioStreamNodeAttachedEvent&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicStartTime=e.eventTime),e instanceof r.AudioSourceErrorEvent&&e.audioSourceId===this.privAudioSourceId&&(this.privMicMetric||(this.privMicMetric={End:e.eventTime,Error:e.error,Name:"Microphone",Start:this.privMicStartTime})),e instanceof r.AudioStreamNodeErrorEvent&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicMetric||(this.privMicMetric={End:e.eventTime,Error:e.error,Name:"Microphone",Start:this.privMicStartTime})),e instanceof r.AudioStreamNodeDetachedEvent&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicMetric||(this.privMicMetric={End:e.eventTime,Name:"Microphone",Start:this.privMicStartTime})),e instanceof s.ConnectingToServiceEvent&&e.requestId===this.privRequestId&&(this.privConnectionId=e.sessionId),e instanceof n.ConnectionStartEvent&&e.connectionId===this.privConnectionId&&(this.privConnectionStartTime=e.eventTime),e instanceof n.ConnectionEstablishedEvent&&e.connectionId===this.privConnectionId&&(this.privConnectionEstablishMetric||(this.privConnectionEstablishMetric={End:e.eventTime,Id:this.privConnectionId,Name:"Connection",Start:this.privConnectionStartTime})),e instanceof n.ConnectionEstablishErrorEvent&&e.connectionId===this.privConnectionId&&(this.privConnectionEstablishMetric||(this.privConnectionEstablishMetric={End:e.eventTime,Error:this.getConnectionError(e.statusCode),Id:this.privConnectionId,Name:"Connection",Start:this.privConnectionStartTime})),e instanceof n.ConnectionMessageReceivedEvent&&e.connectionId===this.privConnectionId&&e.message&&e.message.headers&&e.message.headers.path)){this.privReceivedMessages[e.message.headers.path]||(this.privReceivedMessages[e.message.headers.path]=new Array);const t=50;this.privReceivedMessages[e.message.headers.path].length<t&&this.privReceivedMessages[e.message.headers.path].push(e.networkReceivedTime)}}getTelemetry(){const e=new Array;this.privListeningTriggerMetric&&e.push(this.privListeningTriggerMetric),this.privMicMetric&&e.push(this.privMicMetric),this.privConnectionEstablishMetric&&e.push(this.privConnectionEstablishMetric),this.privPhraseLatencies.length>0&&e.push({PhraseLatencyMs:this.privPhraseLatencies}),this.privHypothesisLatencies.length>0&&e.push({FirstHypothesisLatencyMs:this.privHypothesisLatencies});const t={Metrics:e,ReceivedMessages:this.privReceivedMessages},i=JSON.stringify(t);return this.privReceivedMessages={},this.privListeningTriggerMetric=null,this.privMicMetric=null,this.privConnectionEstablishMetric=null,this.privPhraseLatencies=[],this.privHypothesisLatencies=[],i}get hasTelemetry(){return 0!==Object.keys(this.privReceivedMessages).length||null!==this.privListeningTriggerMetric||null!==this.privMicMetric||null!==this.privConnectionEstablishMetric||0!==this.privPhraseLatencies.length||0!==this.privHypothesisLatencies.length}dispose(){this.privIsDisposed=!0}getConnectionError(e){switch(e){case 400:case 1002:case 1003:case 1005:case 1007:case 1008:case 1009:return"BadRequest";case 401:return"Unauthorized";case 403:return"Forbidden";case 503:case 1001:return"ServerUnavailable";case 500:case 1011:return"ServerError";case 408:case 504:return"Timeout";default:return"statuscode:"+e.toString()}}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{DynamicGrammarBuilder:()=>r});class r{addPhrase(e){this.privPhrases||(this.privPhrases=[]),e instanceof Array?this.privPhrases=this.privPhrases.concat(e):this.privPhrases.push(e)}clearPhrases(){this.privPhrases=void 0}addReferenceGrammar(e){this.privGrammars||(this.privGrammars=[]),e instanceof Array?this.privGrammars=this.privGrammars.concat(e):this.privGrammars.push(e)}clearGrammars(){this.privGrammars=void 0}generateGrammarObject(){if(void 0===this.privGrammars&&void 0===this.privPhrases)return;const e={};if(e.ReferenceGrammars=this.privGrammars,void 0!==this.privPhrases&&0!==this.privPhrases.length){const t=[];this.privPhrases.forEach((e=>{t.push({Text:e})})),e.Groups=[{Type:"Generic",Items:t}]}return e}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SpeechContext:()=>r});class r{constructor(e){this.privContext={},this.privDynamicGrammar=e}getSection(e){return this.privContext[e]||{}}setSection(e,t){this.privContext[e]=t}setPronunciationAssessmentParams(e,t,i=!1){void 0===this.privContext.phraseDetection&&(this.privContext.phraseDetection={enrichment:{pronunciationAssessment:{}}}),void 0===this.privContext.phraseDetection.enrichment&&(this.privContext.phraseDetection.enrichment={pronunciationAssessment:{}}),this.privContext.phraseDetection.enrichment.pronunciationAssessment=JSON.parse(e),i&&(this.privContext.phraseDetection.mode="Conversation"),this.setWordLevelTimings(),this.privContext.phraseOutput.detailed.options.push("PronunciationAssessment"),-1===this.privContext.phraseOutput.detailed.options.indexOf("SNR")&&this.privContext.phraseOutput.detailed.options.push("SNR"),t&&(this.privContext.phraseDetection.enrichment.contentAssessment={topic:t},this.privContext.phraseOutput.detailed.options.push("ContentAssessment"))}setDetailedOutputFormat(){void 0===this.privContext.phraseOutput&&(this.privContext.phraseOutput={detailed:{options:[]},format:{}}),void 0===this.privContext.phraseOutput.detailed&&(this.privContext.phraseOutput.detailed={options:[]}),this.privContext.phraseOutput.format="Detailed"}setWordLevelTimings(){void 0===this.privContext.phraseOutput&&(this.privContext.phraseOutput={detailed:{options:[]},format:{}}),void 0===this.privContext.phraseOutput.detailed&&(this.privContext.phraseOutput.detailed={options:[]}),this.privContext.phraseOutput.format="Detailed",-1===this.privContext.phraseOutput.detailed.options.indexOf("WordTimings")&&this.privContext.phraseOutput.detailed.options.push("WordTimings")}setSpeakerDiarizationAudioOffsetMs(e){this.privContext.phraseDetection.speakerDiarization.audioOffsetMs=e}toJSON(){const e=this.privDynamicGrammar.generateGrammarObject();this.setSection("dgi",e);return JSON.stringify(this.privContext)}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{Timeout:()=>r});class r{static load(){const e=new Map([[0,()=>{}]]),t=new Map,i="data:text/javascript;base64,"+btoa('!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=14)}([function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return a})),n.d(t,"d",(function(){return d}));const r=new Map,o=new Map,i=e=>{const t=r.get(e);if(void 0===t)throw new Error(\'There is no interval scheduled with the given id "\'.concat(e,\'".\'));clearTimeout(t),r.delete(e)},u=e=>{const t=o.get(e);if(void 0===t)throw new Error(\'There is no timeout scheduled with the given id "\'.concat(e,\'".\'));clearTimeout(t),o.delete(e)},f=(e,t)=>{let n,r;if("performance"in self){const o=performance.now();n=o,r=e-Math.max(0,o-t)}else n=Date.now(),r=e;return{expected:n+r,remainingDelay:r}},c=(e,t,n,r)=>{const o="performance"in self?performance.now():Date.now();o>n?postMessage({id:null,method:"call",params:{timerId:t}}):e.set(t,setTimeout(c,n-o,e,t,n))},a=(e,t,n)=>{const{expected:o,remainingDelay:i}=f(e,n);r.set(t,setTimeout(c,i,r,t,o))},d=(e,t,n)=>{const{expected:r,remainingDelay:i}=f(e,n);o.set(t,setTimeout(c,i,o,t,r))}},function(e,t,n){"use strict";n.r(t);var r=n(2);for(var o in r)"default"!==o&&function(e){n.d(t,e,(function(){return r[e]}))}(o);var i=n(3);for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var u=n(4);for(var o in u)"default"!==o&&function(e){n.d(t,e,(function(){return u[e]}))}(o);var f=n(5);for(var o in f)"default"!==o&&function(e){n.d(t,e,(function(){return f[e]}))}(o);var c=n(6);for(var o in c)"default"!==o&&function(e){n.d(t,e,(function(){return c[e]}))}(o);var a=n(7);for(var o in a)"default"!==o&&function(e){n.d(t,e,(function(){return a[e]}))}(o);var d=n(8);for(var o in d)"default"!==o&&function(e){n.d(t,e,(function(){return d[e]}))}(o);var s=n(9);for(var o in s)"default"!==o&&function(e){n.d(t,e,(function(){return s[e]}))}(o)},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.r(t);var r=n(11);for(var o in r)"default"!==o&&function(e){n.d(t,e,(function(){return r[e]}))}(o);var i=n(12);for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var u=n(13);for(var o in u)"default"!==o&&function(e){n.d(t,e,(function(){return u[e]}))}(o)},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.r(t);var r=n(0),o=n(1);for(var i in o)"default"!==i&&function(e){n.d(t,e,(function(){return o[e]}))}(i);var u=n(10);for(var i in u)"default"!==i&&function(e){n.d(t,e,(function(){return u[e]}))}(i);addEventListener("message",({data:e})=>{try{if("clear"===e.method){const{id:t,params:{timerId:n}}=e;Object(r.b)(n),postMessage({error:null,id:t})}else{if("set"!==e.method)throw new Error(\'The given method "\'.concat(e.method,\'" is not supported\'));{const{params:{delay:t,now:n,timerId:o}}=e;Object(r.d)(t,o,n)}}}catch(t){postMessage({error:{message:t.message},id:e.id,result:null})}})}]);'),n=new Worker(i);n.addEventListener("message",(({data:i})=>{if(r.isCallNotification(i)){const{params:{timerId:r}}=i,n=e.get(r);if("number"==typeof n){const e=t.get(n);if(void 0===e||e!==r)throw new Error("The timer is in an undefined state.")}else{if(void 0===n)throw new Error("The timer is in an undefined state.");n(),e.delete(r)}}else{if(!r.isClearResponse(i)){const{error:{message:e}}=i;throw new Error(e)}{const{id:r}=i,n=t.get(r);if(void 0===n)throw new Error("The timer is in an undefined state.");t.delete(r),e.delete(n)}}}));return{clearTimeout:i=>{const r=Math.random();t.set(r,i),e.set(i,r),n.postMessage({id:r,method:"clear",params:{timerId:i}})},setTimeout:(t,i)=>{const r=Math.random();return e.set(r,t),n.postMessage({id:null,method:"set",params:{delay:i,now:performance.now(),timerId:r}}),r}}}static loadWorkerTimers(){return()=>(null!==r.workerTimers||(r.workerTimers=r.load()),r.workerTimers)}static isCallNotification(e){return void 0!==e.method&&"call"===e.method}static isClearResponse(e){return null===e.error&&"number"==typeof e.id}}r.workerTimers=null,r.clearTimeout=e=>r.timers().clearTimeout(e),r.setTimeout=(e,t)=>r.timers().setTimeout(e,t),r.timers=r.loadWorkerTimers()},(e,t,i)=>{"use strict";var r;i.r(t),i.d(t,{CancellationErrorCode:()=>r}),function(e){e[e.NoError=0]="NoError",e[e.AuthenticationFailure=1]="AuthenticationFailure",e[e.BadRequestParameters=2]="BadRequestParameters",e[e.TooManyRequests=3]="TooManyRequests",e[e.ConnectionFailure=4]="ConnectionFailure",e[e.ServiceTimeout=5]="ServiceTimeout",e[e.ServiceError=6]="ServiceError",e[e.RuntimeError=7]="RuntimeError",e[e.Forbidden=8]="Forbidden"}(r||(r={}))},(e,t,i)=>{"use strict";i.r(t),i.d(t,{RecognitionMode:()=>r,RecognizerConfig:()=>a,SpeechResultFormat:()=>n});var r,n,s=i(59),o=i(21);!function(e){e[e.Interactive=0]="Interactive",e[e.Conversation=1]="Conversation",e[e.Dictation=2]="Dictation"}(r||(r={})),function(e){e[e.Simple=0]="Simple",e[e.Detailed=1]="Detailed"}(n||(n={}));class a{constructor(e,t){this.privSpeechServiceConfig=e||new o.SpeechServiceConfig(new o.Context(null)),this.privParameters=t,this.privMaxRetryCount=parseInt(t.getProperty("SPEECH-Error-MaxRetryCount","4"),10),this.privLanguageIdMode=t.getProperty(s.PropertyId.SpeechServiceConnection_LanguageIdMode,void 0),this.privEnableSpeakerId=!1}get parameters(){return this.privParameters}get recognitionMode(){return this.privRecognitionMode}set recognitionMode(e){this.privRecognitionMode=e,this.privRecognitionActivityTimeout=e===r.Interactive?8e3:25e3,this.privSpeechServiceConfig.Recognition=r[e]}get SpeechServiceConfig(){return this.privSpeechServiceConfig}get recognitionActivityTimeout(){return this.privRecognitionActivityTimeout}get isContinuousRecognition(){return this.privRecognitionMode!==r.Interactive}get languageIdMode(){return this.privLanguageIdMode}get autoDetectSourceLanguages(){return this.parameters.getProperty(s.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,void 0)}get recognitionEndpointVersion(){return this.parameters.getProperty(s.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,void 0)}get sourceLanguageModels(){const e=[];let t=!1;if(void 0!==this.autoDetectSourceLanguages)for(const i of this.autoDetectSourceLanguages.split(",")){const r=i+s.PropertyId.SpeechServiceConnection_EndpointId.toString(),n=this.parameters.getProperty(r,void 0);void 0!==n?(e.push({language:i,endpoint:n}),t=!0):e.push({language:i,endpoint:""})}return t?e:void 0}get maxRetryCount(){return this.privMaxRetryCount}get isSpeakerDiarizationEnabled(){return this.privEnableSpeakerId}set isSpeakerDiarizationEnabled(e){this.privEnableSpeakerId=e}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ReplayableAudioNode:()=>r});class r{constructor(e,t){this.privBuffers=[],this.privReplayOffset=0,this.privLastShrinkOffset=0,this.privBufferStartOffset=0,this.privBufferSerial=0,this.privBufferedBytes=0,this.privReplay=!1,this.privLastChunkAcquiredTime=0,this.privAudioNode=e,this.privBytesPerSecond=t}id(){return this.privAudioNode.id()}read(){if(this.privReplay&&0!==this.privBuffers.length){const e=this.privReplayOffset-this.privBufferStartOffset;let t=Math.round(e*this.privBytesPerSecond*1e-7);0!=t%2&&t++;let i=0;for(;i<this.privBuffers.length&&t>=this.privBuffers[i].chunk.buffer.byteLength;)t-=this.privBuffers[i++].chunk.buffer.byteLength;if(i<this.privBuffers.length){const e=this.privBuffers[i].chunk.buffer.slice(t);return this.privReplayOffset+=e.byteLength/this.privBytesPerSecond*1e7,i===this.privBuffers.length-1&&(this.privReplay=!1),Promise.resolve({buffer:e,isEnd:!1,timeReceived:this.privBuffers[i].chunk.timeReceived})}}return this.privAudioNode.read().then((e=>(e&&e.buffer&&(this.privBuffers.push(new n(e,this.privBufferSerial++,this.privBufferedBytes)),this.privBufferedBytes+=e.buffer.byteLength),e)))}detach(){return this.privBuffers=void 0,this.privAudioNode.detach()}replay(){this.privBuffers&&0!==this.privBuffers.length&&(this.privReplay=!0,this.privReplayOffset=this.privLastShrinkOffset)}shrinkBuffers(e){if(void 0===this.privBuffers||0===this.privBuffers.length)return;this.privLastShrinkOffset=e;const t=e-this.privBufferStartOffset;let i=Math.round(t*this.privBytesPerSecond*1e-7),r=0;for(;r<this.privBuffers.length&&i>=this.privBuffers[r].chunk.buffer.byteLength;)i-=this.privBuffers[r++].chunk.buffer.byteLength;this.privBufferStartOffset=Math.round(e-i/this.privBytesPerSecond*1e7),this.privBuffers=this.privBuffers.slice(r)}findTimeAtOffset(e){if(e<this.privBufferStartOffset||void 0===this.privBuffers)return 0;for(const t of this.privBuffers){const i=t.byteOffset/this.privBytesPerSecond*1e7,r=i+t.chunk.buffer.byteLength/this.privBytesPerSecond*1e7;if(e>=i&&e<=r)return t.chunk.timeReceived}return 0}}class n{constructor(e,t,i){this.chunk=e,this.serial=t,this.byteOffset=i}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SpeechConnectionMessage:()=>o});var r=i(80),n=i(17),s=i(64);class o extends r.ConnectionMessage{constructor(e,t,i,r,o,a,c,p){if(!t)throw new n.ArgumentNullError("path");if(!i)throw new n.ArgumentNullError("requestId");const h={};if(h[s.HeaderNames.Path]=t,h[s.HeaderNames.RequestId]=i,h[s.HeaderNames.RequestTimestamp]=(new Date).toISOString(),r&&(h[s.HeaderNames.ContentType]=r),a&&(h[s.HeaderNames.RequestStreamId]=a),c)for(const e in c)e&&(h[e]=c[e]);p?super(e,o,h,p):super(e,o,h),this.privPath=t,this.privRequestId=i,this.privContentType=r,this.privStreamId=a,this.privAdditionalHeaders=c}get path(){return this.privPath}get requestId(){return this.privRequestId}get contentType(){return this.privContentType}get streamId(){return this.privStreamId}get additionalHeaders(){return this.privAdditionalHeaders}static fromConnectionMessage(e){let t=null,i=null,r=null,n=null;const a={};if(e.headers)for(const o in e.headers)o&&(o.toLowerCase()===s.HeaderNames.Path.toLowerCase()?t=e.headers[o]:o.toLowerCase()===s.HeaderNames.RequestId.toLowerCase()?i=e.headers[o]:o.toLowerCase()===s.HeaderNames.ContentType.toLowerCase()?r=e.headers[o]:o.toLowerCase()===s.HeaderNames.RequestStreamId.toLowerCase()?n=e.headers[o]:a[o]=e.headers[o]);return new o(e.messageType,t,i,r,e.body,n,a,e.id)}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SpeechDetected:()=>r});class r{constructor(e){this.privSpeechStartDetected=JSON.parse(e)}static fromJSON(e){return new r(e)}get Offset(){return this.privSpeechStartDetected.Offset}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConversationServiceRecognizer:()=>m});var r=i(60),n=i(59),s=i(57),o=i(44),a=i(47),c=i(85),p=i(97),h=i(99),d=i(98),u=i(61),v=i(100),l=i(101),g=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class m extends c.ServiceRecognizerBase{constructor(e,t,i,r,n){super(e,t,i,r,n),this.handleSpeechPhraseMessage=e=>g(this,void 0,void 0,(function*(){return this.handleSpeechPhrase(e)})),this.handleSpeechHypothesisMessage=e=>this.handleSpeechHypothesis(e)}processTypeSpecificMessages(e){}handleRecognizedCallback(e,t,i){}handleRecognizingCallback(e,t,i){}processSpeechMessages(e){return g(this,void 0,void 0,(function*(){let t=!1;switch(e.path.toLowerCase()){case"speech.hypothesis":case"speech.fragment":this.handleSpeechHypothesisMessage&&this.handleSpeechHypothesisMessage(e.textBody),t=!0;break;case"speech.phrase":this.handleSpeechPhraseMessage&&(yield this.handleSpeechPhraseMessage(e.textBody)),t=!0}return t}))}cancelRecognition(e,t,i,r,n){}handleSpeechPhrase(e){return g(this,void 0,void 0,(function*(){const t=p.SimpleSpeechPhrase.fromJSON(e),i=h.EnumTranslation.implTranslateRecognitionResult(t.RecognitionStatus);let c;const l=new r.PropertyCollection;l.setProperty(n.PropertyId.SpeechServiceResponse_JsonResult,e);const g=t.Offset+this.privRequestSession.currentTurnAudioOffset;let m=g;if(this.privRequestSession.onPhraseRecognized(this.privRequestSession.currentTurnAudioOffset+t.Offset+t.Duration),s.ResultReason.Canceled===i){const e=h.EnumTranslation.implTranslateCancelResult(t.RecognitionStatus),i=h.EnumTranslation.implTranslateCancelErrorCode(t.RecognitionStatus);yield this.cancelRecognitionLocal(e,i,h.EnumTranslation.implTranslateErrorDetails(i))}else if(!this.privRequestSession.isSpeechEnded||i!==s.ResultReason.NoMatch||t.RecognitionStatus===d.RecognitionStatus.InitialSilenceTimeout){if(this.privRecognizerConfig.parameters.getProperty(u.OutputFormatPropertyName)===o.OutputFormat[o.OutputFormat.Simple])c=new a.SpeechRecognitionResult(this.privRequestSession.requestId,i,t.DisplayText,t.Duration,g,t.Language,t.LanguageDetectionConfidence,t.SpeakerId,void 0,e,l);else{const t=v.DetailedSpeechPhrase.fromJSON(e),r=t.Offset+this.privRequestSession.currentTurnAudioOffset,n=t.getJsonWithCorrectedOffsets(r);c=new a.SpeechRecognitionResult(this.privRequestSession.requestId,i,t.Text,t.Duration,r,t.Language,t.LanguageDetectionConfidence,t.SpeakerId,void 0,n,l),m=c.offset}this.handleRecognizedCallback(c,m,this.privRequestSession.sessionId)}}))}handleSpeechHypothesis(e){const t=l.SpeechHypothesis.fromJSON(e),i=t.Offset+this.privRequestSession.currentTurnAudioOffset,o=new r.PropertyCollection;o.setProperty(n.PropertyId.SpeechServiceResponse_JsonResult,e);const c=new a.SpeechRecognitionResult(this.privRequestSession.requestId,s.ResultReason.RecognizingSpeech,t.Text,t.Duration,i,t.Language,t.LanguageDetectionConfidence,t.SpeakerId,void 0,e,o);this.privRequestSession.onHypothesis(i),this.handleRecognizingCallback(c,t.Duration,this.privRequestSession.sessionId)}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SimpleSpeechPhrase:()=>n});var r=i(98);class n{constructor(e){this.privSimpleSpeechPhrase=JSON.parse(e),this.privSimpleSpeechPhrase.RecognitionStatus=r.RecognitionStatus[this.privSimpleSpeechPhrase.RecognitionStatus]}static fromJSON(e){return new n(e)}get RecognitionStatus(){return this.privSimpleSpeechPhrase.RecognitionStatus}get DisplayText(){return this.privSimpleSpeechPhrase.DisplayText}get Offset(){return this.privSimpleSpeechPhrase.Offset}get Duration(){return this.privSimpleSpeechPhrase.Duration}get Language(){return void 0===this.privSimpleSpeechPhrase.PrimaryLanguage?void 0:this.privSimpleSpeechPhrase.PrimaryLanguage.Language}get LanguageDetectionConfidence(){return void 0===this.privSimpleSpeechPhrase.PrimaryLanguage?void 0:this.privSimpleSpeechPhrase.PrimaryLanguage.Confidence}get SpeakerId(){return this.privSimpleSpeechPhrase.SpeakerId}}},(e,t,i)=>{"use strict";var r,n;i.r(t),i.d(t,{RecognitionStatus:()=>n,SynthesisStatus:()=>r}),function(e){e[e.Success=0]="Success",e[e.SynthesisEnd=1]="SynthesisEnd",e[e.Error=2]="Error"}(r||(r={})),function(e){e[e.Success=0]="Success",e[e.NoMatch=1]="NoMatch",e[e.InitialSilenceTimeout=2]="InitialSilenceTimeout",e[e.BabbleTimeout=3]="BabbleTimeout",e[e.Error=4]="Error",e[e.EndOfDictation=5]="EndOfDictation",e[e.TooManyRequests=6]="TooManyRequests",e[e.BadRequest=7]="BadRequest",e[e.Forbidden=8]="Forbidden"}(n||(n={}))},(e,t,i)=>{"use strict";i.r(t),i.d(t,{EnumTranslation:()=>a});var r=i(57),n=i(40),s=i(91),o=i(98);class a{static implTranslateRecognitionResult(e){let t=r.ResultReason.Canceled;switch(e){case o.RecognitionStatus.Success:t=r.ResultReason.RecognizedSpeech;break;case o.RecognitionStatus.NoMatch:case o.RecognitionStatus.InitialSilenceTimeout:case o.RecognitionStatus.BabbleTimeout:case o.RecognitionStatus.EndOfDictation:t=r.ResultReason.NoMatch;break;case o.RecognitionStatus.Error:case o.RecognitionStatus.BadRequest:case o.RecognitionStatus.Forbidden:default:t=r.ResultReason.Canceled}return t}static implTranslateCancelResult(e){let t=n.CancellationReason.EndOfStream;switch(e){case o.RecognitionStatus.Success:case o.RecognitionStatus.EndOfDictation:case o.RecognitionStatus.NoMatch:t=n.CancellationReason.EndOfStream;break;case o.RecognitionStatus.InitialSilenceTimeout:case o.RecognitionStatus.BabbleTimeout:case o.RecognitionStatus.Error:case o.RecognitionStatus.BadRequest:case o.RecognitionStatus.Forbidden:default:t=n.CancellationReason.Error}return t}static implTranslateCancelErrorCode(e){let t=s.CancellationErrorCode.NoError;switch(e){case o.RecognitionStatus.Error:t=s.CancellationErrorCode.ServiceError;break;case o.RecognitionStatus.TooManyRequests:t=s.CancellationErrorCode.TooManyRequests;break;case o.RecognitionStatus.BadRequest:t=s.CancellationErrorCode.BadRequestParameters;break;case o.RecognitionStatus.Forbidden:t=s.CancellationErrorCode.Forbidden;break;default:t=s.CancellationErrorCode.NoError}return t}static implTranslateErrorDetails(e){let t="The speech service encountered an internal error and could not continue.";switch(e){case s.CancellationErrorCode.Forbidden:t="The recognizer is using a free subscription that ran out of quota.";break;case s.CancellationErrorCode.BadRequestParameters:t="Invalid parameter or unsupported audio format in the request.";break;case s.CancellationErrorCode.TooManyRequests:t="The number of parallel requests exceeded the number of allowed concurrent transcriptions."}return t}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{DetailedSpeechPhrase:()=>n});var r=i(98);class n{constructor(e){this.privDetailedSpeechPhrase=JSON.parse(e),this.privDetailedSpeechPhrase.RecognitionStatus=r.RecognitionStatus[this.privDetailedSpeechPhrase.RecognitionStatus]}static fromJSON(e){return new n(e)}getJsonWithCorrectedOffsets(e){if(this.privDetailedSpeechPhrase.NBest){let t;for(const e of this.privDetailedSpeechPhrase.NBest)if(e.Words&&e.Words[0]){t=e.Words[0].Offset;break}if(t&&t<e){const i=e-t;for(const e of this.privDetailedSpeechPhrase.NBest){if(e.Words)for(const t of e.Words)t.Offset+=i;if(e.DisplayWords)for(const t of e.DisplayWords)t.Offset+=i}}}return JSON.stringify(this.privDetailedSpeechPhrase)}get RecognitionStatus(){return this.privDetailedSpeechPhrase.RecognitionStatus}get NBest(){return this.privDetailedSpeechPhrase.NBest}get Duration(){return this.privDetailedSpeechPhrase.Duration}get Offset(){return this.privDetailedSpeechPhrase.Offset}get Language(){return void 0===this.privDetailedSpeechPhrase.PrimaryLanguage?void 0:this.privDetailedSpeechPhrase.PrimaryLanguage.Language}get LanguageDetectionConfidence(){return void 0===this.privDetailedSpeechPhrase.PrimaryLanguage?void 0:this.privDetailedSpeechPhrase.PrimaryLanguage.Confidence}get Text(){return this.privDetailedSpeechPhrase.NBest&&this.privDetailedSpeechPhrase.NBest[0]?this.privDetailedSpeechPhrase.NBest[0].Display||this.privDetailedSpeechPhrase.NBest[0].DisplayText:this.privDetailedSpeechPhrase.DisplayText}get SpeakerId(){return this.privDetailedSpeechPhrase.SpeakerId}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SpeechHypothesis:()=>r});class r{constructor(e){this.privSpeechHypothesis=JSON.parse(e)}static fromJSON(e){return new r(e)}get Text(){return this.privSpeechHypothesis.Text}get Offset(){return this.privSpeechHypothesis.Offset}get Duration(){return this.privSpeechHypothesis.Duration}get Language(){return void 0===this.privSpeechHypothesis.PrimaryLanguage?void 0:this.privSpeechHypothesis.PrimaryLanguage.Language}get LanguageDetectionConfidence(){return void 0===this.privSpeechHypothesis.PrimaryLanguage?void 0:this.privSpeechHypothesis.PrimaryLanguage.Confidence}get SpeakerId(){return this.privSpeechHypothesis.SpeakerId}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SpeechConnectionFactory:()=>v});var r=i(69),n=i(82),s=i(61),o=i(59),a=i(44),c=i(67),p=i(92),h=i(81),d=i(64),u=i(68);class v extends c.ConnectionFactoryBase{constructor(){super(...arguments),this.interactiveRelativeUri="/speech/recognition/interactive/cognitiveservices/v1",this.conversationRelativeUri="/speech/recognition/conversation/cognitiveservices/v1",this.dictationRelativeUri="/speech/recognition/dictation/cognitiveservices/v1",this.universalUri="/speech/universal/v"}create(e,t,i){let v=e.parameters.getProperty(o.PropertyId.SpeechServiceConnection_Endpoint,void 0);const l=e.parameters.getProperty(o.PropertyId.SpeechServiceConnection_Region,void 0),g=c.ConnectionFactoryBase.getHostSuffix(l),m=e.parameters.getProperty(o.PropertyId.SpeechServiceConnection_Host,"wss://"+l+".stt.speech"+g),S={},f=e.parameters.getProperty(o.PropertyId.SpeechServiceConnection_EndpointId,void 0),C=e.parameters.getProperty(o.PropertyId.SpeechServiceConnection_RecoLanguage,void 0);if(f?v&&-1!==v.search(u.QueryParameterNames.CustomSpeechDeploymentId)||(S[u.QueryParameterNames.CustomSpeechDeploymentId]=f):C&&(v&&-1!==v.search(u.QueryParameterNames.Language)||(S[u.QueryParameterNames.Language]=C)),v&&-1!==v.search(u.QueryParameterNames.Format)||(S[u.QueryParameterNames.Format]=e.parameters.getProperty(s.OutputFormatPropertyName,a.OutputFormat[a.OutputFormat.Simple]).toLowerCase()),void 0!==e.autoDetectSourceLanguages&&(S[u.QueryParameterNames.EnableLanguageId]="true"),this.setCommonUrlParams(e,S,v),!v)switch(e.recognitionMode){case p.RecognitionMode.Conversation:v="true"===e.parameters.getProperty(s.ForceDictationPropertyName,"false")?m+this.dictationRelativeUri:void 0!==e.recognitionEndpointVersion&&parseInt(e.recognitionEndpointVersion,10)>1?`${m}${this.universalUri}${e.recognitionEndpointVersion}`:m+this.conversationRelativeUri;break;case p.RecognitionMode.Dictation:v=m+this.dictationRelativeUri;break;default:v=void 0!==e.recognitionEndpointVersion&&parseInt(e.recognitionEndpointVersion,10)>1?`${m}${this.universalUri}${e.recognitionEndpointVersion}`:m+this.interactiveRelativeUri}const y={};void 0!==t.token&&""!==t.token&&(y[t.headerName]=t.token),y[d.HeaderNames.ConnectionId]=i;const R="true"===e.parameters.getProperty("SPEECH-EnableWebsocketCompression","false"),P=new r.WebsocketConnection(v,S,y,new h.WebsocketMessageFormatter,n.ProxyInfo.fromRecognizerConfig(e),R,i),I=P.uri;return e.parameters.setProperty(o.PropertyId.SpeechServiceConnection_Url,I),P}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConversationTranscriberConnectionFactory:()=>d});var r=i(69),n=i(82),s=i(59),o=i(61),a=i(67),c=i(81),p=i(64),h=i(68);class d extends a.ConnectionFactoryBase{constructor(){super(...arguments),this.universalUri="/speech/universal/v2"}create(e,t,i){let o=e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_Endpoint,void 0);const d=e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_Region,void 0),u=a.ConnectionFactoryBase.getHostSuffix(d),v=e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_Host,"wss://"+d+".stt.speech"+u),l={},g=e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_EndpointId,void 0),m=e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_RecoLanguage,void 0);g?o&&-1!==o.search(h.QueryParameterNames.CustomSpeechDeploymentId)||(l[h.QueryParameterNames.CustomSpeechDeploymentId]=g):m&&(o&&-1!==o.search(h.QueryParameterNames.Language)||(l[h.QueryParameterNames.Language]=m)),void 0!==e.autoDetectSourceLanguages&&(l[h.QueryParameterNames.EnableLanguageId]="true"),this.setV2UrlParams(e,l,o),o||(o=`${v}${this.universalUri}`);const S={};void 0!==t.token&&""!==t.token&&(S[t.headerName]=t.token),S[p.HeaderNames.ConnectionId]=i;const f="true"===e.parameters.getProperty("SPEECH-EnableWebsocketCompression","false"),C=new r.WebsocketConnection(o,l,S,new c.WebsocketMessageFormatter,n.ProxyInfo.fromRecognizerConfig(e),f,i),y=C.uri;return e.parameters.setProperty(s.PropertyId.SpeechServiceConnection_Url,y),C}setV2UrlParams(e,t,i){new Map([[s.PropertyId.Speech_SegmentationSilenceTimeoutMs,h.QueryParameterNames.SegmentationSilenceTimeoutMs],[s.PropertyId.SpeechServiceConnection_EnableAudioLogging,h.QueryParameterNames.EnableAudioLogging],[s.PropertyId.SpeechServiceConnection_EndSilenceTimeoutMs,h.QueryParameterNames.EndSilenceTimeoutMs],[s.PropertyId.SpeechServiceConnection_InitialSilenceTimeoutMs,h.QueryParameterNames.InitialSilenceTimeoutMs],[s.PropertyId.SpeechServiceResponse_PostProcessingOption,h.QueryParameterNames.Postprocessing],[s.PropertyId.SpeechServiceResponse_ProfanityOption,h.QueryParameterNames.Profanity],[s.PropertyId.SpeechServiceResponse_StablePartialResultThreshold,h.QueryParameterNames.StableIntermediateThreshold]]).forEach(((r,n)=>{this.setUrlParameter(n,r,e,t,i)}));const r=JSON.parse(e.parameters.getProperty(o.ServicePropertiesPropertyName,"{}"));Object.keys(r).forEach((e=>{t[e]=r[e]}))}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{TranscriberConnectionFactory:()=>u});var r=i(69),n=i(82),s=i(59),o=i(44),a=i(67),c=i(81),p=i(61),h=i(64),d=i(68);class u extends a.ConnectionFactoryBase{constructor(){super(...arguments),this.multiaudioRelativeUri="/speech/recognition/multiaudio"}create(e,t,i){let o=e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_Endpoint,void 0);const p=e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_Region,"centralus"),d="wss://transcribe."+p+".cts.speech"+a.ConnectionFactoryBase.getHostSuffix(p)+this.multiaudioRelativeUri,u=e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_Host,d),v={};this.setQueryParams(v,e,o),o||(o=u);const l={};void 0!==t.token&&""!==t.token&&(l[t.headerName]=t.token),l[h.HeaderNames.ConnectionId]=i,e.parameters.setProperty(s.PropertyId.SpeechServiceConnection_Url,o);const g="true"===e.parameters.getProperty("SPEECH-EnableWebsocketCompression","false");return new r.WebsocketConnection(o,v,l,new c.WebsocketMessageFormatter,n.ProxyInfo.fromRecognizerConfig(e),g,i)}setQueryParams(e,t,i){const r=t.parameters.getProperty(s.PropertyId.SpeechServiceConnection_EndpointId,void 0),n=t.parameters.getProperty(s.PropertyId.SpeechServiceConnection_RecoLanguage,void 0);r&&!(d.QueryParameterNames.CustomSpeechDeploymentId in e)&&(e[d.QueryParameterNames.CustomSpeechDeploymentId]=r),n&&!(d.QueryParameterNames.Language in e)&&(e[d.QueryParameterNames.Language]=n);const a="true"===t.parameters.getProperty(s.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,"false").toLowerCase(),c=t.parameters.getProperty(p.OutputFormatPropertyName,o.OutputFormat[o.OutputFormat.Simple])!==o.OutputFormat[o.OutputFormat.Simple];(a||c)&&(e[d.QueryParameterNames.Format]=o.OutputFormat[o.OutputFormat.Detailed].toLowerCase()),this.setCommonUrlParams(t,e,i)}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{TranslationConnectionFactory:()=>u});var r=i(69),n=i(82),s=i(106),o=i(59),a=i(67),c=i(81),p=i(92),h=i(64),d=i(68);class u extends a.ConnectionFactoryBase{create(e,t,i){const s=this.getEndpointUrl(e),a={};void 0!==e.autoDetectSourceLanguages&&(a[d.QueryParameterNames.EnableLanguageId]="true"),this.setQueryParams(a,e,s);const p={};void 0!==t.token&&""!==t.token&&(p[t.headerName]=t.token),p[h.HeaderNames.ConnectionId]=i,e.parameters.setProperty(o.PropertyId.SpeechServiceConnection_Url,s);const u="true"===e.parameters.getProperty("SPEECH-EnableWebsocketCompression","false");return new r.WebsocketConnection(s,a,p,new c.WebsocketMessageFormatter,n.ProxyInfo.fromRecognizerConfig(e),u,i)}getEndpointUrl(e,t){const i=e.parameters.getProperty(o.PropertyId.SpeechServiceConnection_Region),r=a.ConnectionFactoryBase.getHostSuffix(i);let n=e.parameters.getProperty(o.PropertyId.SpeechServiceConnection_Endpoint,void 0);if(!n)if(void 0!==e.autoDetectSourceLanguages){n=e.parameters.getProperty(o.PropertyId.SpeechServiceConnection_Host,"wss://{region}.stt.speech"+r)+"/speech/universal/v2"}else{n=e.parameters.getProperty(o.PropertyId.SpeechServiceConnection_Host,"wss://{region}.s2s.speech"+r)+"/speech/translation/cognitiveservices/v1"}return!0===t?n:s.StringUtils.formatString(n,{region:i})}setQueryParams(e,t,i){e.from=t.parameters.getProperty(o.PropertyId.SpeechServiceConnection_RecoLanguage),e.to=t.parameters.getProperty(o.PropertyId.SpeechServiceConnection_TranslationToLanguages),e.scenario=t.recognitionMode===p.RecognitionMode.Interactive?"interactive":t.recognitionMode===p.RecognitionMode.Conversation?"conversation":"",this.setCommonUrlParams(t,e,i),this.setUrlParameter(o.PropertyId.SpeechServiceResponse_TranslationRequestStablePartialResult,d.QueryParameterNames.StableTranslation,t,e,i);const r=t.parameters.getProperty(o.PropertyId.SpeechServiceConnection_TranslationVoice,void 0);void 0!==r&&(e.voice=r,e.features="texttospeech")}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{StringUtils:()=>r});class r{static formatString(e,t){if(!e)return"";if(!t)return e;let i="",r="";const n=e=>{i+=e},s=e=>{r+=e};let o=n;for(let a=0;a<e.length;a++){const c=e[a],p=a+1<e.length?e[a+1]:"";switch(c){case"{":"{"===p?(o("{"),a++):o=s;break;case"}":"}"===p?(o("}"),a++):(t.hasOwnProperty(r)&&(i+=t[r]),o=n,r="");break;default:o(c)}}return i}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SpeechSynthesisConnectionFactory:()=>h});var r=i(69),n=i(82),s=i(59),o=i(67),a=i(81),c=i(64),p=i(68);class h{constructor(){this.synthesisUri="/cognitiveservices/websocket/v1"}create(e,t,i){let h=e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_Endpoint,void 0);const d=e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_Region,void 0),u=o.ConnectionFactoryBase.getHostSuffix(d),v=e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_EndpointId,void 0),l=void 0===v?"tts":"voice",g=e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_Host,"wss://"+d+"."+l+".speech"+u),m={},S={};void 0!==t.token&&""!==t.token&&(S[t.headerName]=t.token),S[c.HeaderNames.ConnectionId]=i,void 0!==v&&""!==v&&(h&&-1!==h.search(p.QueryParameterNames.CustomVoiceDeploymentId)||(m[p.QueryParameterNames.CustomVoiceDeploymentId]=v)),e.avatarEnabled&&(h&&-1!==h.search(p.QueryParameterNames.EnableAvatar)||(m[p.QueryParameterNames.EnableAvatar]="true")),h||(h=g+this.synthesisUri),e.parameters.setProperty(s.PropertyId.SpeechServiceConnection_Url,h);const f="true"===e.parameters.getProperty("SPEECH-EnableWebsocketCompression","false");return new r.WebsocketConnection(h,m,S,new a.WebsocketMessageFormatter,n.ProxyInfo.fromParameters(e.parameters),f,i)}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{TranslationSynthesisEnd:()=>n});var r=i(98);class n{constructor(e){this.privSynthesisEnd=JSON.parse(e),this.privSynthesisEnd.SynthesisStatus&&(this.privSynthesisEnd.SynthesisStatus=r.SynthesisStatus[this.privSynthesisEnd.SynthesisStatus]),this.privSynthesisEnd.Status&&(this.privSynthesisEnd.SynthesisStatus=r.SynthesisStatus[this.privSynthesisEnd.Status])}static fromJSON(e){return new n(e)}get SynthesisStatus(){return this.privSynthesisEnd.SynthesisStatus}get FailureReason(){return this.privSynthesisEnd.FailureReason}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{TranslationHypothesis:()=>s});var r=i(36),n=i(110);class s{constructor(e){this.privTranslationHypothesis=e,this.privTranslationHypothesis.Translation.TranslationStatus=n.TranslationStatus[this.privTranslationHypothesis.Translation.TranslationStatus]}static fromJSON(e){return new s(JSON.parse(e))}static fromTranslationResponse(e){r.Contracts.throwIfNullOrUndefined(e,"translationHypothesis");const t=e.SpeechHypothesis;return e.SpeechHypothesis=void 0,t.Translation=e,new s(t)}get Duration(){return this.privTranslationHypothesis.Duration}get Offset(){return this.privTranslationHypothesis.Offset}get Text(){return this.privTranslationHypothesis.Text}get Translation(){return this.privTranslationHypothesis.Translation}get Language(){var e;return null===(e=this.privTranslationHypothesis.PrimaryLanguage)||void 0===e?void 0:e.Language}}},(e,t,i)=>{"use strict";var r;i.r(t),i.d(t,{TranslationStatus:()=>r}),function(e){e[e.Success=0]="Success",e[e.Error=1]="Error"}(r||(r={}))},(e,t,i)=>{"use strict";i.r(t),i.d(t,{TranslationPhrase:()=>o});var r=i(36),n=i(98),s=i(110);class o{constructor(e){this.privTranslationPhrase=e,this.privTranslationPhrase.RecognitionStatus=n.RecognitionStatus[this.privTranslationPhrase.RecognitionStatus],void 0!==this.privTranslationPhrase.Translation&&(this.privTranslationPhrase.Translation.TranslationStatus=s.TranslationStatus[this.privTranslationPhrase.Translation.TranslationStatus])}static fromJSON(e){return new o(JSON.parse(e))}static fromTranslationResponse(e){r.Contracts.throwIfNullOrUndefined(e,"translationResponse");const t=e.SpeechPhrase;return e.SpeechPhrase=void 0,t.Translation=e,t.Text=t.DisplayText,new o(t)}get RecognitionStatus(){return this.privTranslationPhrase.RecognitionStatus}get Offset(){return this.privTranslationPhrase.Offset}get Duration(){return this.privTranslationPhrase.Duration}get Text(){return this.privTranslationPhrase.Text}get Language(){var e;return null===(e=this.privTranslationPhrase.PrimaryLanguage)||void 0===e?void 0:e.Language}get Confidence(){var e;return null===(e=this.privTranslationPhrase.PrimaryLanguage)||void 0===e?void 0:e.Confidence}get Translation(){return this.privTranslationPhrase.Translation}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{TranslationServiceRecognizer:()=>T});var r=i(80),n=i(110),s=i(60),o=i(55),a=i(57),c=i(53),p=i(59),h=i(56),d=i(54),u=i(113),v=i(40),l=i(91),g=i(114),m=i(96),S=i(98),f=i(99),C=i(109),y=i(111),R=i(108),P=i(61),I=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class T extends m.ConversationServiceRecognizer{constructor(e,t,i,r,n){super(e,t,i,r,n),this.privTranslationRecognizer=n,this.connectionEvents.attach((e=>{"ConnectionEstablishedEvent"===e.name&&this.privTranslationRecognizer.onConnection()}))}processTypeSpecificMessages(e){return I(this,void 0,void 0,(function*(){const t=new s.PropertyCollection;let i=yield this.processSpeechMessages(e);if(i)return!0;const n=r=>I(this,void 0,void 0,(function*(){if(this.privRequestSession.onPhraseRecognized(this.privRequestSession.currentTurnAudioOffset+r.Offset+r.Duration),r.RecognitionStatus===S.RecognitionStatus.Success){const e=this.fireEventForResult(r,t);if(this.privTranslationRecognizer.recognized)try{this.privTranslationRecognizer.recognized(this.privTranslationRecognizer,e)}catch(e){}if(this.privSuccessCallback){try{this.privSuccessCallback(e.result)}catch(e){this.privErrorCallback&&this.privErrorCallback(e)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}else{const n=f.EnumTranslation.implTranslateRecognitionResult(r.RecognitionStatus),s=new o.TranslationRecognitionResult(void 0,this.privRequestSession.requestId,n,r.Text,r.Duration,this.privRequestSession.currentTurnAudioOffset+r.Offset,r.Language,r.Confidence,void 0,e.textBody,t);if(n===a.ResultReason.Canceled){const e=f.EnumTranslation.implTranslateCancelResult(r.RecognitionStatus),t=f.EnumTranslation.implTranslateCancelErrorCode(r.RecognitionStatus);yield this.cancelRecognitionLocal(e,t,f.EnumTranslation.implTranslateErrorDetails(t))}else{if(!this.privRequestSession.isSpeechEnded||n!==a.ResultReason.NoMatch||r.RecognitionStatus===S.RecognitionStatus.InitialSilenceTimeout){const e=new c.TranslationRecognitionEventArgs(s,s.offset,this.privRequestSession.sessionId);if(this.privTranslationRecognizer.recognized)try{this.privTranslationRecognizer.recognized(this.privTranslationRecognizer,e)}catch(e){}}if(this.privSuccessCallback){try{this.privSuccessCallback(s)}catch(e){this.privErrorCallback&&this.privErrorCallback(e)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}i=!0}})),g=(e,t)=>{const r=this.fireEventForResult(e,t);if(this.privRequestSession.onHypothesis(this.privRequestSession.currentTurnAudioOffset+r.offset),this.privTranslationRecognizer.recognizing)try{this.privTranslationRecognizer.recognizing(this.privTranslationRecognizer,r)}catch(e){}i=!0};switch(e.messageType===r.MessageType.Text&&t.setProperty(p.PropertyId.SpeechServiceResponse_JsonResult,e.textBody),e.path.toLowerCase()){case"translation.hypothesis":g(C.TranslationHypothesis.fromJSON(e.textBody),t);break;case"translation.response":const r=JSON.parse(e.textBody);if(r.SpeechPhrase)yield n(y.TranslationPhrase.fromTranslationResponse(r));else{const i=JSON.parse(e.textBody);i.SpeechHypothesis&&g(C.TranslationHypothesis.fromTranslationResponse(i),t)}break;case"translation.phrase":yield n(y.TranslationPhrase.fromJSON(e.textBody));break;case"translation.synthesis":this.sendSynthesisAudio(e.binaryBody,this.privRequestSession.sessionId),i=!0;break;case"audio.end":case"translation.synthesis.end":const s=R.TranslationSynthesisEnd.fromJSON(e.textBody);switch(s.SynthesisStatus){case S.SynthesisStatus.Error:if(this.privTranslationRecognizer.synthesizing){const e=new h.TranslationSynthesisResult(a.ResultReason.Canceled,void 0),t=new d.TranslationSynthesisEventArgs(e,this.privRequestSession.sessionId);try{this.privTranslationRecognizer.synthesizing(this.privTranslationRecognizer,t)}catch(e){}}if(this.privTranslationRecognizer.canceled){const e=new u.TranslationRecognitionCanceledEventArgs(this.privRequestSession.sessionId,v.CancellationReason.Error,s.FailureReason,l.CancellationErrorCode.ServiceError,null);try{this.privTranslationRecognizer.canceled(this.privTranslationRecognizer,e)}catch(e){}}break;case S.SynthesisStatus.Success:this.sendSynthesisAudio(void 0,this.privRequestSession.sessionId)}i=!0}return i}))}cancelRecognition(e,t,i,r,n){const c=new s.PropertyCollection;if(c.setProperty(P.CancellationErrorCodePropertyName,l.CancellationErrorCode[r]),this.privTranslationRecognizer.canceled){const t=new u.TranslationRecognitionCanceledEventArgs(e,i,n,r,void 0);try{this.privTranslationRecognizer.canceled(this.privTranslationRecognizer,t)}catch(e){}}if(this.privSuccessCallback){const e=new o.TranslationRecognitionResult(void 0,t,a.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,n,void 0,c);try{this.privSuccessCallback(e),this.privSuccessCallback=void 0}catch(e){}}}handleRecognizingCallback(e,t,i){try{const r=new c.TranslationRecognitionEventArgs(o.TranslationRecognitionResult.fromSpeechRecognitionResult(e),t,i);this.privTranslationRecognizer.recognizing(this.privTranslationRecognizer,r)}catch(e){}}handleRecognizedCallback(e,t,i){try{const r=new c.TranslationRecognitionEventArgs(o.TranslationRecognitionResult.fromSpeechRecognitionResult(e),t,i);this.privTranslationRecognizer.recognized(this.privTranslationRecognizer,r)}catch(e){}}fireEventForResult(e,t){let i,r,s;if(void 0!==e.Translation.Translations){i=new g.Translations;for(const t of e.Translation.Translations)i.set(t.Language,t.Text||t.DisplayText)}e instanceof y.TranslationPhrase?(r=e.Translation&&e.Translation.TranslationStatus===n.TranslationStatus.Success?a.ResultReason.TranslatedSpeech:a.ResultReason.RecognizedSpeech,s=e.Confidence):r=a.ResultReason.TranslatingSpeech;const p=e.Language,h=e.Offset+this.privRequestSession.currentTurnAudioOffset,d=new o.TranslationRecognitionResult(i,this.privRequestSession.requestId,r,e.Text,e.Duration,h,p,s,e.Translation.FailureReason,JSON.stringify(e),t);return new c.TranslationRecognitionEventArgs(d,h,this.privRequestSession.sessionId)}sendSynthesisAudio(e,t){const i=void 0===e?a.ResultReason.SynthesizingAudioCompleted:a.ResultReason.SynthesizingAudio,r=new h.TranslationSynthesisResult(i,e),n=new d.TranslationSynthesisEventArgs(r,t);if(this.privTranslationRecognizer.synthesizing)try{this.privTranslationRecognizer.synthesizing(this.privTranslationRecognizer,n)}catch(e){}}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{TranslationRecognitionCanceledEventArgs:()=>r});class r{constructor(e,t,i,r,n){this.privCancelReason=t,this.privErrorDetails=i,this.privResult=n,this.privSessionId=e,this.privErrorCode=r}get result(){return this.privResult}get sessionId(){return this.privSessionId}get reason(){return this.privCancelReason}get errorCode(){return this.privErrorCode}get errorDetails(){return this.privErrorDetails}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{Translations:()=>n});var r=i(60);class n{constructor(){this.privMap=new r.PropertyCollection}get languages(){return this.privMap.keys}get(e,t){return this.privMap.getProperty(e,t)}set(e,t){this.privMap.setProperty(e,t)}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SpeechKeyword:()=>r});class r{constructor(e){this.privSpeechKeyword=JSON.parse(e)}static fromJSON(e){return new r(e)}get Status(){return this.privSpeechKeyword.Status}get Text(){return this.privSpeechKeyword.Text}get Offset(){return this.privSpeechKeyword.Offset}get Duration(){return this.privSpeechKeyword.Duration}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SpeechServiceRecognizer:()=>C});var r=i(60),n=i(59),s=i(47),o=i(57),a=i(50),c=i(44),p=i(91),h=i(51),d=i(85),u=i(101),v=i(97),l=i(99),g=i(98),m=i(61),S=i(100),f=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class C extends d.ServiceRecognizerBase{constructor(e,t,i,r,n){super(e,t,i,r,n),this.privSpeechRecognizer=n}processTypeSpecificMessages(e){return f(this,void 0,void 0,(function*(){let t;const i=new r.PropertyCollection;i.setProperty(n.PropertyId.SpeechServiceResponse_JsonResult,e.textBody);let p=!1;switch(e.path.toLowerCase()){case"speech.hypothesis":case"speech.fragment":const r=u.SpeechHypothesis.fromJSON(e.textBody),n=r.Offset+this.privRequestSession.currentTurnAudioOffset;t=new s.SpeechRecognitionResult(this.privRequestSession.requestId,o.ResultReason.RecognizingSpeech,r.Text,r.Duration,n,r.Language,r.LanguageDetectionConfidence,void 0,void 0,e.textBody,i),this.privRequestSession.onHypothesis(n);const h=new a.SpeechRecognitionEventArgs(t,r.Duration,this.privRequestSession.sessionId);if(this.privSpeechRecognizer.recognizing)try{this.privSpeechRecognizer.recognizing(this.privSpeechRecognizer,h)}catch(e){}p=!0;break;case"speech.phrase":const d=v.SimpleSpeechPhrase.fromJSON(e.textBody),f=l.EnumTranslation.implTranslateRecognitionResult(d.RecognitionStatus);if(this.privRequestSession.onPhraseRecognized(this.privRequestSession.currentTurnAudioOffset+d.Offset+d.Duration),o.ResultReason.Canceled===f){const e=l.EnumTranslation.implTranslateCancelResult(d.RecognitionStatus),t=l.EnumTranslation.implTranslateCancelErrorCode(d.RecognitionStatus);yield this.cancelRecognitionLocal(e,t,l.EnumTranslation.implTranslateErrorDetails(t))}else{if(!this.privRequestSession.isSpeechEnded||f!==o.ResultReason.NoMatch||d.RecognitionStatus===g.RecognitionStatus.InitialSilenceTimeout){if(this.privRecognizerConfig.parameters.getProperty(m.OutputFormatPropertyName)===c.OutputFormat[c.OutputFormat.Simple])t=new s.SpeechRecognitionResult(this.privRequestSession.requestId,f,d.DisplayText,d.Duration,d.Offset+this.privRequestSession.currentTurnAudioOffset,d.Language,d.LanguageDetectionConfidence,void 0,void 0,e.textBody,i);else{const r=S.DetailedSpeechPhrase.fromJSON(e.textBody),n=r.Offset+this.privRequestSession.currentTurnAudioOffset,o=r.getJsonWithCorrectedOffsets(n);t=new s.SpeechRecognitionResult(this.privRequestSession.requestId,f,r.RecognitionStatus===g.RecognitionStatus.Success?r.NBest[0].Display:void 0,r.Duration,n,r.Language,r.LanguageDetectionConfidence,void 0,void 0,o,i)}const r=new a.SpeechRecognitionEventArgs(t,t.offset,this.privRequestSession.sessionId);if(this.privSpeechRecognizer.recognized)try{this.privSpeechRecognizer.recognized(this.privSpeechRecognizer,r)}catch(e){}}if(this.privSuccessCallback){try{this.privSuccessCallback(t)}catch(e){this.privErrorCallback&&this.privErrorCallback(e)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}p=!0}return p}))}cancelRecognition(e,t,i,n,a){const c=new r.PropertyCollection;if(c.setProperty(m.CancellationErrorCodePropertyName,p.CancellationErrorCode[n]),this.privSpeechRecognizer.canceled){const t=new h.SpeechRecognitionCanceledEventArgs(i,a,n,void 0,e);try{this.privSpeechRecognizer.canceled(this.privSpeechRecognizer,t)}catch(e){}}if(this.privSuccessCallback){const e=new s.SpeechRecognitionResult(t,o.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,void 0,a,void 0,c);try{this.privSuccessCallback(e),this.privSuccessCallback=void 0}catch(e){}}}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConversationTranscriptionServiceRecognizer:()=>C});var r=i(60),n=i(59),s=i(118),o=i(57),a=i(50),c=i(44),p=i(91),h=i(119),d=i(85),u=i(101),v=i(97),l=i(99),g=i(98),m=i(61),S=i(100),f=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class C extends d.ServiceRecognizerBase{constructor(e,t,i,r,n){super(e,t,i,r,n),this.privConversationTranscriber=n,this.setSpeakerDiarizationJson()}setSpeakerDiarizationJson(){if(this.privEnableSpeakerId){const e=this.privSpeechContext.getSection("phraseDetection");e.mode="Conversation";const t={mode:"Anonymous"};t.audioSessionId=this.privDiarizationSessionId,t.audioOffsetMs=0,e.speakerDiarization=t,this.privSpeechContext.setSection("phraseDetection",e)}}processTypeSpecificMessages(e){return f(this,void 0,void 0,(function*(){let t;const i=new r.PropertyCollection;i.setProperty(n.PropertyId.SpeechServiceResponse_JsonResult,e.textBody);let p=!1;switch(e.path.toLowerCase()){case"speech.hypothesis":case"speech.fragment":const r=u.SpeechHypothesis.fromJSON(e.textBody),n=r.Offset+this.privRequestSession.currentTurnAudioOffset;t=new s.ConversationTranscriptionResult(this.privRequestSession.requestId,o.ResultReason.RecognizingSpeech,r.Text,r.Duration,n,r.Language,r.LanguageDetectionConfidence,void 0,void 0,e.textBody,i),this.privRequestSession.onHypothesis(n);const h=new a.ConversationTranscriptionEventArgs(t,r.Duration,this.privRequestSession.sessionId);if(this.privConversationTranscriber.transcribing)try{this.privConversationTranscriber.transcribing(this.privConversationTranscriber,h)}catch(e){}p=!0;break;case"speech.phrase":const d=v.SimpleSpeechPhrase.fromJSON(e.textBody),f=l.EnumTranslation.implTranslateRecognitionResult(d.RecognitionStatus);if(this.privRequestSession.onPhraseRecognized(this.privRequestSession.currentTurnAudioOffset+d.Offset+d.Duration),o.ResultReason.Canceled===f){const e=l.EnumTranslation.implTranslateCancelResult(d.RecognitionStatus),t=l.EnumTranslation.implTranslateCancelErrorCode(d.RecognitionStatus);yield this.cancelRecognitionLocal(e,t,l.EnumTranslation.implTranslateErrorDetails(t))}else if(!this.privRequestSession.isSpeechEnded||f!==o.ResultReason.NoMatch||d.RecognitionStatus===g.RecognitionStatus.InitialSilenceTimeout){if(this.privRecognizerConfig.parameters.getProperty(m.OutputFormatPropertyName)===c.OutputFormat[c.OutputFormat.Simple])t=new s.ConversationTranscriptionResult(this.privRequestSession.requestId,f,d.DisplayText,d.Duration,d.Offset+this.privRequestSession.currentTurnAudioOffset,d.Language,d.LanguageDetectionConfidence,d.SpeakerId,void 0,e.textBody,i);else{const r=S.DetailedSpeechPhrase.fromJSON(e.textBody),n=r.Offset+this.privRequestSession.currentTurnAudioOffset,o=r.getJsonWithCorrectedOffsets(n);t=new s.ConversationTranscriptionResult(this.privRequestSession.requestId,f,r.RecognitionStatus===g.RecognitionStatus.Success?r.NBest[0].Display:void 0,r.Duration,n,r.Language,r.LanguageDetectionConfidence,d.SpeakerId,void 0,o,i)}const r=new a.ConversationTranscriptionEventArgs(t,t.offset,this.privRequestSession.sessionId);if(this.privConversationTranscriber.transcribed)try{this.privConversationTranscriber.transcribed(this.privConversationTranscriber,r)}catch(e){}}p=!0}return p}))}cancelRecognition(e,t,i,n,s){if((new r.PropertyCollection).setProperty(m.CancellationErrorCodePropertyName,p.CancellationErrorCode[n]),this.privConversationTranscriber.canceled){const t=new h.ConversationTranscriptionCanceledEventArgs(i,s,n,void 0,e);try{this.privConversationTranscriber.canceled(this.privConversationTranscriber,t)}catch(e){}}}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConversationTranscriptionResult:()=>n});var r=i(46);class n extends r.RecognitionResult{constructor(e,t,i,r,n,s,o,a,c,p,h){super(e,t,i,r,n,s,o,c,p,h),this.privSpeakerId=a}get speakerId(){return this.privSpeakerId}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConversationTranscriptionCanceledEventArgs:()=>n});var r=i(52);class n extends r.CancellationEventArgsBase{}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{TranscriptionServiceRecognizer:()=>m});var r=i(80),n=i(59),s=i(50),o=i(60),a=i(91),c=i(121),p=i(119),h=i(47),d=i(57),u=i(96),v=i(61),l=i(94),g=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class m extends u.ConversationServiceRecognizer{constructor(e,t,i,r,s){super(e,t,i,r,s),this.privTranscriberRecognizer=s,this.sendPrePayloadJSONOverride=e=>this.sendTranscriptionStartJSON(e),"true"===this.privRecognizerConfig.parameters.getProperty(n.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps)&&this.privSpeechContext.setWordLevelTimings()}sendSpeechEventAsync(e,t){return g(this,void 0,void 0,(function*(){if(this.privRequestSession.isRecognizing){const i=yield this.fetchConnection();yield this.sendSpeechEvent(i,this.createSpeechEventPayload(e,t))}}))}sendMeetingSpeechEventAsync(e,t){return g(this,void 0,void 0,(function*(){if(this.privRequestSession.isRecognizing){const i=yield this.fetchConnection();yield this.sendSpeechEvent(i,this.createMeetingSpeechEventPayload(e,t))}}))}processTypeSpecificMessages(e){return this.processSpeechMessages(e)}handleRecognizedCallback(e,t,i){try{const r=new s.SpeechRecognitionEventArgs(e,t,i);if(this.privTranscriberRecognizer.recognized(this.privTranscriberRecognizer,r),this.privSuccessCallback){try{this.privSuccessCallback(e)}catch(e){this.privErrorCallback&&this.privErrorCallback(e)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}catch(e){}}handleRecognizingCallback(e,t,i){try{const r=new s.SpeechRecognitionEventArgs(e,t,i);this.privTranscriberRecognizer.recognizing(this.privTranscriberRecognizer,r)}catch(e){}}cancelRecognition(e,t,i,r,n){const s=new o.PropertyCollection;if(s.setProperty(v.CancellationErrorCodePropertyName,a.CancellationErrorCode[r]),this.privTranscriberRecognizer.IsMeetingRecognizer()){if(this.privTranscriberRecognizer.canceled){const t=new c.MeetingTranscriptionCanceledEventArgs(i,n,r,void 0,e);try{this.privTranscriberRecognizer.canceled(this.privTranscriberRecognizer,t)}catch(e){}}}else if(this.privTranscriberRecognizer.canceled){const t=new p.ConversationTranscriptionCanceledEventArgs(i,n,r,void 0,e);try{this.privTranscriberRecognizer.canceled(this.privTranscriberRecognizer,t)}catch(e){}}if(this.privSuccessCallback){const e=new h.SpeechRecognitionResult(t,d.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,void 0,n,void 0,s);try{this.privSuccessCallback(e),this.privSuccessCallback=void 0}catch(e){}}}sendTranscriptionStartJSON(e){return g(this,void 0,void 0,(function*(){if(yield this.sendSpeechContext(e,!0),this.privTranscriberRecognizer.IsMeetingRecognizer()){const t=this.privTranscriberRecognizer.getMeetingInfo(),i=this.createMeetingSpeechEventPayload(t,"start");yield this.sendSpeechEvent(e,i)}else{const t=this.privTranscriberRecognizer.getConversationInfo(),i=this.createSpeechEventPayload(t,"start");yield this.sendSpeechEvent(e,i)}yield this.sendWaveHeader(e)}))}sendSpeechEvent(e,t){const i=JSON.stringify(t);if(i)return e.send(new l.SpeechConnectionMessage(r.MessageType.Text,"speech.event",this.privRequestSession.requestId,"application/json",i))}createSpeechEventPayload(e,t){const i={id:"meeting",name:t,meeting:e.conversationProperties};return i.meeting.id=e.id,i.meeting.attendees=e.participants,i}createMeetingSpeechEventPayload(e,t){const i={id:"meeting",name:t,meeting:e.meetingProperties};return i.meeting.id=e.id,i.meeting.attendees=e.participants,i}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{MeetingTranscriptionCanceledEventArgs:()=>n});var r=i(52);class n extends r.CancellationEventArgsBase{}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{AddedLmIntent:()=>r});class r{constructor(e,t){this.modelImpl=e,this.intentName=t}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{IntentServiceRecognizer:()=>f});var r=i(80),n=i(18),s=i(60),o=i(59),a=i(48),c=i(57),p=i(45),h=i(91),d=i(125),u=i(85),v=i(101),l=i(97),g=i(99),m=i(124),S=i(61);class f extends u.ServiceRecognizerBase{constructor(e,t,i,r,n){super(e,t,i,r,n),this.privIntentRecognizer=n,this.privIntentDataSent=!1}setIntents(e,t){this.privAddedLmIntents=e,this.privUmbrellaIntent=t,this.privIntentDataSent=!0}processTypeSpecificMessages(e){let t,i,h=!1;const d=new s.PropertyCollection;switch(e.messageType===r.MessageType.Text&&d.setProperty(o.PropertyId.SpeechServiceResponse_JsonResult,e.textBody),e.path.toLowerCase()){case"speech.hypothesis":const r=v.SpeechHypothesis.fromJSON(e.textBody);if(t=new a.IntentRecognitionResult(void 0,this.privRequestSession.requestId,c.ResultReason.RecognizingIntent,r.Text,r.Duration,r.Offset+this.privRequestSession.currentTurnAudioOffset,r.Language,r.LanguageDetectionConfidence,void 0,e.textBody,d),this.privRequestSession.onHypothesis(t.offset),i=new p.IntentRecognitionEventArgs(t,r.Offset+this.privRequestSession.currentTurnAudioOffset,this.privRequestSession.sessionId),this.privIntentRecognizer.recognizing)try{this.privIntentRecognizer.recognizing(this.privIntentRecognizer,i)}catch(e){}h=!0;break;case"speech.phrase":const n=l.SimpleSpeechPhrase.fromJSON(e.textBody);t=new a.IntentRecognitionResult(void 0,this.privRequestSession.requestId,g.EnumTranslation.implTranslateRecognitionResult(n.RecognitionStatus),n.DisplayText,n.Duration,n.Offset+this.privRequestSession.currentTurnAudioOffset,n.Language,n.LanguageDetectionConfidence,void 0,e.textBody,d),i=new p.IntentRecognitionEventArgs(t,t.offset,this.privRequestSession.sessionId);const u=()=>{if(this.privIntentRecognizer.recognized)try{this.privIntentRecognizer.recognized(this.privIntentRecognizer,i)}catch(e){}if(this.privSuccessCallback){try{this.privSuccessCallback(t)}catch(e){this.privErrorCallback&&this.privErrorCallback(e)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}};!1===this.privIntentDataSent||c.ResultReason.NoMatch===i.result.reason?(this.privRequestSession.onPhraseRecognized(i.offset+i.result.duration),u()):this.privPendingIntentArgs=i,h=!0;break;case"response":if(i=this.privPendingIntentArgs,this.privPendingIntentArgs=void 0,void 0===i){if(""===e.textBody)return;i=new p.IntentRecognitionEventArgs(new a.IntentRecognitionResult,0,this.privRequestSession.sessionId)}const S=m.IntentResponse.fromJSON(e.textBody);if(null!==S&&S.topScoringIntent&&S.topScoringIntent.intent){let t=this.privAddedLmIntents[S.topScoringIntent.intent];if(void 0!==this.privUmbrellaIntent&&(t=this.privUmbrellaIntent),t){const r=void 0===t||void 0===t.intentName?S.topScoringIntent.intent:t.intentName;let n=i.result.reason;void 0!==r&&(n=c.ResultReason.RecognizedIntent);const h=void 0!==i.result.properties?i.result.properties:new s.PropertyCollection;h.setProperty(o.PropertyId.LanguageUnderstandingServiceResponse_JsonResult,e.textBody),i=new p.IntentRecognitionEventArgs(new a.IntentRecognitionResult(r,i.result.resultId,n,i.result.text,i.result.duration,i.result.offset,void 0,void 0,i.result.errorDetails,i.result.json,h),i.offset,i.sessionId)}}if(this.privRequestSession.onPhraseRecognized(i.offset+i.result.duration),this.privIntentRecognizer.recognized)try{this.privIntentRecognizer.recognized(this.privIntentRecognizer,i)}catch(e){}if(this.privSuccessCallback){try{this.privSuccessCallback(i.result)}catch(e){this.privErrorCallback&&this.privErrorCallback(e)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}h=!0}const u=new n.Deferred;return u.resolve(h),u.promise}cancelRecognition(e,t,i,r,n){const o=new s.PropertyCollection;if(o.setProperty(S.CancellationErrorCodePropertyName,h.CancellationErrorCode[r]),this.privIntentRecognizer.canceled){const t=new d.IntentRecognitionCanceledEventArgs(i,n,r,void 0,void 0,e);try{this.privIntentRecognizer.canceled(this.privIntentRecognizer,t)}catch(e){}}if(this.privSuccessCallback){const e=new a.IntentRecognitionResult(void 0,t,c.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,n,void 0,o);try{this.privSuccessCallback(e),this.privSuccessCallback=void 0}catch(e){}}}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{IntentResponse:()=>r});class r{constructor(e){this.privIntentResponse=""===e?{}:JSON.parse(e)}static fromJSON(e){return new r(e)}get query(){return this.privIntentResponse.query}get topScoringIntent(){return this.privIntentResponse.topScoringIntent}get entities(){return this.privIntentResponse.entities}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{IntentRecognitionCanceledEventArgs:()=>n});var r=i(45);class n extends r.IntentRecognitionEventArgs{constructor(e,t,i,r,n,s){super(r,n,s),this.privReason=e,this.privErrorDetails=t,this.privErrorCode=i}get reason(){return this.privReason}get errorCode(){return this.privErrorCode}get errorDetails(){return this.privErrorDetails}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{DialogServiceAdapter:()=>B});var r=i(93),n=i(131),s=i(16),o=i(9),a=i(80),c=i(18),p=i(78),h=i(26),d=i(32),u=i(34),v=i(40),l=i(91),g=i(60),m=i(59),S=i(47),f=i(57),C=i(50),y=i(51),R=i(42),P=i(43),I=i(130),T=i(132),w=i(133),A=i(127),E=i(85),D=i(97),b=i(98),k=i(101),M=i(115),O=i(61),N=i(95),z=i(99),x=i(129),L=i(94),F=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class B extends E.ServiceRecognizerBase{constructor(e,t,i,r,n){super(e,t,i,r,n),this.privEvents=new s.EventSource,this.privDialogServiceConnector=n,this.receiveMessageOverride=()=>this.receiveDialogMessageOverride(),this.privTurnStateManager=new A.DialogServiceTurnStateManager,this.recognizeOverride=(e,t,i)=>this.listenOnce(e,t,i),this.postConnectImplOverride=e=>this.dialogConnectImpl(e),this.configConnectionOverride=e=>this.configConnection(e),this.disconnectOverride=()=>this.privDisconnect(),this.privDialogAudioSource=i,this.agentConfigSent=!1,this.privLastResult=null,this.connectionEvents.attach((e=>{"ConnectionClosedEvent"===e.name&&(this.terminateMessageLoop=!0)}))}sendMessage(e){return F(this,void 0,void 0,(function*(){const t=(0,o.createGuid)(),i=(0,o.createNoDashGuid)(),r={context:{interactionId:t},messagePayload:JSON.parse(e),version:.5},n=JSON.stringify(r),s=yield this.fetchConnection();yield s.send(new L.SpeechConnectionMessage(a.MessageType.Text,"agent",i,"application/json",n))}))}privDisconnect(){return F(this,void 0,void 0,(function*(){yield this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,v.CancellationReason.Error,l.CancellationErrorCode.NoError,"Disconnecting"),this.terminateMessageLoop=!0,this.agentConfigSent=!1}))}processTypeSpecificMessages(e){const t=new g.PropertyCollection;let i,r;switch(e.messageType===a.MessageType.Text&&t.setProperty(m.PropertyId.SpeechServiceResponse_JsonResult,e.textBody),e.path.toLowerCase()){case"speech.phrase":const n=D.SimpleSpeechPhrase.fromJSON(e.textBody);if(this.privRequestSession.onPhraseRecognized(this.privRequestSession.currentTurnAudioOffset+n.Offset+n.Duration),n.RecognitionStatus!==b.RecognitionStatus.TooManyRequests&&n.RecognitionStatus!==b.RecognitionStatus.Error){const e=this.fireEventForResult(n,t);if(this.privLastResult=e.result,this.privDialogServiceConnector.recognized)try{this.privDialogServiceConnector.recognized(this.privDialogServiceConnector,e)}catch(e){}}r=!0;break;case"speech.hypothesis":const s=k.SpeechHypothesis.fromJSON(e.textBody),o=s.Offset+this.privRequestSession.currentTurnAudioOffset;i=new S.SpeechRecognitionResult(this.privRequestSession.requestId,f.ResultReason.RecognizingSpeech,s.Text,s.Duration,o,s.Language,s.LanguageDetectionConfidence,void 0,void 0,e.textBody,t),this.privRequestSession.onHypothesis(o);const a=new C.SpeechRecognitionEventArgs(i,s.Duration,this.privRequestSession.sessionId);if(this.privDialogServiceConnector.recognizing)try{this.privDialogServiceConnector.recognizing(this.privDialogServiceConnector,a)}catch(e){}r=!0;break;case"speech.keyword":const c=M.SpeechKeyword.fromJSON(e.textBody);i=new S.SpeechRecognitionResult(this.privRequestSession.requestId,"Accepted"===c.Status?f.ResultReason.RecognizedKeyword:f.ResultReason.NoMatch,c.Text,c.Duration,c.Offset,void 0,void 0,void 0,void 0,e.textBody,t),"Accepted"!==c.Status&&(this.privLastResult=i);const p=new C.SpeechRecognitionEventArgs(i,i.duration,i.resultId);if(this.privDialogServiceConnector.recognized)try{this.privDialogServiceConnector.recognized(this.privDialogServiceConnector,p)}catch(e){}r=!0;break;case"audio":{const t=e.requestId.toUpperCase(),i=this.privTurnStateManager.GetTurn(t);try{e.binaryBody?i.audioStream.write(e.binaryBody):i.endAudioStream()}catch(e){}}r=!0;break;case"response":this.handleResponseMessage(e),r=!0}const n=new c.Deferred;return n.resolve(r),n.promise}cancelRecognition(e,t,i,r,n){return F(this,void 0,void 0,(function*(){if(this.terminateMessageLoop=!0,this.privRequestSession.isRecognizing&&(yield this.privRequestSession.onStopRecognizing()),this.privDialogServiceConnector.canceled){const t=new g.PropertyCollection;t.setProperty(O.CancellationErrorCodePropertyName,l.CancellationErrorCode[r]);const s=new y.SpeechRecognitionCanceledEventArgs(i,n,r,void 0,e);try{this.privDialogServiceConnector.canceled(this.privDialogServiceConnector,s)}catch(e){}if(this.privSuccessCallback){const e=new S.SpeechRecognitionResult(void 0,f.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,void 0,n,void 0,t);try{this.privSuccessCallback(e),this.privSuccessCallback=void 0}catch(e){}}}}))}listenOnce(e,t,i){return F(this,void 0,void 0,(function*(){this.privRecognizerConfig.recognitionMode=e,this.privSuccessCallback=t,this.privErrorCallback=i,this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privDialogAudioSource.events),this.privRecognizerConfig.parameters.setProperty(m.PropertyId.Speech_SessionId,this.privRequestSession.sessionId);const n=this.connectImpl(),s=this.sendPreAudioMessages(),o=yield this.privDialogAudioSource.attach(this.privRequestSession.audioNodeId),a=yield this.privDialogAudioSource.format,c=yield this.privDialogAudioSource.deviceInfo,p=new r.ReplayableAudioNode(o,a.avgBytesPerSec);yield this.privRequestSession.onAudioSourceAttachCompleted(p,!1),this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:c};try{yield n,yield s}catch(e){return yield this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,v.CancellationReason.Error,l.CancellationErrorCode.ConnectionFailure,e),Promise.resolve()}const h=new R.SessionEventArgs(this.privRequestSession.sessionId);this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,h);this.sendAudio(p).then((()=>{}),(e=>F(this,void 0,void 0,(function*(){yield this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,v.CancellationReason.Error,l.CancellationErrorCode.RuntimeError,e)}))))}))}dialogConnectImpl(e){return this.privConnectionLoop=this.startMessageLoop(),e}receiveDialogMessageOverride(){const e=new c.Deferred,t=()=>F(this,void 0,void 0,(function*(){try{const i=this.isDisposed(),r=!this.isDisposed()&&this.terminateMessageLoop;if(i||r)return void e.resolve(void 0);const n=yield this.fetchConnection(),s=yield n.read();if(!s)return t();const o=L.SpeechConnectionMessage.fromConnectionMessage(s);switch(o.path.toLowerCase()){case"turn.start":{const e=o.requestId.toUpperCase();e!==this.privRequestSession.requestId.toUpperCase()?this.privTurnStateManager.StartTurn(e):this.privRequestSession.onServiceTurnStartResponse()}break;case"speech.startdetected":const e=N.SpeechDetected.fromJSON(o.textBody),t=new P.RecognitionEventArgs(e.Offset,this.privRequestSession.sessionId);this.privRecognizer.speechStartDetected&&this.privRecognizer.speechStartDetected(this.privRecognizer,t);break;case"speech.enddetected":let i;i=o.textBody.length>0?o.textBody:"{ Offset: 0 }";const r=N.SpeechDetected.fromJSON(i);this.privRequestSession.onServiceRecognized(r.Offset+this.privRequestSession.currentTurnAudioOffset);const n=new P.RecognitionEventArgs(r.Offset+this.privRequestSession.currentTurnAudioOffset,this.privRequestSession.sessionId);this.privRecognizer.speechEndDetected&&this.privRecognizer.speechEndDetected(this.privRecognizer,n);break;case"turn.end":{const e=o.requestId.toUpperCase();if(e!==this.privRequestSession.requestId.toUpperCase())this.privTurnStateManager.CompleteTurn(e);else{const e=new R.SessionEventArgs(this.privRequestSession.sessionId);if(yield this.privRequestSession.onServiceTurnEndResponse(!1),this.privRecognizerConfig.isContinuousRecognition&&!this.privRequestSession.isSpeechEnded&&this.privRequestSession.isRecognizing||this.privRecognizer.sessionStopped&&this.privRecognizer.sessionStopped(this.privRecognizer,e),this.privSuccessCallback&&this.privLastResult){try{this.privSuccessCallback(this.privLastResult),this.privLastResult=null}catch(e){this.privErrorCallback&&this.privErrorCallback(e)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}}break;default:try{(yield this.processTypeSpecificMessages(o))||this.serviceEvents&&this.serviceEvents.onEvent(new p.ServiceEvent(o.path.toLowerCase(),o.textBody))}catch(e){}}return t()}catch(t){this.terminateMessageLoop=!0,e.resolve()}}));return t().catch((e=>{h.Events.instance.onEvent(new d.BackgroundEvent(e))})),e.promise}startMessageLoop(){return F(this,void 0,void 0,(function*(){this.terminateMessageLoop=!1;try{yield this.receiveDialogMessageOverride()}catch(e){yield this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,v.CancellationReason.Error,l.CancellationErrorCode.RuntimeError,e)}return Promise.resolve()}))}configConnection(e){return F(this,void 0,void 0,(function*(){return this.terminateMessageLoop?(this.terminateMessageLoop=!1,Promise.reject("Connection to service terminated.")):(yield this.sendSpeechServiceConfig(e,this.privRequestSession,this.privRecognizerConfig.SpeechServiceConfig.serialize()),yield this.sendAgentConfig(e),e)}))}sendPreAudioMessages(){return F(this,void 0,void 0,(function*(){const e=yield this.fetchConnection();this.addKeywordContextData(),yield this.sendSpeechContext(e,!0),yield this.sendAgentContext(e),yield this.sendWaveHeader(e)}))}sendAgentConfig(e){if(this.agentConfig&&!this.agentConfigSent){if(this.privRecognizerConfig.parameters.getProperty(m.PropertyId.Conversation_DialogType)===I.DialogServiceConfig.DialogTypes.CustomCommands){const e=this.agentConfig.get();e.botInfo.commandsCulture=this.privRecognizerConfig.parameters.getProperty(m.PropertyId.SpeechServiceConnection_RecoLanguage,"en-us"),this.agentConfig.set(e)}this.onEvent(new n.SendingAgentContextMessageEvent(this.agentConfig));const t=this.agentConfig.toJsonString();return this.agentConfigSent=!0,e.send(new L.SpeechConnectionMessage(a.MessageType.Text,"agent.config",this.privRequestSession.requestId,"application/json",t))}}sendAgentContext(e){const t=(0,o.createGuid)(),i=this.privDialogServiceConnector.properties.getProperty(m.PropertyId.Conversation_Speech_Activity_Template),r={channelData:"",context:{interactionId:t},messagePayload:void 0===typeof i?void 0:i,version:.5},n=JSON.stringify(r);return e.send(new L.SpeechConnectionMessage(a.MessageType.Text,"speech.agent.context",this.privRequestSession.requestId,"application/json",n))}fireEventForResult(e,t){const i=z.EnumTranslation.implTranslateRecognitionResult(e.RecognitionStatus),r=e.Offset+this.privRequestSession.currentTurnAudioOffset,n=new S.SpeechRecognitionResult(this.privRequestSession.requestId,i,e.DisplayText,e.Duration,r,e.Language,e.LanguageDetectionConfidence,void 0,void 0,JSON.stringify(e),t);return new C.SpeechRecognitionEventArgs(n,r,this.privRequestSession.sessionId)}handleResponseMessage(e){const t=JSON.parse(e.textBody);switch(t.messageType.toLowerCase()){case"message":const i=e.requestId.toUpperCase(),r=x.ActivityPayloadResponse.fromJSON(e.textBody),n=this.privTurnStateManager.GetTurn(i);if(r.conversationId){const e=this.agentConfig.get();e.botInfo.conversationId=r.conversationId,this.agentConfig.set(e)}const s=n.processActivityPayload(r,u.AudioOutputFormatImpl.fromSpeechSynthesisOutputFormatString(this.privDialogServiceConnector.properties.getProperty(m.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0))),o=new T.ActivityReceivedEventArgs(r.messagePayload,s);if(this.privDialogServiceConnector.activityReceived)try{this.privDialogServiceConnector.activityReceived(this.privDialogServiceConnector,o)}catch(e){}break;case"messagestatus":if(this.privDialogServiceConnector.turnStatusReceived)try{this.privDialogServiceConnector.turnStatusReceived(this.privDialogServiceConnector,new w.TurnStatusReceivedEventArgs(e.textBody))}catch(e){}break;default:h.Events.instance.onEvent(new d.BackgroundEvent(`Unexpected response of type ${t.messageType}. Ignoring.`))}}onEvent(e){this.privEvents.onEvent(e),h.Events.instance.onEvent(e)}addKeywordContextData(){const e=this.privRecognizerConfig.parameters.getProperty("SPEECH-KeywordsToDetect");if(void 0===e)return;const t=this.privRecognizerConfig.parameters.getProperty("SPEECH-KeywordsToDetect-Offsets"),i=this.privRecognizerConfig.parameters.getProperty("SPEECH-KeywordsToDetect-Durations"),r=e.split(";"),n=void 0===t?[]:t.split(";"),s=void 0===i?[]:i.split(";"),o=[];for(let e=0;e<r.length;e++){const t={};t.text=r[e],e<n.length&&(t.offset=Number(n[e])),e<s.length&&(t.duration=Number(s[e])),o.push(t)}this.speechContext.setSection("invocationSource","VoiceActivationWithKeyword"),this.speechContext.setSection("keywordDetection",[{clientDetectedKeywords:o,onReject:{action:"EndOfTurn"},type:"startTrigger"}])}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{DialogServiceTurnStateManager:()=>s});var r=i(17),n=i(128);class s{constructor(){this.privTurnMap=new Map}StartTurn(e){if(this.privTurnMap.has(e))throw new r.InvalidOperationError("Service error: There is already a turn with id:"+e);const t=new n.DialogServiceTurnState(this,e);return this.privTurnMap.set(e,t),this.privTurnMap.get(e)}GetTurn(e){return this.privTurnMap.get(e)}CompleteTurn(e){if(!this.privTurnMap.has(e))throw new r.InvalidOperationError("Service error: Received turn end for an unknown turn id:"+e);const t=this.privTurnMap.get(e);return t.complete(),this.privTurnMap.delete(e),t}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{DialogServiceTurnState:()=>o});var r=i(34),n=i(33),s=i(129);class o{constructor(e,t){this.privRequestId=t,this.privIsCompleted=!1,this.privAudioStream=null,this.privTurnManager=e,this.resetTurnEndTimeout()}get audioStream(){return this.resetTurnEndTimeout(),this.privAudioStream}processActivityPayload(e,t){return e.messageDataStreamType===s.MessageDataStreamType.TextToSpeechAudio&&(this.privAudioStream=n.AudioOutputStream.createPullStream(),this.privAudioStream.format=void 0!==t?t:r.AudioOutputFormatImpl.getDefaultOutputFormat()),this.privAudioStream}endAudioStream(){null===this.privAudioStream||this.privAudioStream.isClosed||this.privAudioStream.close()}complete(){void 0!==this.privTimeoutToken&&clearTimeout(this.privTimeoutToken),this.endAudioStream()}resetTurnEndTimeout(){void 0!==this.privTimeoutToken&&clearTimeout(this.privTimeoutToken),this.privTimeoutToken=setTimeout((()=>{this.privTurnManager.CompleteTurn(this.privRequestId)}),2e3)}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ActivityPayloadResponse:()=>r,MessageDataStreamType:()=>n});class r{constructor(e){this.privActivityResponse=JSON.parse(e)}static fromJSON(e){return new r(e)}get conversationId(){return this.privActivityResponse.conversationId}get messageDataStreamType(){return this.privActivityResponse.messageDataStreamType}get messagePayload(){return this.privActivityResponse.messagePayload}get version(){return this.privActivityResponse.version}}var n;!function(e){e[e.None=0]="None",e[e.TextToSpeechAudio=1]="TextToSpeechAudio"}(n||(n={}))},(e,t,i)=>{"use strict";i.r(t),i.d(t,{DialogServiceConfig:()=>o,DialogServiceConfigImpl:()=>a});var r=i(36),n=i(58),s=i(59);class o{constructor(){}set applicationId(e){}static get DialogTypes(){return{BotFramework:"bot_framework",CustomCommands:"custom_commands"}}}class a extends o{constructor(){super(),this.privSpeechConfig=new n.SpeechConfigImpl}get properties(){return this.privSpeechConfig.properties}get speechRecognitionLanguage(){return this.privSpeechConfig.speechRecognitionLanguage}set speechRecognitionLanguage(e){r.Contracts.throwIfNullOrWhitespace(e,"value"),this.privSpeechConfig.speechRecognitionLanguage=e}get outputFormat(){return this.privSpeechConfig.outputFormat}set outputFormat(e){this.privSpeechConfig.outputFormat=e}setProperty(e,t){this.privSpeechConfig.setProperty(e,t)}getProperty(e,t){return this.privSpeechConfig.getProperty(e)}setProxy(e,t,i,r){this.setProperty(s.PropertyId.SpeechServiceConnection_ProxyHostName,e),this.setProperty(s.PropertyId.SpeechServiceConnection_ProxyPort,`${t}`),i&&this.setProperty(s.PropertyId.SpeechServiceConnection_ProxyUserName,i),r&&this.setProperty(s.PropertyId.SpeechServiceConnection_ProxyPassword,r)}setServiceProperty(e,t,i){this.privSpeechConfig.setServiceProperty(e,t)}close(){}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{DialogEvent:()=>n,SendingAgentContextMessageEvent:()=>s});var r=i(20);class n extends r.PlatformEvent{constructor(e,t=r.EventType.Info){super(e,t)}}class s extends n{constructor(e){super("SendingAgentContextMessageEvent"),this.privAgentConfig=e}get agentConfig(){return this.privAgentConfig}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ActivityReceivedEventArgs:()=>r});class r{constructor(e,t){this.privActivity=e,this.privAudioStream=t}get activity(){return this.privActivity}get audioStream(){return this.privAudioStream}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{TurnStatusReceivedEventArgs:()=>n});var r=i(134);class n{constructor(e){this.privTurnStatus=r.TurnStatusResponsePayload.fromJSON(e)}get interactionId(){return this.privTurnStatus.interactionId}get conversationId(){return this.privTurnStatus.conversationId}get statusCode(){return this.privTurnStatus.statusCode}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{TurnStatusResponsePayload:()=>r});class r{constructor(e){this.privMessageStatusResponse=JSON.parse(e)}static fromJSON(e){return new r(e)}get interactionId(){return this.privMessageStatusResponse.interactionId}get conversationId(){return this.privMessageStatusResponse.conversationId}get statusCode(){switch(this.privMessageStatusResponse.statusCode){case"Success":return 200;case"Failed":return 400;case"TimedOut":return 429;default:return this.privMessageStatusResponse.statusCode}}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConversationConnectionConfig:()=>n.ConversationConnectionConfig,ConversationManager:()=>r.ConversationManager,ConversationReceivedTranslationEventArgs:()=>a.ConversationReceivedTranslationEventArgs,ConversationRecognizerFactory:()=>s.ConversationRecognizerFactory,ConversationTranslatorCommandTypes:()=>c.ConversationTranslatorCommandTypes,ConversationTranslatorMessageTypes:()=>c.ConversationTranslatorMessageTypes,InternalParticipants:()=>c.InternalParticipants,LockRoomEventArgs:()=>a.LockRoomEventArgs,MuteAllEventArgs:()=>a.MuteAllEventArgs,ParticipantAttributeEventArgs:()=>a.ParticipantAttributeEventArgs,ParticipantEventArgs:()=>a.ParticipantEventArgs,ParticipantsListEventArgs:()=>a.ParticipantsListEventArgs,TranscriberRecognizer:()=>o.TranscriberRecognizer});var r=i(136),n=i(137),s=i(142),o=i(172),a=i(167),c=i(168)},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConversationManager:()=>a});var r=i(139),n=i(36),s=i(59),o=i(137);class a{constructor(){this.privRequestParams=o.ConversationConnectionConfig.configParams,this.privErrors=o.ConversationConnectionConfig.restErrors,this.privHost=o.ConversationConnectionConfig.host,this.privApiVersion=o.ConversationConnectionConfig.apiVersion,this.privRestPath=o.ConversationConnectionConfig.restPath,this.privRestAdapter=new r.RestMessageAdapter({})}createOrJoin(e,t,i,a){try{n.Contracts.throwIfNullOrUndefined(e,"args");const c=e.getProperty(s.PropertyId.SpeechServiceConnection_RecoLanguage,o.ConversationConnectionConfig.defaultLanguageCode),p=e.getProperty(s.PropertyId.ConversationTranslator_Name,"conversation_host"),h=e.getProperty(s.PropertyId.ConversationTranslator_Host,this.privHost),d=e.getProperty(s.PropertyId.ConversationTranslator_CorrelationId),u=e.getProperty(s.PropertyId.SpeechServiceConnection_Key),v=e.getProperty(s.PropertyId.SpeechServiceConnection_Region),l=e.getProperty(s.PropertyId.SpeechServiceAuthorization_Token);n.Contracts.throwIfNullOrWhitespace(c,"languageCode"),n.Contracts.throwIfNullOrWhitespace(p,"nickname"),n.Contracts.throwIfNullOrWhitespace(h,"endpointHost");const g={};g[this.privRequestParams.apiVersion]=this.privApiVersion,g[this.privRequestParams.languageCode]=c,g[this.privRequestParams.nickname]=p;const m={};d&&(m[this.privRequestParams.correlationId]=d),m[this.privRequestParams.clientAppId]=o.ConversationConnectionConfig.clientAppId,void 0!==t?g[this.privRequestParams.roomId]=t:(n.Contracts.throwIfNullOrUndefined(v,this.privErrors.authInvalidSubscriptionRegion),m[this.privRequestParams.subscriptionRegion]=v,u?m[this.privRequestParams.subscriptionKey]=u:l?m[this.privRequestParams.authorization]=`Bearer ${l}`:n.Contracts.throwIfNullOrUndefined(u,this.privErrors.authInvalidSubscriptionKey));const S={};S.headers=m,this.privRestAdapter.options=S;const f=`https://${h}${this.privRestPath}`;this.privRestAdapter.request(r.RestRequestType.Post,f,g,null).then((e=>{const t=r.RestMessageAdapter.extractHeaderValue(this.privRequestParams.requestId,e.headers);if(!e.ok){if(a){let i,r=this.privErrors.invalidCreateJoinConversationResponse.replace("{status}",e.status.toString());try{i=JSON.parse(e.data),r+=` [${i.error.code}: ${i.error.message}]`}catch(t){r+=` [${e.data}]`}t&&(r+=` ${t}`),a(r)}return}const n=JSON.parse(e.data);if(n&&(n.requestId=t),i){try{i(n)}catch(e){a&&a(e)}i=void 0}})).catch((()=>{}))}catch(e){if(a)if(e instanceof Error){const t=e;a(t.name+": "+t.message)}else a(e)}}leave(e,t){return new Promise(((i,o)=>{try{n.Contracts.throwIfNullOrUndefined(e,this.privErrors.invalidArgs.replace("{arg}","config")),n.Contracts.throwIfNullOrWhitespace(t,this.privErrors.invalidArgs.replace("{arg}","token"));const o=e.getProperty(s.PropertyId.ConversationTranslator_Host,this.privHost),a=e.getProperty(s.PropertyId.ConversationTranslator_CorrelationId),c={};c[this.privRequestParams.apiVersion]=this.privApiVersion,c[this.privRequestParams.sessionToken]=t;const p={};a&&(p[this.privRequestParams.correlationId]=a);const h={};h.headers=p,this.privRestAdapter.options=h;const d=`https://${o}${this.privRestPath}`;this.privRestAdapter.request(r.RestRequestType.Delete,d,c,null).then((e=>{e.ok,i()})).catch((()=>{}))}catch(e){if(e instanceof Error){const t=e;o(t.name+": "+t.message)}else o(e)}}))}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConversationConnectionConfig:()=>n});var r=i(138);class n extends r.RestConfigBase{static get host(){return n.privHost}static get apiVersion(){return n.privApiVersion}static get clientAppId(){return n.privClientAppId}static get defaultLanguageCode(){return n.privDefaultLanguageCode}static get restPath(){return n.privRestPath}static get webSocketPath(){return n.privWebSocketPath}static get transcriptionEventKeys(){return n.privTranscriptionEventKeys}}n.privHost="dev.microsofttranslator.com",n.privRestPath="/capito/room",n.privApiVersion="2.0",n.privDefaultLanguageCode="en-US",n.privClientAppId="FC539C22-1767-4F1F-84BC-B4D811114F15",n.privWebSocketPath="/capito/translate",n.privTranscriptionEventKeys=["iCalUid","callId","organizer","FLAC","MTUri","DifferentiateGuestSpeakers","audiorecording","Threadid","OrganizerMri","OrganizerTenantId","UserToken"]},(e,t,i)=>{"use strict";i.r(t),i.d(t,{RestConfigBase:()=>r});class r{static get requestOptions(){return r.privDefaultRequestOptions}static get configParams(){return r.privDefaultParams}static get restErrors(){return r.privRestErrors}}r.privDefaultRequestOptions={headers:{Accept:"application/json"},ignoreCache:!1,timeout:1e4},r.privRestErrors={authInvalidSubscriptionKey:"You must specify either an authentication token to use, or a Cognitive Speech subscription key.",authInvalidSubscriptionRegion:"You must specify the Cognitive Speech region to use.",invalidArgs:"Required input not found: {arg}.",invalidCreateJoinConversationResponse:"Creating/Joining conversation failed with HTTP {status}.",invalidParticipantRequest:"The requested participant was not found.",permissionDeniedConnect:"Required credentials not found.",permissionDeniedConversation:"Invalid operation: only the host can {command} the conversation.",permissionDeniedParticipant:"Invalid operation: only the host can {command} a participant.",permissionDeniedSend:"Invalid operation: the conversation is not in a connected state.",permissionDeniedStart:"Invalid operation: there is already an active conversation."},r.privDefaultParams={apiVersion:"api-version",authorization:"Authorization",clientAppId:"X-ClientAppId",contentTypeKey:"Content-Type",correlationId:"X-CorrelationId",languageCode:"language",nickname:"nickname",profanity:"profanity",requestId:"X-RequestId",roomId:"roomid",sessionToken:"token",subscriptionKey:"Ocp-Apim-Subscription-Key",subscriptionRegion:"Ocp-Apim-Subscription-Region",token:"X-CapitoToken"}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{RestMessageAdapter:()=>c,RestRequestType:()=>r});var r,n=i(140),s=i(17),o=i(18),a=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};!function(e){e.Get="GET",e.Post="POST",e.Delete="DELETE",e.File="file"}(r||(r={}));class c{constructor(e){if(!e)throw new s.ArgumentNullError("configParams");this.privHeaders=e.headers,this.privIgnoreCache=e.ignoreCache}static extractHeaderValue(e,t){let i="";try{const r=t.trim().split(/[\r\n]+/),n={};r.forEach((e=>{const t=e.split(": "),i=t.shift().toLowerCase(),r=t.join(": ");n[i]=r})),i=n[e.toLowerCase()]}catch(e){}return i}set options(e){this.privHeaders=e.headers,this.privIgnoreCache=e.ignoreCache}setHeaders(e,t){this.privHeaders[e]=t}request(e,t,i={},s=null){const c=new o.Deferred,p=e===r.File?"POST":e,h=(e,t={})=>{const i=e;return{data:JSON.stringify(t),headers:JSON.stringify(e.headers),json:t,ok:e.statusCode>=200&&e.statusCode<300,status:e.statusCode,statusText:t.error?t.error.message:i.statusText?i.statusText:i.statusMessage}};return this.privIgnoreCache&&(this.privHeaders["Cache-Control"]="no-cache"),e===r.Post&&s&&(this.privHeaders["content-type"]="application/json",this.privHeaders["Content-Type"]="application/json"),(s=>{n(t,p,this.privHeaders,200,201,202,204,400,401,402,403,404)(""===this.queryParams(i)?"":`?${this.queryParams(i)}`,s).then((t=>a(this,void 0,void 0,(function*(){if(e===r.Delete||204===t.statusCode)c.resolve(h(t));else try{const e=yield t.json();c.resolve(h(t,e))}catch(e){c.resolve(h(t))}})))).catch((e=>{c.reject(e)}))})(s),c.promise}queryParams(e={}){return Object.keys(e).map((t=>encodeURIComponent(t)+"="+encodeURIComponent(e[t]))).join("&")}}},(e,t,i)=>{"use strict";const r=i(141);class n extends Error{constructor(e,...t){let i;super(...t),Error.captureStackTrace&&Error.captureStackTrace(this,n),this.name="StatusError",this.message=e.statusMessage,this.statusCode=e.status,this.res=e,this.json=e.json.bind(e),this.text=e.text.bind(e),this.arrayBuffer=e.arrayBuffer.bind(e);Object.defineProperty(this,"responseBody",{get:()=>(i||(i=this.arrayBuffer()),i)}),this.headers={};for(const[t,i]of e.headers.entries())this.headers[t.toLowerCase()]=i}}e.exports=r(((e,t,i,r,s)=>async(o,a,c={})=>{o=s+(o||"");let p=new URL(o);if(r||(r={}),p.username&&(r.Authorization="Basic "+btoa(p.username+":"+p.password),p=new URL(p.protocol+"//"+p.host+p.pathname+p.search)),"https:"!==p.protocol&&"http:"!==p.protocol)throw new Error(`Unknown protocol, ${p.protocol}`);if(a)if(a instanceof ArrayBuffer||ArrayBuffer.isView(a)||"string"==typeof a);else{if("object"!=typeof a)throw new Error("Unknown body type.");a=JSON.stringify(a),r["Content-Type"]="application/json"}c=new Headers({...r||{},...c});const h=await fetch(p,{method:t,headers:c,body:a});if(h.statusCode=h.status,!e.has(h.status))throw new n(h);return"json"===i?h.json():"buffer"===i?h.arrayBuffer():"string"===i?h.text():h}))},e=>{"use strict";const t=new Set(["json","buffer","string"]);e.exports=e=>(...i)=>{const r=new Set;let n,s,o,a="";return i.forEach((e=>{if("string"==typeof e)if(e.toUpperCase()===e){if(n){throw new Error(`Can't set method to ${e}, already set to ${n}.`)}n=e}else if(e.startsWith("http:")||e.startsWith("https:"))a=e;else{if(!t.has(e))throw new Error(`Unknown encoding, ${e}`);s=e}else if("number"==typeof e)r.add(e);else{if("object"!=typeof e)throw new Error("Unknown type: "+typeof e);if(Array.isArray(e)||e instanceof Set)e.forEach((e=>r.add(e)));else{if(o)throw new Error("Cannot set headers twice.");o=e}}})),n||(n="GET"),0===r.size&&r.add(200),e(r,n,s,o,a)}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConversationRecognizerFactory:()=>l,ConversationTranslatorRecognizer:()=>g});var r=i(92),n=i(90),s=i(26),o=i(32),a=i(36),c=i(143),p=i(147),h=i(59),d=i(144),u=i(162),v=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class l{static fromConfig(e,t,i){return new g(e,t,i)}}class g extends c.Recognizer{constructor(e,t,i){const r=t;a.Contracts.throwIfNull(r,"speechConfig");const s=e;a.Contracts.throwIfNull(s,"conversationImpl"),super(i,r.properties,new d.ConversationConnectionFactory),this.privConversation=s,this.privIsDisposed=!1,this.privProperties=r.properties.clone(),this.privConnection=p.Connection.fromRecognizer(this);"on"===this.privProperties.getProperty(h.PropertyId.WebWorkerLoadType,"on").toLowerCase()&&"undefined"!=typeof Blob&&"undefined"!=typeof Worker?(this.privSetTimeout=n.Timeout.setTimeout,this.privClearTimeout=n.Timeout.clearTimeout):"undefined"!=typeof window?(this.privSetTimeout=window.setTimeout.bind(window),this.privClearTimeout=window.clearTimeout.bind(window)):(this.privSetTimeout=setTimeout,this.privClearTimeout=clearTimeout)}set connected(e){this.privConnection.connected=e}set disconnected(e){this.privConnection.disconnected=e}get speechRecognitionLanguage(){return this.privSpeechRecognitionLanguage}get properties(){return this.privProperties}isDisposed(){return this.privIsDisposed}connect(e,t,i){try{a.Contracts.throwIfDisposed(this.privIsDisposed),a.Contracts.throwIfNullOrWhitespace(e,"token"),this.privReco.conversationTranslatorToken=e,this.resetConversationTimeout(),this.privReco.connectAsync(t,i)}catch(e){if(i)if(e instanceof Error){const t=e;i(t.name+": "+t.message)}else i(e)}}disconnect(e,t){try{a.Contracts.throwIfDisposed(this.privIsDisposed),void 0!==this.privTimeoutToken&&this.privClearTimeout(this.privTimeoutToken),this.privReco.disconnect().then((()=>{e&&e()}),(e=>{t&&t(e)}))}catch(e){if(t)if(e instanceof Error){const i=e;t(i.name+": "+i.message)}else t(e);this.dispose(!0).catch((e=>{s.Events.instance.onEvent(new o.BackgroundEvent(e))}))}}sendRequest(e,t,i){try{a.Contracts.throwIfDisposed(this.privIsDisposed),this.sendMessage(e,t,i)}catch(e){if(i)if(e instanceof Error){const t=e;i(t.name+": "+t.message)}else i(e);this.dispose(!0).catch((e=>{s.Events.instance.onEvent(new o.BackgroundEvent(e))}))}}onToken(e){this.privConversation.onToken(e)}close(){return v(this,void 0,void 0,(function*(){this.privIsDisposed||(this.privConnection&&(this.privConnection.closeConnection(),this.privConnection.close()),this.privConnection=void 0,yield this.dispose(!0))}))}dispose(e){const t=Object.create(null,{dispose:{get:()=>super.dispose}});return v(this,void 0,void 0,(function*(){this.privIsDisposed||e&&(void 0!==this.privTimeoutToken&&this.privClearTimeout(this.privTimeoutToken),this.privIsDisposed=!0,this.privConnection&&(this.privConnection.closeConnection(),this.privConnection.close(),this.privConnection=void 0),yield t.dispose.call(this,e))}))}createRecognizerConfig(e){return new r.RecognizerConfig(e,this.privProperties)}createServiceRecognizer(e,t,i,r){const n=i;return new u.ConversationServiceAdapter(e,t,n,r,this)}sendMessage(e,t,i){((e,t,i)=>{void 0!==e?e.then((()=>{try{t&&t()}catch(e){i&&i(`'Unhandled error on promise callback: ${e}'`)}}),(e=>{try{i&&i(e)}catch(e){}})):i&&i("Null promise")})(this.privReco.sendMessageAsync(e),t,i),this.resetConversationTimeout()}resetConversationTimeout(){void 0!==this.privTimeoutToken&&this.privClearTimeout(this.privTimeoutToken),this.privTimeoutToken=this.privSetTimeout((()=>{this.sendRequest(this.privConversation.getKeepAlive())}),6e4)}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{Recognizer:()=>u});var r=i(85),n=i(21),s=i(62),o=i(65),a=i(18),c=i(36),p=i(4),h=i(59),d=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class u{constructor(e,t,i){this.audioConfig=void 0!==e?e:p.AudioConfig.fromDefaultMicrophoneInput(),this.privDisposed=!1,this.privProperties=t.clone(),this.privConnectionFactory=i,this.implCommonRecognizerSetup()}close(e,t){c.Contracts.throwIfDisposed(this.privDisposed),(0,a.marshalPromiseToCallbacks)(this.dispose(!0),e,t)}get internalData(){return this.privReco}dispose(e){return d(this,void 0,void 0,(function*(){this.privDisposed||(this.privDisposed=!0,e&&this.privReco&&(yield this.privReco.audioSource.turnOff(),yield this.privReco.dispose()))}))}static get telemetryEnabled(){return r.ServiceRecognizerBase.telemetryDataEnabled}static enableTelemetry(e){r.ServiceRecognizerBase.telemetryDataEnabled=e}implCommonRecognizerSetup(){let e="undefined"!=typeof window?"Browser":"Node",t="unknown",i="unknown";"undefined"!=typeof navigator&&(e=e+"/"+navigator.platform,t=navigator.userAgent,i=navigator.appVersion);const r=this.createRecognizerConfig(new n.SpeechServiceConfig(new n.Context(new n.OS(e,t,i))));this.privReco=this.createServiceRecognizer(u.getAuthFromProperties(this.privProperties),this.privConnectionFactory,this.audioConfig,r)}recognizeOnceAsyncImpl(e){return d(this,void 0,void 0,(function*(){c.Contracts.throwIfDisposed(this.privDisposed);const t=new a.Deferred;yield this.implRecognizerStop(),yield this.privReco.recognize(e,t.resolve,t.reject);const i=yield t.promise;return yield this.implRecognizerStop(),i}))}startContinuousRecognitionAsyncImpl(e){return d(this,void 0,void 0,(function*(){c.Contracts.throwIfDisposed(this.privDisposed),yield this.implRecognizerStop(),yield this.privReco.recognize(e,void 0,void 0)}))}stopContinuousRecognitionAsyncImpl(){return d(this,void 0,void 0,(function*(){c.Contracts.throwIfDisposed(this.privDisposed),yield this.implRecognizerStop()}))}implRecognizerStop(){return d(this,void 0,void 0,(function*(){this.privReco&&(yield this.privReco.stopRecognizing())}))}static getAuthFromProperties(e){const t=e.getProperty(h.PropertyId.SpeechServiceConnection_Key,void 0);return t&&""!==t?new s.CognitiveSubscriptionKeyAuthentication(t):new o.CognitiveTokenAuthentication((()=>{const t=e.getProperty(h.PropertyId.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(t)}),(()=>{const t=e.getProperty(h.PropertyId.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(t)}))}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConversationConnectionFactory:()=>d});var r=i(69),n=i(82),s=i(9),o=i(36),a=i(59),c=i(67),p=i(137),h=i(145);class d extends c.ConnectionFactoryBase{create(e,t,i){const c=e.parameters.getProperty(a.PropertyId.ConversationTranslator_Host,p.ConversationConnectionConfig.host),d=e.parameters.getProperty(a.PropertyId.ConversationTranslator_CorrelationId,(0,s.createGuid)()),u=`wss://${c}${p.ConversationConnectionConfig.webSocketPath}`,v=e.parameters.getProperty(a.PropertyId.ConversationTranslator_Token,void 0);o.Contracts.throwIfNullOrUndefined(v,"token");const l={};l[p.ConversationConnectionConfig.configParams.apiVersion]=p.ConversationConnectionConfig.apiVersion,l[p.ConversationConnectionConfig.configParams.token]=v,l[p.ConversationConnectionConfig.configParams.correlationId]=d;const g="true"===e.parameters.getProperty("SPEECH-EnableWebsocketCompression","false");return new r.WebsocketConnection(u,l,{},new h.ConversationWebsocketMessageFormatter,n.ProxyInfo.fromRecognizerConfig(e),g,i)}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConversationWebsocketMessageFormatter:()=>a});var r=i(18),n=i(80),s=i(79),o=i(146);class a{toConnectionMessage(e){const t=new r.Deferred;try{if(e.messageType===n.MessageType.Text){const i=new o.ConversationConnectionMessage(e.messageType,e.textContent,{},e.id);t.resolve(i)}else e.messageType===n.MessageType.Binary&&t.resolve(new o.ConversationConnectionMessage(e.messageType,e.binaryContent,void 0,e.id))}catch(e){t.reject(`Error formatting the message. Error: ${e}`)}return t.promise}fromConnectionMessage(e){const t=new r.Deferred;try{if(e.messageType===n.MessageType.Text){const i=`${e.textBody?e.textBody:""}`;t.resolve(new s.RawWebsocketMessage(n.MessageType.Text,i,e.id))}}catch(e){t.reject(`Error formatting the message. ${e}`)}return t.promise}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConversationConnectionMessage:()=>n});var r=i(80);class n extends r.ConnectionMessage{constructor(e,t,i,r){super(e,t,i,r);const n=JSON.parse(this.textBody);void 0!==n.type&&(this.privConversationMessageType=n.type)}get conversationMessageType(){return this.privConversationMessageType}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{Connection:()=>d});var r=i(148),n=i(85),s=i(18),o=i(160),a=i(36),c=i(158),p=i(159),h=i(161);class d{static fromRecognizer(e){const t=e.internalData,i=new d;return i.privInternalData=t,i.setupEvents(),i}static fromSynthesizer(e){const t=e.internalData,i=new d;return i.privInternalData=t,i.setupEvents(),i}openConnection(e,t){(0,s.marshalPromiseToCallbacks)(this.privInternalData.connect(),e,t)}closeConnection(e,t){if(this.privInternalData instanceof r.SynthesisAdapterBase)throw new Error("Disconnecting a synthesizer's connection is currently not supported");(0,s.marshalPromiseToCallbacks)(this.privInternalData.disconnect(),e,t)}setMessageProperty(e,t,i){if(a.Contracts.throwIfNullOrWhitespace(t,"propertyName"),this.privInternalData instanceof n.ServiceRecognizerBase){if("speech.context"!==e.toLowerCase())throw new Error("Only speech.context message property sets are currently supported for recognizer");this.privInternalData.speechContext.setSection(t,i)}else if(this.privInternalData instanceof r.SynthesisAdapterBase){if("synthesis.context"!==e.toLowerCase())throw new Error("Only synthesis.context message property sets are currently supported for synthesizer");this.privInternalData.synthesisContext.setSection(t,i)}}sendMessageAsync(e,t,i,r){(0,s.marshalPromiseToCallbacks)(this.privInternalData.sendNetworkMessage(e,t),i,r)}close(){}setupEvents(){this.privEventListener=this.privInternalData.connectionEvents.attach((e=>{"ConnectionEstablishedEvent"===e.name?this.connected&&this.connected(new c.ConnectionEventArgs(e.connectionId)):"ConnectionClosedEvent"===e.name?this.disconnected&&this.disconnected(new c.ConnectionEventArgs(e.connectionId)):"ConnectionMessageSentEvent"===e.name?this.messageSent&&this.messageSent(new p.ConnectionMessageEventArgs(new o.ConnectionMessageImpl(e.message))):"ConnectionMessageReceivedEvent"===e.name&&this.messageReceived&&this.messageReceived(new p.ConnectionMessageEventArgs(new o.ConnectionMessageImpl(e.message)))})),this.privServiceEventListener=this.privInternalData.serviceEvents.attach((e=>{this.receivedServiceMessage&&this.receivedServiceMessage(new h.ServiceEventArgs(e.jsonString,e.name))}))}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SynthesisAdapterBase:()=>w});var r=i(17),n=i(16),s=i(80),o=i(78),a=i(76),c=i(9),p=i(40),h=i(91),d=i(60),u=i(151),v=i(57),l=i(155),g=i(156),m=i(157),S=i(59),f=i(149),C=i(154),y=i(2),R=i(61),P=i(153),I=i(94),T=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class w{constructor(e,t,i,s){if(this.speakOverride=void 0,this.receiveMessageOverride=void 0,this.connectImplOverride=void 0,this.configConnectionOverride=void 0,this.privConnectionConfigurationPromise=void 0,!e)throw new r.ArgumentNullError("authentication");if(!t)throw new r.ArgumentNullError("connectionFactory");if(!i)throw new r.ArgumentNullError("synthesizerConfig");this.privAuthentication=e,this.privConnectionFactory=t,this.privSynthesizerConfig=i,this.privIsDisposed=!1,this.privSessionAudioDestination=s,this.privSynthesisTurn=new f.SynthesisTurn,this.privConnectionEvents=new n.EventSource,this.privServiceEvents=new n.EventSource,this.privSynthesisContext=new C.SynthesisContext,this.privAgentConfig=new y.AgentConfig,this.connectionEvents.attach((e=>{if("ConnectionClosedEvent"===e.name){const t=e;1e3!==t.statusCode&&this.cancelSynthesisLocal(p.CancellationReason.Error,1007===t.statusCode?h.CancellationErrorCode.BadRequestParameters:h.CancellationErrorCode.ConnectionFailure,`${t.reason} websocket error code: ${t.statusCode}`)}}))}get synthesisContext(){return this.privSynthesisContext}get agentConfig(){return this.privAgentConfig}get connectionEvents(){return this.privConnectionEvents}get serviceEvents(){return this.privServiceEvents}set activityTemplate(e){this.privActivityTemplate=e}get activityTemplate(){return this.privActivityTemplate}set audioOutputFormat(e){this.privAudioOutputFormat=e,this.privSynthesisTurn.audioOutputFormat=e,void 0!==this.privSessionAudioDestination&&(this.privSessionAudioDestination.format=e),void 0!==this.synthesisContext&&(this.synthesisContext.audioOutputFormat=e)}isDisposed(){return this.privIsDisposed}dispose(e){return T(this,void 0,void 0,(function*(){if(this.privIsDisposed=!0,void 0!==this.privSessionAudioDestination&&this.privSessionAudioDestination.close(),void 0!==this.privConnectionConfigurationPromise){const t=yield this.privConnectionConfigurationPromise;yield t.dispose(e)}}))}connect(){return T(this,void 0,void 0,(function*(){yield this.connectImpl()}))}sendNetworkMessage(e,t){return T(this,void 0,void 0,(function*(){const i="string"==typeof t?s.MessageType.Text:s.MessageType.Binary,r="string"==typeof t?"application/json":"";return(yield this.fetchConnection()).send(new I.SpeechConnectionMessage(i,e,this.privSynthesisTurn.requestId,r,t))}))}Speak(e,t,i,r,n,s){return T(this,void 0,void 0,(function*(){let o;if(o=t?e:this.privSynthesizer.buildSsml(e),void 0!==this.speakOverride)return this.speakOverride(o,i,r,n);this.privSuccessCallback=r,this.privErrorCallback=n,this.privSynthesisTurn.startNewSynthesis(i,e,t,s);try{yield this.connectImpl();const e=yield this.fetchConnection();yield this.sendSynthesisContext(e),yield this.sendSsmlMessage(e,o,i),this.onSynthesisStarted(i),this.receiveMessage()}catch(e){return this.cancelSynthesisLocal(p.CancellationReason.Error,h.CancellationErrorCode.ConnectionFailure,e),Promise.reject(e)}}))}stopSpeaking(){return T(this,void 0,void 0,(function*(){yield this.connectImpl();return(yield this.fetchConnection()).send(new I.SpeechConnectionMessage(s.MessageType.Text,"synthesis.control",this.privSynthesisTurn.requestId,"application/json",JSON.stringify({action:"stop"})))}))}cancelSynthesis(e,t,i,r){const n=new d.PropertyCollection;n.setProperty(R.CancellationErrorCodePropertyName,h.CancellationErrorCode[i]);const s=new u.SpeechSynthesisResult(e,v.ResultReason.Canceled,void 0,r,n);if(this.onSynthesisCancelled(s),this.privSuccessCallback)try{this.privSuccessCallback(s)}catch(e){}}cancelSynthesisLocal(e,t,i){this.privSynthesisTurn.isSynthesizing&&(this.privSynthesisTurn.onStopSynthesizing(),this.cancelSynthesis(this.privSynthesisTurn.requestId,e,t,i))}processTypeSpecificMessages(e){return!0}receiveMessage(){return T(this,void 0,void 0,(function*(){try{const e=yield this.fetchConnection(),t=yield e.read();if(void 0!==this.receiveMessageOverride)return this.receiveMessageOverride();if(this.privIsDisposed)return;if(!t)return this.privSynthesisTurn.isSynthesizing?this.receiveMessage():void 0;const i=I.SpeechConnectionMessage.fromConnectionMessage(t);if(i.requestId.toLowerCase()===this.privSynthesisTurn.requestId.toLowerCase())switch(i.path.toLowerCase()){case"turn.start":this.privSynthesisTurn.onServiceTurnStartResponse(i.textBody);break;case"response":this.privSynthesisTurn.onServiceResponseMessage(i.textBody);break;case"audio":this.privSynthesisTurn.streamId.toLowerCase()===i.streamId.toLowerCase()&&i.binaryBody&&(this.privSynthesisTurn.onAudioChunkReceived(i.binaryBody),this.onSynthesizing(i.binaryBody),void 0!==this.privSessionAudioDestination&&this.privSessionAudioDestination.write(i.binaryBody));break;case"audio.metadata":const e=P.SynthesisAudioMetadata.fromJSON(i.textBody).Metadata;for(const t of e)switch(t.Type){case P.MetadataType.WordBoundary:case P.MetadataType.SentenceBoundary:this.privSynthesisTurn.onTextBoundaryEvent(t);const e=new l.SpeechSynthesisWordBoundaryEventArgs(t.Data.Offset,t.Data.Duration,t.Data.text.Text,t.Data.text.Length,t.Type===P.MetadataType.WordBoundary?this.privSynthesisTurn.currentTextOffset:this.privSynthesisTurn.currentSentenceOffset,t.Data.text.BoundaryType);this.onWordBoundary(e);break;case P.MetadataType.Bookmark:const i=new g.SpeechSynthesisBookmarkEventArgs(t.Data.Offset,t.Data.Bookmark);this.onBookmarkReached(i);break;case P.MetadataType.Viseme:if(this.privSynthesisTurn.onVisemeMetadataReceived(t),t.Data.IsLastAnimation){const e=new m.SpeechSynthesisVisemeEventArgs(t.Data.Offset,t.Data.VisemeId,this.privSynthesisTurn.getAndClearVisemeAnimation());this.onVisemeReceived(e)}break;case P.MetadataType.AvatarSignal:this.onAvatarEvent(t);break;case P.MetadataType.SessionEnd:this.privSynthesisTurn.onSessionEnd(t)}break;case"turn.end":let t;this.privSynthesisTurn.onServiceTurnEndResponse();try{t=yield this.privSynthesisTurn.constructSynthesisResult(),this.privSuccessCallback&&this.privSuccessCallback(t)}catch(e){this.privErrorCallback&&this.privErrorCallback(e)}this.onSynthesisCompleted(t);break;default:this.processTypeSpecificMessages(i)||this.privServiceEvents&&this.serviceEvents.onEvent(new o.ServiceEvent(i.path.toLowerCase(),i.textBody))}return this.receiveMessage()}catch(e){}}))}sendSynthesisContext(e){this.setSynthesisContextSynthesisSection();const t=this.synthesisContext.toJSON();if(t)return e.send(new I.SpeechConnectionMessage(s.MessageType.Text,"synthesis.context",this.privSynthesisTurn.requestId,"application/json",t))}setSpeechConfigSynthesisSection(){}connectImpl(e=!1){if(null!=this.privConnectionPromise)return this.privConnectionPromise.then((e=>e.state()===a.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionPromise=null,this.connectImpl()):this.privConnectionPromise),(()=>(this.privConnectionId=null,this.privConnectionPromise=null,this.connectImpl())));this.privAuthFetchEventId=(0,c.createNoDashGuid)(),this.privConnectionId=(0,c.createNoDashGuid)(),this.privSynthesisTurn.onPreConnectionStart(this.privAuthFetchEventId);const t=e?this.privAuthentication.fetchOnExpiry(this.privAuthFetchEventId):this.privAuthentication.fetch(this.privAuthFetchEventId);return this.privConnectionPromise=t.then((t=>T(this,void 0,void 0,(function*(){this.privSynthesisTurn.onAuthCompleted(!1);const i=this.privConnectionFactory.create(this.privSynthesizerConfig,t,this.privConnectionId);i.events.attach((e=>{this.connectionEvents.onEvent(e)}));const r=yield i.open();return 200===r.statusCode?(this.privSynthesisTurn.onConnectionEstablishCompleted(r.statusCode),Promise.resolve(i)):403!==r.statusCode||e?(this.privSynthesisTurn.onConnectionEstablishCompleted(r.statusCode),Promise.reject(`Unable to contact server. StatusCode: ${r.statusCode}, ${this.privSynthesizerConfig.parameters.getProperty(S.PropertyId.SpeechServiceConnection_Endpoint)} Reason: ${r.reason}`)):this.connectImpl(!0)}))),(e=>{throw this.privSynthesisTurn.onAuthCompleted(!0),new Error(e)})),this.privConnectionPromise.catch((()=>{})),this.privConnectionPromise}sendSpeechServiceConfig(e,t){if(t)return e.send(new I.SpeechConnectionMessage(s.MessageType.Text,"speech.config",this.privSynthesisTurn.requestId,"application/json",t))}sendSsmlMessage(e,t,i){return e.send(new I.SpeechConnectionMessage(s.MessageType.Text,"ssml",i,"application/ssml+xml",t))}fetchConnection(){return T(this,void 0,void 0,(function*(){return void 0!==this.privConnectionConfigurationPromise?this.privConnectionConfigurationPromise.then((e=>e.state()===a.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.fetchConnection()):this.privConnectionConfigurationPromise),(()=>(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.fetchConnection()))):(this.privConnectionConfigurationPromise=this.configureConnection(),yield this.privConnectionConfigurationPromise)}))}configureConnection(){return T(this,void 0,void 0,(function*(){const e=yield this.connectImpl();return void 0!==this.configConnectionOverride?this.configConnectionOverride(e):(this.setSpeechConfigSynthesisSection(),yield this.sendSpeechServiceConfig(e,this.privSynthesizerConfig.SpeechServiceConfig.serialize()),e)}))}onAvatarEvent(e){}onSynthesisStarted(e){}onSynthesizing(e){}onSynthesisCancelled(e){}onSynthesisCompleted(e){}onWordBoundary(e){}onVisemeReceived(e){}onBookmarkReached(e){}}w.telemetryDataEnabled=!0},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SynthesisTurn:()=>l});var r=i(9),n=i(18),s=i(26),o=i(33),a=i(60),c=i(59),p=i(151),h=i(57),d=i(153),u=i(150),v=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class l{constructor(){this.privIsDisposed=!1,this.privIsSynthesizing=!1,this.privIsSynthesisEnded=!1,this.privBytesReceived=0,this.privInTurn=!1,this.privTextOffset=0,this.privNextSearchTextIndex=0,this.privSentenceOffset=0,this.privNextSearchSentenceIndex=0,this.privRequestId=(0,r.createNoDashGuid)(),this.privTurnDeferral=new n.Deferred,this.privTurnDeferral.resolve()}get requestId(){return this.privRequestId}get streamId(){return this.privStreamId}set streamId(e){this.privStreamId=e}get audioOutputFormat(){return this.privAudioOutputFormat}set audioOutputFormat(e){this.privAudioOutputFormat=e}get turnCompletionPromise(){return this.privTurnDeferral.promise}get isSynthesisEnded(){return this.privIsSynthesisEnded}get isSynthesizing(){return this.privIsSynthesizing}get currentTextOffset(){return this.privTextOffset}get currentSentenceOffset(){return this.privSentenceOffset}get bytesReceived(){return this.privBytesReceived}get audioDuration(){return this.privAudioDuration}get extraProperties(){if(this.privWebRTCSDP){const e=new a.PropertyCollection;return e.setProperty(c.PropertyId.TalkingAvatarService_WebRTC_SDP,this.privWebRTCSDP),e}}getAllReceivedAudio(){return v(this,void 0,void 0,(function*(){return this.privReceivedAudio?Promise.resolve(this.privReceivedAudio):this.privIsSynthesisEnded?(yield this.readAllAudioFromStream(),Promise.resolve(this.privReceivedAudio)):null}))}getAllReceivedAudioWithHeader(){return v(this,void 0,void 0,(function*(){if(this.privReceivedAudioWithHeader)return this.privReceivedAudioWithHeader;if(!this.privIsSynthesisEnded)return null;if(this.audioOutputFormat.hasHeader){const e=yield this.getAllReceivedAudio();return this.privReceivedAudioWithHeader=this.audioOutputFormat.addHeader(e),this.privReceivedAudioWithHeader}return this.getAllReceivedAudio()}))}startNewSynthesis(e,t,i,r){this.privIsSynthesisEnded=!1,this.privIsSynthesizing=!0,this.privRequestId=e,this.privRawText=t,this.privIsSSML=i,this.privAudioOutputStream=new o.PullAudioOutputStreamImpl,this.privAudioOutputStream.format=this.privAudioOutputFormat,this.privReceivedAudio=null,this.privReceivedAudioWithHeader=null,this.privBytesReceived=0,this.privTextOffset=0,this.privNextSearchTextIndex=0,this.privSentenceOffset=0,this.privNextSearchSentenceIndex=0,this.privPartialVisemeAnimation="",this.privWebRTCSDP="",void 0!==r&&(this.privTurnAudioDestination=r,this.privTurnAudioDestination.format=this.privAudioOutputFormat),this.onEvent(new u.SynthesisTriggeredEvent(this.requestId,void 0,void 0===r?void 0:r.id()))}onPreConnectionStart(e){this.privAuthFetchEventId=e,this.onEvent(new u.ConnectingToSynthesisServiceEvent(this.privRequestId,this.privAuthFetchEventId))}onAuthCompleted(e){e&&this.onComplete()}onConnectionEstablishCompleted(e){if(200===e)return this.onEvent(new u.SynthesisStartedEvent(this.requestId,this.privAuthFetchEventId)),void(this.privBytesReceived=0);403===e&&this.onComplete()}onServiceResponseMessage(e){const t=JSON.parse(e);this.streamId=t.audio.streamId}onServiceTurnEndResponse(){this.privInTurn=!1,this.privTurnDeferral.resolve(),this.onComplete()}onServiceTurnStartResponse(e){this.privTurnDeferral&&this.privInTurn&&(this.privTurnDeferral.reject("Another turn started before current completed."),this.privTurnDeferral.promise.then().catch((()=>{}))),this.privInTurn=!0,this.privTurnDeferral=new n.Deferred;const t=JSON.parse(e);t.webrtc&&(this.privWebRTCSDP=t.webrtc.connectionString)}onAudioChunkReceived(e){this.isSynthesizing&&(this.privAudioOutputStream.write(e),this.privBytesReceived+=e.byteLength,void 0!==this.privTurnAudioDestination&&this.privTurnAudioDestination.write(e))}onTextBoundaryEvent(e){this.updateTextOffset(e.Data.text.Text,e.Type)}onVisemeMetadataReceived(e){void 0!==e.Data.AnimationChunk&&(this.privPartialVisemeAnimation+=e.Data.AnimationChunk)}onSessionEnd(e){this.privAudioDuration=e.Data.Offset}constructSynthesisResult(){return v(this,void 0,void 0,(function*(){const e=yield this.getAllReceivedAudioWithHeader();return new p.SpeechSynthesisResult(this.requestId,h.ResultReason.SynthesizingAudioCompleted,e,void 0,this.extraProperties,this.audioDuration)}))}dispose(){this.privIsDisposed||(this.privIsDisposed=!0)}onStopSynthesizing(){this.onComplete()}getAndClearVisemeAnimation(){const e=this.privPartialVisemeAnimation;return this.privPartialVisemeAnimation="",e}onEvent(e){s.Events.instance.onEvent(e)}static isXmlTag(e){return e.length>=2&&"<"===e[0]&&">"===e[e.length-1]}updateTextOffset(e,t){t===d.MetadataType.WordBoundary?(this.privTextOffset=this.privRawText.indexOf(e,this.privNextSearchTextIndex),this.privTextOffset>=0&&(this.privNextSearchTextIndex=this.privTextOffset+e.length,this.privIsSSML&&this.withinXmlTag(this.privTextOffset)&&!l.isXmlTag(e)&&this.updateTextOffset(e,t))):(this.privSentenceOffset=this.privRawText.indexOf(e,this.privNextSearchSentenceIndex),this.privSentenceOffset>=0&&(this.privNextSearchSentenceIndex=this.privSentenceOffset+e.length,this.privIsSSML&&this.withinXmlTag(this.privSentenceOffset)&&!l.isXmlTag(e)&&this.updateTextOffset(e,t)))}onComplete(){this.privIsSynthesizing&&(this.privIsSynthesizing=!1,this.privIsSynthesisEnded=!0,this.privAudioOutputStream.close(),this.privInTurn=!1,void 0!==this.privTurnAudioDestination&&(this.privTurnAudioDestination.close(),this.privTurnAudioDestination=void 0))}readAllAudioFromStream(){return v(this,void 0,void 0,(function*(){if(this.privIsSynthesisEnded){this.privReceivedAudio=new ArrayBuffer(this.bytesReceived);try{yield this.privAudioOutputStream.read(this.privReceivedAudio)}catch(e){this.privReceivedAudio=new ArrayBuffer(0)}}}))}withinXmlTag(e){return this.privRawText.indexOf("<",e+1)>this.privRawText.indexOf(">",e+1)}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConnectingToSynthesisServiceEvent:()=>o,SpeechSynthesisEvent:()=>n,SynthesisStartedEvent:()=>a,SynthesisTriggeredEvent:()=>s});var r=i(20);class n extends r.PlatformEvent{constructor(e,t,i=r.EventType.Info){super(e,i),this.privRequestId=t}get requestId(){return this.privRequestId}}class s extends n{constructor(e,t,i){super("SynthesisTriggeredEvent",e),this.privSessionAudioDestinationId=t,this.privTurnAudioDestinationId=i}get audioSessionDestinationId(){return this.privSessionAudioDestinationId}get audioTurnDestinationId(){return this.privTurnAudioDestinationId}}class o extends n{constructor(e,t){super("ConnectingToSynthesisServiceEvent",e),this.privAuthFetchEventId=t}get authFetchEventId(){return this.privAuthFetchEventId}}class a extends n{constructor(e,t){super("SynthesisStartedEvent",e),this.privAuthFetchEventId=t}get authFetchEventId(){return this.privAuthFetchEventId}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SpeechSynthesisResult:()=>n});var r=i(152);class n extends r.SynthesisResult{constructor(e,t,i,r,n,s){super(e,t,r,n),this.privAudioData=i,this.privAudioDuration=s}get audioData(){return this.privAudioData}get audioDuration(){return this.privAudioDuration}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SynthesisResult:()=>r});class r{constructor(e,t,i,r){this.privResultId=e,this.privReason=t,this.privErrorDetails=i,this.privProperties=r}get resultId(){return this.privResultId}get reason(){return this.privReason}get errorDetails(){return this.privErrorDetails}get properties(){return this.privProperties}}},(e,t,i)=>{"use strict";var r;i.r(t),i.d(t,{MetadataType:()=>r,SynthesisAudioMetadata:()=>n}),function(e){e.WordBoundary="WordBoundary",e.Bookmark="Bookmark",e.Viseme="Viseme",e.SentenceBoundary="SentenceBoundary",e.SessionEnd="SessionEnd",e.AvatarSignal="TalkingAvatarSignal"}(r||(r={}));class n{constructor(e){this.privSynthesisAudioMetadata=JSON.parse(e)}static fromJSON(e){return new n(e)}get Metadata(){return this.privSynthesisAudioMetadata.Metadata}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SynthesisContext:()=>n});var r=i(59);class n{constructor(){this.privContext={}}setSection(e,t){this.privContext[e]=t}set audioOutputFormat(e){this.privAudioOutputFormat=e}toJSON(){return JSON.stringify(this.privContext)}setSynthesisSection(e){const t=this.buildSynthesisContext(e);this.setSection("synthesis",t)}buildSynthesisContext(e){return{audio:{metadataOptions:{bookmarkEnabled:!!(null==e?void 0:e.bookmarkReached),punctuationBoundaryEnabled:null==e?void 0:e.properties.getProperty(r.PropertyId.SpeechServiceResponse_RequestPunctuationBoundary,!!(null==e?void 0:e.wordBoundary)),sentenceBoundaryEnabled:null==e?void 0:e.properties.getProperty(r.PropertyId.SpeechServiceResponse_RequestSentenceBoundary,!1),sessionEndEnabled:!0,visemeEnabled:!!(null==e?void 0:e.visemeReceived),wordBoundaryEnabled:null==e?void 0:e.properties.getProperty(r.PropertyId.SpeechServiceResponse_RequestWordBoundary,!!(null==e?void 0:e.wordBoundary))},outputFormat:this.privAudioOutputFormat.requestAudioFormatString},language:{autoDetection:null==e?void 0:e.autoDetectSourceLanguage}}}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SpeechSynthesisWordBoundaryEventArgs:()=>r});class r{constructor(e,t,i,r,n,s){this.privAudioOffset=e,this.privDuration=t,this.privText=i,this.privWordLength=r,this.privTextOffset=n,this.privBoundaryType=s}get audioOffset(){return this.privAudioOffset}get duration(){return this.privDuration}get text(){return this.privText}get wordLength(){return this.privWordLength}get textOffset(){return this.privTextOffset}get boundaryType(){return this.privBoundaryType}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SpeechSynthesisBookmarkEventArgs:()=>r});class r{constructor(e,t){this.privAudioOffset=e,this.privText=t}get audioOffset(){return this.privAudioOffset}get text(){return this.privText}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SpeechSynthesisVisemeEventArgs:()=>r});class r{constructor(e,t,i){this.privAudioOffset=e,this.privVisemeId=t,this.privAnimation=i}get audioOffset(){return this.privAudioOffset}get visemeId(){return this.privVisemeId}get animation(){return this.privAnimation}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConnectionEventArgs:()=>n});var r=i(42);class n extends r.SessionEventArgs{}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConnectionMessageEventArgs:()=>r});class r{constructor(e){this.privConnectionMessage=e}get message(){return this.privConnectionMessage}toString(){return"Message: "+this.privConnectionMessage.toString()}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConnectionMessage:()=>a,ConnectionMessageImpl:()=>c});var r=i(64),n=i(80),s=i(60),o=i(59);class a{}class c{constructor(e){this.privConnectionMessage=e,this.privProperties=new s.PropertyCollection,this.privConnectionMessage.headers[r.HeaderNames.ConnectionId]&&this.privProperties.setProperty(o.PropertyId.Speech_SessionId,this.privConnectionMessage.headers[r.HeaderNames.ConnectionId]),Object.keys(this.privConnectionMessage.headers).forEach((e=>{this.privProperties.setProperty(e,this.privConnectionMessage.headers[e])}))}get path(){return this.privConnectionMessage.headers[Object.keys(this.privConnectionMessage.headers).find((e=>e.toLowerCase()==="path".toLowerCase()))]}get isTextMessage(){return this.privConnectionMessage.messageType===n.MessageType.Text}get isBinaryMessage(){return this.privConnectionMessage.messageType===n.MessageType.Binary}get TextMessage(){return this.privConnectionMessage.textBody}get binaryMessage(){return this.privConnectionMessage.binaryBody}get properties(){return this.privProperties}toString(){return""}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ServiceEventArgs:()=>n});var r=i(42);class n extends r.SessionEventArgs{constructor(e,t,i){super(i),this.privJsonResult=e,this.privEventName=t}get jsonString(){return this.privJsonResult}get eventName(){return this.privEventName}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConversationServiceAdapter:()=>T});var r=i(9),n=i(80),s=i(18),o=i(76),a=i(40),c=i(91),p=i(164),h=i(169),d=i(57),u=i(171),v=i(114),l=i(85),g=i(65),m=i(146),S=i(163),f=i(167),C=i(168),y=i(165),R=i(166),P=i(170),I=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class T extends l.ServiceRecognizerBase{constructor(e,t,i,n,s){super(e,t,i,n,s),this.privConnectionConfigPromise=void 0,this.privLastPartialUtteranceId="",this.privConversationServiceConnector=s,this.privConversationAuthentication=e,this.receiveMessageOverride=()=>this.receiveConversationMessageOverride(),this.recognizeOverride=()=>this.noOp(),this.postConnectImplOverride=e=>this.conversationConnectImpl(e),this.configConnectionOverride=()=>this.configConnection(),this.disconnectOverride=()=>this.privDisconnect(),this.privConversationRequestSession=new S.ConversationRequestSession((0,r.createNoDashGuid)()),this.privConversationConnectionFactory=t,this.privConversationIsDisposed=!1}isDisposed(){return super.isDisposed()||this.privConversationIsDisposed}dispose(e){const t=Object.create(null,{dispose:{get:()=>super.dispose}});return I(this,void 0,void 0,(function*(){if(this.privConversationIsDisposed=!0,void 0!==this.privConnectionConfigPromise){const t=yield this.privConnectionConfigPromise;yield t.dispose(e)}yield t.dispose.call(this,e)}))}sendMessage(e){return I(this,void 0,void 0,(function*(){return(yield this.fetchConnection()).send(new m.ConversationConnectionMessage(n.MessageType.Text,e))}))}sendMessageAsync(e){return I(this,void 0,void 0,(function*(){const t=yield this.fetchConnection();yield t.send(new m.ConversationConnectionMessage(n.MessageType.Text,e))}))}privDisconnect(){if(!this.terminateMessageLoop)return this.cancelRecognition(this.privConversationRequestSession.sessionId,this.privConversationRequestSession.requestId,a.CancellationReason.Error,c.CancellationErrorCode.NoError,"Disconnecting"),this.terminateMessageLoop=!0,Promise.resolve()}processTypeSpecificMessages(){return I(this,void 0,void 0,(function*(){return!0}))}cancelRecognition(e,t,i,r,n){this.terminateMessageLoop=!0;const s=new p.ConversationTranslationCanceledEventArgs(i,n,r,void 0,e);try{this.privConversationServiceConnector.canceled&&this.privConversationServiceConnector.canceled(this.privConversationServiceConnector,s)}catch(e){}}conversationConnectImpl(e){return I(this,void 0,void 0,(function*(){return this.privConnectionLoop=this.startMessageLoop(),e}))}receiveConversationMessageOverride(){return I(this,void 0,void 0,(function*(){if(this.isDisposed()||this.terminateMessageLoop)return Promise.resolve();const e=new s.Deferred;try{const t=yield this.fetchConnection(),i=yield t.read();if(this.isDisposed()||this.terminateMessageLoop)return e.resolve(),Promise.resolve();if(!i)return this.receiveConversationMessageOverride();const r=this.privConversationRequestSession.sessionId,n=i.conversationMessageType.toLowerCase();let s=!1;try{switch(n){case"info":case"participant_command":case"command":const e=y.CommandResponsePayload.fromJSON(i.textBody);switch(e.command.toLowerCase()){case"participantlist":const t=R.ParticipantsListPayloadResponse.fromJSON(i.textBody),n=t.participants.map((e=>({avatar:e.avatar,displayName:e.nickname,id:e.participantId,isHost:e.ishost,isMuted:e.ismuted,isUsingTts:e.usetts,preferredLanguage:e.locale})));this.privConversationServiceConnector.participantsListReceived&&this.privConversationServiceConnector.participantsListReceived(this.privConversationServiceConnector,new f.ParticipantsListEventArgs(t.roomid,t.token,t.translateTo,t.profanityFilter,t.roomProfanityFilter,t.roomLocked,t.muteAll,n,r));break;case"settranslatetolanguages":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new f.ParticipantAttributeEventArgs(e.participantId,C.ConversationTranslatorCommandTypes.setTranslateToLanguages,e.value,r));break;case"setprofanityfiltering":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new f.ParticipantAttributeEventArgs(e.participantId,C.ConversationTranslatorCommandTypes.setProfanityFiltering,e.value,r));break;case"setmute":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new f.ParticipantAttributeEventArgs(e.participantId,C.ConversationTranslatorCommandTypes.setMute,e.value,r));break;case"setmuteall":this.privConversationServiceConnector.muteAllCommandReceived&&this.privConversationServiceConnector.muteAllCommandReceived(this.privConversationServiceConnector,new f.MuteAllEventArgs(e.value,r));break;case"roomexpirationwarning":this.privConversationServiceConnector.conversationExpiration&&this.privConversationServiceConnector.conversationExpiration(this.privConversationServiceConnector,new h.ConversationExpirationEventArgs(e.value,this.privConversationRequestSession.sessionId));break;case"setusetts":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new f.ParticipantAttributeEventArgs(e.participantId,C.ConversationTranslatorCommandTypes.setUseTTS,e.value,r));break;case"setlockstate":this.privConversationServiceConnector.lockRoomCommandReceived&&this.privConversationServiceConnector.lockRoomCommandReceived(this.privConversationServiceConnector,new f.LockRoomEventArgs(e.value,r));break;case"changenickname":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new f.ParticipantAttributeEventArgs(e.participantId,C.ConversationTranslatorCommandTypes.changeNickname,e.value,r));break;case"joinsession":const s=R.ParticipantPayloadResponse.fromJSON(i.textBody),o={avatar:s.avatar,displayName:s.nickname,id:s.participantId,isHost:s.ishost,isMuted:s.ismuted,isUsingTts:s.usetts,preferredLanguage:s.locale};this.privConversationServiceConnector.participantJoinCommandReceived&&this.privConversationServiceConnector.participantJoinCommandReceived(this.privConversationServiceConnector,new f.ParticipantEventArgs(o,r));break;case"leavesession":const a={id:e.participantId};this.privConversationServiceConnector.participantLeaveCommandReceived&&this.privConversationServiceConnector.participantLeaveCommandReceived(this.privConversationServiceConnector,new f.ParticipantEventArgs(a,r));break;case"disconnectsession":e.participantId;break;case"token":const c=new g.CognitiveTokenAuthentication((()=>{const t=e.token;return Promise.resolve(t)}),(()=>{const t=e.token;return Promise.resolve(t)}));this.authentication=c,this.privConversationServiceConnector.onToken(c)}break;case"partial":case"final":const t=P.SpeechResponsePayload.fromJSON(i.textBody),o="final"===n?d.ResultReason.TranslatedParticipantSpeech:d.ResultReason.TranslatingParticipantSpeech,a=new u.ConversationTranslationResult(t.participantId,this.getTranslations(t.translations),t.language,t.id,o,t.recognition,void 0,void 0,i.textBody,void 0);t.isFinal?((void 0!==a.text&&a.text.length>0||t.id===this.privLastPartialUtteranceId)&&(s=!0),s&&this.privConversationServiceConnector.translationReceived&&this.privConversationServiceConnector.translationReceived(this.privConversationServiceConnector,new f.ConversationReceivedTranslationEventArgs(C.ConversationTranslatorMessageTypes.final,a,r))):void 0!==a.text&&(this.privLastPartialUtteranceId=t.id,this.privConversationServiceConnector.translationReceived&&this.privConversationServiceConnector.translationReceived(this.privConversationServiceConnector,new f.ConversationReceivedTranslationEventArgs(C.ConversationTranslatorMessageTypes.partial,a,r)));break;case"translated_message":const c=P.TextResponsePayload.fromJSON(i.textBody),p=new u.ConversationTranslationResult(c.participantId,this.getTranslations(c.translations),c.language,void 0,void 0,c.originalText,void 0,void 0,void 0,i.textBody,void 0);this.privConversationServiceConnector.translationReceived&&this.privConversationServiceConnector.translationReceived(this.privConversationServiceConnector,new f.ConversationReceivedTranslationEventArgs(C.ConversationTranslatorMessageTypes.instantMessage,p,r))}}catch(e){}return this.receiveConversationMessageOverride()}catch(e){this.terminateMessageLoop=!0}return e.promise}))}startMessageLoop(){return I(this,void 0,void 0,(function*(){if(this.isDisposed())return Promise.resolve();this.terminateMessageLoop=!1;const e=this.receiveConversationMessageOverride();try{return yield e}catch(e){return this.cancelRecognition(this.privRequestSession?this.privRequestSession.sessionId:"",this.privRequestSession?this.privRequestSession.requestId:"",a.CancellationReason.Error,c.CancellationErrorCode.RuntimeError,e),null}}))}configConnection(){return this.isDisposed()?Promise.resolve(void 0):void 0!==this.privConnectionConfigPromise?this.privConnectionConfigPromise.then((e=>e.state()===o.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionConfigPromise=void 0,this.configConnection()):this.privConnectionConfigPromise),(()=>(this.privConnectionId=null,this.privConnectionConfigPromise=void 0,this.configConnection()))):this.terminateMessageLoop?Promise.resolve(void 0):(this.privConnectionConfigPromise=this.connectImpl().then((e=>e)),this.privConnectionConfigPromise)}getTranslations(e){let t;if(void 0!==e){t=new v.Translations;for(const i of e)t.set(i.lang,i.translation)}return t}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConversationRequestSession:()=>o});var r=i(9),n=i(18),s=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class o{constructor(e){this.privIsDisposed=!1,this.privDetachables=new Array,this.privSessionId=e,this.privRequestId=(0,r.createNoDashGuid)(),this.privRequestCompletionDeferral=new n.Deferred}get sessionId(){return this.privSessionId}get requestId(){return this.privRequestId}get completionPromise(){return this.privRequestCompletionDeferral.promise}onPreConnectionStart(e,t){this.privSessionId=t}onAuthCompleted(e){e&&this.onComplete()}onConnectionEstablishCompleted(e){200!==e&&403===e&&this.onComplete()}onServiceTurnEndResponse(e){e?this.privRequestId=(0,r.createNoDashGuid)():this.onComplete()}dispose(){return s(this,void 0,void 0,(function*(){if(!this.privIsDisposed){this.privIsDisposed=!0;for(const e of this.privDetachables)yield e.detach()}}))}onComplete(){}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConversationTranslationCanceledEventArgs:()=>n});var r=i(52);class n extends r.CancellationEventArgsBase{}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{CommandResponsePayload:()=>r});class r{constructor(e){this.privCommandResponse=(e=>JSON.parse(e))(e)}get type(){return this.privCommandResponse.type}get command(){return this.privCommandResponse.command}get id(){return this.privCommandResponse.id}get nickname(){return this.privCommandResponse.nickname}get participantId(){return this.privCommandResponse.participantId}get roomid(){return this.privCommandResponse.roomid}get value(){return this.privCommandResponse.value}get token(){return this.privCommandResponse.token}static fromJSON(e){return new r(e)}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ParticipantPayloadResponse:()=>n,ParticipantsListPayloadResponse:()=>r});class r{constructor(e){this.privParticipantsPayloadResponse=(e=>JSON.parse(e))(e)}get roomid(){return this.privParticipantsPayloadResponse.roomid}get id(){return this.privParticipantsPayloadResponse.id}get command(){return this.privParticipantsPayloadResponse.command}get participants(){return this.privParticipantsPayloadResponse.participants}get token(){return this.privParticipantsPayloadResponse.token}get translateTo(){return this.privParticipantsPayloadResponse.translateTo}get profanityFilter(){return this.privParticipantsPayloadResponse.profanityFilter}get roomProfanityFilter(){return this.privParticipantsPayloadResponse.roomProfanityFilter}get roomLocked(){return this.privParticipantsPayloadResponse.roomLocked}get muteAll(){return this.privParticipantsPayloadResponse.muteAll}get type(){return this.privParticipantsPayloadResponse.type}static fromJSON(e){return new r(e)}}class n{constructor(e){this.privParticipantPayloadResponse=(e=>JSON.parse(e))(e)}get nickname(){return this.privParticipantPayloadResponse.nickname}get locale(){return this.privParticipantPayloadResponse.locale}get usetts(){return this.privParticipantPayloadResponse.usetts}get ismuted(){return this.privParticipantPayloadResponse.ismuted}get ishost(){return this.privParticipantPayloadResponse.ishost}get participantId(){return this.privParticipantPayloadResponse.participantId}get avatar(){return this.privParticipantPayloadResponse.avatar}static fromJSON(e){return new n(e)}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConversationReceivedTranslationEventArgs:()=>p,LockRoomEventArgs:()=>s,MuteAllEventArgs:()=>n,ParticipantAttributeEventArgs:()=>a,ParticipantEventArgs:()=>o,ParticipantsListEventArgs:()=>c});var r=i(42);class n extends r.SessionEventArgs{constructor(e,t){super(t),this.privIsMuted=e}get isMuted(){return this.privIsMuted}}class s extends r.SessionEventArgs{constructor(e,t){super(t),this.privIsLocked=e}get isMuted(){return this.privIsLocked}}class o extends r.SessionEventArgs{constructor(e,t){super(t),this.privParticipant=e}get participant(){return this.privParticipant}}class a extends r.SessionEventArgs{constructor(e,t,i,r){super(r),this.privKey=t,this.privValue=i,this.privParticipantId=e}get value(){return this.privValue}get key(){return this.privKey}get id(){return this.privParticipantId}}class c extends r.SessionEventArgs{constructor(e,t,i,r,n,s,o,a,c){super(c),this.privRoomId=e,this.privSessionToken=t,this.privTranslateTo=i,this.privProfanityFilter=r,this.privRoomProfanityFilter=n,this.privIsRoomLocked=s,this.privIsRoomLocked=o,this.privParticipants=a}get sessionToken(){return this.privSessionToken}get conversationId(){return this.privRoomId}get translateTo(){return this.privTranslateTo}get profanityFilter(){return this.privProfanityFilter}get roomProfanityFilter(){return this.privRoomProfanityFilter}get isRoomLocked(){return this.privIsRoomLocked}get isMuteAll(){return this.privIsMuteAll}get participants(){return this.privParticipants}}class p{constructor(e,t,i){this.privPayload=t,this.privCommand=e,this.privSessionId=i}get payload(){return this.privPayload}get command(){return this.privCommand}get sessionId(){return this.privSessionId}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConversationTranslatorCommandTypes:()=>s,ConversationTranslatorMessageTypes:()=>n,InternalParticipants:()=>r});class r{constructor(e=[],t){this.participants=e,this.meId=t}addOrUpdateParticipant(e){if(void 0===e)return;const t=this.getParticipantIndex(e.id);return t>-1?this.participants.splice(t,1,e):this.participants.push(e),this.getParticipant(e.id)}getParticipantIndex(e){return this.participants.findIndex((t=>t.id===e))}getParticipant(e){return this.participants.find((t=>t.id===e))}deleteParticipant(e){this.participants=this.participants.filter((t=>t.id!==e))}get host(){return this.participants.find((e=>!0===e.isHost))}get me(){return this.getParticipant(this.meId)}}const n={command:"command",final:"final",info:"info",instantMessage:"instant_message",keepAlive:"keep_alive",partial:"partial",participantCommand:"participant_command",translatedMessage:"translated_message"},s={changeNickname:"ChangeNickname",disconnectSession:"DisconnectSession",ejectParticipant:"EjectParticipant",instant_message:"instant_message",joinSession:"JoinSession",leaveSession:"LeaveSession",participantList:"ParticipantList",roomExpirationWarning:"RoomExpirationWarning",setLockState:"SetLockState",setMute:"SetMute",setMuteAll:"SetMuteAll",setProfanityFiltering:"SetProfanityFiltering",setTranslateToLanguages:"SetTranslateToLanguages",setUseTTS:"SetUseTTS"}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConversationExpirationEventArgs:()=>n});var r=i(42);class n extends r.SessionEventArgs{constructor(e,t){super(t),this.privExpirationTime=e}get expirationTime(){return this.privExpirationTime}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SpeechResponsePayload:()=>r,TextResponsePayload:()=>n});class r{constructor(e){this.privSpeechResponse=(e=>JSON.parse(e))(e)}get recognition(){return this.privSpeechResponse.recognition}get translations(){return this.privSpeechResponse.translations}get id(){return this.privSpeechResponse.id}get language(){return this.privSpeechResponse.language}get nickname(){return this.privSpeechResponse.nickname}get participantId(){return this.privSpeechResponse.participantId}get roomid(){return this.privSpeechResponse.roomid}get timestamp(){return this.privSpeechResponse.timestamp}get type(){return this.privSpeechResponse.type}get isFinal(){return"final"===this.privSpeechResponse.type}static fromJSON(e){return new r(e)}}class n{constructor(e){this.privTextResponse=(e=>JSON.parse(e))(e)}get originalText(){return this.privTextResponse.originalText}get translations(){return this.privTextResponse.translations}get id(){return this.privTextResponse.id}get language(){return this.privTextResponse.language}get nickname(){return this.privTextResponse.nickname}get participantId(){return this.privTextResponse.participantId}get roomid(){return this.privTextResponse.roomid}get timestamp(){return this.privTextResponse.timestamp}get type(){return this.privTextResponse.type}static fromJSON(e){return new n(e)}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConversationTranslationResult:()=>n});var r=i(55);class n extends r.TranslationRecognitionResult{constructor(e,t,i,r,n,s,o,a,c,p,h){super(t,r,n,s,o,a,void 0,void 0,c,p,h),this.privId=e,this.privOrigLang=i}get participantId(){return this.privId}get originalLang(){return this.privOrigLang}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{TranscriberRecognizer:()=>d});var r=i(18),n=i(36),s=i(143),o=i(59),a=i(104),c=i(92),p=i(120),h=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class d extends s.Recognizer{constructor(e,t){const i=e;n.Contracts.throwIfNull(i,"speechTranslationConfig");const r=t;n.Contracts.throwIfNull(r,"audioConfigImpl"),n.Contracts.throwIfNullOrWhitespace(i.speechRecognitionLanguage,o.PropertyId[o.PropertyId.SpeechServiceConnection_RecoLanguage]),super(t,i.properties,new a.TranscriberConnectionFactory),this.privDisposedRecognizer=!1,this.isMeetingRecognizer=!1}get speechRecognitionLanguage(){return n.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(o.PropertyId.SpeechServiceConnection_RecoLanguage)}get properties(){return this.privProperties}get authorizationToken(){return this.properties.getProperty(o.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(e){n.Contracts.throwIfNullOrWhitespace(e,"token"),this.properties.setProperty(o.PropertyId.SpeechServiceAuthorization_Token,e)}set conversation(e){n.Contracts.throwIfNullOrUndefined(e,"Conversation"),this.isMeetingRecognizer=!1,this.privConversation=e}getConversationInfo(){return n.Contracts.throwIfNullOrUndefined(this.privConversation,"Conversation"),this.privConversation.conversationInfo}set meeting(e){n.Contracts.throwIfNullOrUndefined(e,"Meeting"),this.isMeetingRecognizer=!0,this.privMeeting=e}getMeetingInfo(){return n.Contracts.throwIfNullOrUndefined(this.privMeeting,"Meeting"),this.privMeeting.meetingInfo}IsMeetingRecognizer(){return this.isMeetingRecognizer}startContinuousRecognitionAsync(e,t){(0,r.marshalPromiseToCallbacks)(this.startContinuousRecognitionAsyncImpl(c.RecognitionMode.Conversation),e,t)}stopContinuousRecognitionAsync(e,t){(0,r.marshalPromiseToCallbacks)(this.stopContinuousRecognitionAsyncImpl(),e,t)}close(){return h(this,void 0,void 0,(function*(){this.privDisposedRecognizer||(yield this.dispose(!0))}))}pushConversationEvent(e,t){return h(this,void 0,void 0,(function*(){const i=this.privReco;n.Contracts.throwIfNullOrUndefined(i,"serviceRecognizer"),yield i.sendSpeechEventAsync(e,t)}))}pushMeetingEvent(e,t){return h(this,void 0,void 0,(function*(){const i=this.privReco;n.Contracts.throwIfNullOrUndefined(i,"serviceRecognizer"),yield i.sendMeetingSpeechEventAsync(e,t)}))}enforceAudioGating(){return h(this,void 0,void 0,(function*(){const e=this.audioConfig,t=(yield e.format).channels;if(1===t){if("true"!==this.properties.getProperty("f0f5debc-f8c9-4892-ac4b-90a7ab359fd2","false").toLowerCase())throw new Error("Single channel audio configuration for MeetingTranscriber is currently under private preview, please contact diarizationrequest@microsoft.com for more details")}else if(8!==t)throw new Error(`Unsupported audio configuration: Detected ${t}-channel audio`)}))}connectMeetingCallbacks(e){this.isMeetingRecognizer=!0,this.canceled=(t,i)=>{e.canceled&&e.canceled(e,i)},this.recognizing=(t,i)=>{e.transcribing&&e.transcribing(e,i)},this.recognized=(t,i)=>{e.transcribed&&e.transcribed(e,i)},this.sessionStarted=(t,i)=>{e.sessionStarted&&e.sessionStarted(e,i)},this.sessionStopped=(t,i)=>{e.sessionStopped&&e.sessionStopped(e,i)}}disconnectCallbacks(){this.canceled=void 0,this.recognizing=void 0,this.recognized=void 0,this.sessionStarted=void 0,this.sessionStopped=void 0}dispose(e){const t=Object.create(null,{dispose:{get:()=>super.dispose}});return h(this,void 0,void 0,(function*(){this.privDisposedRecognizer||(e&&(this.privDisposedRecognizer=!0,yield this.implRecognizerStop()),yield t.dispose.call(this,e))}))}createRecognizerConfig(e){return new c.RecognizerConfig(e,this.properties)}createServiceRecognizer(e,t,i,r){const n=i;return new p.TranscriptionServiceRecognizer(e,t,n,r,this)}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{AvatarSynthesisAdapter:()=>o});var r=i(59),n=i(174),s=i(148);class o extends s.SynthesisAdapterBase{constructor(e,t,i,r,n){super(e,t,i,void 0),this.privAvatarSynthesizer=r,this.privSynthesizer=r,this.privAvatarConfig=n}setSynthesisContextSynthesisSection(){this.privSynthesisContext.setSynthesisSection(void 0)}setSpeechConfigSynthesisSection(){var e,t,i,n,s,o,a,c,p,h,d,u,v,l,g,m;this.privSynthesizerConfig.synthesisVideoSection={format:{bitrate:null===(e=this.privAvatarConfig.videoFormat)||void 0===e?void 0:e.bitrate,codec:null===(t=this.privAvatarConfig.videoFormat)||void 0===t?void 0:t.codec,crop:{bottomRight:{x:null===(s=null===(n=null===(i=this.privAvatarConfig.videoFormat)||void 0===i?void 0:i.cropRange)||void 0===n?void 0:n.bottomRight)||void 0===s?void 0:s.x,y:null===(c=null===(a=null===(o=this.privAvatarConfig.videoFormat)||void 0===o?void 0:o.cropRange)||void 0===a?void 0:a.bottomRight)||void 0===c?void 0:c.y},topLeft:{x:null===(d=null===(h=null===(p=this.privAvatarConfig.videoFormat)||void 0===p?void 0:p.cropRange)||void 0===h?void 0:h.topLeft)||void 0===d?void 0:d.x,y:null===(l=null===(v=null===(u=this.privAvatarConfig.videoFormat)||void 0===u?void 0:u.cropRange)||void 0===v?void 0:v.topLeft)||void 0===l?void 0:l.y}},resolution:{height:null===(g=this.privAvatarConfig.videoFormat)||void 0===g?void 0:g.height,width:null===(m=this.privAvatarConfig.videoFormat)||void 0===m?void 0:m.width}},protocol:{name:"WebRTC",webrtcConfig:{clientDescription:btoa(this.privSynthesizerConfig.parameters.getProperty(r.PropertyId.TalkingAvatarService_WebRTC_SDP)),iceServers:this.privAvatarSynthesizer.iceServers}},talkingAvatar:{background:{color:this.privAvatarConfig.backgroundColor},character:this.privAvatarConfig.character,customized:this.privAvatarConfig.customized,style:this.privAvatarConfig.style}}}onAvatarEvent(e){if(this.privAvatarSynthesizer.avatarEventReceived){const t=new n.AvatarEventArgs(e.Data.Offset,e.Data.Name);try{this.privAvatarSynthesizer.avatarEventReceived(this.privAvatarSynthesizer,t)}catch(e){}}}}},(e,t,i)=>{"use strict";var r;i.r(t),i.d(t,{AvatarEventArgs:()=>n,AvatarEventTypes:()=>r}),function(e){e.SwitchedToSpeaking="SwitchedToSpeaking",e.SwitchedToIdle="SwitchedToIdle",e.SessionClosed="SessionClosed"}(r||(r={}));class n{constructor(e,t){this.privOffset=e,this.privDescription=t}get type(){return this.privType}get offset(){return this.privOffset}get description(){return this.privDescription}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SpeechSynthesisAdapter:()=>a});var r=i(176),n=i(151),s=i(57),o=i(148);class a extends o.SynthesisAdapterBase{constructor(e,t,i,r,n){super(e,t,i,n),this.privSpeechSynthesizer=r,this.privSynthesizer=r}setSynthesisContextSynthesisSection(){this.privSynthesisContext.setSynthesisSection(this.privSpeechSynthesizer)}onSynthesisStarted(e){const t=new r.SpeechSynthesisEventArgs(new n.SpeechSynthesisResult(e,s.ResultReason.SynthesizingAudioStarted));this.privSpeechSynthesizer.synthesisStarted&&this.privSpeechSynthesizer.synthesisStarted(this.privSpeechSynthesizer,t)}onSynthesizing(e){if(this.privSpeechSynthesizer.synthesizing)try{const t=this.privSynthesisTurn.audioOutputFormat.addHeader(e),i=new r.SpeechSynthesisEventArgs(new n.SpeechSynthesisResult(this.privSynthesisTurn.requestId,s.ResultReason.SynthesizingAudio,t));this.privSpeechSynthesizer.synthesizing(this.privSpeechSynthesizer,i)}catch(e){}}onSynthesisCancelled(e){if(this.privSpeechSynthesizer.SynthesisCanceled){const t=new r.SpeechSynthesisEventArgs(e);try{this.privSpeechSynthesizer.SynthesisCanceled(this.privSpeechSynthesizer,t)}catch(e){}}}onSynthesisCompleted(e){if(this.privSpeechSynthesizer.synthesisCompleted)try{this.privSpeechSynthesizer.synthesisCompleted(this.privSpeechSynthesizer,new r.SpeechSynthesisEventArgs(e))}catch(e){}}onWordBoundary(e){if(this.privSpeechSynthesizer.wordBoundary)try{this.privSpeechSynthesizer.wordBoundary(this.privSpeechSynthesizer,e)}catch(e){}}onVisemeReceived(e){if(this.privSpeechSynthesizer.visemeReceived)try{this.privSpeechSynthesizer.visemeReceived(this.privSpeechSynthesizer,e)}catch(e){}}onBookmarkReached(e){if(this.privSpeechSynthesizer.bookmarkReached)try{this.privSpeechSynthesizer.bookmarkReached(this.privSpeechSynthesizer,e)}catch(e){}}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SpeechSynthesisEventArgs:()=>r});class r{constructor(e){this.privResult=e}get result(){return this.privResult}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SynthesisRestAdapter:()=>c});var r=i(138),n=i(139),s=i(59),o=i(67),a=i(64);class c{constructor(e,t){let i=e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_Endpoint,void 0);if(!i){const t=e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_Region,"westus"),r=o.ConnectionFactoryBase.getHostSuffix(t);i=e.parameters.getProperty(s.PropertyId.SpeechServiceConnection_Host,`https://${t}.tts.speech${r}`)}this.privUri=`${i}/cognitiveservices/voices/list`;const a=r.RestConfigBase.requestOptions;this.privRestAdapter=new n.RestMessageAdapter(a),this.privAuthentication=t}getVoicesList(e){return this.privRestAdapter.setHeaders(a.HeaderNames.ConnectionId,e),this.privAuthentication.fetch(e).then((e=>(this.privRestAdapter.setHeaders(e.headerName,e.token),this.privRestAdapter.request(n.RestRequestType.Get,this.privUri))))}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SynthesisServiceType:()=>r,SynthesizerConfig:()=>s});var r,n=i(21);!function(e){e[e.Standard=0]="Standard",e[e.Custom=1]="Custom"}(r||(r={}));class s{constructor(e,t){this.privSynthesisServiceType=r.Standard,this.avatarEnabled=!1,this.privSpeechServiceConfig=e||new n.SpeechServiceConfig(new n.Context(null)),this.privParameters=t}get parameters(){return this.privParameters}get synthesisServiceType(){return this.privSynthesisServiceType}set synthesisServiceType(e){this.privSynthesisServiceType=e}set synthesisVideoSection(e){this.privSpeechServiceConfig.Context.synthesis={video:e}}get SpeechServiceConfig(){return this.privSpeechServiceConfig}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SpeakerRecognitionConfig:()=>n});var r=i(21);class n{constructor(e,t){this.privContext=e||new r.Context(null),this.privParameters=t}get parameters(){return this.privParameters}get Context(){return this.privContext}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SpeakerServiceRecognizer:()=>S});var r=i(93),n=i(80),s=i(18),o=i(60),a=i(59),c=i(181),p=i(57),h=i(91),d=i(40),u=i(42),v=i(85),l=i(61),g=i(94),m=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class S extends v.ServiceRecognizerBase{constructor(e,t,i,r,n){super(e,t,i,r,n),this.privSpeakerRecognizer=n,this.privSpeakerAudioSource=i,this.recognizeSpeaker=e=>this.recognizeSpeakerOnce(e),this.sendPrePayloadJSONOverride=()=>this.noOp()}processTypeSpecificMessages(e){let t=!1;const i=new o.PropertyCollection;if(e.messageType===n.MessageType.Text&&i.setProperty(a.PropertyId.SpeechServiceResponse_JsonResult,e.textBody),"speaker.response"===e.path.toLowerCase()){const i=JSON.parse(e.textBody);let r;r="success"!==i.status.statusCode.toLowerCase()?new c.SpeakerRecognitionResult(i,p.ResultReason.Canceled,h.CancellationErrorCode.ServiceError,i.status.reason):new c.SpeakerRecognitionResult(i,p.ResultReason.RecognizedSpeaker),this.privResultDeferral&&this.privResultDeferral.resolve(r),t=!0}const r=new s.Deferred;return r.resolve(t),r.promise}cancelRecognition(e,t,i,r,n){if((new o.PropertyCollection).setProperty(l.CancellationErrorCodePropertyName,h.CancellationErrorCode[r]),this.privResultDeferral){const e=new c.SpeakerRecognitionResult({scenario:this.privSpeakerModel.scenario,status:{statusCode:n,reason:n}},p.ResultReason.Canceled,r,n);try{this.privResultDeferral.resolve(e)}catch(n){this.privResultDeferral.reject(n)}}}recognizeSpeakerOnce(e){return m(this,void 0,void 0,(function*(){this.privSpeakerModel=e,this.voiceProfileType=e.scenario,this.privResultDeferral||(this.privResultDeferral=new s.Deferred),this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privSpeakerAudioSource.events),this.privRecognizerConfig.parameters.setProperty(a.PropertyId.Speech_SessionId,this.privRequestSession.sessionId);const t=this.connectImpl(),i=this.sendPreAudioMessages(this.extractSpeakerContext(e)),n=yield this.privSpeakerAudioSource.attach(this.privRequestSession.audioNodeId),o=yield this.privSpeakerAudioSource.format,c=yield this.privSpeakerAudioSource.deviceInfo,p=new r.ReplayableAudioNode(n,o.avgBytesPerSec);yield this.privRequestSession.onAudioSourceAttachCompleted(p,!1),this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:c};try{yield t,yield i}catch(e){this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,d.CancellationReason.Error,h.CancellationErrorCode.ConnectionFailure,e)}const v=new u.SessionEventArgs(this.privRequestSession.sessionId);this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,v),this.receiveMessage();return this.sendAudio(p).then((()=>{}),(e=>{this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,d.CancellationReason.Error,h.CancellationErrorCode.RuntimeError,e)})),this.privResultDeferral.promise}))}sendPreAudioMessages(e){return m(this,void 0,void 0,(function*(){const t=yield this.fetchConnection();yield this.sendSpeakerRecognition(t,e)}))}sendSpeakerRecognition(e,t){return m(this,void 0,void 0,(function*(){const i=JSON.stringify(t);return e.send(new g.SpeechConnectionMessage(n.MessageType.Text,"speaker.context",this.privRequestSession.requestId,"application/json; charset=utf-8",i))}))}extractSpeakerContext(e){return{features:{interimResult:"enabled",progressiveDetection:"disabled"},profileIds:e.profileIds,scenario:e.scenario}}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SpeakerRecognitionCancellationDetails:()=>u,SpeakerRecognitionResult:()=>d,SpeakerRecognitionResultType:()=>r});var r,n=i(61),s=i(57),o=i(91),a=i(60),c=i(59),p=i(182),h=i(40);!function(e){e[e.Verify=0]="Verify",e[e.Identify=1]="Identify"}(r||(r={}));class d{constructor(e,t=s.ResultReason.RecognizedSpeaker,i=o.CancellationErrorCode.NoError,p=""){this.privProperties=new a.PropertyCollection;const h="TextIndependentIdentification"===e.scenario?r.Identify:r.Verify;this.privReason=t,this.privReason!==s.ResultReason.Canceled?h===r.Identify?(this.privProfileId=e.identificationResult.identifiedProfile.profileId,this.privScore=e.identificationResult.identifiedProfile.score,this.privReason=s.ResultReason.RecognizedSpeakers):(this.privScore=e.verificationResult.score,"accept"!==e.verificationResult.recognitionResult.toLowerCase()&&(this.privReason=s.ResultReason.NoMatch),void 0!==e.verificationResult.profileId&&""!==e.verificationResult.profileId&&(this.privProfileId=e.verificationResult.profileId)):(this.privErrorDetails=p,this.privProperties.setProperty(n.CancellationErrorCodePropertyName,o.CancellationErrorCode[i])),this.privProperties.setProperty(c.PropertyId.SpeechServiceResponse_JsonResult,JSON.stringify(e))}get properties(){return this.privProperties}get reason(){return this.privReason}get profileId(){return this.privProfileId}get errorDetails(){return this.privErrorDetails}get score(){return this.privScore}}class u extends p.CancellationDetailsBase{constructor(e,t,i){super(e,t,i)}static fromResult(e){const t=h.CancellationReason.Error;let i=o.CancellationErrorCode.NoError;return e.properties&&(i=o.CancellationErrorCode[e.properties.getProperty(n.CancellationErrorCodePropertyName,o.CancellationErrorCode[o.CancellationErrorCode.NoError])]),new u(t,e.errorDetails,i)}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{CancellationDetailsBase:()=>r});class r{constructor(e,t,i){this.privReason=e,this.privErrorDetails=t,this.privErrorCode=i}get reason(){return this.privReason}get errorDetails(){return this.privErrorDetails}get ErrorCode(){return this.privErrorCode}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{VoiceServiceRecognizer:()=>R});var r=i(93),n=i(184),s=i(80),o=i(18),a=i(60),c=i(59),p=i(185),h=i(91),d=i(57),u=i(40),v=i(42),l=i(186),g=i(187),m=i(188),S=i(85),f=i(61),C=i(94),y=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class R extends S.ServiceRecognizerBase{constructor(e,t,i,r,s){super(e,t,i,r,s),this.privDeferralMap=new n.DeferralMap,this.privSpeakerAudioSource=i,this.sendPrePayloadJSONOverride=()=>this.noOp()}set SpeakerAudioSource(e){this.privSpeakerAudioSource=e}processTypeSpecificMessages(e){let t=!1;const i=new a.PropertyCollection;switch(e.messageType===s.MessageType.Text&&i.setProperty(c.PropertyId.SpeechServiceResponse_JsonResult,e.textBody),e.path.toLowerCase()){case"speaker.profiles":const i=JSON.parse(e.textBody);switch(i.operation.toLowerCase()){case"create":this.handleCreateResponse(i,e.requestId);break;case"delete":case"reset":this.handleResultResponse(i,e.requestId);break;case"fetch":const t=JSON.parse(e.textBody);this.handleFetchResponse(t,e.requestId)}t=!0;break;case"speaker.phrases":const r=JSON.parse(e.textBody);this.handlePhrasesResponse(r,e.requestId),t=!0;break;case"speaker.profile.enrollment":const n=JSON.parse(e.textBody),s=new p.VoiceProfileEnrollmentResult(this.enrollmentReasonFrom(n.enrollment?n.enrollment.enrollmentStatus:n.status.statusCode),n.enrollment?JSON.stringify(n.enrollment):void 0,n.status.reason);this.privDeferralMap.getId(e.requestId)&&this.privDeferralMap.complete(e.requestId,s),this.privRequestSession.onSpeechEnded(),t=!0}const r=new o.Deferred;return r.resolve(t),r.promise}cancelRecognition(e,t,i,r,n){(new a.PropertyCollection).setProperty(f.CancellationErrorCodePropertyName,h.CancellationErrorCode[r]);const s=new p.VoiceProfileEnrollmentResult(d.ResultReason.Canceled,n,n);this.privDeferralMap.getId(t)&&this.privDeferralMap.complete(t,s)}createProfile(e,t){return y(this,void 0,void 0,(function*(){this.voiceProfileType=e.toString();const i=this.connectImpl();try{const r=new o.Deferred;return yield i,yield this.sendCreateProfile(r,e,t),this.receiveMessage(),r.promise}catch(e){throw e}}))}resetProfile(e){return y(this,void 0,void 0,(function*(){return this.voiceProfileType=e.profileType.toString(),this.sendCommonRequest("reset",e.profileType,e)}))}deleteProfile(e){return y(this,void 0,void 0,(function*(){return this.voiceProfileType=e.profileType.toString(),this.sendCommonRequest("delete",e.profileType,e)}))}retrieveEnrollmentResult(e){return y(this,void 0,void 0,(function*(){return this.voiceProfileType=e.profileType.toString(),this.privExpectedProfileId=e.profileId,this.sendCommonRequest("fetch",e.profileType,e)}))}getAllProfiles(e){return y(this,void 0,void 0,(function*(){return this.voiceProfileType=e.toString(),this.sendCommonRequest("fetch",e)}))}getActivationPhrases(e,t){return y(this,void 0,void 0,(function*(){this.voiceProfileType=e.toString();const i=this.connectImpl();try{const r=new o.Deferred;return yield i,yield this.sendPhrasesRequest(r,e,t),this.receiveMessage(),r.promise}catch(e){throw e}}))}enrollProfile(e){return y(this,void 0,void 0,(function*(){this.voiceProfileType=e.profileType.toString();const t=new o.Deferred;this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privSpeakerAudioSource.events),this.privRecognizerConfig.parameters.setProperty(c.PropertyId.Speech_SessionId,this.privRequestSession.sessionId);const i=this.connectImpl(),n=this.sendPreAudioMessages(e,t),s=yield this.privSpeakerAudioSource.attach(this.privRequestSession.audioNodeId),a=yield this.privSpeakerAudioSource.format,p=yield this.privSpeakerAudioSource.deviceInfo,d=new r.ReplayableAudioNode(s,a.avgBytesPerSec);yield this.privRequestSession.onAudioSourceAttachCompleted(d,!1),this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:p};try{yield i,yield n}catch(e){this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,u.CancellationReason.Error,h.CancellationErrorCode.ConnectionFailure,e)}const l=new v.SessionEventArgs(this.privRequestSession.sessionId);this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,l),this.receiveMessage();return this.sendAudio(d).then((()=>{}),(e=>{this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,u.CancellationReason.Error,h.CancellationErrorCode.RuntimeError,e)})),t.promise}))}sendPreAudioMessages(e,t){return y(this,void 0,void 0,(function*(){const i=yield this.fetchConnection();this.privRequestSession.onSpeechContext(),this.privDeferralMap.add(this.privRequestSession.requestId,t),yield this.sendBaseRequest(i,"enroll",this.scenarioFrom(e.profileType),e)}))}sendPhrasesRequest(e,t,i){return y(this,void 0,void 0,(function*(){const r=yield this.fetchConnection();this.privRequestSession.onSpeechContext(),this.privDeferralMap.add(this.privRequestSession.requestId,e);const n=this.scenarioFrom(t),o={locale:i,scenario:n};return r.send(new C.SpeechConnectionMessage(s.MessageType.Text,"speaker.profile.phrases",this.privRequestSession.requestId,"application/json; charset=utf-8",JSON.stringify(o)))}))}sendCreateProfile(e,t,i){return y(this,void 0,void 0,(function*(){const r=yield this.fetchConnection();this.privRequestSession.onSpeechContext(),this.privDeferralMap.add(this.privRequestSession.requestId,e);const n=t===l.VoiceProfileType.TextIndependentIdentification?"TextIndependentIdentification":t===l.VoiceProfileType.TextIndependentVerification?"TextIndependentVerification":"TextDependentVerification",o={locale:i,number:"1",scenario:n};return r.send(new C.SpeechConnectionMessage(s.MessageType.Text,"speaker.profile.create",this.privRequestSession.requestId,"application/json; charset=utf-8",JSON.stringify(o)))}))}sendCommonRequest(e,t,i){return y(this,void 0,void 0,(function*(){const r=this.connectImpl();try{const n=new o.Deferred;this.privRequestSession.onSpeechContext(),yield r;const s=yield this.fetchConnection();return this.privDeferralMap.add(this.privRequestSession.requestId,n),yield this.sendBaseRequest(s,e,this.scenarioFrom(t),i),this.receiveMessage(),n.promise}catch(e){throw e}}))}sendBaseRequest(e,t,i,r){return y(this,void 0,void 0,(function*(){const n={scenario:i};return r?n.profileIds=[r.profileId]:n.maxPageSize=-1,e.send(new C.SpeechConnectionMessage(s.MessageType.Text,`speaker.profile.${t}`,this.privRequestSession.requestId,"application/json; charset=utf-8",JSON.stringify(n)))}))}extractSpeakerContext(e){return{features:{interimResult:"enabled",progressiveDetection:"disabled"},profileIds:e.profileIds,scenario:e.scenario}}handlePhrasesResponse(e,t){if(!this.privDeferralMap.getId(t))throw new Error(`Voice Profile get activation phrases request for requestID ${t} not found`);if("success"!==e.status.statusCode.toLowerCase()){const i=d.ResultReason.Canceled,r=new g.VoiceProfilePhraseResult(i,e.status.statusCode,e.passPhraseType,[]);this.privDeferralMap.complete(t,r)}else{if(!(e.phrases&&e.phrases.length>0))throw new Error("Voice Profile get activation phrases failed, no phrases received");{const i=d.ResultReason.EnrollingVoiceProfile,r=new g.VoiceProfilePhraseResult(i,e.status.statusCode,e.passPhraseType,e.phrases);this.privDeferralMap.complete(t,r)}}}handleCreateResponse(e,t){if(!(e.profiles&&e.profiles.length>0))throw new Error("Voice Profile create failed, no profile id received");if(!this.privDeferralMap.getId(t))throw new Error(`Voice Profile create request for requestID ${t} not found`);{const i=e.profiles.map((e=>e.profileId));this.privDeferralMap.complete(t,i)}}handleResultResponse(e,t){if(!this.privDeferralMap.getId(t))throw new Error(`Voice Profile create request for requestID ${t} not found`);{const i="delete"===e.operation.toLowerCase()?d.ResultReason.DeletedVoiceProfile:d.ResultReason.ResetVoiceProfile,r="success"===e.status.statusCode.toLowerCase()?i:d.ResultReason.Canceled,n=new m.VoiceProfileResult(r,`statusCode: ${e.status.statusCode}, errorDetails: ${e.status.reason}`);this.privDeferralMap.complete(t,n)}}handleFetchResponse(e,t){if(!this.privDeferralMap.getId(t)||!e.profiles[0])throw new Error(`Voice Profile fetch request for requestID ${t} not found`);if(this.privExpectedProfileId&&1===e.profiles.length&&e.profiles[0].profileId===this.privExpectedProfileId){this.privExpectedProfileId=void 0;const i=e.profiles[0],r=new p.VoiceProfileEnrollmentResult(this.enrollmentReasonFrom(i.enrollmentStatus),JSON.stringify(i),e.status.reason);this.privDeferralMap.complete(t,r)}else if(e.profiles.length>0){const i=e.profiles,r=[];for(const t of i)r.push(new p.VoiceProfileEnrollmentResult(this.enrollmentReasonFrom(t.enrollmentStatus),JSON.stringify(t),e.status.reason));this.privDeferralMap.complete(t,r)}}enrollmentReasonFrom(e){switch(e.toLowerCase()){case"enrolled":return d.ResultReason.EnrolledVoiceProfile;case"invalidlocale":case"invalidphrase":case"invalidaudioformat":case"invalidscenario":case"invalidprofilecount":case"invalidoperation":case"audiotooshort":case"audiotoolong":case"toomanyenrollments":case"storageconflict":case"profilenotfound":case"incompatibleprofiles":case"incompleteenrollment":return d.ResultReason.Canceled;default:return d.ResultReason.EnrollingVoiceProfile}}scenarioFrom(e){return e===l.VoiceProfileType.TextIndependentIdentification?"TextIndependentIdentification":e===l.VoiceProfileType.TextIndependentVerification?"TextIndependentVerification":"TextDependentVerification"}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{DeferralMap:()=>r});class r{constructor(){this.privMap={}}add(e,t){this.privMap[e]=t}getId(e){return this.privMap[e]}complete(e,t){try{this.privMap[e].resolve(t)}catch(t){this.privMap[e].reject(t)}finally{this.privMap[e]=void 0}}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{VoiceProfileEnrollmentCancellationDetails:()=>h,VoiceProfileEnrollmentResult:()=>p});var r=i(61),n=i(60),s=i(57),o=i(91),a=i(182),c=i(40);class p{constructor(e,t,i){this.privReason=e,this.privProperties=new n.PropertyCollection,this.privReason!==s.ResultReason.Canceled?t&&(this.privDetails=JSON.parse(t),"enrolling"===this.privDetails.enrollmentStatus.toLowerCase()&&(this.privReason=s.ResultReason.EnrollingVoiceProfile)):(this.privErrorDetails=i,this.privProperties.setProperty(r.CancellationErrorCodePropertyName,o.CancellationErrorCode[o.CancellationErrorCode.ServiceError]))}get reason(){return this.privReason}get enrollmentsCount(){return this.privDetails.enrollmentsCount}get enrollmentsLength(){return this.privDetails.enrollmentsLength}get properties(){return this.privProperties}get enrollmentResultDetails(){return this.privDetails}get errorDetails(){return this.privErrorDetails}static FromIdentificationProfileList(e){const t=[];for(const i of e.value){const e="enrolling"===i.enrollmentStatus.toLowerCase()?s.ResultReason.EnrollingVoiceProfile:"enrolled"===i.enrollmentStatus.toLowerCase()?s.ResultReason.EnrolledVoiceProfile:s.ResultReason.Canceled,r=new p(e,null,null);r.privDetails=this.getIdentificationDetails(i),t.push(r)}return t}static FromVerificationProfileList(e){const t=[];for(const i of e.value){const e="enrolling"===i.enrollmentStatus.toLowerCase()?s.ResultReason.EnrollingVoiceProfile:"enrolled"===i.enrollmentStatus.toLowerCase()?s.ResultReason.EnrolledVoiceProfile:s.ResultReason.Canceled,r=new p(e,null,null);r.privDetails=this.getVerificationDetails(i),t.push(r)}return t}static getIdentificationDetails(e){return{audioLength:e.audioLength?parseFloat(e.audioLength):0,audioSpeechLength:e.audioSpeechLength?parseFloat(e.audioSpeechLength):0,enrollmentStatus:e.enrollmentStatus,enrollmentsCount:e.enrollmentsCount||0,enrollmentsLength:e.enrollmentsLength?parseFloat(e.enrollmentsLength):0,enrollmentsSpeechLength:e.enrollmentsSpeechLength?parseFloat(e.enrollmentsSpeechLength):0,profileId:e.profileId||e.identificationProfileId,remainingEnrollmentsSpeechLength:e.remainingEnrollmentsSpeechLength?parseFloat(e.remainingEnrollmentsSpeechLength):0}}static getVerificationDetails(e){return{audioLength:e.audioLength?parseFloat(e.audioLength):0,audioSpeechLength:e.audioSpeechLength?parseFloat(e.audioSpeechLength):0,enrollmentStatus:e.enrollmentStatus,enrollmentsCount:e.enrollmentsCount,enrollmentsLength:e.enrollmentsLength?parseFloat(e.enrollmentsLength):0,enrollmentsSpeechLength:e.enrollmentsSpeechLength?parseFloat(e.enrollmentsSpeechLength):0,profileId:e.profileId||e.verificationProfileId,remainingEnrollmentsCount:e.remainingEnrollments||e.remainingEnrollmentsCount,remainingEnrollmentsSpeechLength:e.remainingEnrollmentsSpeechLength?parseFloat(e.remainingEnrollmentsSpeechLength):0}}}class h extends a.CancellationDetailsBase{constructor(e,t,i){super(e,t,i)}static fromResult(e){const t=c.CancellationReason.Error;let i=o.CancellationErrorCode.NoError;return e.properties&&(i=o.CancellationErrorCode[e.properties.getProperty(r.CancellationErrorCodePropertyName,o.CancellationErrorCode[o.CancellationErrorCode.NoError])]),new h(t,e.errorDetails,i)}}},(e,t,i)=>{"use strict";var r;i.r(t),i.d(t,{VoiceProfileType:()=>r}),function(e){e[e.TextIndependentIdentification=0]="TextIndependentIdentification",e[e.TextDependentVerification=1]="TextDependentVerification",e[e.TextIndependentVerification=2]="TextIndependentVerification"}(r||(r={}))},(e,t,i)=>{"use strict";i.r(t),i.d(t,{VoiceProfilePhraseResult:()=>s});var r=i(36),n=i(188);class s extends n.VoiceProfileResult{constructor(e,t,i,n){super(e,t),this.privPhrases=[],r.Contracts.throwIfNullOrUndefined(n,"phrase array"),this.privType=i,n&&n[0]&&(this.privPhrases=n)}get phrases(){return this.privPhrases}get type(){return this.privType}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{VoiceProfileCancellationDetails:()=>d,VoiceProfileResult:()=>h});var r=i(61),n=i(36),s=i(60),o=i(57),a=i(91),c=i(182),p=i(40);class h{constructor(e,t){this.privReason=e,this.privProperties=new s.PropertyCollection,e===o.ResultReason.Canceled&&(n.Contracts.throwIfNullOrUndefined(t,"statusText"),this.privErrorDetails=t,this.privProperties.setProperty(r.CancellationErrorCodePropertyName,a.CancellationErrorCode[a.CancellationErrorCode.ServiceError]))}get reason(){return this.privReason}get properties(){return this.privProperties}get errorDetails(){return this.privErrorDetails}}class d extends c.CancellationDetailsBase{constructor(e,t,i){super(e,t,i)}static fromResult(e){const t=p.CancellationReason.Error;let i=a.CancellationErrorCode.NoError;return e.properties&&(i=a.CancellationErrorCode[e.properties.getProperty(r.CancellationErrorCodePropertyName,a.CancellationErrorCode[a.CancellationErrorCode.NoError])]),new d(t,e.errorDetails,i)}}},(e,t,i)=>{"use strict";var r;i.r(t),i.d(t,{ProfanityOption:()=>r}),function(e){e[e.Masked=0]="Masked",e[e.Removed=1]="Removed",e[e.Raw=2]="Raw"}(r||(r={}))},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SpeechTranslationConfig:()=>d,SpeechTranslationConfigImpl:()=>u});var r=i(61),n=i(36),s=i(58),o=i(59),a=i(60),c=i(44),p=i(189),h=i(35);class d extends s.SpeechConfig{constructor(){super()}static fromSubscription(e,t){n.Contracts.throwIfNullOrWhitespace(e,"subscriptionKey"),n.Contracts.throwIfNullOrWhitespace(t,"region");const i=new u;return i.properties.setProperty(o.PropertyId.SpeechServiceConnection_Key,e),i.properties.setProperty(o.PropertyId.SpeechServiceConnection_Region,t),i}static fromAuthorizationToken(e,t){n.Contracts.throwIfNullOrWhitespace(e,"authorizationToken"),n.Contracts.throwIfNullOrWhitespace(t,"region");const i=new u;return i.properties.setProperty(o.PropertyId.SpeechServiceAuthorization_Token,e),i.properties.setProperty(o.PropertyId.SpeechServiceConnection_Region,t),i}static fromHost(e,t){n.Contracts.throwIfNull(e,"hostName");const i=new u;return i.setProperty(o.PropertyId.SpeechServiceConnection_Host,e.protocol+"//"+e.hostname+(""===e.port?"":":"+e.port)),void 0!==t&&i.setProperty(o.PropertyId.SpeechServiceConnection_Key,t),i}static fromEndpoint(e,t){n.Contracts.throwIfNull(e,"endpoint"),n.Contracts.throwIfNull(t,"subscriptionKey");const i=new u;return i.properties.setProperty(o.PropertyId.SpeechServiceConnection_Endpoint,e.href),i.properties.setProperty(o.PropertyId.SpeechServiceConnection_Key,t),i}}class u extends d{constructor(){super(),this.privSpeechProperties=new a.PropertyCollection,this.outputFormat=c.OutputFormat.Simple}set authorizationToken(e){n.Contracts.throwIfNullOrWhitespace(e,"value"),this.privSpeechProperties.setProperty(o.PropertyId.SpeechServiceAuthorization_Token,e)}set speechRecognitionLanguage(e){n.Contracts.throwIfNullOrWhitespace(e,"value"),this.privSpeechProperties.setProperty(o.PropertyId.SpeechServiceConnection_RecoLanguage,e)}get speechRecognitionLanguage(){return this.privSpeechProperties.getProperty(o.PropertyId[o.PropertyId.SpeechServiceConnection_RecoLanguage])}get subscriptionKey(){return this.privSpeechProperties.getProperty(o.PropertyId[o.PropertyId.SpeechServiceConnection_Key])}get outputFormat(){return c.OutputFormat[this.privSpeechProperties.getProperty(r.OutputFormatPropertyName,void 0)]}set outputFormat(e){this.privSpeechProperties.setProperty(r.OutputFormatPropertyName,c.OutputFormat[e])}get endpointId(){return this.privSpeechProperties.getProperty(o.PropertyId.SpeechServiceConnection_EndpointId)}set endpointId(e){this.privSpeechProperties.setProperty(o.PropertyId.SpeechServiceConnection_EndpointId,e)}addTargetLanguage(e){n.Contracts.throwIfNullOrWhitespace(e,"value");const t=this.targetLanguages;t.includes(e)||(t.push(e),this.privSpeechProperties.setProperty(o.PropertyId.SpeechServiceConnection_TranslationToLanguages,t.join(",")))}get targetLanguages(){return void 0!==this.privSpeechProperties.getProperty(o.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0)?this.privSpeechProperties.getProperty(o.PropertyId.SpeechServiceConnection_TranslationToLanguages).split(","):[]}get voiceName(){return this.getProperty(o.PropertyId[o.PropertyId.SpeechServiceConnection_TranslationVoice])}set voiceName(e){n.Contracts.throwIfNullOrWhitespace(e,"value"),this.privSpeechProperties.setProperty(o.PropertyId.SpeechServiceConnection_TranslationVoice,e)}get region(){return this.privSpeechProperties.getProperty(o.PropertyId.SpeechServiceConnection_Region)}setProxy(e,t,i,r){this.setProperty(o.PropertyId[o.PropertyId.SpeechServiceConnection_ProxyHostName],e),this.setProperty(o.PropertyId[o.PropertyId.SpeechServiceConnection_ProxyPort],t),this.setProperty(o.PropertyId[o.PropertyId.SpeechServiceConnection_ProxyUserName],i),this.setProperty(o.PropertyId[o.PropertyId.SpeechServiceConnection_ProxyPassword],r)}getProperty(e,t){return this.privSpeechProperties.getProperty(e,t)}setProperty(e,t){this.privSpeechProperties.setProperty(e,t)}get properties(){return this.privSpeechProperties}close(){}setServiceProperty(e,t){const i=JSON.parse(this.privSpeechProperties.getProperty(r.ServicePropertiesPropertyName,"{}"));i[e]=t,this.privSpeechProperties.setProperty(r.ServicePropertiesPropertyName,JSON.stringify(i))}setProfanity(e){this.privSpeechProperties.setProperty(o.PropertyId.SpeechServiceResponse_ProfanityOption,p.ProfanityOption[e])}enableAudioLogging(){this.privSpeechProperties.setProperty(o.PropertyId.SpeechServiceConnection_EnableAudioLogging,"true")}requestWordLevelTimestamps(){this.privSpeechProperties.setProperty(o.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,"true")}enableDictation(){this.privSpeechProperties.setProperty(r.ForceDictationPropertyName,"true")}get speechSynthesisLanguage(){return this.privSpeechProperties.getProperty(o.PropertyId.SpeechServiceConnection_SynthLanguage)}set speechSynthesisLanguage(e){this.privSpeechProperties.setProperty(o.PropertyId.SpeechServiceConnection_SynthLanguage,e)}get speechSynthesisVoiceName(){return this.privSpeechProperties.getProperty(o.PropertyId.SpeechServiceConnection_SynthVoice)}set speechSynthesisVoiceName(e){this.privSpeechProperties.setProperty(o.PropertyId.SpeechServiceConnection_SynthVoice,e)}get speechSynthesisOutputFormat(){return h.SpeechSynthesisOutputFormat[this.privSpeechProperties.getProperty(o.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0)]}set speechSynthesisOutputFormat(e){this.privSpeechProperties.setProperty(o.PropertyId.SpeechServiceConnection_SynthOutputFormat,h.SpeechSynthesisOutputFormat[e])}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SpeechRecognizer:()=>v});var r=i(102),n=i(61),s=i(92),o=i(116),a=i(18),c=i(36),p=i(143),h=i(59),d=i(44),u=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class v extends p.Recognizer{constructor(e,t){const i=e;c.Contracts.throwIfNull(i,"speechConfig"),c.Contracts.throwIfNullOrWhitespace(i.properties.getProperty(h.PropertyId.SpeechServiceConnection_RecoLanguage),h.PropertyId[h.PropertyId.SpeechServiceConnection_RecoLanguage]),super(t,i.properties,new r.SpeechConnectionFactory),this.privDisposedRecognizer=!1}static FromConfig(e,t,i){const r=e;t.properties.mergeTo(r.properties);return new v(e,i)}get endpointId(){return c.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(h.PropertyId.SpeechServiceConnection_EndpointId,"00000000-0000-0000-0000-000000000000")}get authorizationToken(){return this.properties.getProperty(h.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(e){c.Contracts.throwIfNullOrWhitespace(e,"token"),this.properties.setProperty(h.PropertyId.SpeechServiceAuthorization_Token,e)}get speechRecognitionLanguage(){return c.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(h.PropertyId.SpeechServiceConnection_RecoLanguage)}get outputFormat(){return c.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(n.OutputFormatPropertyName,d.OutputFormat[d.OutputFormat.Simple])===d.OutputFormat[d.OutputFormat.Simple]?d.OutputFormat.Simple:d.OutputFormat.Detailed}get properties(){return this.privProperties}recognizeOnceAsync(e,t){(0,a.marshalPromiseToCallbacks)(this.recognizeOnceAsyncImpl(s.RecognitionMode.Interactive),e,t)}startContinuousRecognitionAsync(e,t){(0,a.marshalPromiseToCallbacks)(this.startContinuousRecognitionAsyncImpl(s.RecognitionMode.Conversation),e,t)}stopContinuousRecognitionAsync(e,t){(0,a.marshalPromiseToCallbacks)(this.stopContinuousRecognitionAsyncImpl(),e,t)}startKeywordRecognitionAsync(e,t,i){c.Contracts.throwIfNull(e,"model"),i&&i("Not yet implemented.")}stopKeywordRecognitionAsync(e){e&&e()}close(e,t){c.Contracts.throwIfDisposed(this.privDisposedRecognizer),(0,a.marshalPromiseToCallbacks)(this.dispose(!0),e,t)}dispose(e){const t=Object.create(null,{dispose:{get:()=>super.dispose}});return u(this,void 0,void 0,(function*(){this.privDisposedRecognizer||(e&&(this.privDisposedRecognizer=!0,yield this.implRecognizerStop()),yield t.dispose.call(this,e))}))}createRecognizerConfig(e){return new s.RecognizerConfig(e,this.privProperties)}createServiceRecognizer(e,t,i,r){const n=i;return new o.SpeechServiceRecognizer(e,t,n,r,this)}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{IntentRecognizer:()=>u});var r=i(66),n=i(92),s=i(122),o=i(123),a=i(18),c=i(36),p=i(143),h=i(59),d=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class u extends p.Recognizer{constructor(e,t){c.Contracts.throwIfNullOrUndefined(e,"speechConfig");const i=e;c.Contracts.throwIfNullOrUndefined(i,"speechConfig"),super(t,i.properties,new r.IntentConnectionFactory),this.privAddedIntents=[],this.privAddedLmIntents={},this.privDisposedIntentRecognizer=!1,this.privProperties=i.properties,c.Contracts.throwIfNullOrWhitespace(this.properties.getProperty(h.PropertyId.SpeechServiceConnection_RecoLanguage),h.PropertyId[h.PropertyId.SpeechServiceConnection_RecoLanguage])}get speechRecognitionLanguage(){return c.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),this.properties.getProperty(h.PropertyId.SpeechServiceConnection_RecoLanguage)}get authorizationToken(){return this.properties.getProperty(h.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(e){this.properties.setProperty(h.PropertyId.SpeechServiceAuthorization_Token,e)}get properties(){return this.privProperties}recognizeOnceAsync(e,t){if(c.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),0!==Object.keys(this.privAddedLmIntents).length||void 0!==this.privUmbrellaIntent){const e=this.buildSpeechContext();this.privReco.speechContext.setSection("intent",e.Intent),this.privReco.dynamicGrammar.addReferenceGrammar(e.ReferenceGrammars);this.privReco.setIntents(this.privAddedLmIntents,this.privUmbrellaIntent)}(0,a.marshalPromiseToCallbacks)(this.recognizeOnceAsyncImpl(n.RecognitionMode.Interactive),e,t)}startContinuousRecognitionAsync(e,t){if(0!==Object.keys(this.privAddedLmIntents).length||void 0!==this.privUmbrellaIntent){const e=this.buildSpeechContext();this.privReco.speechContext.setSection("intent",e.Intent),this.privReco.dynamicGrammar.addReferenceGrammar(e.ReferenceGrammars);this.privReco.setIntents(this.privAddedLmIntents,this.privUmbrellaIntent)}(0,a.marshalPromiseToCallbacks)(this.startContinuousRecognitionAsyncImpl(n.RecognitionMode.Conversation),e,t)}stopContinuousRecognitionAsync(e,t){(0,a.marshalPromiseToCallbacks)(this.stopContinuousRecognitionAsyncImpl(),e,t)}startKeywordRecognitionAsync(e,t,i){c.Contracts.throwIfNull(e,"model"),i&&i("Not yet implemented.")}stopKeywordRecognitionAsync(e,t){if(e)try{e()}catch(e){t&&t(e)}}addIntent(e,t){c.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),c.Contracts.throwIfNullOrWhitespace(t,"intentId"),c.Contracts.throwIfNullOrWhitespace(e,"simplePhrase"),this.privAddedIntents.push([t,e])}addIntentWithLanguageModel(e,t,i){c.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),c.Contracts.throwIfNullOrWhitespace(e,"intentId"),c.Contracts.throwIfNull(t,"model");const r=t;c.Contracts.throwIfNullOrWhitespace(r.appId,"model.appId"),this.privAddedLmIntents[e]=new s.AddedLmIntent(r,i)}addAllIntents(e,t){c.Contracts.throwIfNull(e,"model");const i=e;c.Contracts.throwIfNullOrWhitespace(i.appId,"model.appId"),this.privUmbrellaIntent=new s.AddedLmIntent(i,t)}close(e,t){c.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),(0,a.marshalPromiseToCallbacks)(this.dispose(!0),e,t)}createRecognizerConfig(e){return new n.RecognizerConfig(e,this.privProperties)}createServiceRecognizer(e,t,i,r){const n=i;return new o.IntentServiceRecognizer(e,t,n,r,this)}dispose(e){const t=Object.create(null,{dispose:{get:()=>super.dispose}});return d(this,void 0,void 0,(function*(){this.privDisposedIntentRecognizer||e&&(this.privDisposedIntentRecognizer=!0,yield t.dispose.call(this,e))}))}buildSpeechContext(){let e,t,i;const r=[];void 0!==this.privUmbrellaIntent&&(e=this.privUmbrellaIntent.modelImpl.appId,t=this.privUmbrellaIntent.modelImpl.region,i=this.privUmbrellaIntent.modelImpl.subscriptionKey);for(const n of Object.keys(this.privAddedLmIntents)){const s=this.privAddedLmIntents[n];if(void 0===e)e=s.modelImpl.appId;else if(e!==s.modelImpl.appId)throw new Error("Intents must all be from the same LUIS model");if(void 0===t)t=s.modelImpl.region;else if(t!==s.modelImpl.region)throw new Error("Intents must all be from the same LUIS model in a single region");if(void 0===i)i=s.modelImpl.subscriptionKey;else if(i!==s.modelImpl.subscriptionKey)throw new Error("Intents must all use the same subscription key");const o="luis/"+e+"-PRODUCTION#"+n;r.push(o)}return{Intent:{id:e,key:void 0===i?this.privProperties.getProperty(h.PropertyId[h.PropertyId.SpeechServiceConnection_Key]):i,provider:"LUIS"},ReferenceGrammars:void 0===this.privUmbrellaIntent?r:["luis/"+e+"-PRODUCTION"]}}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{TranslationRecognizer:()=>u});var r=i(105),n=i(92),s=i(112),o=i(18),a=i(147),c=i(36),p=i(143),h=i(59),d=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class u extends p.Recognizer{constructor(e,t,i){const n=e;c.Contracts.throwIfNull(n,"speechConfig"),super(t,n.properties,i||new r.TranslationConnectionFactory),this.privDisposedTranslationRecognizer=!1,void 0!==this.properties.getProperty(h.PropertyId.SpeechServiceConnection_TranslationVoice,void 0)&&c.Contracts.throwIfNullOrWhitespace(this.properties.getProperty(h.PropertyId.SpeechServiceConnection_TranslationVoice),h.PropertyId[h.PropertyId.SpeechServiceConnection_TranslationVoice]),c.Contracts.throwIfNullOrWhitespace(this.properties.getProperty(h.PropertyId.SpeechServiceConnection_TranslationToLanguages),h.PropertyId[h.PropertyId.SpeechServiceConnection_TranslationToLanguages]),c.Contracts.throwIfNullOrWhitespace(this.properties.getProperty(h.PropertyId.SpeechServiceConnection_RecoLanguage),h.PropertyId[h.PropertyId.SpeechServiceConnection_RecoLanguage])}static FromConfig(e,t,i){const r=e;return t.properties.mergeTo(r.properties),new u(e,i)}get speechRecognitionLanguage(){return c.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),this.properties.getProperty(h.PropertyId.SpeechServiceConnection_RecoLanguage)}get targetLanguages(){return c.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),this.properties.getProperty(h.PropertyId.SpeechServiceConnection_TranslationToLanguages).split(",")}get voiceName(){return c.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),this.properties.getProperty(h.PropertyId.SpeechServiceConnection_TranslationVoice,void 0)}get properties(){return this.privProperties}get authorizationToken(){return this.properties.getProperty(h.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(e){this.properties.setProperty(h.PropertyId.SpeechServiceAuthorization_Token,e)}recognizeOnceAsync(e,t){c.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),(0,o.marshalPromiseToCallbacks)(this.recognizeOnceAsyncImpl(n.RecognitionMode.Interactive),e,t)}startContinuousRecognitionAsync(e,t){(0,o.marshalPromiseToCallbacks)(this.startContinuousRecognitionAsyncImpl(n.RecognitionMode.Conversation),e,t)}stopContinuousRecognitionAsync(e,t){(0,o.marshalPromiseToCallbacks)(this.stopContinuousRecognitionAsyncImpl(),e,t)}removeTargetLanguage(e){if(c.Contracts.throwIfNullOrUndefined(e,"language to be removed"),void 0!==this.properties.getProperty(h.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0)){const t=this.properties.getProperty(h.PropertyId.SpeechServiceConnection_TranslationToLanguages).split(","),i=t.indexOf(e);i>-1&&(t.splice(i,1),this.properties.setProperty(h.PropertyId.SpeechServiceConnection_TranslationToLanguages,t.join(",")),this.updateLanguages(t))}}addTargetLanguage(e){c.Contracts.throwIfNullOrUndefined(e,"language to be added");let t=[];void 0!==this.properties.getProperty(h.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0)?(t=this.properties.getProperty(h.PropertyId.SpeechServiceConnection_TranslationToLanguages).split(","),t.includes(e)||(t.push(e),this.properties.setProperty(h.PropertyId.SpeechServiceConnection_TranslationToLanguages,t.join(",")))):(this.properties.setProperty(h.PropertyId.SpeechServiceConnection_TranslationToLanguages,e),t=[e]),this.updateLanguages(t)}close(e,t){c.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),(0,o.marshalPromiseToCallbacks)(this.dispose(!0),e,t)}onConnection(){}dispose(e){const t=Object.create(null,{dispose:{get:()=>super.dispose}});return d(this,void 0,void 0,(function*(){this.privDisposedTranslationRecognizer||(this.privDisposedTranslationRecognizer=!0,e&&(yield this.implRecognizerStop(),yield t.dispose.call(this,e)))}))}createRecognizerConfig(e){return new n.RecognizerConfig(e,this.privProperties)}createServiceRecognizer(e,t,i,r){const n=i;return new s.TranslationServiceRecognizer(e,t,n,r,this)}updateLanguages(e){const t=a.Connection.fromRecognizer(this);t&&(t.setMessageProperty("speech.context","translationcontext",{to:e}),t.sendMessageAsync("event",JSON.stringify({id:"translation",name:"updateLanguage",to:e})))}}},(e,t,i)=>{"use strict";var r;i.r(t),i.d(t,{NoMatchReason:()=>r}),function(e){e[e.NotRecognized=0]="NotRecognized",e[e.InitialSilenceTimeout=1]="InitialSilenceTimeout",e[e.InitialBabbleTimeout=2]="InitialBabbleTimeout"}(r||(r={}))},(e,t,i)=>{"use strict";i.r(t),i.d(t,{NoMatchDetails:()=>o});var r=i(97),n=i(98),s=i(194);class o{constructor(e){this.privReason=e}static fromResult(e){const t=r.SimpleSpeechPhrase.fromJSON(e.json);let i=s.NoMatchReason.NotRecognized;switch(t.RecognitionStatus){case n.RecognitionStatus.BabbleTimeout:i=s.NoMatchReason.InitialBabbleTimeout;break;case n.RecognitionStatus.InitialSilenceTimeout:i=s.NoMatchReason.InitialSilenceTimeout;break;default:i=s.NoMatchReason.NotRecognized}return new o(i)}get reason(){return this.privReason}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{CancellationDetails:()=>h});var r=i(97),n=i(99),s=i(61),o=i(182),a=i(40),c=i(91),p=i(46);class h extends o.CancellationDetailsBase{constructor(e,t,i){super(e,t,i)}static fromResult(e){let t=a.CancellationReason.Error,i=c.CancellationErrorCode.NoError;if(e instanceof p.RecognitionResult&&e.json){const i=r.SimpleSpeechPhrase.fromJSON(e.json);t=n.EnumTranslation.implTranslateCancelResult(i.RecognitionStatus)}return e.properties&&(i=c.CancellationErrorCode[e.properties.getProperty(s.CancellationErrorCodePropertyName,c.CancellationErrorCode[c.CancellationErrorCode.NoError])]),new h(t,e.errorDetails||n.EnumTranslation.implTranslateErrorDetails(i),i)}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{PhraseListGrammar:()=>r});class r{constructor(e){this.privGrammerBuilder=e.dynamicGrammar}static fromRecognizer(e){const t=e.internalData;return new r(t)}addPhrase(e){this.privGrammerBuilder.addPhrase(e)}addPhrases(e){this.privGrammerBuilder.addPhrase(e)}clear(){this.privGrammerBuilder.clearPhrases()}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{BotFrameworkConfig:()=>o});var r=i(36),n=i(130),s=i(59);class o extends n.DialogServiceConfigImpl{constructor(){super()}static fromSubscription(e,t,i){r.Contracts.throwIfNullOrWhitespace(e,"subscription"),r.Contracts.throwIfNullOrWhitespace(t,"region");const o=new n.DialogServiceConfigImpl;return o.setProperty(s.PropertyId.Conversation_DialogType,n.DialogServiceConfig.DialogTypes.BotFramework),o.setProperty(s.PropertyId.SpeechServiceConnection_Key,e),o.setProperty(s.PropertyId.SpeechServiceConnection_Region,t),i&&o.setProperty(s.PropertyId.Conversation_ApplicationId,i),o}static fromAuthorizationToken(e,t,i){r.Contracts.throwIfNullOrWhitespace(e,"authorizationToken"),r.Contracts.throwIfNullOrWhitespace(t,"region");const o=new n.DialogServiceConfigImpl;return o.setProperty(s.PropertyId.Conversation_DialogType,n.DialogServiceConfig.DialogTypes.BotFramework),o.setProperty(s.PropertyId.SpeechServiceAuthorization_Token,e),o.setProperty(s.PropertyId.SpeechServiceConnection_Region,t),i&&o.setProperty(s.PropertyId.Conversation_ApplicationId,i),o}static fromHost(e,t,i){r.Contracts.throwIfNullOrUndefined(e,"host");const o=e instanceof URL?e:new URL(`wss://${e}.convai.speech.azure.us`);r.Contracts.throwIfNullOrUndefined(o,"resolvedHost");const a=new n.DialogServiceConfigImpl;return a.setProperty(s.PropertyId.Conversation_DialogType,n.DialogServiceConfig.DialogTypes.BotFramework),a.setProperty(s.PropertyId.SpeechServiceConnection_Host,o.toString()),void 0!==t&&a.setProperty(s.PropertyId.SpeechServiceConnection_Key,t),a}static fromEndpoint(e,t){r.Contracts.throwIfNull(e,"endpoint");const i=new n.DialogServiceConfigImpl;return i.setProperty(s.PropertyId.Conversation_DialogType,n.DialogServiceConfig.DialogTypes.BotFramework),i.setProperty(s.PropertyId.SpeechServiceConnection_Endpoint,e.toString()),void 0!==t&&i.setProperty(s.PropertyId.SpeechServiceConnection_Key,t),i}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{CustomCommandsConfig:()=>o});var r=i(36),n=i(130),s=i(59);class o extends n.DialogServiceConfigImpl{constructor(){super()}static fromSubscription(e,t,i){r.Contracts.throwIfNullOrWhitespace(e,"applicationId"),r.Contracts.throwIfNullOrWhitespace(t,"subscription"),r.Contracts.throwIfNullOrWhitespace(i,"region");const o=new n.DialogServiceConfigImpl;return o.setProperty(s.PropertyId.Conversation_DialogType,n.DialogServiceConfig.DialogTypes.CustomCommands),o.setProperty(s.PropertyId.Conversation_ApplicationId,e),o.setProperty(s.PropertyId.SpeechServiceConnection_Key,t),o.setProperty(s.PropertyId.SpeechServiceConnection_Region,i),o}static fromAuthorizationToken(e,t,i){r.Contracts.throwIfNullOrWhitespace(e,"applicationId"),r.Contracts.throwIfNullOrWhitespace(t,"authorizationToken"),r.Contracts.throwIfNullOrWhitespace(i,"region");const o=new n.DialogServiceConfigImpl;return o.setProperty(s.PropertyId.Conversation_DialogType,n.DialogServiceConfig.DialogTypes.CustomCommands),o.setProperty(s.PropertyId.Conversation_ApplicationId,e),o.setProperty(s.PropertyId.SpeechServiceAuthorization_Token,t),o.setProperty(s.PropertyId.SpeechServiceConnection_Region,i),o}set applicationId(e){r.Contracts.throwIfNullOrWhitespace(e,"value"),this.setProperty(s.PropertyId.Conversation_ApplicationId,e)}get applicationId(){return this.getProperty(s.PropertyId.Conversation_ApplicationId)}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{DialogServiceConnector:()=>d});var r=i(201),n=i(92),s=i(126),o=i(18),a=i(36),c=i(143),p=i(59),h=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class d extends c.Recognizer{constructor(e,t){const i=e;a.Contracts.throwIfNull(e,"dialogConfig"),super(t,i.properties,new r.DialogConnectionFactory),this.isTurnComplete=!0,this.privIsDisposed=!1,this.privProperties=i.properties.clone();const n=this.buildAgentConfig();this.privReco.agentConfig.set(n)}connect(e,t){(0,o.marshalPromiseToCallbacks)(this.privReco.connect(),e,t)}disconnect(e,t){(0,o.marshalPromiseToCallbacks)(this.privReco.disconnect(),e,t)}get authorizationToken(){return this.properties.getProperty(p.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(e){a.Contracts.throwIfNullOrWhitespace(e,"token"),this.properties.setProperty(p.PropertyId.SpeechServiceAuthorization_Token,e)}get properties(){return this.privProperties}get speechActivityTemplate(){return this.properties.getProperty(p.PropertyId.Conversation_Speech_Activity_Template)}set speechActivityTemplate(e){this.properties.setProperty(p.PropertyId.Conversation_Speech_Activity_Template,e)}listenOnceAsync(e,t){if(this.isTurnComplete){a.Contracts.throwIfDisposed(this.privIsDisposed);const i=(()=>h(this,void 0,void 0,(function*(){yield this.privReco.connect(),yield this.implRecognizerStop(),this.isTurnComplete=!1;const e=new o.Deferred;yield this.privReco.recognize(n.RecognitionMode.Conversation,e.resolve,e.reject);const t=yield e.promise;return yield this.implRecognizerStop(),t})))();i.catch((()=>{this.dispose(!0).catch((()=>{}))})),(0,o.marshalPromiseToCallbacks)(i.finally((()=>{this.isTurnComplete=!0})),e,t)}}sendActivityAsync(e,t,i){(0,o.marshalPromiseToCallbacks)(this.privReco.sendMessage(e),t,i)}close(e,t){a.Contracts.throwIfDisposed(this.privIsDisposed),(0,o.marshalPromiseToCallbacks)(this.dispose(!0),e,t)}dispose(e){const t=Object.create(null,{dispose:{get:()=>super.dispose}});return h(this,void 0,void 0,(function*(){this.privIsDisposed||e&&(this.privIsDisposed=!0,yield this.implRecognizerStop(),yield t.dispose.call(this,e))}))}createRecognizerConfig(e){return new n.RecognizerConfig(e,this.privProperties)}createServiceRecognizer(e,t,i,r){const n=i;return new s.DialogServiceAdapter(e,t,n,r,this)}buildAgentConfig(){return{botInfo:{commType:this.properties.getProperty("Conversation_Communication_Type","Default"),commandsCulture:void 0,connectionId:this.properties.getProperty(p.PropertyId.Conversation_Agent_Connection_Id),conversationId:this.properties.getProperty(p.PropertyId.Conversation_Conversation_Id,void 0),fromId:this.properties.getProperty(p.PropertyId.Conversation_From_Id,void 0),ttsAudioFormat:this.properties.getProperty(p.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0)},version:.2}}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{DialogConnectionFactory:()=>v});var r=i(69),n=i(82),s=i(61),o=i(59),a=i(44),c=i(130),p=i(67),h=i(81),d=i(64),u=i(68);class v extends p.ConnectionFactoryBase{create(e,t,i){const l=e.parameters.getProperty(o.PropertyId.Conversation_ApplicationId,""),g=e.parameters.getProperty(o.PropertyId.Conversation_DialogType),m=e.parameters.getProperty(o.PropertyId.SpeechServiceConnection_Region),S=e.parameters.getProperty(o.PropertyId.SpeechServiceConnection_RecoLanguage,"en-US"),f=e.parameters.getProperty(o.PropertyId.Conversation_Request_Bot_Status_Messages,"true"),C={};C[d.HeaderNames.ConnectionId]=i,C[u.QueryParameterNames.Format]=e.parameters.getProperty(s.OutputFormatPropertyName,a.OutputFormat[a.OutputFormat.Simple]).toLowerCase(),C[u.QueryParameterNames.Language]=S,C[u.QueryParameterNames.RequestBotStatusMessages]=f,l&&(C[u.QueryParameterNames.BotId]=l,g===c.DialogServiceConfig.DialogTypes.CustomCommands&&(C[d.HeaderNames.CustomCommandsAppId]=l));const y=g===c.DialogServiceConfig.DialogTypes.CustomCommands?"commands/":"",R=g===c.DialogServiceConfig.DialogTypes.CustomCommands?"v1":g===c.DialogServiceConfig.DialogTypes.BotFramework?"v3":"v0",P={};null!=t.token&&""!==t.token&&(P[t.headerName]=t.token);let I=e.parameters.getProperty(o.PropertyId.SpeechServiceConnection_Endpoint,"");if(!I){const t=p.ConnectionFactoryBase.getHostSuffix(m),i=e.parameters.getProperty(o.PropertyId.SpeechServiceConnection_Host,`wss://${m}.${v.BaseUrl}${t}`);I=`${i.endsWith("/")?i:i+"/"}${y}${v.ApiKey}/${R}`}this.setCommonUrlParams(e,C,I);const T="true"===e.parameters.getProperty("SPEECH-EnableWebsocketCompression","false");return new r.WebsocketConnection(I,C,P,new h.WebsocketMessageFormatter,n.ProxyInfo.fromRecognizerConfig(e),T,i)}}v.ApiKey="api",v.BaseUrl="convai.speech"},(e,t,i)=>{"use strict";var r;i.r(t),i.d(t,{ServicePropertyChannel:()=>r}),function(e){e[e.UriQueryParameter=0]="UriQueryParameter"}(r||(r={}))},(e,t,i)=>{"use strict";i.r(t),i.d(t,{BaseAudioPlayer:()=>o});var r=i(17),n=i(27),s=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class o{constructor(e){this.audioContext=null,this.gainNode=null,this.autoUpdateBufferTimer=0,void 0===e&&(e=n.AudioStreamFormat.getDefaultInputFormat()),this.init(e)}playAudioSample(e,t,i){try{this.ensureInitializedContext();const i=this.formatAudioData(e),r=new Float32Array(this.samples.length+i.length);r.set(this.samples,0),r.set(i,this.samples.length),this.samples=r,t&&t()}catch(e){i&&i(e)}}stopAudio(e,t){null!==this.audioContext&&(this.samples=new Float32Array,clearInterval(this.autoUpdateBufferTimer),this.audioContext.close().then((()=>{e&&e()}),(e=>{t&&t(e)})),this.audioContext=null)}init(e){this.audioFormat=e,this.samples=new Float32Array}ensureInitializedContext(){if(null===this.audioContext){this.createAudioContext();const e=200;this.autoUpdateBufferTimer=setInterval((()=>{this.updateAudioBuffer()}),e)}}createAudioContext(){this.audioContext=n.AudioStreamFormatImpl.getAudioContext(),this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=1,this.gainNode.connect(this.audioContext.destination),this.startTime=this.audioContext.currentTime}formatAudioData(e){switch(this.audioFormat.bitsPerSample){case 8:return this.formatArrayBuffer(new Int8Array(e),128);case 16:return this.formatArrayBuffer(new Int16Array(e),32768);case 32:return this.formatArrayBuffer(new Int32Array(e),2147483648);default:throw new r.InvalidOperationError("Only WAVE_FORMAT_PCM (8/16/32 bps) format supported at this time")}}formatArrayBuffer(e,t){const i=new Float32Array(e.length);for(let r=0;r<e.length;r++)i[r]=e[r]/t;return i}updateAudioBuffer(){if(0===this.samples.length)return;const e=this.audioFormat.channels,t=this.audioContext.createBufferSource(),i=this.samples.length/e,r=this.audioContext.createBuffer(e,i,this.audioFormat.samplesPerSec);for(let t=0;t<e;t++){let i=t;const n=r.getChannelData(t);for(let t=0;t<this.samples.length;t++,i+=e)n[t]=this.samples[i]}this.startTime<this.audioContext.currentTime&&(this.startTime=this.audioContext.currentTime),t.buffer=r,t.connect(this.gainNode),t.start(this.startTime),this.startTime+=r.duration,this.samples=new Float32Array}playAudio(e){return s(this,void 0,void 0,(function*(){null===this.audioContext&&this.createAudioContext();const t=this.audioContext.createBufferSource(),i=this.audioContext.destination;yield this.audioContext.decodeAudioData(e,(e=>{t.buffer=e,t.connect(i),t.start(0)}))}))}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{VoiceProfile:()=>r});class r{constructor(e,t){this.privId=e,this.privProfileType=t}get profileId(){return this.privId}get profileType(){return this.privProfileType}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{VoiceProfileClient:()=>g});var r=i(83),n=i(183),s=i(92),o=i(4),a=i(36),c=i(143),p=i(30),h=i(59),d=i(204),u=i(188),v=i(57),l=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class g extends c.Recognizer{constructor(e){a.Contracts.throwIfNullOrUndefined(e,"speechConfig");const t=e;a.Contracts.throwIfNull(t,"speechConfig"),super(o.AudioConfig.fromStreamInput(p.AudioInputStream.createPushStream()),t.properties,new r.VoiceProfileConnectionFactory),this.privProperties=t.properties.clone(),this.privVoiceAdapter=this.privReco,this.privDisposedVoiceAdapter=!1}get properties(){return this.privProperties}get authorizationToken(){return this.properties.getProperty(h.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(e){a.Contracts.throwIfNullOrWhitespace(e,"token"),this.properties.setProperty(h.PropertyId.SpeechServiceAuthorization_Token,e)}createProfileAsync(e,t){return l(this,void 0,void 0,(function*(){const i=yield this.privVoiceAdapter.createProfile(e,t);return new d.VoiceProfile(i[0],e)}))}retrieveEnrollmentResultAsync(e){return l(this,void 0,void 0,(function*(){return this.privVoiceAdapter.retrieveEnrollmentResult(e)}))}getAllProfilesAsync(e){return l(this,void 0,void 0,(function*(){return this.privVoiceAdapter.getAllProfiles(e)}))}getActivationPhrasesAsync(e,t){return l(this,void 0,void 0,(function*(){return this.privVoiceAdapter.getActivationPhrases(e,t)}))}enrollProfileAsync(e,t){return l(this,void 0,void 0,(function*(){const i=t;return a.Contracts.throwIfNullOrUndefined(i,"audioConfig"),this.audioConfig=t,this.privVoiceAdapter.SpeakerAudioSource=i,this.privVoiceAdapter.enrollProfile(e)}))}deleteProfileAsync(e){return l(this,void 0,void 0,(function*(){return this.privVoiceAdapter.deleteProfile(e)}))}resetProfileAsync(e){return l(this,void 0,void 0,(function*(){return this.privVoiceAdapter.resetProfile(e)}))}close(){return l(this,void 0,void 0,(function*(){yield this.dispose(!0)}))}createServiceRecognizer(e,t,i,r){const s=i;return new n.VoiceServiceRecognizer(e,t,s,r,this)}dispose(e){const t=Object.create(null,{dispose:{get:()=>super.dispose}});return l(this,void 0,void 0,(function*(){this.privDisposedVoiceAdapter||(this.privDisposedVoiceAdapter=!0,e&&(yield t.dispose.call(this,e)))}))}createRecognizerConfig(e){return new s.RecognizerConfig(e,this.properties)}getResult(e,t){return new u.VoiceProfileResult(e.ok?t:v.ResultReason.Canceled,e.statusText)}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SpeakerRecognizer:()=>h});var r=i(83),n=i(92),s=i(180),o=i(36),a=i(143),c=i(59),p=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class h extends a.Recognizer{constructor(e,t){o.Contracts.throwIfNullOrUndefined(e,"speechConfig");const i=e;o.Contracts.throwIfNullOrUndefined(i,"speechConfig"),super(t,i.properties,new r.SpeakerRecognitionConnectionFactory),this.privAudioConfigImpl=t,o.Contracts.throwIfNull(this.privAudioConfigImpl,"audioConfig"),this.privDisposedSpeakerRecognizer=!1,this.privProperties=i.properties}get authorizationToken(){return this.properties.getProperty(c.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(e){o.Contracts.throwIfNullOrWhitespace(e,"token"),this.properties.setProperty(c.PropertyId.SpeechServiceAuthorization_Token,e)}get properties(){return this.privProperties}recognizeOnceAsync(e){return p(this,void 0,void 0,(function*(){return o.Contracts.throwIfDisposed(this.privDisposedSpeakerRecognizer),this.recognizeSpeakerOnceAsyncImpl(e)}))}close(){return p(this,void 0,void 0,(function*(){o.Contracts.throwIfDisposed(this.privDisposedSpeakerRecognizer),yield this.dispose(!0)}))}recognizeSpeakerOnceAsyncImpl(e){return p(this,void 0,void 0,(function*(){o.Contracts.throwIfDisposed(this.privDisposedSpeakerRecognizer),yield this.implRecognizerStop();const t=yield this.privReco.recognizeSpeaker(e);return yield this.implRecognizerStop(),t}))}implRecognizerStop(){return p(this,void 0,void 0,(function*(){this.privReco&&(yield this.privReco.stopRecognizing())}))}createRecognizerConfig(e){return new n.RecognizerConfig(e,this.privProperties)}createServiceRecognizer(e,t,i,r){const n=i;return new s.SpeakerServiceRecognizer(e,t,n,r,this)}dispose(e){const t=Object.create(null,{dispose:{get:()=>super.dispose}});return p(this,void 0,void 0,(function*(){this.privDisposedSpeakerRecognizer||e&&(this.privDisposedSpeakerRecognizer=!0,yield t.dispose.call(this,e))}))}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SpeakerIdentificationModel:()=>s});var r=i(36),n=i(186);class s{constructor(e){if(this.privVoiceProfiles=[],this.privProfileIds=[],r.Contracts.throwIfNullOrUndefined(e,"VoiceProfiles"),0===e.length)throw new Error("Empty Voice Profiles array");for(const t of e){if(t.profileType!==n.VoiceProfileType.TextIndependentIdentification)throw new Error("Identification model can only be created from Identification profile: "+t.profileId);this.privVoiceProfiles.push(t),this.privProfileIds.push(t.profileId)}}static fromProfiles(e){return new s(e)}get voiceProfileIds(){return this.privProfileIds.join(",")}get profileIds(){return this.privProfileIds}get scenario(){return"TextIndependentIdentification"}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SpeakerVerificationModel:()=>s});var r=i(36),n=i(186);class s{constructor(e){if(r.Contracts.throwIfNullOrUndefined(e,"VoiceProfile"),e.profileType===n.VoiceProfileType.TextIndependentIdentification)throw new Error("Verification model cannot be created from Identification profile");this.privVoiceProfile=e}static fromProfile(e){return new s(e)}get voiceProfile(){return this.privVoiceProfile}get profileIds(){return[this.voiceProfile.profileId]}get scenario(){return this.voiceProfile.profileType===n.VoiceProfileType.TextDependentVerification?"TextDependentVerification":"TextIndependentVerification"}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{AutoDetectSourceLanguageConfig:()=>c});var r=i(61),n=i(36),s=i(60),o=i(59),a=i(210);class c{constructor(){this.privProperties=new s.PropertyCollection,this.privProperties.setProperty(o.PropertyId.SpeechServiceConnection_LanguageIdMode,"AtStart"),this.privLanguageIdMode=a.LanguageIdMode.AtStart}static fromOpenRange(){const e=new c;return e.properties.setProperty(o.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,r.AutoDetectSourceLanguagesOpenRangeOptionName),e}static fromLanguages(e){n.Contracts.throwIfArrayEmptyOrWhitespace(e,"languages");const t=new c;return t.properties.setProperty(o.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,e.join()),t}static fromSourceLanguageConfigs(e){if(e.length<1)throw new Error("Expected non-empty SourceLanguageConfig array.");const t=new c,i=[];return e.forEach((e=>{if(i.push(e.language),void 0!==e.endpointId&&""!==e.endpointId){const i=e.language+o.PropertyId.SpeechServiceConnection_EndpointId.toString();t.properties.setProperty(i,e.endpointId)}})),t.properties.setProperty(o.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,i.join()),t}get properties(){return this.privProperties}set mode(e){e===a.LanguageIdMode.Continuous?(this.privProperties.setProperty(o.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,"2"),this.privProperties.setProperty(o.PropertyId.SpeechServiceConnection_LanguageIdMode,"Continuous")):(this.privProperties.setProperty(o.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,"1"),this.privProperties.setProperty(o.PropertyId.SpeechServiceConnection_LanguageIdMode,"AtStart")),this.privLanguageIdMode=e}}},(e,t,i)=>{"use strict";var r;i.r(t),i.d(t,{LanguageIdMode:()=>r}),function(e){e[e.AtStart=0]="AtStart",e[e.Continuous=1]="Continuous"}(r||(r={}))},(e,t,i)=>{"use strict";i.r(t),i.d(t,{AutoDetectSourceLanguageResult:()=>n});var r=i(36);class n{constructor(e,t){r.Contracts.throwIfNullOrUndefined(e,"language"),r.Contracts.throwIfNullOrUndefined(t,"languageDetectionConfidence"),this.privLanguage=e,this.privLanguageDetectionConfidence=t}static fromResult(e){return new n(e.language,e.languageDetectionConfidence)}static fromConversationTranscriptionResult(e){return new n(e.language,e.languageDetectionConfidence)}get language(){return this.privLanguage}get languageDetectionConfidence(){return this.privLanguageDetectionConfidence}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SourceLanguageConfig:()=>n});var r=i(36);class n{constructor(e,t){r.Contracts.throwIfNullOrUndefined(e,"language"),this.privLanguage=e,this.privEndpointId=t}static fromLanguage(e,t){return new n(e,t)}get language(){return this.privLanguage}get endpointId(){return this.privEndpointId}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{Conversation:()=>S,ConversationImpl:()=>f});var r=i(137),n=i(168),s=i(136),o=i(142),a=i(18),c=i(36),p=i(59),h=i(214),d=i(215),u=i(216),v=i(60),l=i(189),g=i(217),m=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class S{constructor(){}static createConversationAsync(e,t,i,n){let s,o,h;return c.Contracts.throwIfNullOrUndefined(e,r.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","config")),c.Contracts.throwIfNullOrUndefined(e.region,r.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","SpeechServiceConnection_Region")),e.subscriptionKey||e.getProperty(p.PropertyId[p.PropertyId.SpeechServiceAuthorization_Token])||c.Contracts.throwIfNullOrUndefined(e.subscriptionKey,r.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","SpeechServiceConnection_Key")),"string"==typeof t?(s=new f(e,t),(0,a.marshalPromiseToCallbacks)((()=>m(this,void 0,void 0,(function*(){})))(),i,n)):(s=new f(e),o=t,h=i,s.createConversationAsync((()=>{o&&o()}),(e=>{h&&h(e)}))),s}}class f extends S{constructor(e,t){super(),this.privErrors=r.ConversationConnectionConfig.restErrors,this.onConnected=e=>{var t;this.privIsConnected=!0;try{(null===(t=this.privConversationTranslator)||void 0===t?void 0:t.sessionStarted)&&this.privConversationTranslator.sessionStarted(this.privConversationTranslator,e)}catch(e){}},this.onDisconnected=e=>{var t;try{(null===(t=this.privConversationTranslator)||void 0===t?void 0:t.sessionStopped)&&this.privConversationTranslator.sessionStopped(this.privConversationTranslator,e)}catch(e){}finally{this.close(!1)}},this.onCanceled=(e,t)=>{var i;try{(null===(i=this.privConversationTranslator)||void 0===i?void 0:i.canceled)&&this.privConversationTranslator.canceled(this.privConversationTranslator,t)}catch(t){}},this.onParticipantUpdateCommandReceived=(e,t)=>{try{const e=this.privParticipants.getParticipant(t.id);if(void 0!==e){switch(t.key){case n.ConversationTranslatorCommandTypes.changeNickname:e.displayName=t.value;break;case n.ConversationTranslatorCommandTypes.setUseTTS:e.isUsingTts=t.value;break;case n.ConversationTranslatorCommandTypes.setProfanityFiltering:e.profanity=t.value;break;case n.ConversationTranslatorCommandTypes.setMute:e.isMuted=t.value;break;case n.ConversationTranslatorCommandTypes.setTranslateToLanguages:e.translateToLanguages=t.value}this.privParticipants.addOrUpdateParticipant(e),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new h.ConversationParticipantsChangedEventArgs(d.ParticipantChangedReason.Updated,[this.toParticipant(e)],t.sessionId))}}catch(t){}},this.onLockRoomCommandReceived=()=>{},this.onMuteAllCommandReceived=(e,t)=>{try{this.privParticipants.participants.forEach((e=>e.isMuted=!e.isHost&&t.isMuted)),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new h.ConversationParticipantsChangedEventArgs(d.ParticipantChangedReason.Updated,this.toParticipants(!1),t.sessionId))}catch(t){}},this.onParticipantJoinCommandReceived=(e,t)=>{try{const e=this.privParticipants.addOrUpdateParticipant(t.participant);void 0!==e&&this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new h.ConversationParticipantsChangedEventArgs(d.ParticipantChangedReason.JoinedConversation,[this.toParticipant(e)],t.sessionId))}catch(t){}},this.onParticipantLeaveCommandReceived=(e,t)=>{try{const e=this.privParticipants.getParticipant(t.participant.id);void 0!==e&&(this.privParticipants.deleteParticipant(t.participant.id),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new h.ConversationParticipantsChangedEventArgs(d.ParticipantChangedReason.LeftConversation,[this.toParticipant(e)],t.sessionId)))}catch(t){}},this.onTranslationReceived=(e,t)=>{try{switch(t.command){case n.ConversationTranslatorMessageTypes.final:this.privConversationTranslator&&this.privConversationTranslator.transcribed(this.privConversationTranslator,new u.ConversationTranslationEventArgs(t.payload,void 0,t.sessionId));break;case n.ConversationTranslatorMessageTypes.partial:this.privConversationTranslator&&this.privConversationTranslator.transcribing(this.privConversationTranslator,new u.ConversationTranslationEventArgs(t.payload,void 0,t.sessionId));break;case n.ConversationTranslatorMessageTypes.instantMessage:this.privConversationTranslator&&this.privConversationTranslator.textMessageReceived(this.privConversationTranslator,new u.ConversationTranslationEventArgs(t.payload,void 0,t.sessionId))}}catch(t){}},this.onParticipantsListReceived=(e,t)=>{var i;try{if(void 0!==t.sessionToken&&null!==t.sessionToken&&(this.privRoom.token=t.sessionToken),this.privParticipants.participants=[...t.participants],void 0!==this.privParticipants.me&&(this.privIsReady=!0),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new h.ConversationParticipantsChangedEventArgs(d.ParticipantChangedReason.JoinedConversation,this.toParticipants(!0),t.sessionId)),this.me.isHost){const e=null===(i=this.privConversationTranslator)||void 0===i?void 0:i.properties.getProperty(p.PropertyId.ConversationTranslator_Name);void 0!==e&&e.length>0&&e!==this.me.displayName&&this.changeNicknameAsync(e)}}catch(t){}},this.onConversationExpiration=(e,t)=>{try{this.privConversationTranslator&&this.privConversationTranslator.conversationExpiration(this.privConversationTranslator,t)}catch(t){}},this.privIsConnected=!1,this.privIsDisposed=!1,this.privConversationId="",this.privProperties=new v.PropertyCollection,this.privManager=new s.ConversationManager;if(e.getProperty(p.PropertyId[p.PropertyId.SpeechServiceConnection_RecoLanguage])||e.setProperty(p.PropertyId[p.PropertyId.SpeechServiceConnection_RecoLanguage],r.ConversationConnectionConfig.defaultLanguageCode),this.privLanguage=e.getProperty(p.PropertyId[p.PropertyId.SpeechServiceConnection_RecoLanguage]),t)this.privConversationId=t;else{0===e.targetLanguages.length&&e.addTargetLanguage(this.privLanguage);e.getProperty(p.PropertyId[p.PropertyId.SpeechServiceResponse_ProfanityOption])||e.setProfanity(l.ProfanityOption.Masked);let t=e.getProperty(p.PropertyId[p.PropertyId.ConversationTranslator_Name]);null==t&&(t="Host"),c.Contracts.throwIfNullOrTooLong(t,"nickname",50),c.Contracts.throwIfNullOrTooShort(t,"nickname",2),e.setProperty(p.PropertyId[p.PropertyId.ConversationTranslator_Name],t)}this.privConfig=e;const i=e;c.Contracts.throwIfNull(i,"speechConfig"),this.privProperties=i.properties.clone(),this.privIsConnected=!1,this.privParticipants=new n.InternalParticipants,this.privIsReady=!1,this.privTextMessageMaxLength=1e3}get room(){return this.privRoom}get connection(){return this.privConversationRecognizer}get config(){return this.privConfig}get conversationId(){return this.privRoom?this.privRoom.roomId:this.privConversationId}get properties(){return this.privProperties}get speechRecognitionLanguage(){return this.privLanguage}get isMutedByHost(){var e,t;return!(null===(e=this.privParticipants.me)||void 0===e?void 0:e.isHost)&&(null===(t=this.privParticipants.me)||void 0===t?void 0:t.isMuted)}get isConnected(){return this.privIsConnected&&this.privIsReady}get participants(){return this.toParticipants(!0)}get me(){return this.toParticipant(this.privParticipants.me)}get host(){return this.toParticipant(this.privParticipants.host)}get transcriberRecognizer(){return this.privTranscriberRecognizer}get conversationInfo(){const e=this.conversationId,t=this.participants.map((e=>({id:e.id,preferredLanguage:e.preferredLanguage,voice:e.voice}))),i={};for(const e of r.ConversationConnectionConfig.transcriptionEventKeys){const t=this.properties.getProperty(e,"");""!==t&&(i[e]=t)}return{id:e,participants:t,conversationProperties:i}}get canSend(){var e;return this.privIsConnected&&!(null===(e=this.privParticipants.me)||void 0===e?void 0:e.isMuted)}get canSendAsHost(){var e;return this.privIsConnected&&(null===(e=this.privParticipants.me)||void 0===e?void 0:e.isHost)}get authorizationToken(){return this.privToken}set authorizationToken(e){c.Contracts.throwIfNullOrWhitespace(e,"authorizationToken"),this.privToken=e}set conversationTranslator(e){this.privConversationTranslator=e}onToken(e){this.privConversationTranslator.onToken(e)}createConversationAsync(e,t){try{this.privConversationRecognizer&&this.handleError(new Error(this.privErrors.permissionDeniedStart),t),this.privManager.createOrJoin(this.privProperties,void 0,(i=>{i||this.handleError(new Error(this.privErrors.permissionDeniedConnect),t),this.privRoom=i,this.handleCallback(e,t)}),(e=>{this.handleError(e,t)}))}catch(e){this.handleError(e,t)}}startConversationAsync(e,t){try{this.privConversationRecognizer&&this.handleError(new Error(this.privErrors.permissionDeniedStart),t),c.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedConnect),this.privParticipants.meId=this.privRoom.participantId,this.privConversationRecognizer=o.ConversationRecognizerFactory.fromConfig(this,this.privConfig),this.privConversationRecognizer.connected=this.onConnected,this.privConversationRecognizer.disconnected=this.onDisconnected,this.privConversationRecognizer.canceled=this.onCanceled,this.privConversationRecognizer.participantUpdateCommandReceived=this.onParticipantUpdateCommandReceived,this.privConversationRecognizer.lockRoomCommandReceived=this.onLockRoomCommandReceived,this.privConversationRecognizer.muteAllCommandReceived=this.onMuteAllCommandReceived,this.privConversationRecognizer.participantJoinCommandReceived=this.onParticipantJoinCommandReceived,this.privConversationRecognizer.participantLeaveCommandReceived=this.onParticipantLeaveCommandReceived,this.privConversationRecognizer.translationReceived=this.onTranslationReceived,this.privConversationRecognizer.participantsListReceived=this.onParticipantsListReceived,this.privConversationRecognizer.conversationExpiration=this.onConversationExpiration,this.privConversationRecognizer.connect(this.privRoom.token,(()=>{this.handleCallback(e,t)}),(e=>{this.handleError(e,t)}))}catch(e){this.handleError(e,t)}}addParticipantAsync(e,t,i){c.Contracts.throwIfNullOrUndefined(e,"Participant"),(0,a.marshalPromiseToCallbacks)(this.addParticipantImplAsync(e),t,i)}joinConversationAsync(e,t,i,r,n){try{c.Contracts.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace("{arg}","conversationId")),c.Contracts.throwIfNullOrWhitespace(t,this.privErrors.invalidArgs.replace("{arg}","nickname")),c.Contracts.throwIfNullOrWhitespace(i,this.privErrors.invalidArgs.replace("{arg}","language")),this.privManager.createOrJoin(this.privProperties,e,(e=>{c.Contracts.throwIfNullOrUndefined(e,this.privErrors.permissionDeniedConnect),this.privRoom=e,this.privConfig.authorizationToken=e.cognitiveSpeechAuthToken,r&&r(e.cognitiveSpeechAuthToken)}),(e=>{this.handleError(e,n)}))}catch(e){this.handleError(e,n)}}deleteConversationAsync(e,t){(0,a.marshalPromiseToCallbacks)(this.deleteConversationImplAsync(),e,t)}deleteConversationImplAsync(){return m(this,void 0,void 0,(function*(){c.Contracts.throwIfNullOrUndefined(this.privProperties,this.privErrors.permissionDeniedConnect),c.Contracts.throwIfNullOrWhitespace(this.privRoom.token,this.privErrors.permissionDeniedConnect),yield this.privManager.leave(this.privProperties,this.privRoom.token),this.dispose()}))}endConversationAsync(e,t){(0,a.marshalPromiseToCallbacks)(this.endConversationImplAsync(),e,t)}endConversationImplAsync(){return this.close(!0)}lockConversationAsync(e,t){try{c.Contracts.throwIfDisposed(this.privIsDisposed),c.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),c.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","lock")),t),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getLockCommand(!0),(()=>{this.handleCallback(e,t)}),(e=>{this.handleError(e,t)}))}catch(e){this.handleError(e,t)}}muteAllParticipantsAsync(e,t){try{c.Contracts.throwIfDisposed(this.privIsDisposed),c.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),c.Contracts.throwIfNullOrUndefined(this.privConversationRecognizer,this.privErrors.permissionDeniedSend),c.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","mute")),t),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteAllCommand(!0),(()=>{this.handleCallback(e,t)}),(e=>{this.handleError(e,t)}))}catch(e){this.handleError(e,t)}}muteParticipantAsync(e,t,i){try{c.Contracts.throwIfDisposed(this.privIsDisposed),c.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),c.Contracts.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace("{arg}","userId")),c.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),i),this.me.isHost||this.me.id===e||this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","mute")),i);-1===this.privParticipants.getParticipantIndex(e)&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),i),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteCommand(e,!0),(()=>{this.handleCallback(t,i)}),(e=>{this.handleError(e,i)}))}catch(e){this.handleError(e,i)}}removeParticipantAsync(e,t,i){try{if(c.Contracts.throwIfDisposed(this.privIsDisposed),this.privTranscriberRecognizer&&e.hasOwnProperty("id"))(0,a.marshalPromiseToCallbacks)(this.removeParticipantImplAsync(e),t,i);else{c.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),c.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","remove")),i);let r="";if("string"==typeof e)r=e;else if(e.hasOwnProperty("id")){r=e.id}else if(e.hasOwnProperty("userId")){r=e.userId}c.Contracts.throwIfNullOrWhitespace(r,this.privErrors.invalidArgs.replace("{arg}","userId"));-1===this.participants.findIndex((e=>e.id===r))&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),i),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getEjectCommand(r),(()=>{this.handleCallback(t,i)}),(e=>{this.handleError(e,i)}))}}catch(e){this.handleError(e,i)}}unlockConversationAsync(e,t){try{c.Contracts.throwIfDisposed(this.privIsDisposed),c.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),c.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","unlock")),t),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getLockCommand(!1),(()=>{this.handleCallback(e,t)}),(e=>{this.handleError(e,t)}))}catch(e){this.handleError(e,t)}}unmuteAllParticipantsAsync(e,t){try{c.Contracts.throwIfDisposed(this.privIsDisposed),c.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),c.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","unmute all")),t),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteAllCommand(!1),(()=>{this.handleCallback(e,t)}),(e=>{this.handleError(e,t)}))}catch(e){this.handleError(e,t)}}unmuteParticipantAsync(e,t,i){try{c.Contracts.throwIfDisposed(this.privIsDisposed),c.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),c.Contracts.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace("{arg}","userId")),c.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),i),this.me.isHost||this.me.id===e||this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","mute")),i);-1===this.privParticipants.getParticipantIndex(e)&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),i),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteCommand(e,!1),(()=>{this.handleCallback(t,i)}),(e=>{this.handleError(e,i)}))}catch(e){this.handleError(e,i)}}sendTextMessageAsync(e,t,i){try{c.Contracts.throwIfDisposed(this.privIsDisposed),c.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),c.Contracts.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace("{arg}","message")),c.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),i),e.length>this.privTextMessageMaxLength&&this.handleError(new Error(this.privErrors.invalidArgs.replace("{arg}","message length")),i),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMessageCommand(e),(()=>{this.handleCallback(t,i)}),(e=>{this.handleError(e,i)}))}catch(e){this.handleError(e,i)}}setTranslatedLanguagesAsync(e,t,i){try{c.Contracts.throwIfDisposed(this.privIsDisposed),c.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),c.Contracts.throwIfArrayEmptyOrWhitespace(e,this.privErrors.invalidArgs.replace("{arg}","languages")),c.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),i),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getSetTranslateToLanguagesCommand(e),(()=>{this.handleCallback(t,i)}),(e=>{this.handleError(e,i)}))}catch(e){this.handleError(e,i)}}changeNicknameAsync(e,t,i){try{c.Contracts.throwIfDisposed(this.privIsDisposed),c.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),c.Contracts.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace("{arg}","nickname")),c.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),i),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getChangeNicknameCommand(e),(()=>{this.handleCallback(t,i)}),(e=>{this.handleError(e,i)}))}catch(e){this.handleError(e,i)}}isDisposed(){return this.privIsDisposed}dispose(){this.isDisposed||(this.privIsDisposed=!0,this.config&&this.config.close(),this.privConfig=void 0,this.privLanguage=void 0,this.privProperties=void 0,this.privRoom=void 0,this.privToken=void 0,this.privManager=void 0,this.privIsConnected=!1,this.privIsReady=!1,this.privParticipants=void 0)}connectTranscriberRecognizer(e){return m(this,void 0,void 0,(function*(){this.privTranscriberRecognizer&&(yield this.privTranscriberRecognizer.close()),yield e.enforceAudioGating(),this.privTranscriberRecognizer=e,this.privTranscriberRecognizer.conversation=this}))}getKeepAlive(){const e=this.me?this.me.displayName:"default_nickname";return JSON.stringify({id:"0",nickname:e,participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,type:n.ConversationTranslatorMessageTypes.keepAlive})}addParticipantImplAsync(e){if(void 0!==this.privParticipants.addOrUpdateParticipant(e)&&this.privTranscriberRecognizer){const t=this.conversationInfo;return t.participants=[e],this.privTranscriberRecognizer.pushConversationEvent(t,"join")}}removeParticipantImplAsync(e){this.privParticipants.deleteParticipant(e.id);const t=this.conversationInfo;return t.participants=[e],this.privTranscriberRecognizer.pushConversationEvent(t,"leave")}close(e){var t;return m(this,void 0,void 0,(function*(){try{this.privIsConnected=!1,yield null===(t=this.privConversationRecognizer)||void 0===t?void 0:t.close(),this.privConversationRecognizer=void 0,this.privConversationTranslator&&this.privConversationTranslator.dispose()}catch(e){throw e}e&&this.dispose()}))}handleCallback(e,t){if(e){try{e()}catch(e){t&&t(e)}e=void 0}}handleError(e,t){if(t)if(e instanceof Error){const i=e;t(i.name+": "+i.message)}else t(e)}toParticipants(e){const t=this.privParticipants.participants.map((e=>this.toParticipant(e)));return e?t:t.filter((e=>!1===e.isHost))}toParticipant(e){return new g.Participant(e.id,e.avatar,e.displayName,e.isHost,e.isMuted,e.isUsingTts,e.preferredLanguage,e.voice)}getMuteAllCommand(e){return c.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),c.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:n.ConversationTranslatorCommandTypes.setMuteAll,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:n.ConversationTranslatorMessageTypes.participantCommand,value:e})}getMuteCommand(e,t){return c.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),c.Contracts.throwIfNullOrWhitespace(e,"participantId"),JSON.stringify({command:n.ConversationTranslatorCommandTypes.setMute,participantId:e,roomid:this.privRoom.roomId,type:n.ConversationTranslatorMessageTypes.participantCommand,value:t})}getLockCommand(e){return c.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),c.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:n.ConversationTranslatorCommandTypes.setLockState,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:n.ConversationTranslatorMessageTypes.participantCommand,value:e})}getEjectCommand(e){return c.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),c.Contracts.throwIfNullOrWhitespace(e,"participantId"),JSON.stringify({command:n.ConversationTranslatorCommandTypes.ejectParticipant,participantId:e,roomid:this.privRoom.roomId,type:n.ConversationTranslatorMessageTypes.participantCommand})}getSetTranslateToLanguagesCommand(e){return c.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),c.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:n.ConversationTranslatorCommandTypes.setTranslateToLanguages,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:n.ConversationTranslatorMessageTypes.participantCommand,value:e})}getChangeNicknameCommand(e){return c.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),c.Contracts.throwIfNullOrWhitespace(e,"nickname"),c.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:n.ConversationTranslatorCommandTypes.changeNickname,nickname:e,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:n.ConversationTranslatorMessageTypes.participantCommand,value:e})}getMessageCommand(e){return c.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),c.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),c.Contracts.throwIfNullOrWhitespace(e,"message"),JSON.stringify({participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,text:e,type:n.ConversationTranslatorMessageTypes.instantMessage})}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConversationParticipantsChangedEventArgs:()=>n});var r=i(42);class n extends r.SessionEventArgs{constructor(e,t,i){super(i),this.privReason=e,this.privParticipant=t}get reason(){return this.privReason}get participants(){return this.privParticipant}}},(e,t,i)=>{"use strict";var r;i.r(t),i.d(t,{ParticipantChangedReason:()=>r}),function(e){e[e.JoinedConversation=0]="JoinedConversation",e[e.LeftConversation=1]="LeftConversation",e[e.Updated=2]="Updated"}(r||(r={}))},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConversationTranslationEventArgs:()=>n});var r=i(43);class n extends r.RecognitionEventArgs{constructor(e,t,i){super(t,i),this.privResult=e}get result(){return this.privResult}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{Participant:()=>s,User:()=>n});var r=i(60);class n{constructor(e){this.privUserId=e}get userId(){return this.privUserId}}class s{constructor(e,t,i,n,s,o,a,c){this.privId=e,this.privAvatar=t,this.privDisplayName=i,this.privIsHost=n,this.privIsMuted=s,this.privIsUsingTts=o,this.privPreferredLanguage=a,this.privVoice=c,this.privProperties=new r.PropertyCollection}get avatar(){return this.privAvatar}get displayName(){return this.privDisplayName}get id(){return this.privId}get preferredLanguage(){return this.privPreferredLanguage}get isHost(){return this.privIsHost}get isMuted(){return this.privIsMuted}get isUsingTts(){return this.privIsUsingTts}get voice(){return this.privVoice}get properties(){return this.privProperties}static From(e,t,i){return new s(e,"",e,!1,!1,!1,t,i)}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConversationTranslator:()=>I,SpeechState:()=>r});var r,n=i(137),s=i(61),o=i(219),a=i(18),c=i(36),p=i(193),h=i(40),d=i(91),u=i(60),v=i(190),l=i(189),g=i(59),m=i(202),S=i(4),f=i(213),C=i(164),y=i(220),R=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};!function(e){e[e.Inactive=0]="Inactive",e[e.Connecting=1]="Connecting",e[e.Connected=2]="Connected"}(r||(r={}));class P extends p.TranslationRecognizer{constructor(e,t,i,n){super(e,t,new o.ConversationTranslatorConnectionFactory(n)),this.privSpeechState=r.Inactive,i&&(this.privTranslator=i,this.sessionStarted=()=>{this.privSpeechState=r.Connected},this.sessionStopped=()=>{this.privSpeechState=r.Inactive},this.recognizing=(e,t)=>{this.privTranslator.recognizing&&this.privTranslator.recognizing(this.privTranslator,t)},this.recognized=(e,t)=>R(this,void 0,void 0,(function*(){var e;(null===(e=t.result)||void 0===e?void 0:e.errorDetails)?(yield this.cancelSpeech(),this.fireCancelEvent(t.result.errorDetails)):this.privTranslator.recognized&&this.privTranslator.recognized(this.privTranslator,t)})),this.canceled=()=>R(this,void 0,void 0,(function*(){if(this.privSpeechState!==r.Inactive)try{yield this.cancelSpeech()}catch(e){this.privSpeechState=r.Inactive}})))}get state(){return this.privSpeechState}set state(e){this.privSpeechState=e}set authentication(e){this.privReco.authentication=e}onConnection(){this.privSpeechState=r.Connected}onCancelSpeech(){return R(this,void 0,void 0,(function*(){this.privSpeechState=r.Inactive,yield this.cancelSpeech()}))}fireCancelEvent(e){try{if(this.privTranslator.canceled){const t=new C.ConversationTranslationCanceledEventArgs(h.CancellationReason.Error,e,d.CancellationErrorCode.RuntimeError);this.privTranslator.canceled(this.privTranslator,t)}}catch(e){}}cancelSpeech(){var e;return R(this,void 0,void 0,(function*(){try{this.stopContinuousRecognitionAsync(),yield null===(e=this.privReco)||void 0===e?void 0:e.disconnect(),this.privSpeechState=r.Inactive}catch(e){}}))}}class I extends y.ConversationCommon{constructor(e){super(e),this.privErrors=n.ConversationConnectionConfig.restErrors,this.privIsDisposed=!1,this.privIsSpeaking=!1,this.privPlaceholderKey="abcdefghijklmnopqrstuvwxyz012345",this.privPlaceholderRegion="westus",this.privProperties=new u.PropertyCollection}get properties(){return this.privProperties}get speechRecognitionLanguage(){return this.privSpeechRecognitionLanguage}get participants(){var e;return null===(e=this.privConversation)||void 0===e?void 0:e.participants}get canSpeak(){return!(!this.privConversation.isConnected||!this.privCTRecognizer)&&(!this.privIsSpeaking&&this.privCTRecognizer.state!==r.Connected&&this.privCTRecognizer.state!==r.Connecting&&!this.privConversation.isMutedByHost)}onToken(e){this.privCTRecognizer.authentication=e}setServiceProperty(e,t){const i=JSON.parse(this.privProperties.getProperty(s.ServicePropertiesPropertyName,"{}"));i[e]=t,this.privProperties.setProperty(s.ServicePropertiesPropertyName,JSON.stringify(i))}joinConversationAsync(e,t,i,r,o){try{if("string"==typeof e){c.Contracts.throwIfNullOrUndefined(e,this.privErrors.invalidArgs.replace("{arg}","conversation id")),c.Contracts.throwIfNullOrWhitespace(t,this.privErrors.invalidArgs.replace("{arg}","nickname")),this.privConversation&&this.handleError(new Error(this.privErrors.permissionDeniedStart),o);let a=i;null!=a&&""!==a||(a=n.ConversationConnectionConfig.defaultLanguageCode),this.privSpeechTranslationConfig=v.SpeechTranslationConfig.fromSubscription(this.privPlaceholderKey,this.privPlaceholderRegion),this.privSpeechTranslationConfig.setProfanity(l.ProfanityOption.Masked),this.privSpeechTranslationConfig.addTargetLanguage(a),this.privSpeechTranslationConfig.setProperty(g.PropertyId[g.PropertyId.SpeechServiceConnection_RecoLanguage],a),this.privSpeechTranslationConfig.setProperty(g.PropertyId[g.PropertyId.ConversationTranslator_Name],t);const p=[g.PropertyId.SpeechServiceConnection_Host,g.PropertyId.ConversationTranslator_Host,g.PropertyId.SpeechServiceConnection_Endpoint,g.PropertyId.SpeechServiceConnection_ProxyHostName,g.PropertyId.SpeechServiceConnection_ProxyPassword,g.PropertyId.SpeechServiceConnection_ProxyPort,g.PropertyId.SpeechServiceConnection_ProxyUserName,"ConversationTranslator_MultiChannelAudio","ConversationTranslator_Region"];for(const e of p){const t=this.privProperties.getProperty(e);if(t){const i="string"==typeof e?e:g.PropertyId[e];this.privSpeechTranslationConfig.setProperty(i,t)}}const h=JSON.parse(this.privProperties.getProperty(s.ServicePropertiesPropertyName,"{}"));for(const e of Object.keys(h))this.privSpeechTranslationConfig.setServiceProperty(e,h[e],m.ServicePropertyChannel.UriQueryParameter);this.privConversation=new f.ConversationImpl(this.privSpeechTranslationConfig),this.privConversation.conversationTranslator=this,this.privConversation.joinConversationAsync(e,t,a,(e=>{e||this.handleError(new Error(this.privErrors.permissionDeniedConnect),o),this.privSpeechTranslationConfig.authorizationToken=e,this.privConversation.room.isHost=!1,this.privConversation.startConversationAsync((()=>{this.handleCallback(r,o)}),(e=>{this.handleError(e,o)}))}),(e=>{this.handleError(e,o)}))}else"object"==typeof e?(c.Contracts.throwIfNullOrUndefined(e,this.privErrors.invalidArgs.replace("{arg}","conversation id")),c.Contracts.throwIfNullOrWhitespace(t,this.privErrors.invalidArgs.replace("{arg}","nickname")),this.privProperties.setProperty(g.PropertyId.ConversationTranslator_Name,t),this.privConversation=e,this.privConversation.conversationTranslator=this,this.privConversation.room.isHost=!0,c.Contracts.throwIfNullOrUndefined(this.privConversation,this.privErrors.permissionDeniedConnect),c.Contracts.throwIfNullOrUndefined(this.privConversation.room.token,this.privErrors.permissionDeniedConnect),this.privSpeechTranslationConfig=e.config,this.handleCallback(i,r)):this.handleError(new Error(this.privErrors.invalidArgs.replace("{arg}","invalid conversation type")),r)}catch(e){this.handleError(e,"string"==typeof i?o:r)}}leaveConversationAsync(e,t){(0,a.marshalPromiseToCallbacks)((()=>R(this,void 0,void 0,(function*(){yield this.cancelSpeech(),yield this.privConversation.endConversationImplAsync(),yield this.privConversation.deleteConversationImplAsync(),this.dispose()})))(),e,t)}sendTextMessageAsync(e,t,i){try{c.Contracts.throwIfNullOrUndefined(this.privConversation,this.privErrors.permissionDeniedSend),c.Contracts.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace("{arg}",e)),this.privConversation.sendTextMessageAsync(e,t,i)}catch(e){this.handleError(e,i)}}startTranscribingAsync(e,t){(0,a.marshalPromiseToCallbacks)((()=>R(this,void 0,void 0,(function*(){try{c.Contracts.throwIfNullOrUndefined(this.privConversation,this.privErrors.permissionDeniedSend),c.Contracts.throwIfNullOrUndefined(this.privConversation.room.token,this.privErrors.permissionDeniedConnect),void 0===this.privCTRecognizer&&(yield this.connectTranslatorRecognizer()),c.Contracts.throwIfNullOrUndefined(this.privCTRecognizer,this.privErrors.permissionDeniedSend),this.canSpeak||this.handleError(new Error(this.privErrors.permissionDeniedSend),t),yield this.startContinuousRecognition(),this.privIsSpeaking=!0}catch(e){throw this.privIsSpeaking=!1,yield this.cancelSpeech(),e}})))(),e,t)}stopTranscribingAsync(e,t){(0,a.marshalPromiseToCallbacks)((()=>R(this,void 0,void 0,(function*(){try{if(!this.privIsSpeaking)return void(yield this.cancelSpeech());this.privIsSpeaking=!1,yield new Promise(((e,t)=>{this.privCTRecognizer.stopContinuousRecognitionAsync(e,t)}))}catch(e){yield this.cancelSpeech()}})))(),e,t)}isDisposed(){return this.privIsDisposed}dispose(e,t,i){(0,a.marshalPromiseToCallbacks)((()=>R(this,void 0,void 0,(function*(){this.isDisposed&&!this.privIsSpeaking||(yield this.cancelSpeech(),this.privIsDisposed=!0,this.privSpeechTranslationConfig.close(),this.privSpeechRecognitionLanguage=void 0,this.privProperties=void 0,this.privAudioConfig=void 0,this.privSpeechTranslationConfig=void 0,this.privConversation.dispose(),this.privConversation=void 0)})))(),t,i)}cancelSpeech(){var e;return R(this,void 0,void 0,(function*(){try{this.privIsSpeaking=!1,yield null===(e=this.privCTRecognizer)||void 0===e?void 0:e.onCancelSpeech(),this.privCTRecognizer=void 0}catch(e){}}))}connectTranslatorRecognizer(){return R(this,void 0,void 0,(function*(){try{void 0===this.privAudioConfig&&(this.privAudioConfig=S.AudioConfig.fromDefaultMicrophoneInput()),this.privSpeechTranslationConfig.getProperty(g.PropertyId[g.PropertyId.SpeechServiceConnection_Key])===this.privPlaceholderKey&&this.privSpeechTranslationConfig.setProperty(g.PropertyId[g.PropertyId.SpeechServiceConnection_Key],"");const e=()=>this.privConversation;this.privCTRecognizer=new P(this.privSpeechTranslationConfig,this.privAudioConfig,this,e)}catch(e){throw yield this.cancelSpeech(),e}}))}startContinuousRecognition(){return new Promise(((e,t)=>{this.privCTRecognizer.startContinuousRecognitionAsync(e,t)}))}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConversationTranslatorConnectionFactory:()=>g});var r=i(138),n=i(69),s=i(82),o=i(106),a=i(36),c=i(59),p=i(64),h=i(68),d=i(67),u=i(104),v=i(105),l=i(81);class g extends d.ConnectionFactoryBase{constructor(e){super(),a.Contracts.throwIfNullOrUndefined(e,"convGetter"),this.privConvGetter=e}create(e,t,i){const a="TRUE"===e.parameters.getProperty("ConversationTranslator_MultiChannelAudio","").toUpperCase(),m=this.privConvGetter().room,S=m.cognitiveSpeechRegion||e.parameters.getProperty(c.PropertyId.SpeechServiceConnection_Region,""),f={hostSuffix:d.ConnectionFactoryBase.getHostSuffix(S),path:g.CTS_VIRT_MIC_PATH,region:encodeURIComponent(S)};f[h.QueryParameterNames.Language]=encodeURIComponent(e.parameters.getProperty(c.PropertyId.SpeechServiceConnection_RecoLanguage,"")),f[h.QueryParameterNames.CtsMeetingId]=encodeURIComponent(m.roomId),f[h.QueryParameterNames.CtsDeviceId]=encodeURIComponent(m.participantId),f[h.QueryParameterNames.CtsIsParticipant]=m.isHost?"":"&"+h.QueryParameterNames.CtsIsParticipant;let C="";const y={},R={};if(a){if(C=e.parameters.getProperty(c.PropertyId.SpeechServiceConnection_Endpoint),!C){C="wss://"+e.parameters.getProperty(c.PropertyId.SpeechServiceConnection_Host,"transcribe.{region}.cts.speech{hostSuffix}")+"{path}"}C=o.StringUtils.formatString(C,f);const t=new URL(C);t.searchParams.forEach(((e,t)=>{y[t]=e}));(new u.TranscriberConnectionFactory).setQueryParams(y,e,C),y[h.QueryParameterNames.CtsMeetingId]=f[h.QueryParameterNames.CtsMeetingId],y[h.QueryParameterNames.CtsDeviceId]=f[h.QueryParameterNames.CtsDeviceId],m.isHost||(y[h.QueryParameterNames.CtsIsParticipant]=""),h.QueryParameterNames.Format in y||(y[h.QueryParameterNames.Format]="simple"),t.searchParams.forEach(((e,i)=>{t.searchParams.set(i,y[i]),delete y[i]})),C=t.toString()}else{const t=new v.TranslationConnectionFactory;C=t.getEndpointUrl(e,!0),C=o.StringUtils.formatString(C,f),t.setQueryParams(y,e,C)}R[p.HeaderNames.ConnectionId]=i,R[r.RestConfigBase.configParams.token]=m.token,t.token&&(R[t.headerName]=t.token);const P="TRUE"===e.parameters.getProperty("SPEECH-EnableWebsocketCompression","").toUpperCase();return new n.WebsocketConnection(C,y,R,new l.WebsocketMessageFormatter,s.ProxyInfo.fromRecognizerConfig(e),P,i)}}g.CTS_VIRT_MIC_PATH="/speech/recognition/dynamicaudio"},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConversationCommon:()=>r});class r{constructor(e){this.privAudioConfig=e}handleCallback(e,t){if(e){try{e()}catch(e){t&&t(e)}e=void 0}}handleError(e,t){if(t)if(e instanceof Error){const i=e;t(i.name+": "+i.message)}else t(e)}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConversationTranscriber:()=>v});var r=i(103),n=i(61),s=i(92),o=i(117),a=i(18),c=i(36),p=i(143),h=i(59),d=i(44),u=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class v extends p.Recognizer{constructor(e,t){const i=e;c.Contracts.throwIfNull(i,"speechConfig"),c.Contracts.throwIfNullOrWhitespace(i.properties.getProperty(h.PropertyId.SpeechServiceConnection_RecoLanguage),h.PropertyId[h.PropertyId.SpeechServiceConnection_RecoLanguage]),super(t,i.properties,new r.ConversationTranscriberConnectionFactory),this.privProperties.setProperty(h.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,"2"),this.privDisposedRecognizer=!1}static FromConfig(e,t,i){const r=e;t.properties.mergeTo(r.properties);return new v(e,i)}get endpointId(){return c.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(h.PropertyId.SpeechServiceConnection_EndpointId,"00000000-0000-0000-0000-000000000000")}get authorizationToken(){return this.properties.getProperty(h.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(e){c.Contracts.throwIfNullOrWhitespace(e,"token"),this.properties.setProperty(h.PropertyId.SpeechServiceAuthorization_Token,e)}get speechRecognitionLanguage(){return c.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(h.PropertyId.SpeechServiceConnection_RecoLanguage)}get outputFormat(){return c.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(n.OutputFormatPropertyName,d.OutputFormat[d.OutputFormat.Simple])===d.OutputFormat[d.OutputFormat.Simple]?d.OutputFormat.Simple:d.OutputFormat.Detailed}get properties(){return this.privProperties}startTranscribingAsync(e,t){(0,a.marshalPromiseToCallbacks)(this.startContinuousRecognitionAsyncImpl(s.RecognitionMode.Conversation),e,t)}stopTranscribingAsync(e,t){(0,a.marshalPromiseToCallbacks)(this.stopContinuousRecognitionAsyncImpl(),e,t)}close(e,t){c.Contracts.throwIfDisposed(this.privDisposedRecognizer),(0,a.marshalPromiseToCallbacks)(this.dispose(!0),e,t)}dispose(e){const t=Object.create(null,{dispose:{get:()=>super.dispose}});return u(this,void 0,void 0,(function*(){this.privDisposedRecognizer||(e&&(this.privDisposedRecognizer=!0,yield this.implRecognizerStop()),yield t.dispose.call(this,e))}))}createRecognizerConfig(e){return new s.RecognizerConfig(e,this.privProperties)}createServiceRecognizer(e,t,i,r){const n=i;return r.isSpeakerDiarizationEnabled=!0,new o.ConversationTranscriptionServiceRecognizer(e,t,n,r,this)}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{Meeting:()=>g,MeetingImpl:()=>m});var r=i(137),n=i(168),s=i(136),o=i(18),a=i(36),c=i(59),p=i(214),h=i(215),d=i(216),u=i(60),v=i(217),l=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class g{constructor(){}static createMeetingAsync(e,t,i,n){if(a.Contracts.throwIfNullOrUndefined(e,r.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","config")),a.Contracts.throwIfNullOrUndefined(e.region,r.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","SpeechServiceConnection_Region")),a.Contracts.throwIfNull(t,"meetingId"),0===t.length)throw new Error("meetingId cannot be empty");e.subscriptionKey||e.getProperty(c.PropertyId[c.PropertyId.SpeechServiceAuthorization_Token])||a.Contracts.throwIfNullOrUndefined(e.subscriptionKey,r.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","SpeechServiceConnection_Key"));const s=new m(e,t);return(0,o.marshalPromiseToCallbacks)((()=>l(this,void 0,void 0,(function*(){})))(),i,n),s}}class m extends g{constructor(e,t){super(),this.privErrors=r.ConversationConnectionConfig.restErrors,this.onConnected=e=>{var t;this.privIsConnected=!0;try{(null===(t=this.privConversationTranslator)||void 0===t?void 0:t.sessionStarted)&&this.privConversationTranslator.sessionStarted(this.privConversationTranslator,e)}catch(e){}},this.onDisconnected=e=>{var t;try{(null===(t=this.privConversationTranslator)||void 0===t?void 0:t.sessionStopped)&&this.privConversationTranslator.sessionStopped(this.privConversationTranslator,e)}catch(e){}finally{this.close(!1)}},this.onCanceled=(e,t)=>{var i;try{(null===(i=this.privConversationTranslator)||void 0===i?void 0:i.canceled)&&this.privConversationTranslator.canceled(this.privConversationTranslator,t)}catch(t){}},this.onParticipantUpdateCommandReceived=(e,t)=>{try{const e=this.privParticipants.getParticipant(t.id);if(void 0!==e){switch(t.key){case n.ConversationTranslatorCommandTypes.changeNickname:e.displayName=t.value;break;case n.ConversationTranslatorCommandTypes.setUseTTS:e.isUsingTts=t.value;break;case n.ConversationTranslatorCommandTypes.setProfanityFiltering:e.profanity=t.value;break;case n.ConversationTranslatorCommandTypes.setMute:e.isMuted=t.value;break;case n.ConversationTranslatorCommandTypes.setTranslateToLanguages:e.translateToLanguages=t.value}this.privParticipants.addOrUpdateParticipant(e),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new p.ConversationParticipantsChangedEventArgs(h.ParticipantChangedReason.Updated,[this.toParticipant(e)],t.sessionId))}}catch(t){}},this.onLockRoomCommandReceived=()=>{},this.onMuteAllCommandReceived=(e,t)=>{try{this.privParticipants.participants.forEach((e=>e.isMuted=!e.isHost&&t.isMuted)),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new p.ConversationParticipantsChangedEventArgs(h.ParticipantChangedReason.Updated,this.toParticipants(!1),t.sessionId))}catch(t){}},this.onParticipantJoinCommandReceived=(e,t)=>{try{const e=this.privParticipants.addOrUpdateParticipant(t.participant);void 0!==e&&this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new p.ConversationParticipantsChangedEventArgs(h.ParticipantChangedReason.JoinedConversation,[this.toParticipant(e)],t.sessionId))}catch(t){}},this.onParticipantLeaveCommandReceived=(e,t)=>{try{const e=this.privParticipants.getParticipant(t.participant.id);void 0!==e&&(this.privParticipants.deleteParticipant(t.participant.id),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new p.ConversationParticipantsChangedEventArgs(h.ParticipantChangedReason.LeftConversation,[this.toParticipant(e)],t.sessionId)))}catch(t){}},this.onTranslationReceived=(e,t)=>{try{switch(t.command){case n.ConversationTranslatorMessageTypes.final:this.privConversationTranslator&&this.privConversationTranslator.transcribed(this.privConversationTranslator,new d.ConversationTranslationEventArgs(t.payload,void 0,t.sessionId));break;case n.ConversationTranslatorMessageTypes.partial:this.privConversationTranslator&&this.privConversationTranslator.transcribing(this.privConversationTranslator,new d.ConversationTranslationEventArgs(t.payload,void 0,t.sessionId));break;case n.ConversationTranslatorMessageTypes.instantMessage:this.privConversationTranslator&&this.privConversationTranslator.textMessageReceived(this.privConversationTranslator,new d.ConversationTranslationEventArgs(t.payload,void 0,t.sessionId))}}catch(t){}},this.onParticipantsListReceived=(e,t)=>{var i;try{if(void 0!==t.sessionToken&&null!==t.sessionToken&&(this.privRoom.token=t.sessionToken),this.privParticipants.participants=[...t.participants],void 0!==this.privParticipants.me&&(this.privIsReady=!0),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new p.ConversationParticipantsChangedEventArgs(h.ParticipantChangedReason.JoinedConversation,this.toParticipants(!0),t.sessionId)),this.me.isHost){const e=null===(i=this.privConversationTranslator)||void 0===i?void 0:i.properties.getProperty(c.PropertyId.ConversationTranslator_Name);void 0!==e&&e.length>0&&e!==this.me.displayName&&this.changeNicknameAsync(e)}}catch(t){}},this.onConversationExpiration=(e,t)=>{try{this.privConversationTranslator&&this.privConversationTranslator.conversationExpiration(this.privConversationTranslator,t)}catch(t){}},this.privIsConnected=!1,this.privIsDisposed=!1,this.privConversationId="",this.privProperties=new u.PropertyCollection,this.privManager=new s.ConversationManager;e.getProperty(c.PropertyId[c.PropertyId.SpeechServiceConnection_RecoLanguage])||e.setProperty(c.PropertyId[c.PropertyId.SpeechServiceConnection_RecoLanguage],r.ConversationConnectionConfig.defaultLanguageCode),this.privLanguage=e.getProperty(c.PropertyId[c.PropertyId.SpeechServiceConnection_RecoLanguage]),this.privConversationId=t,this.privConfig=e;const i=e;a.Contracts.throwIfNull(i,"speechConfig"),this.privProperties=i.properties.clone(),this.privIsConnected=!1,this.privParticipants=new n.InternalParticipants,this.privIsReady=!1,this.privTextMessageMaxLength=1e3}get room(){return this.privRoom}get connection(){return this.privConversationRecognizer}get config(){return this.privConfig}get meetingId(){return this.privRoom?this.privRoom.roomId:this.privConversationId}get properties(){return this.privProperties}get speechRecognitionLanguage(){return this.privLanguage}get isMutedByHost(){var e,t;return!(null===(e=this.privParticipants.me)||void 0===e?void 0:e.isHost)&&(null===(t=this.privParticipants.me)||void 0===t?void 0:t.isMuted)}get isConnected(){return this.privIsConnected&&this.privIsReady}get participants(){return this.toParticipants(!0)}get me(){return this.toParticipant(this.privParticipants.me)}get host(){return this.toParticipant(this.privParticipants.host)}get transcriberRecognizer(){return this.privTranscriberRecognizer}get meetingInfo(){const e=this.meetingId,t=this.participants.map((e=>({id:e.id,preferredLanguage:e.preferredLanguage,voice:e.voice}))),i={};for(const e of r.ConversationConnectionConfig.transcriptionEventKeys){const t=this.properties.getProperty(e,"");""!==t&&(i[e]=t)}return{id:e,participants:t,meetingProperties:i}}get canSend(){var e;return this.privIsConnected&&!(null===(e=this.privParticipants.me)||void 0===e?void 0:e.isMuted)}get canSendAsHost(){var e;return this.privIsConnected&&(null===(e=this.privParticipants.me)||void 0===e?void 0:e.isHost)}get authorizationToken(){return this.privToken}set authorizationToken(e){a.Contracts.throwIfNullOrWhitespace(e,"authorizationToken"),this.privToken=e}createMeetingAsync(e,t){try{this.privConversationRecognizer&&this.handleError(new Error(this.privErrors.permissionDeniedStart),t),this.privManager.createOrJoin(this.privProperties,void 0,(i=>{i||this.handleError(new Error(this.privErrors.permissionDeniedConnect),t),this.privRoom=i,this.handleCallback(e,t)}),(e=>{this.handleError(e,t)}))}catch(e){this.handleError(e,t)}}startMeetingAsync(e,t){try{this.privConversationRecognizer&&this.handleError(new Error(this.privErrors.permissionDeniedStart),t),a.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedConnect),this.privParticipants.meId=this.privRoom.participantId,this.privConversationRecognizer.connected=this.onConnected,this.privConversationRecognizer.disconnected=this.onDisconnected,this.privConversationRecognizer.canceled=this.onCanceled,this.privConversationRecognizer.participantUpdateCommandReceived=this.onParticipantUpdateCommandReceived,this.privConversationRecognizer.lockRoomCommandReceived=this.onLockRoomCommandReceived,this.privConversationRecognizer.muteAllCommandReceived=this.onMuteAllCommandReceived,this.privConversationRecognizer.participantJoinCommandReceived=this.onParticipantJoinCommandReceived,this.privConversationRecognizer.participantLeaveCommandReceived=this.onParticipantLeaveCommandReceived,this.privConversationRecognizer.translationReceived=this.onTranslationReceived,this.privConversationRecognizer.participantsListReceived=this.onParticipantsListReceived,this.privConversationRecognizer.conversationExpiration=this.onConversationExpiration,this.privConversationRecognizer.connect(this.privRoom.token,(()=>{this.handleCallback(e,t)}),(e=>{this.handleError(e,t)}))}catch(e){this.handleError(e,t)}}addParticipantAsync(e,t,i){a.Contracts.throwIfNullOrUndefined(e,"Participant"),(0,o.marshalPromiseToCallbacks)(this.addParticipantImplAsync(e),t,i)}joinMeetingAsync(e,t,i,r,n){try{a.Contracts.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace("{arg}","conversationId")),a.Contracts.throwIfNullOrWhitespace(t,this.privErrors.invalidArgs.replace("{arg}","nickname")),a.Contracts.throwIfNullOrWhitespace(i,this.privErrors.invalidArgs.replace("{arg}","language")),this.privManager.createOrJoin(this.privProperties,e,(e=>{a.Contracts.throwIfNullOrUndefined(e,this.privErrors.permissionDeniedConnect),this.privRoom=e,this.privConfig.authorizationToken=e.cognitiveSpeechAuthToken,r&&r(e.cognitiveSpeechAuthToken)}),(e=>{this.handleError(e,n)}))}catch(e){this.handleError(e,n)}}deleteMeetingAsync(e,t){(0,o.marshalPromiseToCallbacks)(this.deleteMeetingImplAsync(),e,t)}deleteMeetingImplAsync(){return l(this,void 0,void 0,(function*(){a.Contracts.throwIfNullOrUndefined(this.privProperties,this.privErrors.permissionDeniedConnect),a.Contracts.throwIfNullOrWhitespace(this.privRoom.token,this.privErrors.permissionDeniedConnect),yield this.privManager.leave(this.privProperties,this.privRoom.token),this.dispose()}))}endMeetingAsync(e,t){(0,o.marshalPromiseToCallbacks)(this.endMeetingImplAsync(),e,t)}endMeetingImplAsync(){return this.close(!0)}lockMeetingAsync(e,t){try{a.Contracts.throwIfDisposed(this.privIsDisposed),a.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),a.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","lock")),t),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getLockCommand(!0),(()=>{this.handleCallback(e,t)}),(e=>{this.handleError(e,t)}))}catch(e){this.handleError(e,t)}}muteAllParticipantsAsync(e,t){try{a.Contracts.throwIfDisposed(this.privIsDisposed),a.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),a.Contracts.throwIfNullOrUndefined(this.privConversationRecognizer,this.privErrors.permissionDeniedSend),a.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","mute")),t),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteAllCommand(!0),(()=>{this.handleCallback(e,t)}),(e=>{this.handleError(e,t)}))}catch(e){this.handleError(e,t)}}muteParticipantAsync(e,t,i){try{a.Contracts.throwIfDisposed(this.privIsDisposed),a.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),a.Contracts.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace("{arg}","userId")),a.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),i),this.me.isHost||this.me.id===e||this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","mute")),i);-1===this.privParticipants.getParticipantIndex(e)&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),i),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteCommand(e,!0),(()=>{this.handleCallback(t,i)}),(e=>{this.handleError(e,i)}))}catch(e){this.handleError(e,i)}}removeParticipantAsync(e,t,i){try{if(a.Contracts.throwIfDisposed(this.privIsDisposed),this.privTranscriberRecognizer&&e.hasOwnProperty("id"))(0,o.marshalPromiseToCallbacks)(this.removeParticipantImplAsync(e),t,i);else{a.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),a.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","remove")),i);let r="";if("string"==typeof e)r=e;else if(e.hasOwnProperty("id")){r=e.id}else if(e.hasOwnProperty("userId")){r=e.userId}a.Contracts.throwIfNullOrWhitespace(r,this.privErrors.invalidArgs.replace("{arg}","userId"));-1===this.participants.findIndex((e=>e.id===r))&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),i),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getEjectCommand(r),(()=>{this.handleCallback(t,i)}),(e=>{this.handleError(e,i)}))}}catch(e){this.handleError(e,i)}}unlockMeetingAsync(e,t){try{a.Contracts.throwIfDisposed(this.privIsDisposed),a.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),a.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","unlock")),t),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getLockCommand(!1),(()=>{this.handleCallback(e,t)}),(e=>{this.handleError(e,t)}))}catch(e){this.handleError(e,t)}}unmuteAllParticipantsAsync(e,t){try{a.Contracts.throwIfDisposed(this.privIsDisposed),a.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),a.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","unmute all")),t),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteAllCommand(!1),(()=>{this.handleCallback(e,t)}),(e=>{this.handleError(e,t)}))}catch(e){this.handleError(e,t)}}unmuteParticipantAsync(e,t,i){try{a.Contracts.throwIfDisposed(this.privIsDisposed),a.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),a.Contracts.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace("{arg}","userId")),a.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),i),this.me.isHost||this.me.id===e||this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","mute")),i);-1===this.privParticipants.getParticipantIndex(e)&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),i),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteCommand(e,!1),(()=>{this.handleCallback(t,i)}),(e=>{this.handleError(e,i)}))}catch(e){this.handleError(e,i)}}sendTextMessageAsync(e,t,i){try{a.Contracts.throwIfDisposed(this.privIsDisposed),a.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),a.Contracts.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace("{arg}","message")),a.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),i),e.length>this.privTextMessageMaxLength&&this.handleError(new Error(this.privErrors.invalidArgs.replace("{arg}","message length")),i),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMessageCommand(e),(()=>{this.handleCallback(t,i)}),(e=>{this.handleError(e,i)}))}catch(e){this.handleError(e,i)}}setTranslatedLanguagesAsync(e,t,i){try{a.Contracts.throwIfDisposed(this.privIsDisposed),a.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),a.Contracts.throwIfArrayEmptyOrWhitespace(e,this.privErrors.invalidArgs.replace("{arg}","languages")),a.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),i),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getSetTranslateToLanguagesCommand(e),(()=>{this.handleCallback(t,i)}),(e=>{this.handleError(e,i)}))}catch(e){this.handleError(e,i)}}changeNicknameAsync(e,t,i){try{a.Contracts.throwIfDisposed(this.privIsDisposed),a.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),a.Contracts.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace("{arg}","nickname")),a.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),i),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getChangeNicknameCommand(e),(()=>{this.handleCallback(t,i)}),(e=>{this.handleError(e,i)}))}catch(e){this.handleError(e,i)}}isDisposed(){return this.privIsDisposed}dispose(){this.isDisposed||(this.privIsDisposed=!0,this.config&&this.config.close(),this.privConfig=void 0,this.privLanguage=void 0,this.privProperties=void 0,this.privRoom=void 0,this.privToken=void 0,this.privManager=void 0,this.privIsConnected=!1,this.privIsReady=!1,this.privParticipants=void 0)}connectTranscriberRecognizer(e){return l(this,void 0,void 0,(function*(){this.privTranscriberRecognizer&&(yield this.privTranscriberRecognizer.close()),yield e.enforceAudioGating(),this.privTranscriberRecognizer=e,this.privTranscriberRecognizer.meeting=this}))}getKeepAlive(){const e=this.me?this.me.displayName:"default_nickname";return JSON.stringify({id:"0",nickname:e,participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,type:n.ConversationTranslatorMessageTypes.keepAlive})}addParticipantImplAsync(e){if(void 0!==this.privParticipants.addOrUpdateParticipant(e)&&this.privTranscriberRecognizer){const t=this.meetingInfo;return t.participants=[e],this.privTranscriberRecognizer.pushMeetingEvent(t,"join")}}removeParticipantImplAsync(e){this.privParticipants.deleteParticipant(e.id);const t=this.meetingInfo;return t.participants=[e],this.privTranscriberRecognizer.pushMeetingEvent(t,"leave")}close(e){var t;return l(this,void 0,void 0,(function*(){try{this.privIsConnected=!1,yield null===(t=this.privConversationRecognizer)||void 0===t?void 0:t.close(),this.privConversationRecognizer=void 0,this.privConversationTranslator&&this.privConversationTranslator.dispose()}catch(e){throw e}e&&this.dispose()}))}handleCallback(e,t){if(e){try{e()}catch(e){t&&t(e)}e=void 0}}handleError(e,t){if(t)if(e instanceof Error){const i=e;t(i.name+": "+i.message)}else t(e)}toParticipants(e){const t=this.privParticipants.participants.map((e=>this.toParticipant(e)));return e?t:t.filter((e=>!1===e.isHost))}toParticipant(e){return new v.Participant(e.id,e.avatar,e.displayName,e.isHost,e.isMuted,e.isUsingTts,e.preferredLanguage,e.voice)}getMuteAllCommand(e){return a.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingd"),a.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:n.ConversationTranslatorCommandTypes.setMuteAll,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:n.ConversationTranslatorMessageTypes.participantCommand,value:e})}getMuteCommand(e,t){return a.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),a.Contracts.throwIfNullOrWhitespace(e,"participantId"),JSON.stringify({command:n.ConversationTranslatorCommandTypes.setMute,participantId:e,roomid:this.privRoom.roomId,type:n.ConversationTranslatorMessageTypes.participantCommand,value:t})}getLockCommand(e){return a.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),a.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:n.ConversationTranslatorCommandTypes.setLockState,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:n.ConversationTranslatorMessageTypes.participantCommand,value:e})}getEjectCommand(e){return a.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),a.Contracts.throwIfNullOrWhitespace(e,"participantId"),JSON.stringify({command:n.ConversationTranslatorCommandTypes.ejectParticipant,participantId:e,roomid:this.privRoom.roomId,type:n.ConversationTranslatorMessageTypes.participantCommand})}getSetTranslateToLanguagesCommand(e){return a.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),a.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:n.ConversationTranslatorCommandTypes.setTranslateToLanguages,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:n.ConversationTranslatorMessageTypes.participantCommand,value:e})}getChangeNicknameCommand(e){return a.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),a.Contracts.throwIfNullOrWhitespace(e,"nickname"),a.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:n.ConversationTranslatorCommandTypes.changeNickname,nickname:e,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:n.ConversationTranslatorMessageTypes.participantCommand,value:e})}getMessageCommand(e){return a.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),a.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),a.Contracts.throwIfNullOrWhitespace(e,"message"),JSON.stringify({participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,text:e,type:n.ConversationTranslatorMessageTypes.instantMessage})}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{MeetingTranscriber:()=>d});var r=i(172),n=i(18),s=i(36),o=i(60),a=i(59),c=i(147),p=i(222),h=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class d{constructor(e){this.privAudioConfig=e,this.privProperties=new o.PropertyCollection,this.privRecognizer=void 0,this.privDisposedRecognizer=!1}get speechRecognitionLanguage(){return s.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(a.PropertyId.SpeechServiceConnection_RecoLanguage)}get properties(){return this.privProperties}get internalData(){return this.privRecognizer.internalData}get connection(){return c.Connection.fromRecognizer(this.privRecognizer)}get authorizationToken(){return this.properties.getProperty(a.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(e){s.Contracts.throwIfNullOrWhitespace(e,"token"),this.properties.setProperty(a.PropertyId.SpeechServiceAuthorization_Token,e)}joinMeetingAsync(e,t,i){const o=e;s.Contracts.throwIfNullOrUndefined(p.MeetingImpl,"Meeting"),this.privRecognizer=new r.TranscriberRecognizer(e.config,this.privAudioConfig),s.Contracts.throwIfNullOrUndefined(this.privRecognizer,"Recognizer"),this.privRecognizer.connectMeetingCallbacks(this),(0,n.marshalPromiseToCallbacks)(o.connectTranscriberRecognizer(this.privRecognizer),t,i)}startTranscribingAsync(e,t){this.privRecognizer.startContinuousRecognitionAsync(e,t)}stopTranscribingAsync(e,t){this.privRecognizer.stopContinuousRecognitionAsync(e,t)}leaveMeetingAsync(e,t){this.privRecognizer.disconnectCallbacks(),(0,n.marshalPromiseToCallbacks)((()=>h(this,void 0,void 0,(function*(){})))(),e,t)}close(e,t){s.Contracts.throwIfDisposed(this.privDisposedRecognizer),(0,n.marshalPromiseToCallbacks)(this.dispose(!0),e,t)}dispose(e){return h(this,void 0,void 0,(function*(){this.privDisposedRecognizer||(this.privRecognizer&&(yield this.privRecognizer.close(),this.privRecognizer=void 0),e&&(this.privDisposedRecognizer=!0))}))}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SynthesisRequest:()=>v,Synthesizer:()=>u});var r=i(61),n=i(178),s=i(21),o=i(62),a=i(65),c=i(24),p=i(36),h=i(59),d=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class u{constructor(e){const t=e;p.Contracts.throwIfNull(t,"speechConfig"),this.privProperties=t.properties.clone(),this.privDisposed=!1,this.privSynthesizing=!1,this.synthesisRequestQueue=new c.Queue}get authorizationToken(){return this.properties.getProperty(h.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(e){p.Contracts.throwIfNullOrWhitespace(e,"token"),this.properties.setProperty(h.PropertyId.SpeechServiceAuthorization_Token,e)}get properties(){return this.privProperties}get autoDetectSourceLanguage(){return this.properties.getProperty(h.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages)===r.AutoDetectSourceLanguagesOpenRangeOptionName}buildSsml(e){const t={"af-ZA":"af-ZA-AdriNeural","am-ET":"am-ET-AmehaNeural","ar-AE":"ar-AE-FatimaNeural","ar-BH":"ar-BH-AliNeural","ar-DZ":"ar-DZ-AminaNeural","ar-EG":"ar-EG-SalmaNeural","ar-IQ":"ar-IQ-BasselNeural","ar-JO":"ar-JO-SanaNeural","ar-KW":"ar-KW-FahedNeural","ar-LY":"ar-LY-ImanNeural","ar-MA":"ar-MA-JamalNeural","ar-QA":"ar-QA-AmalNeural","ar-SA":"ar-SA-HamedNeural","ar-SY":"ar-SY-AmanyNeural","ar-TN":"ar-TN-HediNeural","ar-YE":"ar-YE-MaryamNeural","bg-BG":"bg-BG-BorislavNeural","bn-BD":"bn-BD-NabanitaNeural","bn-IN":"bn-IN-BashkarNeural","ca-ES":"ca-ES-JoanaNeural","cs-CZ":"cs-CZ-AntoninNeural","cy-GB":"cy-GB-AledNeural","da-DK":"da-DK-ChristelNeural","de-AT":"de-AT-IngridNeural","de-CH":"de-CH-JanNeural","de-DE":"de-DE-KatjaNeural","el-GR":"el-GR-AthinaNeural","en-AU":"en-AU-NatashaNeural","en-CA":"en-CA-ClaraNeural","en-GB":"en-GB-LibbyNeural","en-HK":"en-HK-SamNeural","en-IE":"en-IE-ConnorNeural","en-IN":"en-IN-NeerjaNeural","en-KE":"en-KE-AsiliaNeural","en-NG":"en-NG-AbeoNeural","en-NZ":"en-NZ-MitchellNeural","en-PH":"en-PH-JamesNeural","en-SG":"en-SG-LunaNeural","en-TZ":"en-TZ-ElimuNeural","en-US":"en-US-JennyNeural","en-ZA":"en-ZA-LeahNeural","es-AR":"es-AR-ElenaNeural","es-BO":"es-BO-MarceloNeural","es-CL":"es-CL-CatalinaNeural","es-CO":"es-CO-GonzaloNeural","es-CR":"es-CR-JuanNeural","es-CU":"es-CU-BelkysNeural","es-DO":"es-DO-EmilioNeural","es-EC":"es-EC-AndreaNeural","es-ES":"es-ES-AlvaroNeural","es-GQ":"es-GQ-JavierNeural","es-GT":"es-GT-AndresNeural","es-HN":"es-HN-CarlosNeural","es-MX":"es-MX-DaliaNeural","es-NI":"es-NI-FedericoNeural","es-PA":"es-PA-MargaritaNeural","es-PE":"es-PE-AlexNeural","es-PR":"es-PR-KarinaNeural","es-PY":"es-PY-MarioNeural","es-SV":"es-SV-LorenaNeural","es-US":"es-US-AlonsoNeural","es-UY":"es-UY-MateoNeural","es-VE":"es-VE-PaolaNeural","et-EE":"et-EE-AnuNeural","fa-IR":"fa-IR-DilaraNeural","fi-FI":"fi-FI-SelmaNeural","fil-PH":"fil-PH-AngeloNeural","fr-BE":"fr-BE-CharlineNeural","fr-CA":"fr-CA-SylvieNeural","fr-CH":"fr-CH-ArianeNeural","fr-FR":"fr-FR-DeniseNeural","ga-IE":"ga-IE-ColmNeural","gl-ES":"gl-ES-RoiNeural","gu-IN":"gu-IN-DhwaniNeural","he-IL":"he-IL-AvriNeural","hi-IN":"hi-IN-MadhurNeural","hr-HR":"hr-HR-GabrijelaNeural","hu-HU":"hu-HU-NoemiNeural","id-ID":"id-ID-ArdiNeural","is-IS":"is-IS-GudrunNeural","it-IT":"it-IT-IsabellaNeural","ja-JP":"ja-JP-NanamiNeural","jv-ID":"jv-ID-DimasNeural","kk-KZ":"kk-KZ-AigulNeural","km-KH":"km-KH-PisethNeural","kn-IN":"kn-IN-GaganNeural","ko-KR":"ko-KR-SunHiNeural","lo-LA":"lo-LA-ChanthavongNeural","lt-LT":"lt-LT-LeonasNeural","lv-LV":"lv-LV-EveritaNeural","mk-MK":"mk-MK-AleksandarNeural","ml-IN":"ml-IN-MidhunNeural","mr-IN":"mr-IN-AarohiNeural","ms-MY":"ms-MY-OsmanNeural","mt-MT":"mt-MT-GraceNeural","my-MM":"my-MM-NilarNeural","nb-NO":"nb-NO-PernilleNeural","nl-BE":"nl-BE-ArnaudNeural","nl-NL":"nl-NL-ColetteNeural","pl-PL":"pl-PL-AgnieszkaNeural","ps-AF":"ps-AF-GulNawazNeural","pt-BR":"pt-BR-FranciscaNeural","pt-PT":"pt-PT-DuarteNeural","ro-RO":"ro-RO-AlinaNeural","ru-RU":"ru-RU-SvetlanaNeural","si-LK":"si-LK-SameeraNeural","sk-SK":"sk-SK-LukasNeural","sl-SI":"sl-SI-PetraNeural","so-SO":"so-SO-MuuseNeural","sr-RS":"sr-RS-NicholasNeural","su-ID":"su-ID-JajangNeural","sv-SE":"sv-SE-SofieNeural","sw-KE":"sw-KE-RafikiNeural","sw-TZ":"sw-TZ-DaudiNeural","ta-IN":"ta-IN-PallaviNeural","ta-LK":"ta-LK-KumarNeural","ta-SG":"ta-SG-AnbuNeural","te-IN":"te-IN-MohanNeural","th-TH":"th-TH-PremwadeeNeural","tr-TR":"tr-TR-AhmetNeural","uk-UA":"uk-UA-OstapNeural","ur-IN":"ur-IN-GulNeural","ur-PK":"ur-PK-AsadNeural","uz-UZ":"uz-UZ-MadinaNeural","vi-VN":"vi-VN-HoaiMyNeural","zh-CN":"zh-CN-XiaoxiaoNeural","zh-HK":"zh-HK-HiuMaanNeural","zh-TW":"zh-TW-HsiaoChenNeural","zu-ZA":"zu-ZA-ThandoNeural"};let i=this.properties.getProperty(h.PropertyId.SpeechServiceConnection_SynthLanguage,"en-US"),r=this.properties.getProperty(h.PropertyId.SpeechServiceConnection_SynthVoice,""),n=u.XMLEncode(e);return this.autoDetectSourceLanguage?i="en-US":r=r||t[i],r&&(n=`<voice name='${r}'>${n}</voice>`),n=`<speak version='1.0' xmlns='http://www.w3.org/2001/10/synthesis' xmlns:mstts='http://www.w3.org/2001/mstts' xmlns:emo='http://www.w3.org/2009/10/emotionml' xml:lang='${i}'>${n}</speak>`,n}dispose(e){return d(this,void 0,void 0,(function*(){this.privDisposed||(e&&this.privAdapter&&(yield this.privAdapter.dispose()),this.privDisposed=!0)}))}adapterSpeak(){return d(this,void 0,void 0,(function*(){if(!this.privDisposed&&!this.privSynthesizing){this.privSynthesizing=!0;const e=yield this.synthesisRequestQueue.dequeue();return this.privAdapter.Speak(e.text,e.isSSML,e.requestId,e.cb,e.err,e.dataStream)}}))}createSynthesizerConfig(e){return new n.SynthesizerConfig(e,this.privProperties)}implCommonSynthesizeSetup(){let e="undefined"!=typeof window?"Browser":"Node",t="unknown",i="unknown";"undefined"!=typeof navigator&&(e=e+"/"+navigator.platform,t=navigator.userAgent,i=navigator.appVersion);const r=this.createSynthesizerConfig(new s.SpeechServiceConfig(new s.Context(new s.OS(e,t,i)))),n=this.privProperties.getProperty(h.PropertyId.SpeechServiceConnection_Key,void 0),c=n&&""!==n?new o.CognitiveSubscriptionKeyAuthentication(n):new a.CognitiveTokenAuthentication((()=>{const e=this.privProperties.getProperty(h.PropertyId.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(e)}),(()=>{const e=this.privProperties.getProperty(h.PropertyId.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(e)}));this.privAdapter=this.createSynthesisAdapter(c,this.privConnectionFactory,r),this.privRestAdapter=this.createRestSynthesisAdapter(c,r)}static XMLEncode(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}}class v{constructor(e,t,i,r,n,s){this.requestId=e,this.text=t,this.isSSML=i,this.cb=r,this.err=n,this.dataStream=s}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SpeechSynthesizer:()=>C});var r=i(107),n=i(175),s=i(177),o=i(18),a=i(9),c=i(37),p=i(34),h=i(33),d=i(36),u=i(224),v=i(4),l=i(35),g=i(59),m=i(39),S=i(226),f=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class C extends u.Synthesizer{constructor(e,t){super(e),null!==t&&(this.audioConfig=void 0===t?"undefined"==typeof window?void 0:v.AudioConfig.fromDefaultSpeakerOutput():t),this.privConnectionFactory=new r.SpeechSynthesisConnectionFactory,this.implCommonSynthesizeSetup()}static FromConfig(e,t,i){const r=e;return t.properties.mergeTo(r.properties),new C(e,i)}speakTextAsync(e,t,i,r){this.speakImpl(e,!1,t,i,r)}speakSsmlAsync(e,t,i,r){this.speakImpl(e,!0,t,i,r)}getVoicesAsync(e=""){return f(this,void 0,void 0,(function*(){return this.getVoices(e)}))}close(e,t){d.Contracts.throwIfDisposed(this.privDisposed),(0,o.marshalPromiseToCallbacks)(this.dispose(!0),e,t)}get internalData(){return this.privAdapter}createSynthesisAdapter(e,t,i){return new n.SpeechSynthesisAdapter(e,t,i,this,this.audioConfig)}createRestSynthesisAdapter(e,t){return new s.SynthesisRestAdapter(t,e)}implCommonSynthesizeSetup(){super.implCommonSynthesizeSetup(),this.privAdapter.audioOutputFormat=p.AudioOutputFormatImpl.fromSpeechSynthesisOutputFormat(l.SpeechSynthesisOutputFormat[this.properties.getProperty(g.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0)])}speakImpl(e,t,i,r,n){try{d.Contracts.throwIfDisposed(this.privDisposed);const s=(0,a.createNoDashGuid)();let o;o=n instanceof m.PushAudioOutputStreamCallback?new h.PushAudioOutputStreamImpl(n):n instanceof h.PullAudioOutputStream?n:void 0!==n?new c.AudioFileWriter(n):void 0,this.synthesisRequestQueue.enqueue(new u.SynthesisRequest(s,e,t,(e=>{if(this.privSynthesizing=!1,i)try{i(e)}catch(e){r&&r(e)}i=void 0,this.adapterSpeak().catch((()=>{}))}),(e=>{r&&r(e)}),o)),this.adapterSpeak().catch((()=>{}))}catch(e){if(r)if(e instanceof Error){const t=e;r(t.name+": "+t.message)}else r(e);this.dispose(!0).catch((()=>{}))}}getVoices(e){return f(this,void 0,void 0,(function*(){const t=(0,a.createNoDashGuid)(),i=yield this.privRestAdapter.getVoicesList(t);if(i.ok&&Array.isArray(i.json)){let r=i.json;return e&&e.length>0&&(r=r.filter((t=>!!t.Locale&&t.Locale.toLowerCase()===e.toLowerCase()))),new S.SynthesisVoicesResult(t,r,void 0)}return new S.SynthesisVoicesResult(t,void 0,`Error: ${i.status}: ${i.statusText}`)}))}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{SynthesisVoicesResult:()=>a});var r=i(152),n=i(57),s=i(60),o=i(227);class a extends r.SynthesisResult{constructor(e,t,i){if(Array.isArray(t)){super(e,n.ResultReason.VoicesListRetrieved,void 0,new s.PropertyCollection),this.privVoices=[];for(const e of t)this.privVoices.push(new o.VoiceInfo(e))}else super(e,n.ResultReason.Canceled,i||"Error information unavailable",new s.PropertyCollection)}get voices(){return this.privVoices}}},(e,t,i)=>{"use strict";var r,n;i.r(t),i.d(t,{SynthesisVoiceGender:()=>r,SynthesisVoiceType:()=>n,VoiceInfo:()=>s}),function(e){e[e.Unknown=0]="Unknown",e[e.Female=1]="Female",e[e.Male=2]="Male"}(r||(r={})),function(e){e[e.OnlineNeural=1]="OnlineNeural",e[e.OnlineStandard=2]="OnlineStandard",e[e.OfflineNeural=3]="OfflineNeural",e[e.OfflineStandard=4]="OfflineStandard"}(n||(n={}));class s{constructor(e){if(this.privStyleList=[],this.privVoicePath="",e&&(this.privName=e.Name,this.privLocale=e.Locale,this.privShortName=e.ShortName,this.privLocaleName=e.LocaleName,this.privDisplayName=e.DisplayName,this.privLocalName=e.LocalName,this.privVoiceType=e.VoiceType.endsWith("Standard")?n.OnlineStandard:n.OnlineNeural,this.privGender="Male"===e.Gender?r.Male:"Female"===e.Gender?r.Female:r.Unknown,e.StyleList&&Array.isArray(e.StyleList)))for(const t of e.StyleList)this.privStyleList.push(t)}get name(){return this.privName}get locale(){return this.privLocale}get shortName(){return this.privShortName}get displayName(){return this.privDisplayName}get localName(){return this.privLocalName}get localeName(){return this.privLocaleName}get gender(){return this.privGender}get voiceType(){return this.privVoiceType}get styleList(){return this.privStyleList}get voicePath(){return this.privVoicePath}}},(e,t,i)=>{"use strict";var r;i.r(t),i.d(t,{SpeechSynthesisBoundaryType:()=>r}),function(e){e.Word="WordBoundary",e.Punctuation="PunctuationBoundary",e.Sentence="SentenceBoundary"}(r||(r={}))},(e,t,i)=>{"use strict";var r;i.r(t),i.d(t,{PronunciationAssessmentGradingSystem:()=>r}),function(e){e[e.FivePoint=1]="FivePoint",e[e.HundredMark=2]="HundredMark"}(r||(r={}))},(e,t,i)=>{"use strict";var r;i.r(t),i.d(t,{PronunciationAssessmentGranularity:()=>r}),function(e){e[e.Phoneme=1]="Phoneme",e[e.Word=2]="Word",e[e.FullText=3]="FullText"}(r||(r={}))},(e,t,i)=>{"use strict";i.r(t),i.d(t,{PronunciationAssessmentConfig:()=>c});var r=i(36),n=i(229),s=i(230),o=i(60),a=i(59);class c{constructor(e,t=n.PronunciationAssessmentGradingSystem.FivePoint,i=s.PronunciationAssessmentGranularity.Phoneme,c=!1){r.Contracts.throwIfNullOrUndefined(e,"referenceText"),this.privProperties=new o.PropertyCollection,this.privProperties.setProperty(a.PropertyId.PronunciationAssessment_ReferenceText,e),this.privProperties.setProperty(a.PropertyId.PronunciationAssessment_GradingSystem,n.PronunciationAssessmentGradingSystem[t]),this.privProperties.setProperty(a.PropertyId.PronunciationAssessment_Granularity,s.PronunciationAssessmentGranularity[i]),this.privProperties.setProperty(a.PropertyId.PronunciationAssessment_EnableMiscue,String(c))}static fromJSON(e){r.Contracts.throwIfNullOrUndefined(e,"json");const t=new c("");return t.privProperties=new o.PropertyCollection,t.properties.setProperty(a.PropertyId.PronunciationAssessment_Json,e),t}toJSON(){return this.updateJson(),this.privProperties.getProperty(a.PropertyId.PronunciationAssessment_Params)}applyTo(e){this.updateJson();const t=e.internalData;t.speechContext.setPronunciationAssessmentParams(this.properties.getProperty(a.PropertyId.PronunciationAssessment_Params),this.privContentAssessmentTopic,t.isSpeakerDiarizationEnabled)}get referenceText(){return this.properties.getProperty(a.PropertyId.PronunciationAssessment_ReferenceText)}set referenceText(e){r.Contracts.throwIfNullOrWhitespace(e,"referenceText"),this.properties.setProperty(a.PropertyId.PronunciationAssessment_ReferenceText,e)}set phonemeAlphabet(e){r.Contracts.throwIfNullOrWhitespace(e,"phonemeAlphabet"),this.privPhonemeAlphabet=e}set enableMiscue(e){const t=e?"true":"false";this.properties.setProperty(a.PropertyId.PronunciationAssessment_EnableMiscue,t)}get enableMiscue(){return"true"===this.properties.getProperty(a.PropertyId.PronunciationAssessment_EnableMiscue,"false").toLowerCase()}set nbestPhonemeCount(e){this.privNBestPhonemeCount=e}set enableProsodyAssessment(e){this.privEnableProsodyAssessment=e}enableContentAssessmentWithTopic(e){this.privContentAssessmentTopic=e}get properties(){return this.privProperties}updateJson(){const e=this.privProperties.getProperty(a.PropertyId.PronunciationAssessment_Json,"{}"),t=JSON.parse(e),i=this.privProperties.getProperty(a.PropertyId.PronunciationAssessment_ReferenceText);i&&(t.referenceText=i);const r=this.privProperties.getProperty(a.PropertyId.PronunciationAssessment_GradingSystem);r&&(t.gradingSystem=r);const n=this.privProperties.getProperty(a.PropertyId.PronunciationAssessment_Granularity);n&&(t.granularity=n),this.privPhonemeAlphabet&&(t.phonemeAlphabet=this.privPhonemeAlphabet),this.privNBestPhonemeCount&&(t.nbestPhonemeCount=this.privNBestPhonemeCount),t.enableProsodyAssessment=this.privEnableProsodyAssessment,t.dimension="Comprehensive";this.privProperties.getProperty(a.PropertyId.PronunciationAssessment_EnableMiscue)&&(t.enableMiscue=this.enableMiscue),this.privProperties.setProperty(a.PropertyId.PronunciationAssessment_Params,JSON.stringify(t))}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ContentAssessmentResult:()=>s,PronunciationAssessmentResult:()=>o});var r=i(36),n=i(59);class s{constructor(e){this.privPronJson=e}get grammarScore(){return this.privPronJson.ContentAssessment.GrammarScore}get vocabularyScore(){return this.privPronJson.ContentAssessment.VocabularyScore}get topicScore(){return this.privPronJson.ContentAssessment.TopicScore}}class o{constructor(e){const t=JSON.parse(e);r.Contracts.throwIfNullOrUndefined(t.NBest[0],"NBest"),this.privPronJson=t.NBest[0]}static fromResult(e){r.Contracts.throwIfNullOrUndefined(e,"result");const t=e.properties.getProperty(n.PropertyId.SpeechServiceResponse_JsonResult);return r.Contracts.throwIfNullOrUndefined(t,"json"),new o(t)}get detailResult(){return this.privPronJson}get accuracyScore(){var e;return null===(e=this.detailResult.PronunciationAssessment)||void 0===e?void 0:e.AccuracyScore}get pronunciationScore(){var e;return null===(e=this.detailResult.PronunciationAssessment)||void 0===e?void 0:e.PronScore}get completenessScore(){var e;return null===(e=this.detailResult.PronunciationAssessment)||void 0===e?void 0:e.CompletenessScore}get fluencyScore(){var e;return null===(e=this.detailResult.PronunciationAssessment)||void 0===e?void 0:e.FluencyScore}get prosodyScore(){var e;return null===(e=this.detailResult.PronunciationAssessment)||void 0===e?void 0:e.ProsodyScore}get contentAssessmentResult(){if(void 0!==this.detailResult.ContentAssessment)return new s(this.detailResult)}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{AvatarConfig:()=>s});var r=i(36),n=i(234);class s{constructor(e,t,i){this.privCustomized=!1,r.Contracts.throwIfNullOrWhitespace(e,"character"),this.character=e,this.style=t,void 0===i&&(i=new n.AvatarVideoFormat),this.videoFormat=i}get customized(){return this.privCustomized}set customized(e){this.privCustomized=e}get backgroundColor(){return this.privBackgroundColor}set backgroundColor(e){this.privBackgroundColor=e}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{AvatarVideoFormat:()=>n,Coordinate:()=>r});class r{constructor(e,t){this.x=e,this.y=t}}class n{constructor(e="H264",t=2e6,i=1920,r=1080){this.codec=e,this.bitrate=t,this.width=i,this.height=r}setCropRange(e,t){this.cropRange={bottomRight:t,topLeft:e}}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{AvatarSynthesizer:()=>m});var r=i(107),n=i(173),s=i(18),o=i(26),a=i(20),c=i(9),p=i(34),h=i(224),d=i(35),u=i(59),v=i(152),l=i(36),g=function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class m extends h.Synthesizer{constructor(e,t){super(e),l.Contracts.throwIfNullOrUndefined(t,"avatarConfig"),this.privConnectionFactory=new r.SpeechSynthesisConnectionFactory,this.privAvatarConfig=t,this.implCommonSynthesizeSetup()}implCommonSynthesizeSetup(){super.implCommonSynthesizeSetup(),this.privAdapter.audioOutputFormat=p.AudioOutputFormatImpl.fromSpeechSynthesisOutputFormat(d.SpeechSynthesisOutputFormat.Riff24Khz16BitMonoPcm)}startAvatarAsync(e){return g(this,void 0,void 0,(function*(){l.Contracts.throwIfNullOrUndefined(e,"peerConnection"),this.privIceServers=e.getConfiguration().iceServers,l.Contracts.throwIfNullOrUndefined(this.privIceServers,"Ice servers must be set.");const t=new s.Deferred;e.onicegatheringstatechange=()=>{o.Events.instance.onEvent(new a.PlatformEvent("peer connection: ice gathering state: "+e.iceGatheringState,a.EventType.Debug)),"complete"===e.iceGatheringState&&(o.Events.instance.onEvent(new a.PlatformEvent("peer connection: ice gathering complete.",a.EventType.Info)),t.resolve())};const i=yield e.createOffer();yield e.setLocalDescription(i),yield t.promise,o.Events.instance.onEvent(new a.PlatformEvent("peer connection: got local SDP.",a.EventType.Info)),this.privProperties.setProperty(u.PropertyId.TalkingAvatarService_WebRTC_SDP,JSON.stringify(e.localDescription));const r=yield this.speak("",!1),n=atob(r.properties.getProperty(u.PropertyId.TalkingAvatarService_WebRTC_SDP)),c=new RTCSessionDescription(JSON.parse(n));return yield e.setRemoteDescription(c),new v.SynthesisResult(r.resultId,r.reason,void 0,r.properties)}))}speakTextAsync(e){return g(this,void 0,void 0,(function*(){const t=yield this.speak(e,!1);return new v.SynthesisResult(t.resultId,t.reason,t.errorDetails,t.properties)}))}speakSsmlAsync(e){return g(this,void 0,void 0,(function*(){const t=yield this.speak(e,!0);return new v.SynthesisResult(t.resultId,t.reason,t.errorDetails,t.properties)}))}stopSpeakingAsync(){return g(this,void 0,void 0,(function*(){return this.privAdapter.stopSpeaking()}))}stopAvatarAsync(){return g(this,void 0,void 0,(function*(){return l.Contracts.throwIfDisposed(this.privDisposed),this.dispose(!0)}))}close(){return g(this,void 0,void 0,(function*(){if(!this.privDisposed)return this.dispose(!0)}))}get iceServers(){return this.privIceServers}createSynthesisAdapter(e,t,i){return new n.AvatarSynthesisAdapter(e,t,i,this,this.privAvatarConfig)}createRestSynthesisAdapter(e,t){}createSynthesizerConfig(e){const t=super.createSynthesizerConfig(e);return t.avatarEnabled=!0,t}speak(e,t){return g(this,void 0,void 0,(function*(){const i=(0,c.createNoDashGuid)(),r=new s.Deferred;return this.synthesisRequestQueue.enqueue(new h.SynthesisRequest(i,e,t,(e=>{r.resolve(e),this.privSynthesizing=!1,this.adapterSpeak()}),(e=>{r.reject(e),this.privSynthesizing=!1}))),this.adapterSpeak(),r.promise}))}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{AvatarWebRTCConnectionResult:()=>n});var r=i(152);class n extends r.SynthesisResult{constructor(e,t,i,r,n){super(t,i,r,n),this.privSDPAnswer=e}get SDPAnswer(){return this.privSDPAnswer}}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{Diagnostics:()=>s});var r=i(238),n=i(26);class s{static SetLoggingLevel(e){this.privListener=new r.ConsoleLoggingListener(e),n.Events.instance.attachConsoleListener(this.privListener)}static StartConsoleOutput(){this.privListener&&(this.privListener.enableConsoleOutput=!0)}static StopConsoleOutput(){this.privListener&&(this.privListener.enableConsoleOutput=!1)}static SetLogOutputPath(e){if("undefined"!=typeof window)throw new Error("File system logging not available in browser.");this.privListener&&(this.privListener.logPath=e)}}s.privListener=void 0},(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConsoleLoggingListener:()=>o});var r=i(239),n=i(20),s=i(36);class o{constructor(e=n.EventType.None){this.privLogPath=void 0,this.privEnableConsoleOutput=!0,this.privLogLevelFilter=e}set logPath(e){s.Contracts.throwIfNullOrUndefined(r.openSync,"\nFile System access not available"),this.privLogPath=e}set enableConsoleOutput(e){this.privEnableConsoleOutput=e}onEvent(e){if(e.eventType>=this.privLogLevelFilter){const t=this.toString(e);if(this.privLogPath&&r.writeFileSync(this.privLogPath,t+"\n",{flag:"a+"}),this.privEnableConsoleOutput)switch(e.eventType){case n.EventType.Debug:console.debug(t);break;case n.EventType.Info:console.info(t);break;case n.EventType.Warning:console.warn(t);break;case n.EventType.Error:console.error(t);break;default:console.log(t)}}}toString(e){const t=[`${e.eventTime}`,`${e.name}`],i=e;for(const r in i)if(r&&e.hasOwnProperty(r)&&"eventTime"!==r&&"eventType"!==r&&"eventId"!==r&&"name"!==r&&"constructor"!==r){const e=i[r];let n="<NULL>";null!=e&&(n="number"==typeof e||"string"==typeof e?e.toString():JSON.stringify(e)),t.push(`${r}: ${n}`)}return t.join(" | ")}}},()=>{}],t={};function i(r){var n=t[r];if(void 0!==n)return n.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,i),s.exports}i.m=e,i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;i.g.importScripts&&(e=i.g.location+"");var t=i.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");r.length&&(e=r[r.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=e})(),i.b=document.baseURI||self.location.href;var r={};(()=>{"use strict";i.r(r);var e=i(1);window.SpeechSDK=e})()})();